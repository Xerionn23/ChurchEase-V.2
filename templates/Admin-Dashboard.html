<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChurchEase - Admin Dashboard</title>
    <link rel="icon" type="image/jpeg" href="{{ url_for('static', filename='ChurchLogo.jpg') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='reservation-styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='dashboard-styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='payment-styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='reservation-onepage.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='calendar-enhancements.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='client-search.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='mobile-responsive.css') }}">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="static/payment-calculator.js"></script>
    
    <!-- Stipendium Tracking Specific Styles -->
    <style>
        /* ============================================================================ */
        /* LOGIN PAGE COLOR PALETTE - APPLIED GLOBALLY */
        /* ============================================================================ */
        :root {
            --primary-dark: #1e3a8a;
            --primary-mid: #0369a1;
            --primary-light: #0891b2;
            --primary-accent: #1e40af;
            --primary-gradient: linear-gradient(135deg, #1e3a8a 0%, #0369a1 50%, #0891b2 100%);
            --primary-gradient-reverse: linear-gradient(135deg, #0891b2 0%, #0369a1 50%, #1e3a8a 100%);
            --primary-shadow: rgba(30, 58, 138, 0.3);
            --primary-glow: rgba(8, 145, 178, 0.1);
            --border-radius-lg: 20px;
            --border-radius-md: 15px;
            --border-radius-sm: 10px;
        }

        /* Enhanced Service Badge Styles for Stipendium Module */
        .service-badge.wedding {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #92400e;
            border: 1px solid #fcd34d;
        }
        
        .service-badge.baptism {
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
        
        .service-badge.funeral {
            background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
            color: #374151;
            border: 1px solid #d1d5db;
        }
        
        .service-badge.confirmation {
            background: linear-gradient(135deg, #c084fc 0%, #a855f7 100%);
            color: #7c2d12;
            border: 1px solid #ddd6fe;
        }
        
        .service-badge.all-services {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: #064e3b;
            border: 1px solid #6ee7b7;
        }
        
        /* Stipendium Filter Pills */
        .payment-filter-tab {
            transition: all 0.3s ease;
            color: #6b7280 !important;
            background: white !important;
            border: 2px solid #e5e7eb !important;
        }
        
        .payment-filter-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            color: var(--primary-dark) !important;
            border-color: var(--primary-light) !important;
        }
        
        .payment-filter-tab.active {
            background: var(--primary-gradient) !important;
            color: white !important;
            box-shadow: 0 4px 12px var(--primary-shadow);
            border-color: transparent !important;
        }
        
        /* Stipendium Table Enhancements */
        #stipendiumTable tbody tr:hover {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        /* Stipendium Summary Cards */
        .report-summary .summary-item {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }
        
        .report-summary .summary-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }
        
        .report-summary .summary-label {
            font-size: 0.875rem;
            color: #64748b;
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .report-summary .summary-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        /* Activity Feed Styles */
        .activity-feed {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .activity-header {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .activity-header h3 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
        }
        
        .activity-filters {
            display: flex;
            gap: 8px;
        }
        
        .filter-btn {
            padding: 6px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            color: #6b7280;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .filter-btn:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }
        
        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .activity-list {
            max-height: 600px;
            overflow-y: auto;
        }
        
        .activity-item {
            padding: 16px 20px;
            border-bottom: 1px solid #f1f5f9;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: background 0.2s;
        }
        
        .activity-item:hover {
            background: #f8fafc;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.875rem;
        }
        
        .activity-content {
            flex: 1;
        }
        
        .activity-title {
            font-weight: 500;
            color: #1f2937;
            margin-bottom: 4px;
        }
        
        .activity-meta {
            display: flex;
            gap: 12px;
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .activity-user {
            font-weight: 500;
        }
        
        .activity-status {
            flex-shrink: 0;
        }
        
        /* Settings Styles */
        .settings-tabs {
            display: flex;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 24px;
        }
        
        .settings-tabs .tab-btn {
            padding: 12px 20px;
            border: none;
            background: none;
            color: #6b7280;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .settings-tabs .tab-btn:hover {
            color: var(--primary-light);
        }
        
        .settings-tabs .tab-btn.active {
            color: var(--primary-light);
            border-bottom-color: var(--primary-light);
        }
        
        .settings-content {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .settings-section {
            margin-bottom: 32px;
        }
        
        .settings-section h3 {
            margin: 0 0 20px 0;
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            margin-bottom: 6px;
            font-weight: 500;
            color: #374151;
            font-size: 0.875rem;
        }
        
        .form-control {
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            transition: border-color 0.2s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 4px var(--primary-glow);
        }
        
        /* Enhanced Module Styles */
        .module-content {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .chart-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .chart-header {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chart-title {
            margin: 0;
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
        }
        
        .chart-container {
            padding: 20px;
            height: 300px;
        }
        
        /* Header Actions Enhancement */
        .header-actions .btn {
            transition: all 0.3s ease;
        }
        
        .header-actions .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            border: none;
            color: white;
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #475569 0%, #334155 100%);
        }
        
        /* Search Input Enhancement */
        #stipendiumSearchInput {
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        #stipendiumSearchInput:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* Chart Container Enhancement */
        .chart-container {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e2e8f0;
        }
        
        /* ============================================================================ */
        /* REPORTS MODULE STYLES */
        /* ============================================================================ */
        
        /* Section Subtitle */
        .section-subtitle {
            color: #64748b;
            font-size: 0.95rem;
            margin-top: 4px;
            font-weight: 400;
        }
        
        /* Chart Cards */
        .chart-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .chart-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .chart-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
        }
        
        /* Chart Legend */
        .chart-legend {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.875rem;
            color: #64748b;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
            flex-shrink: 0;
        }
        
        /* Chart Stats */
        .chart-stats {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }
        
        .stat-item {
            text-align: right;
        }
        
        .stat-number {
            display: block;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            line-height: 1;
        }
        
        .stat-text {
            font-size: 0.75rem;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Reports Table Section */
        .reports-table-section {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 32px;
        }
        
        /* Insights Panel */
        .insights-panel {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 16px;
            padding: 32px;
            border: 1px solid #e2e8f0;
        }
        
        .insight-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .insight-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }
        
        .insight-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
        }
        
        .insight-icon i {
            color: white;
            font-size: 1.25rem;
        }
        
        .insight-title {
            font-size: 1rem;
            font-weight: 600;
            color: #1e293b;
            margin: 0 0 8px 0;
        }
        
        .insight-description {
            font-size: 0.875rem;
            color: #64748b;
            line-height: 1.5;
            margin: 0;
        }
        
        /* Responsive Design for Reports */
        @media (max-width: 1024px) {
            .reports-charts-grid {
                grid-template-columns: 1fr !important;
            }
            
            .chart-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .chart-legend {
                flex-direction: row;
                flex-wrap: wrap;
            }
        }
        
        @media (max-width: 768px) {
            .insights-grid {
                grid-template-columns: 1fr !important;
            }
            
            .chart-card {
                padding: 16px;
            }
            
            .insights-panel {
                padding: 20px;
            }
        }
        
        /* Loading States */
        .loading-shimmer {
            background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }
            100% {
                background-position: 200% 0;
            }
        }
        
        /* Enhanced Filter Selects */
        .filter-select {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 0.875rem;
            color: #374151;
            transition: all 0.3s ease;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* ============================================================================ */
        /* ENHANCED DASHBOARD STYLES */
        /* ============================================================================ */
        
        /* Enhanced Stat Cards */
        .enhanced-card {
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .enhanced-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            border-color: var(--primary);
        }
        
        .stat-background-pattern {
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .enhanced-card:hover .stat-background-pattern {
            opacity: 1;
        }
        
        .stat-progress {
            width: 100%;
            height: 4px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 2px;
            margin-top: 12px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-dark) 0%, var(--primary-light) 100%);
            border-radius: 2px;
            transition: width 1s ease-in-out;
            position: relative;
        }
        
        .progress-bar.success {
            background: linear-gradient(90deg, var(--success) 0%, #059669 100%);
        }
        
        .progress-bar.warning {
            background: linear-gradient(90deg, var(--warning) 0%, #D97706 100%);
        }
        
        .progress-bar.info {
            background: linear-gradient(90deg, var(--info) 0%, #1D4ED8 100%);
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        /* Enhanced Dashboard Widgets */
        .dashboard-widgets {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
            margin-bottom: 32px;
        }
        
        .activity-chart {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 20px;
            padding: 28px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .activity-chart::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }
        
        .activity-chart:hover {
            transform: translateY(-4px);
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.12);
        }
        
        .mini-calendar {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 20px;
            padding: 24px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .mini-calendar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient-reverse);
        }
        
        .mini-calendar:hover {
            transform: translateY(-4px);
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.12);
        }
        
        /* Enhanced Quick Actions */
        .quick-actions {
            margin-bottom: 32px;
        }
        
        .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .quick-action-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .quick-action-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, var(--primary-glow), transparent);
            transition: left 0.5s ease;
        }
        
        .quick-action-card:hover::before {
            left: 100%;
        }
        
        .quick-action-card:hover {
            transform: translateY(-6px) scale(1.03);
            box-shadow: 0 16px 40px rgba(0, 0, 0, 0.15);
            border-color: var(--primary-light);
        }
        
        .quick-action-icon {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }
        
        .quick-action-card:hover .quick-action-icon {
            transform: scale(1.1) rotate(5deg);
        }
        
        .quick-action-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 8px;
        }
        
        .quick-action-desc {
            font-size: 0.875rem;
            color: #64748b;
            line-height: 1.5;
        }
        
        /* Enhanced Reservations Section */
        .reservations-section {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 20px;
            padding: 28px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            margin-bottom: 32px;
            position: relative;
            overflow: hidden;
        }
        
        .reservations-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }
        
        /* Enhanced Calendar Section */
        .calendar-section {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 20px;
            padding: 28px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }
        
        .calendar-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient-reverse);
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .dashboard-widgets {
                grid-template-columns: 1fr;
            }
            
            .quick-actions-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-cards {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
            
            .enhanced-card {
                padding: 20px;
            }
            
            .activity-chart, .mini-calendar, .reservations-section, .calendar-section {
                padding: 20px;
            }
        }
        
        /* Enhanced Header Styles */
        .enhanced-header {
            background: linear-gradient(135deg, #1e3a8a 0%, #0369a1 50%, #0891b2 100%);
            border-radius: 0 0 20px 20px;
            padding: 20px 32px;
            margin-bottom: 24px;
            color: white;
            position: relative;
            overflow: hidden;
            border: none;
            box-shadow: 0 8px 32px rgba(30, 58, 138, 0.3);
        }
        
        .enhanced-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 1;
            width: 100%;
        }
        
        .header-info {
            flex: 1;
        }
        
        .enhanced-header .breadcrumb {
            margin-bottom: 8px;
        }
        
        .enhanced-header .breadcrumb a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
        }
        
        .enhanced-header .breadcrumb i {
            color: rgba(255, 255, 255, 0.6);
            margin: 0 8px;
        }
        
        .enhanced-header .breadcrumb span {
            color: white;
        }
        
        .enhanced-title {
            font-size: 1.4rem;
            font-weight: 600;
            margin: 0 0 4px 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            color: white !important;
        }
        
        .enhanced-subtitle {
            font-size: 0.875rem;
            opacity: 0.9;
            margin: 0;
            color: rgba(255, 255, 255, 0.9) !important;
        }
        
        
        /* Override default header styles */
        .enhanced-header .menu-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 12px;
            border-radius: 10px;
            margin-right: 20px;
            transition: all 0.3s ease;
        }
        
        .enhanced-header .menu-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        @media (max-width: 768px) {
            .enhanced-header {
                padding: 16px 20px;
            }
            
            .header-content {
                flex-direction: row;
                align-items: center;
            }
            
            .enhanced-header .menu-toggle {
                margin-right: 16px;
            }
            
            .enhanced-title {
                font-size: 1.2rem;
            }
            
            .enhanced-subtitle {
                font-size: 0.8rem;
            }
        }

        /* ============================================================================ */
        /* SIDEBAR & NAVIGATION - LOGIN PAGE COLORS */
        /* ============================================================================ */
        .sidebar {
            background: var(--primary-gradient);
            box-shadow: 4px 0 20px var(--primary-shadow);
        }

        .sidebar-header {
            background: rgba(255, 255, 255, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .sidebar .logo-text {
            color: white !important;
            font-weight: 700 !important;
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.9) !important;
        }

        .nav-link.active {
            background: rgba(255, 255, 255, 0.2) !important;
            border-left: 4px solid white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            color: white !important;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.15) !important;
            color: white !important;
        }

        .nav-link i {
            color: rgba(255, 255, 255, 0.9) !important;
        }

        .nav-link.active i {
            color: white !important;
        }

        .nav-text {
            color: rgba(255, 255, 255, 0.9) !important;
        }

        .nav-link.active .nav-text {
            color: white !important;
        }

        .nav-category {
            color: rgba(255, 255, 255, 0.7) !important;
            font-weight: 600 !important;
        }

        .nav-badge {
            background: white !important;
            color: var(--primary-dark) !important;
            box-shadow: 0 2px 8px rgba(255, 255, 255, 0.3);
            font-weight: 700 !important;
        }

        .user-name, .user-role {
            color: white !important;
        }

        .user-avatar {
            background: white !important;
            color: var(--primary-dark) !important;
            font-weight: 700 !important;
        }

        /* BUTTONS - LOGIN PAGE COLORS */
        .btn-primary, .btn.btn-primary {
            background: var(--primary-gradient) !important;
            border: none !important;
            color: white !important;
            border-radius: var(--border-radius-md) !important;
            padding: 12px 24px !important;
            font-weight: 600 !important;
            box-shadow: 0 4px 12px var(--primary-shadow) !important;
            transition: all 0.3s ease !important;
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before, .btn.btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover::before, .btn.btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover, .btn.btn-primary:hover {
            background: var(--primary-gradient-reverse) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 20px var(--primary-shadow) !important;
        }

        /* STAT CARDS - LOGIN PAGE COLORS */
        .stat-icon.primary {
            background: var(--primary-gradient) !important;
            box-shadow: 0 4px 12px var(--primary-shadow) !important;
            color: white !important;
        }
        
        .stat-icon.primary i {
            color: white !important;
        }
        
        .stat-icon.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3) !important;
            color: white !important;
        }
        
        .stat-icon.success i {
            color: white !important;
        }
        
        .stat-icon.warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%) !important;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3) !important;
            color: white !important;
        }
        
        .stat-icon.warning i {
            color: white !important;
        }
        
        .stat-icon.info {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%) !important;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3) !important;
            color: white !important;
        }
        
        .stat-icon.info i {
            color: white !important;
        }

        /* MODALS - LOGIN PAGE COLORS */
        .modal-header {
            background: var(--primary-gradient) !important;
            border-radius: var(--border-radius-md) var(--border-radius-md) 0 0 !important;
        }

        /* BADGES & PILLS */
        .badge-primary, .status-badge.approved, .status-badge.confirmed {
            background: var(--primary-gradient) !important;
            box-shadow: 0 2px 8px var(--primary-glow) !important;
        }

        /* LINKS & HOVER STATES */
        a:hover {
            color: var(--primary-dark) !important;
        }

        /* FOCUS STATES */
        input:focus, select:focus, textarea:focus {
            border-color: var(--primary-light) !important;
            box-shadow: 0 0 0 4px var(--primary-glow) !important;
        }

        /* TABLES */
        table thead {
            background: var(--primary-gradient) !important;
            color: white !important;
        }

        table thead th {
            color: white !important;
            font-weight: 600 !important;
        }

        table tbody {
            background: white !important;
        }

        table tbody td {
            color: #1f2937 !important;
        }

        /* TABS */
        .tab-active, .nav-tabs .nav-link.active {
            border-bottom: 3px solid var(--primary-light) !important;
            color: var(--primary-dark) !important;
            font-weight: 600 !important;
        }

        .nav-tabs .nav-link {
            color: #6b7280 !important;
        }

        .nav-tabs .nav-link:hover {
            color: var(--primary-dark) !important;
        }

        /* LOADING STATES */
        .spinner-border, .loading-spinner {
            border-color: var(--primary-light) !important;
            border-right-color: transparent !important;
        }

        /* CARDS HOVER */
        .card:hover, .stat-card:hover {
            border-color: var(--primary-light) !important;
            box-shadow: 0 8px 25px var(--primary-glow) !important;
        }

        /* SECTION TITLES & HEADINGS */
        .section-title, .chart-title, .card-title, h1, h2, h3, h4, h5, h6 {
            color: #1f2937 !important;
        }

        /* BREADCRUMBS */
        .breadcrumb {
            color: rgba(255, 255, 255, 0.9) !important;
        }

        .breadcrumb a {
            color: rgba(255, 255, 255, 0.8) !important;
        }

        .breadcrumb a:hover {
            color: white !important;
        }

        /* STAT CARDS TEXT */
        .stat-label {
            color: #6b7280 !important;
        }
        
        /* USER MANAGEMENT FILTER PILLS */
        .filter-pill:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(8, 145, 178, 0.2);
        }
        
        .filter-pill.active {
            background: linear-gradient(135deg, #0891b2, #0e7490) !important;
            border-color: #0891b2 !important;
            color: white !important;
        }
        
        .filter-pill:not(.active):hover {
            border-color: #0891b2 !important;
            color: #0891b2 !important;
        }
        
        /* SEARCH CONTAINER */
        .search-container {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .search-input:focus {
            border-color: #0891b2 !important;
            outline: none;
            box-shadow: 0 0 0 3px rgba(8, 145, 178, 0.1);
        }
        
        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(8, 145, 178, 0.3);
        }
        
        /* RESET PASSWORD MODAL INPUTS */
        #resetPasswordModal input[type="password"]:focus {
            border-color: #0891b2 !important;
            outline: none;
            box-shadow: 0 0 0 3px rgba(8, 145, 178, 0.15);
        }
        
        #resetPasswordModal .toggle-password:hover {
            color: #0891b2;
        }

        .stat-value {
            color: #1f2937 !important;
            font-weight: 700 !important;
        }

        .stat-sublabel {
            color: #9ca3af !important;
        }

        /* DROPDOWN MENUS */
        .dropdown-item {
            color: #1f2937 !important;
        }

        .dropdown-item:hover {
            background: var(--primary-glow) !important;
            color: var(--primary-dark) !important;
        }

        /* FORM LABELS */
        label, .form-label {
            color: #374151 !important;
            font-weight: 500 !important;
        }

        /* MODAL TEXT */
        .modal-body {
            color: #1f2937 !important;
        }

        .modal-title {
            color: white !important;
        }

        /* CALENDAR TEXT */
        .fc-toolbar-title {
            color: white !important;
        }

        .fc-daygrid-day-number {
            color: #1f2937 !important;
        }

        /* FILTER BUTTONS */
        .filter-btn {
            color: #6b7280 !important;
        }

        .filter-btn.active {
            color: white !important;
            background: var(--primary-gradient) !important;
        }

        .filter-btn:hover {
            color: var(--primary-dark) !important;
        }

        /* ACTIVITY FEED TEXT */
        .activity-title {
            color: #1f2937 !important;
            font-weight: 600 !important;
        }

        .activity-meta, .activity-user, .activity-time {
            color: #6b7280 !important;
        }

        /* PREVIEW CARD TEXT */
        .preview-label {
            color: #6b7280 !important;
        }

        .preview-value {
            color: #1f2937 !important;
            font-weight: 600 !important;
        }

        /* QUICK ACTION TEXT */
        .quick-action-title {
            color: #1f2937 !important;
            font-weight: 600 !important;
        }

        .quick-action-desc {
            color: #6b7280 !important;
        }

        /* INSIGHT CARD TEXT */
        .insight-title {
            color: #1f2937 !important;
            font-weight: 600 !important;
        }

        .insight-description {
            color: #6b7280 !important;
        }

        /* REPORT SUMMARY TEXT */
        .summary-label {
            color: #6b7280 !important;
        }

        .summary-value {
            color: var(--primary-dark) !important;
            font-weight: 700 !important;
        }

        /* CHART LEGEND TEXT */
        .legend-item {
            color: #6b7280 !important;
        }

        /* SETTINGS TEXT */
        .settings-section h3 {
            color: #1f2937 !important;
        }

        /* BUTTON TEXT - ENSURE WHITE */
        .btn-primary, .btn-primary:hover, .btn-primary:focus, .btn-primary:active {
            color: white !important;
        }

        /* SECONDARY BUTTONS */
        .btn-secondary {
            background: #f3f4f6 !important;
            color: #374151 !important;
            border: 2px solid #e5e7eb !important;
        }

        .btn-secondary:hover {
            background: #e5e7eb !important;
            color: #1f2937 !important;
            border-color: var(--primary-light) !important;
        }

        /* SEARCH INPUT TEXT */
        .search-input, .form-input, input, select, textarea {
            color: #1f2937 !important;
        }

        .search-input::placeholder, .form-input::placeholder, 
        input::placeholder, select::placeholder, textarea::placeholder {
            color: #9ca3af !important;
        }

        /* TOOLTIP TEXT */
        .nav-tooltip {
            background: rgba(0, 0, 0, 0.9) !important;
            color: white !important;
        }

        /* TREND INDICATORS */
        .stat-trend {
            color: #10b981 !important;
        }

        .stat-trend.trend-down {
            color: #ef4444 !important;
        }

        /* CARD HEADERS */
        .card-header h4, .card-header h3 {
            color: #1f2937 !important;
        }

        /* PAGINATION TEXT */
        .pagination .page-link {
            color: #6b7280 !important;
        }

        .pagination .page-link:hover {
            color: var(--primary-dark) !important;
            background: var(--primary-glow) !important;
        }

        .pagination .page-link.active {
            background: var(--primary-gradient) !important;
            color: white !important;
            border-color: transparent !important;
        }
    </style>
</head>
<body>
    <!-- Modern Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <img src="{{ url_for('static', filename='ChurchLogo.jpg') }}" alt="Church Logo" class="logo-image">
                <span class="logo-text">ChurchEase</span>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        <nav class="nav-menu">
            <div class="nav-category">Admin Menu</div>
            <div class="nav-item">
                <a href="#dashboard" class="nav-link active" data-page="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span class="nav-text">Dashboard</span>
                    <span class="nav-tooltip">Dashboard Overview</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#user-management" class="nav-link" data-page="user-management">
                    <i class="fas fa-users-cog"></i>
                    <span class="nav-text">User Management</span>
                    <span class="nav-badge" id="userCountBadge">0</span>
                    <span class="nav-tooltip">Manage System Users</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#reservations-overview" class="nav-link" data-page="reservations-overview">
                    <i class="fas fa-calendar-check"></i>
                    <span class="nav-text">Reservations</span>
                    <span class="nav-badge" id="pendingReservationsBadge">0</span>
                    <span class="nav-tooltip">View All Reservations</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#events" class="nav-link" data-page="events">
                    <i class="fas fa-calendar-day"></i>
                    <span class="nav-text">Events</span>
                    <span class="nav-tooltip">View Event History</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#calendar" class="nav-link" data-page="calendar">
                    <i class="fas fa-calendar-alt"></i>
                    <span class="nav-text">Calendar</span>
                    <span class="nav-tooltip">View Calendar</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#financial-reports" class="nav-link" data-page="financial-reports">
                    <i class="fas fa-chart-bar"></i>
                    <span class="nav-text">Reports</span>
                    <span class="nav-tooltip">Reports & Analytics</span>
                </a>
            </div>
            <!-- User Profile Section - Positioned at Bottom -->
            <div class="nav-item user-profile-nav">
                <div class="nav-link" style="position: relative; cursor: pointer;" id="sidebarUserProfile">
                    <div class="user-avatar">{{ user.full_name[0] if user.full_name else 'A' }}{{ user.full_name.split()[1][0] if user.full_name and ' ' in user.full_name else 'D' }}</div>
                    <div class="nav-text user-info">
                        <div class="user-name">{{ user.full_name or 'Administrator' }}</div>
                        <div class="user-role">{{ (user.role or 'admin').title() }}</div>
                    </div>
                    <i class="fas fa-chevron-up" style="margin-left: auto; font-size: 12px; color: rgba(255,255,255,0.7); transition: transform 0.3s;" id="dropdownArrow"></i>
                    <span class="nav-tooltip">Profile</span>
                </div>
                <!-- User Dropdown for Sidebar -->
                <div class="user-dropdown sidebar-dropdown" id="sidebarUserDropdown" style="display: none;">
                    <div class="dropdown-header">
                        <div class="dropdown-user-info">
                            <div class="dropdown-avatar">{{ user.full_name[0] if user.full_name else 'A' }}{{ user.full_name.split()[1][0] if user.full_name and ' ' in user.full_name else 'D' }}</div>
                            <div class="dropdown-user-details">
                                <div class="dropdown-user-name">{{ user.full_name or 'Administrator' }}</div>
                                <div class="dropdown-user-email">{{ user.email or 'admin@churchease.com' }}</div>
                            </div>
                        </div>
                    </div>
                    <a href="#" class="dropdown-item" id="myProfileBtn">
                        <i class="fas fa-user-circle"></i>
                        <span>My Profile</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="/" class="dropdown-item">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </a>
                </div>
            </div>
        </nav>
    </aside>
    
    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <div class="content-wrapper">
            <!-- Enhanced Top Header with Welcome Banner Design -->
            <header class="top-header enhanced-header">
                <div class="header-content">
                    <div class="header-left">
                        <button class="menu-toggle" id="menuToggle">
                            <i class="fas fa-bars"></i>
                        </button>
                        <div class="header-info">
                            <div class="breadcrumb">
                                <a href="#">Home</a>
                                <i class="fas fa-chevron-right"></i>
                                <span id="breadcrumb-current">Dashboard</span>
                            </div>
                            <h1 class="page-title enhanced-title">Good Morning, Administrator! ðŸ‘‹</h1>
                            <p class="page-subtitle enhanced-subtitle">Here's what's happening with your church operations today</p>
                        </div>
                    </div>
                </div>
            </header>

        <!-- Dashboard Content -->
        <div id="dashboardContent">
            <!-- Simple Dashboard Overview Cards -->
            <div class="dashboard-cards" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px;">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon primary">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="dashTotalReservations">0</div>
                    <div class="stat-label">Total Reservations</div>
                    <div class="stat-sublabel">All time</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon warning">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="dashPendingApprovals">0</div>
                    <div class="stat-label">Pending Approvals</div>
                    <div class="stat-sublabel">Needs attention</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon info">
                            <i class="fas fa-church"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="dashTotalPriests">0</div>
                    <div class="stat-label" id="dashPriestsLabel">Priests</div>
                    <div class="stat-sublabel" id="dashPriestsNames">Loading...</div>
                </div>
            </div>

            <!-- Dashboard Charts -->
            <div class="charts-section" style="margin-top: 32px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 24px;">
                    <!-- Monthly Approved Reservations Chart -->
                    <div style="background: white; border-radius: 16px; padding: 24px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 1px solid #e2e8f0;">
                        <h3 style="margin: 0 0 20px 0; color: #1e293b; font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-chart-line" style="color: #002b5c;"></i>
                            Monthly Approved Reservations
                        </h3>
                        <canvas id="monthlyReservationsChart" style="max-height: 300px;"></canvas>
                    </div>
                    
                    <!-- Service Type Distribution Chart -->
                    <div style="background: white; border-radius: 16px; padding: 24px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 1px solid #e2e8f0;">
                        <h3 style="margin: 0 0 20px 0; color: #1e293b; font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-chart-pie" style="color: #002b5c;"></i>
                            Service Type Distribution
                        </h3>
                        <canvas id="serviceDistributionChart" style="max-height: 300px;"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Events Module -->
        <div id="eventsModule" class="module-content" style="display: none; padding: 0 24px;">
            <!-- Events Header -->
            <div class="section-header" style="margin-bottom: 32px;">
                <div class="header-actions" style="display: flex; gap: 12px; align-items: center;">
                    <button class="btn btn-primary" id="refreshEventsBtn">
                        <i class="fas fa-sync-alt"></i>
                        Refresh Events
                    </button>
                </div>
            </div>
            
            <!-- Search and Filters -->
            <div class="search-and-filters" style="margin-bottom: 24px; background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); padding: 20px; border-radius: 12px; border: 1px solid #cbd5e1;">
                <!-- Search Bar -->
                <div class="search-container" style="margin-bottom: 16px;">
                    <div class="search-input-wrapper" style="position: relative; flex: 1;">
                        <i class="fas fa-search search-icon" style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: #64748b;"></i>
                        <input type="text" id="eventSearchInput" class="search-input" placeholder="Search events by title, description, or secretary..." style="width: 100%; padding: 12px 16px 12px 45px; border: 2px solid #cbd5e1; border-radius: 8px; font-size: 14px; background: white;">
                        <button class="clear-search" id="clearEventSearch" style="display: none; position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #94a3b8; cursor: pointer;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Quick Filters -->
                <div class="quick-filters">
                    <div class="filter-pills" style="display: flex; gap: 12px; flex-wrap: wrap;">
                        <button class="filter-pill active event-filter-tab" data-filter="all" style="padding: 10px 20px; border-radius: 8px; border: 2px solid #0891b2; background: linear-gradient(135deg, #0891b2, #0e7490); color: white; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.3s;">
                            <i class="fas fa-calendar-day"></i>
                            All Events
                        </button>
                        <button class="filter-pill event-filter-tab" data-filter="upcoming" style="padding: 10px 20px; border-radius: 8px; border: 2px solid #cbd5e1; background: white; color: #475569; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.3s;">
                            <i class="fas fa-clock"></i>
                            Upcoming
                        </button>
                        <button class="filter-pill event-filter-tab" data-filter="past" style="padding: 10px 20px; border-radius: 8px; border: 2px solid #cbd5e1; background: white; color: #475569; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.3s;">
                            <i class="fas fa-history"></i>
                            Past Events
                        </button>
                    </div>
                </div>
            </div>

            <!-- Events Table -->
            <div class="events-table-section" style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #e2e8f0;">
                <div class="table-container">
                    <table class="data-table" id="eventsTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>EVENT TITLE</th>
                                <th>EVENT DATE</th>
                                <th>SECRETARY</th>
                                <th>CREATED AT</th>
                                <th>ACTIONS</th>
                            </tr>
                        </thead>
                        <tbody id="eventsTableBody">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 40px;">
                                    <i class="fas fa-spinner fa-spin" style="font-size: 24px; color: #6b7280;"></i>
                                    <p style="margin-top: 12px; color: #6b7280;">Loading events...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Calendar Module -->
        <div id="calendarModule" class="module-content" style="display: none;">
            <div class="calendar-reservation-container">
                <!-- Calendar Header -->
                <div class="calendar-header" style="margin-bottom: 10px;">
                    <div class="calendar-title-section">
                        <h3 class="calendar-title" style="font-size: 18px; margin-bottom: 5px;">
                            <i class="fas fa-calendar-alt"></i>
                            Church Events Calendar
                        </h3>
                        <p class="calendar-subtitle" style="font-size: 13px; margin-bottom: 0;">View all confirmed church reservations and events</p>
                    </div>
                    
                    <!-- Filters and Refresh Button -->
                    <div class="calendar-controls" style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                        <!-- Type Filter (Events/Reservations) -->
                        <div class="type-filter">
                            <label style="font-size: 13px; font-weight: 600; color: #334155;">Type:</label>
                            <select id="adminTypeFilter" style="font-size: 13px; padding: 6px 12px; border-radius: 6px; border: 2px solid #e2e8f0; background: white; color: #334155; font-weight: 500; cursor: pointer; transition: all 0.2s;">
                                <option value="all">All (Events + Reservations)</option>
                                <option value="reservations">Reservations Only</option>
                                <option value="events">Events Only</option>
                            </select>
                        </div>
                        
                        <!-- Service Filter -->
                        <div class="service-filter">
                            <label style="font-size: 13px; font-weight: 600; color: #334155;">Service:</label>
                            <select id="adminServiceFilter" style="font-size: 13px; padding: 6px 12px; border-radius: 6px; border: 2px solid #e2e8f0; background: white; color: #334155; font-weight: 500; cursor: pointer; transition: all 0.2s;">
                                <option value="all">All Services</option>
                                <option value="wedding">Wedding</option>
                                <option value="baptism">Baptism</option>
                                <option value="funeral">Funeral</option>
                                <option value="confirmation">Confirmation</option>
                            </select>
                        </div>
                        
                        <button id="refreshAdminCalendarBtn" class="refresh-btn" style="font-size: 13px; padding: 8px 16px; border-radius: 6px; background: linear-gradient(135deg, #002b5c, #0d1b2a); color: white; border: none; cursor: pointer; font-weight: 600; transition: all 0.2s; display: flex; align-items: center; gap: 6px;">
                            <i class="fas fa-sync-alt"></i>
                            <span>Refresh</span>
                        </button>
                        
                        <button id="printAdminCalendarBtn" class="print-btn" style="font-size: 13px; padding: 8px 16px; border-radius: 6px; background: linear-gradient(135deg, #228b22, #1a6b1a); color: white; border: none; cursor: pointer; font-weight: 600; transition: all 0.2s; display: flex; align-items: center; gap: 6px;">
                            <i class="fas fa-print"></i>
                            <span>Print</span>
                        </button>
                    </div>
                </div>

                <!-- Admin Calendar Container -->
                <div id="adminCalendar" class="calendar-container" style="background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);"></div>

                <!-- Calendar Legend -->
                <div class="calendar-legend" style="margin-top: 8px; padding: 6px; background: #f8f9fa; border-radius: 6px; border: 1px solid #e9ecef;">
                    <div class="legend-items" style="display: flex; flex-wrap: wrap; gap: 12px; justify-content: center;">
                        <div class="legend-item" style="font-size: 11px;">
                            <div class="legend-color available" style="width: 10px; height: 10px;"></div>
                            <span>Available</span>
                        </div>
                        <div class="legend-item" style="font-size: 11px;">
                            <div class="legend-color wedding" style="width: 10px; height: 10px;"></div>
                            <span>Wedding</span>
                        </div>
                        <div class="legend-item" style="font-size: 11px;">
                            <div class="legend-color baptism" style="width: 10px; height: 10px;"></div>
                            <span>Baptism</span>
                        </div>
                        <div class="legend-item" style="font-size: 11px;">
                            <div class="legend-color funeral" style="width: 10px; height: 10px;"></div>
                            <span>Funeral</span>
                        </div>
                        <div class="legend-item" style="font-size: 11px;">
                            <div class="legend-color confirmation" style="width: 10px; height: 10px;"></div>
                            <span>Confirmation</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Enhanced Dashboard JavaScript -->
        <script>
            // Initialize AOS (Animate On Scroll)
            // Enhanced Dashboard Functionality
            document.addEventListener('DOMContentLoaded', function() {
                if (!dashboardInitialized) {
                    // Animate stat values on load
                    animateStatValues();
                    
                    // Initialize enhanced chart
                    initializeEnhancedChart();
                    
                    // Add interactive quick actions
                    initializeQuickActions();
                    
                    // Add real-time clock
                    initializeRealTimeClock();
                    
                    dashboardInitialized = true;
                }
            });
            
            // Animate stat values with counting effect
            function animateStatValues() {
                const statValues = [
                    { element: 'totalReservations', target: 247, duration: 2000 },
                    { element: 'approvedReservations', target: 189, duration: 2200 },
                    { element: 'pendingApprovals', target: 23, duration: 1800 },
                    { element: 'activeMembers', target: 456, duration: 2400 }
                ];
                
                statValues.forEach(stat => {
                    const element = document.getElementById(stat.element);
                    if (element) {
                        animateValue(element, 0, stat.target, stat.duration);
                    }
                });
            }
            
            function animateValue(element, start, end, duration) {
                const startTime = performance.now();
                const startValue = start;
                const endValue = end;
                
                function updateValue(currentTime) {
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    // Easing function for smooth animation
                    const easeOutCubic = 1 - Math.pow(1 - progress, 3);
                    const currentValue = Math.floor(startValue + (endValue - startValue) * easeOutCubic);
                    
                    element.textContent = currentValue.toLocaleString();
                    
                    if (progress < 1) {
                        requestAnimationFrame(updateValue);
                    }
                }
                
                requestAnimationFrame(updateValue);
            }
            
            // Global chart variables for cleanup
            let activityChartInstance = null;
            let financialRevenueChartInstance = null;
            let dashboardInitialized = false;
            let dashboardDataLoaded = false;
            let financialReportsInitialized = false;
            
            // Initialize enhanced chart with gradient colors
            function initializeEnhancedChart() {
                const ctx = document.getElementById('activityChart');
                if (ctx) {
                    // Destroy existing chart if it exists
                    if (activityChartInstance) {
                        activityChartInstance.destroy();
                    }
                    
                    const gradient = ctx.getContext('2d').createLinearGradient(0, 0, 0, 400);
                    gradient.addColorStop(0, 'rgba(59, 130, 246, 0.8)');
                    gradient.addColorStop(1, 'rgba(59, 130, 246, 0.1)');
                    
                    activityChartInstance = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                            datasets: [{
                                label: 'Reservations',
                                data: [12, 19, 15, 25, 22, 30, 28],
                                borderColor: '#3b82f6',
                                backgroundColor: gradient,
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4,
                                pointBackgroundColor: '#ffffff',
                                pointBorderColor: '#3b82f6',
                                pointBorderWidth: 3,
                                pointRadius: 6,
                                pointHoverRadius: 8
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: 'rgba(0, 0, 0, 0.05)'
                                    },
                                    ticks: {
                                        color: '#64748b'
                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    },
                                    ticks: {
                                        color: '#64748b'
                                    }
                                }
                            },
                            interaction: {
                                intersect: false,
                                mode: 'index'
                            }
                        }
                    });
                }
            }
            
            // Initialize AOS animations with click handlers
            function initializeQuickActions() {
                const quickActionCards = document.querySelectorAll('.quick-action-card');
                
                quickActionCards.forEach(card => {
                    card.addEventListener('click', function() {
                        const action = this.getAttribute('data-action');
                        handleQuickAction(action);
                        
                        // Add click animation
                        this.style.transform = 'scale(0.95)';
                        setTimeout(() => {
                            this.style.transform = '';
                        }, 150);
                    });
                });
            }
            
            function handleQuickAction(action) {
                switch(action) {
                    case 'new-reservation':
                        // Navigate to reservations management
                        document.querySelector('[data-page="reservations-management"]').click();
                        break;
                    case 'approve-pending':
                        // Show pending approvals
                        showNotification('Showing pending approvals...', 'info');
                        break;
                    case 'view-calendar':
                        // Scroll to calendar section
                        document.querySelector('.calendar-section').scrollIntoView({ behavior: 'smooth' });
                        break;
                    case 'export-data':
                        // Trigger data export
                        showNotification('Preparing data export...', 'success');
                        break;
                }
            }
            
            // Add real-time clock to header
            function initializeRealTimeClock() {
                const headerRight = document.querySelector('.header-right');
                if (headerRight) {
                    const clockElement = document.createElement('div');
                    clockElement.className = 'real-time-clock';
                    clockElement.style.cssText = `
                        font-family: 'Poppins', sans-serif;
                        font-weight: 500;
                        color: #64748b;
                        font-size: 0.875rem;
                        padding: 8px 16px;
                        background: rgba(255, 255, 255, 0.8);
                        border-radius: 8px;
                        border: 1px solid #e2e8f0;
                    `;
                    headerRight.appendChild(clockElement);
                    
                    function updateClock() {
                        const now = new Date();
                        const options = {
                            weekday: 'short',
                            year: 'numeric',
                            month: 'short',
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit'
                        };
                        clockElement.textContent = now.toLocaleDateString('en-US', options);
                    }
                    
                    updateClock();
                    setInterval(updateClock, 1000);
                }
            }
            
            // Notification system
            function showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 16px 24px;
                    background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
                    color: white;
                    border-radius: 8px;
                    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
                    z-index: 1000;
                    font-family: 'Poppins', sans-serif;
                    font-weight: 500;
                    transform: translateX(100%);
                    transition: transform 0.3s ease;
                `;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                // Animate in
                setTimeout(() => {
                    notification.style.transform = 'translateX(0)';
                }, 100);
                
                // Remove after 3 seconds
                setTimeout(() => {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            }
        </script>
        
        <!-- User Management Module -->
        <div id="userManagementModule" class="module-content" style="display: none; padding: 0 24px;">
            <!-- User Management Header -->
            <div class="section-header" style="margin-bottom: 32px;">
                <div class="header-actions" style="display: flex; gap: 12px; align-items: center;">
                    <button class="btn btn-primary" id="addUserBtn">
                        <i class="fas fa-user-plus"></i>
                        Add New User
                    </button>
                </div>
            </div>
            
            <!-- Search and Filters -->
            <div class="search-and-filters" style="margin-bottom: 24px; background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); padding: 20px; border-radius: 12px; border: 1px solid #cbd5e1;">
                <!-- Search Bar -->
                <div class="search-container" style="margin-bottom: 16px;">
                    <div class="search-input-wrapper" style="position: relative; flex: 1;">
                        <i class="fas fa-search search-icon" style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: #64748b;"></i>
                        <input type="text" id="userSearchInput" class="search-input" placeholder="Search users by name, username, or email..." style="width: 100%; padding: 12px 16px 12px 45px; border: 2px solid #cbd5e1; border-radius: 8px; font-size: 14px; background: white;">
                        <button class="clear-search" id="clearUserSearch" style="display: none; position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #94a3b8; cursor: pointer;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="refresh-controls" style="margin-left: 12px;">
                        <button class="refresh-btn" id="refreshUsersBtn" title="Refresh Users" style="padding: 12px 20px; background: linear-gradient(135deg, #0891b2, #0e7490); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px; transition: all 0.3s;">
                            <i class="fas fa-sync-alt"></i>
                            <span>Refresh</span>
                        </button>
                    </div>
                </div>
                
                <!-- Quick Filters -->
                <div class="quick-filters">
                    <div class="filter-pills" style="display: flex; gap: 12px; flex-wrap: wrap;">
                        <button class="filter-pill active role-filter-tab" data-filter="all" style="padding: 10px 20px; border-radius: 8px; border: 2px solid #0891b2; background: linear-gradient(135deg, #0891b2, #0e7490); color: white; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.3s;">
                            <i class="fas fa-users"></i>
                            All Users
                        </button>
                        <button class="filter-pill role-filter-tab" data-filter="admin" style="padding: 10px 20px; border-radius: 8px; border: 2px solid #cbd5e1; background: white; color: #475569; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.3s;">
                            <i class="fas fa-user-shield"></i>
                            Administrators
                        </button>
                        <button class="filter-pill role-filter-tab" data-filter="secretary" style="padding: 10px 20px; border-radius: 8px; border: 2px solid #cbd5e1; background: white; color: #475569; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.3s;">
                            <i class="fas fa-user-tie"></i>
                            Secretaries
                        </button>
                        <button class="filter-pill role-filter-tab" data-filter="priest" style="padding: 10px 20px; border-radius: 8px; border: 2px solid #cbd5e1; background: white; color: #475569; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.3s;">
                            <i class="fas fa-pray"></i>
                            Priests
                        </button>
                    </div>
                </div>
            </div>

            <!-- Users Table -->
            <div class="users-table-section" style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #e2e8f0;">
                <div class="table-container">
                    <table class="data-table" id="usersTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>USERNAME</th>
                                <th>FULL NAME</th>
                                <th>EMAIL</th>
                                <th>ROLE</th>
                                <th>STATUS</th>
                                <th>CREATED AT</th>
                                <th>ACTIONS</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <tr>
                                <td>#001</td>
                                <td>Administrator</td>
                                <td>admin</td>
                                <td>admin@churchease.com</td>
                                <td><span class="status-badge status-confirmed">Admin</span></td>
                                <td><span class="status-badge status-confirmed">Active</span></td>
                                <td>Jan 15, 2024</td>
                                <td class="table-actions">
                                    <button class="action-btn" data-action="view" data-user-id="001" title="View Details">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="action-btn" data-action="edit" data-user-id="001" title="Edit User">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn" data-action="reset-password" data-user-id="001" title="Reset Password">
                                        <i class="fas fa-key"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>#002</td>
                                <td>Maria Santos</td>
                                <td>maria.santos</td>
                                <td>maria.santos@churchease.com</td>
                                <td><span class="status-badge status-pending">Secretary</span></td>
                                <td><span class="status-badge status-confirmed">Active</span></td>
                                <td>Feb 10, 2024</td>
                                <td class="table-actions">
                                    <button class="action-btn" data-action="view" data-user-id="002" title="View Details">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="action-btn" data-action="edit" data-user-id="002" title="Edit User">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn" data-action="reset-password" data-user-id="002" title="Reset Password">
                                        <i class="fas fa-key"></i>
                                    </button>
                                    <button class="action-btn action-btn-danger" data-action="delete" data-user-id="002" title="Delete User">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>#003</td>
                                <td>Ana Reyes</td>
                                <td>ana.reyes</td>
                                <td>ana.reyes@churchease.com</td>
                                <td><span class="status-badge status-pending">Secretary</span></td>
                                <td><span class="status-badge status-confirmed">Active</span></td>
                                <td>Feb 15, 2024</td>
                                <td class="table-actions">
                                    <button class="action-btn" data-action="view" data-user-id="003" title="View Details">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="action-btn" data-action="edit" data-user-id="003" title="Edit User">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn" data-action="reset-password" data-user-id="003" title="Reset Password">
                                        <i class="fas fa-key"></i>
                                    </button>
                                    <button class="action-btn action-btn-danger" data-action="delete" data-user-id="003" title="Delete User">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>#004</td>
                                <td>Carmen Garcia</td>
                                <td>carmen.garcia</td>
                                <td>carmen.garcia@churchease.com</td>
                                <td><span class="status-badge status-pending">Secretary</span></td>
                                <td><span class="status-badge status-confirmed">Active</span></td>
                                <td>Mar 01, 2024</td>
                                <td class="table-actions">
                                    <button class="action-btn" data-action="view" data-user-id="004" title="View Details">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="action-btn" data-action="edit" data-user-id="004" title="Edit User">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn" data-action="reset-password" data-user-id="004" title="Reset Password">
                                        <i class="fas fa-key"></i>
                                    </button>
                                    <button class="action-btn action-btn-danger" data-action="delete" data-user-id="004" title="Delete User">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>#005</td>
                                <td>Father Antonio Rodriguez</td>
                                <td>father.antonio</td>
                                <td>father.antonio@churchease.com</td>
                                <td><span class="status-badge status-info">Priest</span></td>
                                <td><span class="status-badge status-confirmed">Active</span></td>
                                <td>Jan 20, 2024</td>
                                <td class="table-actions">
                                    <button class="action-btn" data-action="view" data-user-id="005" title="View Details">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="action-btn" data-action="edit" data-user-id="005" title="Edit User">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn" data-action="reset-password" data-user-id="005" title="Reset Password">
                                        <i class="fas fa-key"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Priest Management Module -->
        <div id="priestManagementModule" class="module-content" style="display: none;">
            <!-- Priest Management Header -->
            <div class="section-header" style="margin-bottom: 32px;">
                <div class="header-actions" style="display: flex; gap: 12px; align-items: center;">
                    <h2 class="section-title">Priest Management</h2>
                    <button class="btn btn-primary" id="addPriestBtn">
                        <i class="fas fa-plus"></i>
                        Add New Priest
                    </button>
                    <button class="btn btn-secondary" id="refreshPriestsBtn">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
                <p class="section-subtitle">Manage church priests and their service assignments</p>
            </div>

            <!-- Priests Table -->
            <div class="table-container">
                <div class="table-header">
                    <div class="table-title">
                        <h3>All Priests</h3>
                        <span class="table-count" id="priestsCount">Loading...</span>
                    </div>
                    <div class="search-input-wrapper">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="priestSearchInput" class="search-input" placeholder="Search priests by name or specialization...">
                        <button class="clear-search" id="clearPriestSearch" style="display: none;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <table class="data-table" id="priestsTable">
                    <thead>
                        <tr>
                            <th>Priest Name</th>
                            <th>Email</th>
                            <th>Specialization</th>
                            <th>Status</th>
                            <th>Date Added</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="priestsTableBody">
                        <!-- Priest data will be loaded dynamically from database -->
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px; color: #6b7280;">
                                <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 16px;"></i>
                                <p>Loading priests data...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Events Module -->
        <div id="eventsModule" class="module-content" style="display: none;">
            <!-- Action Bar -->
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                <div class="flex flex-col sm:flex-row gap-3">
                    <button class="bg-white hover:bg-gray-50 text-gray-700 border border-gray-200 px-6 py-3 rounded-xl font-semibold transition-all duration-200 shadow-sm hover:shadow-md flex items-center gap-2" id="refreshEventsBtn">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
            </div>


            <!-- Main Content Layout -->
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                <!-- Events Calendar - Main Content -->
                <div class="lg:col-span-3">
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                        <!-- Calendar Body -->
                        <div class="p-6">
                            <div class="calendar-reservation-container">
                                <!-- Calendar Header -->
                                <div class="calendar-header" style="margin-bottom: 10px;">
                                    <div class="calendar-title-section">
                                        <h3 class="calendar-title" style="font-size: 18px; margin-bottom: 5px;">
                                            <i class="fas fa-calendar-alt"></i>
                                            Church Events Calendar
                                        </h3>
                                        <p class="calendar-subtitle" style="font-size: 13px; margin-bottom: 0;">View all confirmed church events and reservations</p>
                                    </div>
                                    
                                    <!-- Service Filter and Refresh Button -->
                                    <div class="calendar-controls">
                                        <div class="service-filter">
                                            <label style="font-size: 13px;">Filter by Service:</label>
                                            <select id="eventsServiceFilter" class="form-select" style="font-size: 13px; padding: 6px 10px;">
                                                <option value="all">All Services</option>
                                                <option value="wedding">Wedding</option>
                                                <option value="baptism">Baptism</option>
                                                <option value="funeral">Funeral</option>
                                                <option value="confirmation">Confirmation</option>
                                            </select>
                                        </div>
                                        <button class="refresh-btn calendar-refresh-btn" id="refreshEventsBtn" title="Refresh Events Calendar">
                                            <i class="fas fa-sync-alt"></i>
                                            <span>Refresh</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- FullCalendar Container -->
                                <div id="eventsFullCalendar" class="full-calendar-container"></div>

                                <!-- Calendar Legend -->
                                <div class="calendar-legend" style="margin-top: 8px; padding: 6px; gap: 8px;">
                                    <div class="legend-item" style="font-size: 11px;">
                                        <div class="legend-color available" style="width: 10px; height: 10px;"></div>
                                        <span>Available</span>
                                    </div>
                                    <div class="legend-item" style="font-size: 11px;">
                                        <div class="legend-color wedding" style="width: 10px; height: 10px;"></div>
                                        <span>Wedding</span>
                                    </div>
                                    <div class="legend-item" style="font-size: 11px;">
                                        <div class="legend-color baptism" style="width: 10px; height: 10px;"></div>
                                        <span>Baptism</span>
                                    </div>
                                    <div class="legend-item" style="font-size: 11px;">
                                        <div class="legend-color funeral" style="width: 10px; height: 10px;"></div>
                                        <span>Funeral</span>
                                    </div>
                                    <div class="legend-item" style="font-size: 11px;">
                                        <div class="legend-color confirmation" style="width: 10px; height: 10px;"></div>
                                        <span>Confirmation</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="lg:col-span-1 space-y-6">
                    <!-- Quick Actions -->
                    <div class="bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl p-6 text-white">
                        <h4 class="text-lg font-bold mb-4 flex items-center gap-2">
                            <i class="fas fa-bolt"></i>
                            Quick Actions
                        </h4>
                        <div class="space-y-3">
                            <button class="w-full bg-white bg-opacity-20 hover:bg-opacity-30 backdrop-blur-sm text-white px-4 py-3 rounded-xl font-medium transition-all duration-200 flex items-center gap-2" onclick="document.getElementById('refreshEventsBtn').click()">
                                <i class="fas fa-sync-alt"></i>
                                Refresh
                            </button>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                        <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <i class="fas fa-filter text-blue-600"></i>
                            Filter Events
                        </h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Event Type</label>
                                <select class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-white text-sm" id="eventTypeFilter">
                                    <option value="">All Types</option>
                                    <option value="service">Church Service</option>
                                    <option value="meeting">Meeting</option>
                                    <option value="social">Social Event</option>
                                    <option value="fundraiser">Fundraiser</option>
                                    <option value="education">Education</option>
                                    <option value="outreach">Outreach</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Status</label>
                                <select class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-white text-sm" id="eventStatusFilter">
                                    <option value="">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="upcoming">Upcoming</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Upcoming Events -->
                    <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                        <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <i class="fas fa-calendar-check text-green-600"></i>
                            Upcoming Events
                        </h4>
                        <div class="space-y-3" id="upcomingEventsList">
                            <!-- Events will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Reservations Management Module -->
        <div id="reservationsManagementModule" class="module-content" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">Reservations Management</h2>
                <button class="btn btn-primary">
                    <i class="fas fa-plus"></i>
                    New Reservation
                </button>
            </div>
            
            <!-- Reservation Stats Cards -->
            <div class="dashboard-cards">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon primary">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <span class="stat-trend trend-up" id="reservationsMgmt-growth">+0%</span>
                    </div>
                    <div class="stat-value" id="reservationsMgmt-total">Loading...</div>
                    <div class="stat-label">Total Reservations</div>
                    <div class="stat-sublabel">All time</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon warning">
                            <i class="fas fa-hourglass-half"></i>
                        </div>
                        <span class="stat-trend">-</span>
                    </div>
                    <div class="stat-value" id="reservationsMgmt-pending">Loading...</div>
                    <div class="stat-label">Pending Approval</div>
                    <div class="stat-sublabel">Awaiting review</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon success">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <span class="stat-trend">-</span>
                    </div>
                    <div class="stat-value" id="reservationsMgmt-confirmed">Loading...</div>
                    <div class="stat-label">Confirmed</div>
                    <div class="stat-sublabel">This month</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon info">
                            <i class="fas fa-calendar-week"></i>
                        </div>
                        <span class="stat-trend">-</span>
                    </div>
                    <div class="stat-value" id="reservationsMgmt-thisWeek">Loading...</div>
                    <div class="stat-label">This Week</div>
                    <div class="stat-sublabel">Upcoming events</div>
                </div>
            </div>

            <!-- Recent Reservations Table -->
            <div class="reservations-section">
                <div class="section-header">
                    <h2 class="section-title">Recent Reservations</h2>
                    <button class="refresh-btn">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
                
                <!-- Search Filter -->
                <div style="margin-bottom: 20px; display: flex; gap: 12px; align-items: center;">
                    <div style="position: relative; flex: 1; max-width: 500px;">
                        <i class="fas fa-search" style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: #9ca3af; font-size: 14px;"></i>
                        <input 
                            type="text" 
                            id="adminReservationSearch" 
                            placeholder="Search by client name, phone, service type, or ID..." 
                            style="width: 100%; padding: 12px 16px 12px 45px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 14px; transition: all 0.3s ease; background: white;"
                            onfocus="this.style.borderColor='#0891b2'; this.style.boxShadow='0 0 0 3px rgba(8, 145, 178, 0.1)'"
                            onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'"
                        >
                        <button 
                            id="adminClearSearch" 
                            style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #9ca3af; cursor: pointer; padding: 4px 8px; display: none; transition: color 0.2s;"
                            onmouseover="this.style.color='#ef4444'"
                            onmouseout="this.style.color='#9ca3af'"
                        >
                            <i class="fas fa-times-circle"></i>
                        </button>
                    </div>
                    <div style="color: #6b7280; font-size: 14px; font-weight: 500;">
                        <span id="adminSearchResultCount"></span>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Client Name</th>
                                <th>Service</th>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Priest</th>
                                <th>Status</th>
                                <th>Created By</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="recentReservationsTableBody">
                            <tr>
                                <td colspan="9" style="text-align: center; padding: 40px;">
                                    <i class="fas fa-spinner fa-spin" style="font-size: 24px; color: #6b7280;"></i>
                                    <p style="margin-top: 12px; color: #6b7280;">Loading recent reservations...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Reports Module -->
        <div id="financialReportsModule" class="module-content" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">Reports & Analytics</h2>
                <p style="color: #6b7280; margin-top: 8px;">Comprehensive reports and analytics for church operations</p>
            </div>
            
            <!-- Summary Statistics Cards -->
            <div class="dashboard-cards" style="margin-top: 24px;">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon primary">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <span class="stat-trend trend-up">+12%</span>
                    </div>
                    <div class="stat-value" id="reportTotalReservations">247</div>
                    <div class="stat-label">Total Reservations</div>
                    <div class="stat-sublabel">This year</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon success">
                            <i class="fas fa-peso-sign"></i>
                        </div>
                        <span class="stat-trend trend-up">+8%</span>
                    </div>
                    <div class="stat-value" id="reportTotalRevenue">â‚±1,245,000</div>
                    <div class="stat-label">Total Stipendium</div>
                    <div class="stat-sublabel">All collections</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon warning">
                            <i class="fas fa-clock"></i>
                        </div>
                        <span class="stat-trend">-</span>
                    </div>
                    <div class="stat-value" id="reportPendingApprovals">23</div>
                    <div class="stat-label">Pending Approvals</div>
                    <div class="stat-sublabel">Needs attention</div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="dashboard-widgets" style="margin-top: 32px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px;">
                <!-- Monthly Reservations Chart -->
                <div class="activity-chart" style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <div class="section-header" style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: flex-start;">
                        <div>
                            <h3 class="section-title" style="font-size: 1.125rem;">Monthly Approved Reservations</h3>
                            <p style="font-size: 0.875rem; color: #6b7280; margin-top: 4px;">Priest-approved reservations only</p>
                        </div>
                        <button class="btn btn-sm btn-secondary" onclick="printChart('reportsMonthlyReservationsChart', 'Monthly Approved Reservations')" style="padding: 6px 12px; font-size: 0.875rem;">
                            <i class="fas fa-print"></i> Print
                        </button>
                    </div>
                    <div class="chart-container" style="position: relative; height: 300px;">
                        <canvas id="reportsMonthlyReservationsChart"></canvas>
                    </div>
                </div>

                <!-- Service Type Distribution Chart -->
                <div class="activity-chart" style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <div class="section-header" style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: flex-start;">
                        <div>
                            <h3 class="section-title" style="font-size: 1.125rem;">Service Type Distribution</h3>
                        </div>
                        <button class="btn btn-sm btn-secondary" onclick="printChart('reportsServiceDistributionChart', 'Service Type Distribution')" style="padding: 6px 12px; font-size: 0.875rem;">
                            <i class="fas fa-print"></i> Print
                        </button>
                    </div>
                    <div class="chart-container" style="position: relative; height: 300px;">
                        <canvas id="reportsServiceDistributionChart"></canvas>
                    </div>
                </div>

                <!-- Stipendium Trends Chart -->
                <div class="activity-chart" style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <div class="section-header" style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: flex-start;">
                        <div>
                            <h3 class="section-title" style="font-size: 1.125rem;">Stipendium Trends</h3>
                        </div>
                        <button class="btn btn-sm btn-secondary" onclick="printChart('reportsRevenueTrendsChart', 'Stipendium Trends')" style="padding: 6px 12px; font-size: 0.875rem;">
                            <i class="fas fa-print"></i> Print
                        </button>
                    </div>
                    <div class="chart-container" style="position: relative; height: 300px;">
                        <canvas id="reportsRevenueTrendsChart"></canvas>
                    </div>
                </div>
                
                <!-- Attendance Rate Chart -->
                <div class="activity-chart" style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <div class="section-header" style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: flex-start;">
                        <div>
                            <h3 class="section-title" style="font-size: 1.125rem;">Attendance Rate</h3>
                        </div>
                        <button class="btn btn-sm btn-secondary" onclick="printChart('reportsAttendanceRateChart', 'Attendance Rate')" style="padding: 6px 12px; font-size: 0.875rem;">
                            <i class="fas fa-print"></i> Print
                        </button>
                    </div>
                    <div class="chart-container" style="position: relative; height: 300px;">
                        <canvas id="reportsAttendanceRateChart"></canvas>
                    </div>
                </div>
            </div>

        </div>

        <!-- Reports Module -->
        <div id="reportsModule" class="module-content" style="display: none;">
            <!-- Reports Header -->
            <div class="section-header" style="margin-bottom: 32px;">
                <div class="header-actions" style="display: flex; gap: 12px;">
                    <button class="btn btn-secondary" id="exportReportsBtn">
                        <i class="fas fa-file-export"></i>
                        Export All Data
                    </button>
                    <button class="btn btn-primary" id="refreshReportsBtn">
                        <i class="fas fa-sync-alt"></i>
                        Refresh Reports
                    </button>
                </div>
            </div>

            <!-- Summary Statistics Cards -->
            <div class="dashboard-cards fade-in">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon primary">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <span class="stat-trend trend-up" id="reservations-growth">+0%</span>
                    </div>
                    <div class="stat-value" id="total-reservations">Loading...</div>
                    <div class="stat-label">Total Reservations</div>
                    <div class="stat-sublabel">All time</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon success">
                            <i class="fas fa-peso-sign"></i>
                        </div>
                        <span class="stat-trend trend-up" id="revenue-growth">+0%</span>
                    </div>
                    <div class="stat-value" id="total-revenue">Loading...</div>
                    <div class="stat-label">Total Revenue</div>
                    <div class="stat-sublabel">From payments</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon warning">
                            <i class="fas fa-hourglass-half"></i>
                        </div>
                        <span class="stat-trend trend-down" id="pending-growth">0%</span>
                    </div>
                    <div class="stat-value" id="pending-approvals">Loading...</div>
                    <div class="stat-label">Pending Approvals</div>
                    <div class="stat-sublabel">Requires action</div>
                </div>
            </div>

            <!-- Charts Grid -->
            <div class="reports-charts-grid" style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px; margin-bottom: 32px;">
                <!-- Monthly Reservations Chart -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Monthly Reservations Trend</h3>
                        <select class="filter-select" id="monthlyReservationsFilter">
                            <option value="year">This Year</option>
                            <option value="6months">Last 6 Months</option>
                            <option value="3months">Last 3 Months</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="reportsModule2MonthlyReservationsChart"></canvas>
                    </div>
                </div>

                <!-- Service Distribution -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Service Distribution</h3>
                        <div class="chart-legend">
                            <div class="legend-item">
                                <span class="legend-color" style="background: #fbbf24;"></span>
                                <span>Wedding</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color" style="background: #60a5fa;"></span>
                                <span>Baptism</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color" style="background: #9ca3af;"></span>
                                <span>Funeral</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color" style="background: #c084fc;"></span>
                                <span>Confirmation</span>
                            </div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="reportsModule2ServiceDistributionChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Revenue and Payment Charts -->
            <div class="reports-charts-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 32px;">
                <!-- Revenue Trends -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Revenue Trends</h3>
                        <select class="filter-select" id="revenueTrendsFilter">
                            <option value="6months">Last 6 Months</option>
                            <option value="year">This Year</option>
                            <option value="3months">Last 3 Months</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="reportsModule2RevenueTrendsChart"></canvas>
                    </div>
                </div>

                <!-- Stipendium Status -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Stipendium Status Overview</h3>
                        <div class="chart-stats">
                            <div class="stat-item">
                                <span class="stat-number" id="payment-completion-rate">0%</span>
                                <span class="stat-text">Completion Rate</span>
                            </div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="paymentStatusChart"></canvas>
                    </div>
                </div>
            </div>

        </div>

        <!-- Reservations Overview Module -->
        <div id="reservationsOverviewModule" class="module-content" style="display: none;">
            <div class="section-header" style="margin-bottom: 32px;">
                <h2 class="section-title">Reservations Overview</h2>
                <div class="header-actions" style="display: flex; gap: 12px;">
                    <button class="btn btn-primary" id="refreshReservationsOverviewBtn">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
            </div>

            <!-- Reservations Summary Cards -->
            <div class="dashboard-cards fade-in" style="margin-bottom: 32px;">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon primary">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="overview-total-reservations">Loading...</div>
                    <div class="stat-label">Total Reservations</div>
                    <div class="stat-sublabel">All time</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon success">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="overview-approved-reservations">Loading...</div>
                    <div class="stat-label">Approved</div>
                    <div class="stat-sublabel">Confirmed bookings</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon warning">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="overview-pending-reservations">Loading...</div>
                    <div class="stat-label">Pending</div>
                    <div class="stat-sublabel">Awaiting approval</div>
                </div>
            </div>

            <!-- Search Filter for Reservations Overview -->
            <div style="margin-bottom: 20px; display: flex; gap: 12px; align-items: center;">
                <div style="position: relative; flex: 1; max-width: 500px;">
                    <i class="fas fa-search" style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: #9ca3af; font-size: 14px;"></i>
                    <input 
                        type="text" 
                        id="overviewReservationSearch" 
                        placeholder="Search by client name, phone, service type, or ID..." 
                        style="width: 100%; padding: 12px 16px 12px 45px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 14px; transition: all 0.3s ease; background: white;"
                        onfocus="this.style.borderColor='#0891b2'; this.style.boxShadow='0 0 0 3px rgba(8, 145, 178, 0.1)'"
                        onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'"
                    >
                    <button 
                        id="overviewClearSearch" 
                        style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #9ca3af; cursor: pointer; padding: 4px 8px; display: none; transition: color 0.2s;"
                        onmouseover="this.style.color='#ef4444'"
                        onmouseout="this.style.color='#9ca3af'"
                    >
                        <i class="fas fa-times-circle"></i>
                    </button>
                </div>
                <div style="color: #6b7280; font-size: 14px; font-weight: 500;">
                    <span id="overviewSearchResultCount"></span>
                </div>
            </div>

            <!-- Reservations Table -->
            <div class="table-container">
                <table class="data-table" id="reservationsOverviewTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Client Name</th>
                            <th>Service Type</th>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Assigned Priest</th>
                            <th>Status</th>
                            <th>Stipendium</th>
                            <th>Attendance</th>
                            <th>Created By</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="reservationsOverviewTableBody">
                        <tr>
                            <td colspan="11" style="text-align: center; padding: 40px;">
                                <i class="fas fa-spinner fa-spin" style="font-size: 24px; color: #6b7280;"></i>
                                <p style="margin-top: 12px; color: #6b7280;">Loading reservations...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Financial Reports Module -->
        <div id="financialReportsModule" class="module-content" style="display: none;">
            <div class="section-header" style="margin-bottom: 32px;">
                <h2 class="section-title">Financial Reports</h2>
                <div class="header-actions" style="display: flex; gap: 12px;">
                    <button class="btn btn-secondary" id="exportFinancialBtn">
                        <i class="fas fa-file-export"></i>
                        Export Report
                    </button>
                    <button class="btn btn-primary" id="refreshFinancialBtn">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
            </div>

            <!-- Financial Summary Cards -->
            <div class="dashboard-cards fade-in" style="margin-bottom: 32px;">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon success">
                            <i class="fas fa-peso-sign"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="financial-total-revenue">Loading...</div>
                    <div class="stat-label">Total Revenue</div>
                    <div class="stat-sublabel">All payments</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon info">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="financial-monthly-revenue">Loading...</div>
                    <div class="stat-label">This Month</div>
                    <div class="stat-sublabel">Current month revenue</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon warning">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="financial-pending-payments">Loading...</div>
                    <div class="stat-label">Pending Stipendium</div>
                    <div class="stat-sublabel">Outstanding amounts</div>
                </div>
            </div>

            <!-- Revenue Chart -->
            <div class="chart-card" style="margin-bottom: 32px;">
                <div class="chart-header">
                    <h3 class="chart-title">Monthly Revenue Trends</h3>
                    <select class="filter-select" id="financialRevenueFilter">
                        <option value="6months">Last 6 Months</option>
                        <option value="year">This Year</option>
                        <option value="3months">Last 3 Months</option>
                    </select>
                </div>
                <div class="chart-container">
                    <canvas id="financialRevenueChart"></canvas>
                </div>
            </div>
        </div>

        <!-- System Activity Module -->
        <div id="systemActivityModule" class="module-content" style="display: none;">
            <div class="section-header" style="margin-bottom: 32px;">
                <h2 class="section-title">System Activity</h2>
                <div class="header-actions" style="display: flex; gap: 12px;">
                    <button class="btn btn-secondary" id="exportActivityBtn">
                        <i class="fas fa-file-export"></i>
                        Export Log
                    </button>
                    <button class="btn btn-primary" id="refreshActivityBtn">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
            </div>

            <!-- Activity Feed -->
            <div class="activity-feed">
                <div class="activity-header">
                    <h3>Recent Activities</h3>
                    <div class="activity-filters">
                        <button class="filter-btn active" data-filter="all">All</button>
                        <button class="filter-btn" data-filter="reservation">Reservations</button>
                        <button class="filter-btn" data-filter="user">Users</button>
                        <button class="filter-btn" data-filter="payment">Payments</button>
                    </div>
                </div>
                <div class="activity-list" id="activityList">
                    <div style="text-align: center; padding: 40px;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 24px; color: #6b7280;"></i>
                        <p style="margin-top: 12px; color: #6b7280;">Loading activities...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Module -->
        <div id="settingsModule" class="module-content" style="display: none;">
            <div class="section-header" style="margin-bottom: 32px;">
                <h2 class="section-title">System Settings</h2>
                <div class="header-actions" style="display: flex; gap: 12px;">
                    <button class="btn btn-primary" id="saveSettingsBtn">
                        <i class="fas fa-save"></i>
                        Save Changes
                    </button>
                </div>
            </div>

            <!-- Settings Tabs -->
            <div class="settings-tabs">
                <button class="tab-btn active" data-tab="general">
                    <i class="fas fa-cog"></i>
                    General
                </button>
                <button class="tab-btn" data-tab="email">
                    <i class="fas fa-envelope"></i>
                    Email
                </button>
                <button class="tab-btn" data-tab="security">
                    <i class="fas fa-shield-alt"></i>
                    Security
                </button>
            </div>

            <!-- Settings Content -->
            <div class="settings-content">
                <div class="settings-section">
                    <h3>Church Information</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Church Name</label>
                            <input type="text" class="form-control" value="ChurchEase Parish" />
                        </div>
                        <div class="form-group">
                            <label>Contact Email</label>
                            <input type="email" class="form-control" value="admin@churchease.com" />
                        </div>
                        <div class="form-group">
                            <label>Phone Number</label>
                            <input type="tel" class="form-control" value="+63 123 456 7890" />
                        </div>
                        <div class="form-group">
                            <label>Address</label>
                            <textarea class="form-control" rows="3">123 Church Street, City, Province</textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reservation Module -->
        <div id="reservationModule" class="module-content" style="display: none;">
            
            <!-- Tab Navigation -->
            <div class="reservation-tabs">
                <button class="tab-btn active" data-tab="all-reservations">
                    <i class="fas fa-list"></i>
                    All Reservations
                </button>
                <button class="tab-btn" data-tab="add-reservation">
                    <i class="fas fa-plus"></i>
                    Add Reservation
                </button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- All Reservations Tab -->
                <div id="all-reservations" class="tab-pane active">
                    <!-- Search and Filters -->
                    <div class="search-and-filters">
                        <!-- Search Bar and Refresh -->
                        <div class="search-container">
                            <div class="search-input-wrapper">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" id="nameSearchInput" class="search-input" placeholder="Search by client name...">
                                <button class="clear-search" id="clearSearch" style="display: none;">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="refresh-controls">
                                <button class="refresh-btn" id="refreshReservations" title="Refresh Reservations">
                                    <i class="fas fa-sync-alt"></i>
                                    <span>Refresh</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Quick Filters -->
                        <div class="quick-filters">
                            <div class="filter-pills">
                                <button class="filter-pill active service-filter-tab" data-filter="all">
                                    <i class="fas fa-border-all"></i>
                                    All Services
                                </button>
                                <button class="filter-pill service-filter-tab" data-filter="wedding">
                                    <i class="fas fa-ring"></i>
                                    Wedding (Kasal)
                                </button>
                                <button class="filter-pill service-filter-tab" data-filter="baptism">
                                    <i class="fas fa-baby"></i>
                                    Baptism (Binyag)
                                </button>
                                <button class="filter-pill service-filter-tab" data-filter="funeral">
                                    <i class="fas fa-cross"></i>
                                    Funeral (Burol)
                                </button>
                                <button class="filter-pill service-filter-tab" data-filter="confirmation">
                                    <i class="fas fa-praying-hands"></i>
                                    Confirmation (Kumpil)
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Reservations Table -->
                    <div class="reservations-table-container">
                        <table class="reservations-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Service Type</th>
                                    <th>Client Name</th>
                                    <th class="sortable-header" data-sort="date">
                                        Date & Time
                                        <span class="sort-arrows">
                                            <i class="fas fa-sort sort-icon" data-direction="none"></i>
                                        </span>
                                    </th>
                                    <th>Status</th>
                                    <th>Stipendium</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="reservationsTableBody">
                                <!-- Reservations will be loaded from database -->
                            </tbody>
                        </table>
                    </div>
                </div>


                <!-- Add Reservation Tab -->
                <div id="add-reservation" class="tab-pane">
                    <div class="calendar-reservation-container">
                        <!-- Calendar Header -->
                        <div class="calendar-header" style="margin-bottom: 10px;">
                            <div class="calendar-title-section">
                                <h3 class="calendar-title" style="font-size: 18px; margin-bottom: 5px;">
                                    <i class="fas fa-calendar-plus"></i>
                                    Church Reservation Calendar
                                </h3>
                                <p class="calendar-subtitle" style="font-size: 13px; margin-bottom: 0;">Click on any available date to make a reservation</p>
                            </div>
                            
                            <!-- Service Filter and Refresh Button -->
                            <div class="calendar-controls">
                                <div class="service-filter">
                                    <label style="font-size: 13px;">Filter by Service:</label>
                                    <select id="calendarServiceFilter" class="form-select" style="font-size: 13px; padding: 6px 10px;">
                                        <option value="all">All Services</option>
                                        <option value="wedding">Wedding</option>
                                        <option value="baptism">Baptism</option>
                                        <option value="funeral">Funeral</option>
                                        <option value="confirmation">Confirmation</option>
                                    </select>
                                </div>
                                <button class="refresh-btn calendar-refresh-btn" id="refreshCalendar" title="Refresh Calendar">
                                    <i class="fas fa-sync-alt"></i>
                                    <span>Refresh</span>
                                </button>
                            </div>
                        </div>

                        <!-- FullCalendar Container -->
                        <div id="fullCalendar" class="full-calendar-container"></div>

                        <!-- Calendar Legend -->
                        <div class="calendar-legend" style="margin-top: 8px; padding: 6px; gap: 8px;">
                            <div class="legend-item" style="font-size: 11px;">
                                <div class="legend-color available" style="width: 10px; height: 10px;"></div>
                                <span>Available</span>
                            </div>
                            <div class="legend-item" style="font-size: 11px;">
                                <div class="legend-color wedding" style="width: 10px; height: 10px;"></div>
                                <span>Wedding</span>
                            </div>
                            <div class="legend-item" style="font-size: 11px;">
                                <div class="legend-color baptism" style="width: 10px; height: 10px;"></div>
                                <span>Baptism</span>
                            </div>
                            <div class="legend-item" style="font-size: 11px;">
                                <div class="legend-color funeral" style="width: 10px; height: 10px;"></div>
                                <span>Funeral</span>
                            </div>
                            <div class="legend-item" style="font-size: 11px;">
                                <div class="legend-color confirmation" style="width: 10px; height: 10px;"></div>
                                <span>Confirmation</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>



                <!-- Date Details Modal -->
                <div class="date-details-modal" id="dateDetailsModal" style="display: none;">
                    <div class="modal-overlay"></div>
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title" id="dateModalTitle">Reservations for March 15, 2025</h4>
                            <button class="modal-close" id="dateModalClose">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <!-- Time Slots Grid -->
                            <div class="time-slots-section">
                                <h5>Available Time Slots</h5>
                                <div class="time-slots-grid" id="timeSlotsGrid">
                                    <!-- Time slots will be populated dynamically -->
                                </div>
                            </div>
                            
                            <!-- Existing Reservations -->
                            <div class="existing-reservations" id="existingReservations">
                                <h5>Existing Reservations</h5>
                                <div class="reservations-list" id="reservationsList">
                                    <!-- Existing reservations will be populated dynamically -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reservation Form Modal -->
                <div class="reservation-form-modal" id="reservationFormModal" style="display: none;">
                    <div class="modal-overlay"></div>
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title" id="formModalTitle">Make Reservation</h4>
                            <button class="modal-close" id="formModalClose">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="reservationForm">
                                <!-- Service Selection -->
                                <div class="form-section">
                                    <h5>Service Type</h5>
                                    <div class="service-selection">
                                        <div class="service-option" data-service="wedding">
                                            <i class="fas fa-ring"></i>
                                            <span>Wedding</span>
                                        </div>
                                        <div class="service-option" data-service="baptism">
                                            <i class="fas fa-water"></i>
                                            <span>Baptism</span>
                                        </div>
                                        <div class="service-option" data-service="funeral">
                                            <i class="fas fa-cross"></i>
                                            <span>Funeral</span>
                                        </div>
                                        <div class="service-option" data-service="confirmation">
                                            <i class="fas fa-hands-praying"></i>
                                            <span>Confirmation</span>
                                        </div>
                                    </div>
                                    <input type="hidden" id="selectedService" name="service_type" required>
                                </div>

                                <!-- Date and Time -->
                                <div class="form-section">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>Date</label>
                                            <input type="date" id="reservationDate" name="date" readonly required>
                                        </div>
                                        <div class="form-group">
                                            <label>Time Slot</label>
                                            <input type="text" id="reservationTime" name="time_slot" readonly required>
                                        </div>
                                    </div>
                                </div>

                                <!-- Client Search/Auto-fill -->
                                <div class="form-section">
                                    <h5>Client Information</h5>
                                    <div class="form-group">
                                        <label>Search Existing Client</label>
                                        <div class="client-search-container">
                                            <input type="text" id="clientSearch" placeholder="Search by name, phone, or email..." autocomplete="off">
                                            <div class="search-results" id="searchResults" style="display: none;"></div>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>First Name *</label>
                                            <input type="text" id="contactFirstName" name="contact_first_name" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Last Name *</label>
                                            <input type="text" id="contactLastName" name="contact_last_name" required>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>Phone Number *</label>
                                            <input type="tel" id="contactPhone" name="contact_phone" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Email Address</label>
                                            <input type="email" id="contactEmail" name="contact_email">
                                        </div>
                                    </div>
                                </div>

                                <!-- Service-Specific Fields -->
                                <div id="serviceSpecificFields" class="form-section" style="display: none;">
                                    <!-- Wedding Fields -->
                                    <div id="weddingFields" class="service-fields" style="display: none;">
                                        <h5>Wedding Details</h5>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Bride's Full Name *</label>
                                                <input type="text" id="brideName" name="bride_name" required>
                                            </div>
                                            <div class="form-group">
                                                <label>Groom's Full Name *</label>
                                                <input type="text" id="groomName" name="groom_name" required>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Baptism Fields -->
                                    <div id="baptismFields" class="service-fields" style="display: none;">
                                        <h5>Child Information</h5>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Child's Full Name *</label>
                                                <input type="text" id="childFullName" name="child_full_name" required>
                                            </div>
                                            <div class="form-group">
                                                <label>Date of Birth *</label>
                                                <input type="date" id="childDateOfBirth" name="child_date_of_birth" required>
                                            </div>
                                        </div>
                                        <h5>Parents Information</h5>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Father's Full Name *</label>
                                                <input type="text" id="fatherName" name="father_name" required>
                                            </div>
                                            <div class="form-group">
                                                <label>Mother's Full Name *</label>
                                                <input type="text" id="motherName" name="mother_name" required>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Funeral Fields -->
                                    <div id="funeralFields" class="service-fields" style="display: none;">
                                        <h5>Deceased Information</h5>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Deceased's Full Name *</label>
                                                <input type="text" id="deceasedName" name="deceased_name" required>
                                            </div>
                                            <div class="form-group">
                                                <label>Date of Death *</label>
                                                <input type="date" id="dateOfDeath" name="date_of_death" required>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label>Funeral Home Contact</label>
                                            <input type="text" id="funeralHomeContact" name="funeral_home_contact">
                                        </div>
                                    </div>
                                    
                                    <!-- Confirmation Fields -->
                                    <div id="confirmationFields" class="service-fields" style="display: none;">
                                        <h5>Confirmation Details</h5>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Candidate's Full Name *</label>
                                                <input type="text" id="candidateName" name="candidate_name" required>
                                            </div>
                                            <div class="form-group">
                                                <label>Sponsor's Full Name *</label>
                                                <input type="text" id="sponsorName" name="sponsor_name" required>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Stipendium Information -->
                                <div class="form-section" id="paymentSection">
                                    <h5><i class="fas fa-credit-card"></i> Stipendium Information</h5>
                                    
                                    <!-- Stipendium Method & Type -->
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>Stipendium Method</label>
                                            <input type="text" id="paymentMethod" name="payment_method" value="Cash" readonly class="readonly-field">
                                        </div>
                                        <div class="form-group">
                                            <label>Stipendium Type *</label>
                                            <select id="paymentType" name="payment_type" required>
                                                <option value="">Select Stipendium Type</option>
                                                <option value="Full">Full Stipendium</option>
                                                <option value="Downpayment">Partial Stipendium</option>
                                            </select>
                                        </div>
                                    </div>


                                    <!-- Pricing Information -->
                                    <div class="payment-summary-card">
                                        <h6><i class="fas fa-calculator"></i> Stipendium Summary</h6>
                                        
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Base Price</label>
                                                <input type="text" id="basePrice" name="base_price" readonly class="readonly-field">
                                            </div>
                                            <div class="form-group">
                                                <label>Discount Type</label>
                                                <select id="discountType" name="discount_type">
                                                    <option value="none">No Discount</option>
                                                    <option value="percentage">Percentage (%)</option>
                                                    <option value="fixed">Fixed Amount (â‚±)</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="form-row" id="discountValueGroup" style="display: none;">
                                            <div class="form-group">
                                                <label id="discountValueLabel">Discount Value</label>
                                                <input type="number" id="discountValue" name="discount_value" min="0" step="0.01" placeholder="0">
                                            </div>
                                            <div class="form-group">
                                                <label>Discount Amount</label>
                                                <input type="text" id="discountAmount" name="discount_amount" readonly class="readonly-field">
                                            </div>
                                        </div>

                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Amount Due</label>
                                                <input type="text" id="amountDue" name="amount_due" readonly class="readonly-field amount-highlight">
                                            </div>
                                            <div class="form-group">
                                                <label>Amount Paid *</label>
                                                <input type="number" id="amountPaid" name="amount_paid" min="0" step="0.01" placeholder="0.00" required>
                                            </div>
                                        </div>

                                        <div class="form-group" id="balanceGroup" style="display: none;">
                                            <label>Remaining Balance</label>
                                            <input type="text" id="remainingBalance" name="remaining_balance" readonly class="readonly-field balance-highlight">
                                        </div>

                                        <div class="payment-status-indicator" id="paymentStatusIndicator">
                                            <span class="status-badge status-pending">Stipendium Pending</span>
                                        </div>
                                    </div>
                                </div>


                                <!-- Submit Button -->
                                <div class="form-actions">
                                    <button type="button" id="cancelReservation" class="btn btn-secondary">Cancel</button>
                                    <button type="submit" id="submitReservation" class="btn btn-primary">Make Reservation</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        
        <!-- View Reservation Details Modal -->
        <div class="view-reservation-modal" id="viewReservationModal" style="display: none;">
            <div class="modal-overlay"></div>
            <div class="modal-content large-modal">
                <div class="modal-header">
                    <h4 class="modal-title">Reservation Details</h4>
                    <button class="modal-close" id="viewModalClose">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="reservation-details-container">
                        <!-- Reservation Summary Section -->
                        <div class="details-section">
                            <div class="section-header">
                                <h5><i class="fas fa-calendar-check"></i> Reservation Summary</h5>
                            </div>
                            <div class="details-grid">
                                <div class="detail-item">
                                    <label>Reservation ID:</label>
                                    <span id="detail-id">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Service Type:</label>
                                    <span id="detail-service-type">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Date:</label>
                                    <span id="detail-date">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Time:</label>
                                    <span id="detail-time">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Status:</label>
                                    <span id="detail-status">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Created Date:</label>
                                    <span id="detail-created">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Created By:</label>
                                    <span id="detail-created-by" style="font-weight: 600; color: var(--primary-dark);">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Contact Information Section -->
                        <div class="details-section">
                            <div class="section-header">
                                <h5><i class="fas fa-user"></i> Contact Information</h5>
                            </div>
                            <div class="details-grid">
                                <div class="detail-item">
                                    <label>Full Name:</label>
                                    <span id="detail-contact-name">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Phone Number:</label>
                                    <span id="detail-contact-phone">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Email Address:</label>
                                    <span id="detail-contact-email">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Address:</label>
                                    <span id="detail-contact-address">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Service-Specific Details Section -->
                        <div class="details-section">
                            <div class="section-header">
                                <h5><i class="fas fa-info-circle"></i> Service Details</h5>
                            </div>
                            <div id="service-specific-details">
                                <!-- Content will be populated dynamically based on service type -->
                            </div>
                        </div>

                        <!-- Additional Information Section -->
                        <div class="details-section">
                            <div class="section-header">
                                <h5><i class="fas fa-sticky-note"></i> Additional Information</h5>
                            </div>
                            <div class="details-grid">
                                <div class="detail-item full-width">
                                    <label>Assigned Priest:</label>
                                    <span id="detail-priest-name">-</span>
                                </div>
                                <div class="detail-item full-width">
                                    <label>Special Requests:</label>
                                    <span id="detail-special-requests">-</span>
                                </div>
                                <div class="detail-item full-width">
                                    <label>Notes:</label>
                                    <span id="detail-notes">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Stipendium Information Section -->
                        <div class="details-section">
                            <div class="section-header">
                                <h5><i class="fas fa-credit-card"></i> Stipendium Information</h5>
                            </div>
                            <div class="details-grid">
                                <div class="detail-item">
                                    <label>Stipendium Status:</label>
                                    <span id="detail-payment-status">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Stipendium Type:</label>
                                    <span id="detail-payment-type">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Base Price:</label>
                                    <span id="detail-base-price">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Amount Due:</label>
                                    <span id="detail-amount-due">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Amount Paid:</label>
                                    <span id="detail-amount-paid">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Balance:</label>
                                    <span id="detail-balance">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Stipendium Method:</label>
                                    <span id="detail-payment-method">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="closeViewModal">Close</button>
                    <button type="button" class="btn btn-secondary" id="printReservationBtn" onclick="printReservationDetails()">
                        <i class="fas fa-print"></i> Print
                    </button>
                    <button type="button" class="btn btn-primary" id="editFromView">Edit Reservation</button>
                    <!-- REMOVED: Approve button - Only priests can approve reservations -->
                </div>
            </div>
        </div>
        
        </div>
    </main>

    <!-- Profile Settings Modal -->
    <div id="profileSettingsModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); z-index: 9999; justify-content: center; align-items: center;">
        <div class="modal-content profile-modal" style="background: white; border-radius: 16px; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3); position: relative; max-height: 90vh; overflow-y: auto;">
            <!-- Modal Header with Gradient Background -->
            <div class="modal-header" style="background: linear-gradient(135deg, #1e40af 0%, #0369a1 100%); padding: 24px 28px; border-radius: 16px 16px 0 0; position: relative;">
                <h2 style="margin: 0; color: #ffffff !important; font-size: 22px; font-weight: 600; display: flex; align-items: center; gap: 10px; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                    <i class="fas fa-user-circle" style="font-size: 24px; color: #ffffff !important;"></i>
                    <span style="color: #ffffff !important;">My Profile</span>
                </h2>
                <button class="close-btn" id="closeProfileModal" style="position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.2); border: none; font-size: 20px; cursor: pointer; color: #ffffff !important; padding: 8px; border-radius: 50%; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <i class="fas fa-times" style="color: #ffffff !important;"></i>
                </button>
            </div>
            
            <!-- Modal Body with Better Spacing -->
            <div class="modal-body" style="padding: 32px 28px;">
                <form id="profileSettingsForm">
                    <!-- Account Information Section -->
                    <div style="margin-bottom: 24px;">
                        <h3 style="font-size: 16px; font-weight: 600; color: #1f2937; margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid #e5e7eb;">
                            <i class="fas fa-info-circle" style="color: #3b82f6; margin-right: 8px;"></i>
                            Account Information
                        </h3>
                        
                        <div class="form-group" style="margin-bottom: 20px;">
                            <label for="fullName" style="display: block; font-weight: 500; color: #374151; margin-bottom: 8px; font-size: 14px;">Full Name</label>
                            <input type="text" id="fullName" name="fullName" value="{{ user.full_name or 'Administrator' }}" class="form-input" readonly style="width: 100%; padding: 12px 16px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; background-color: #f9fafb; color: #6b7280; cursor: not-allowed;">
                        </div>
                        
                        <div class="form-group" style="margin-bottom: 20px;">
                            <label for="email" style="display: block; font-weight: 500; color: #374151; margin-bottom: 8px; font-size: 14px;">Email Address</label>
                            <input type="email" id="email" name="email" value="{{ user.email or 'admin@churchease.com' }}" class="form-input" readonly style="width: 100%; padding: 12px 16px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; background-color: #f9fafb; color: #6b7280; cursor: not-allowed;">
                        </div>
                        
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="userRole" style="display: block; font-weight: 500; color: #374151; margin-bottom: 8px; font-size: 14px;">Role</label>
                            <input type="text" id="userRole" name="userRole" value="{{ (user.role or 'admin').title() }}" class="form-input" readonly style="width: 100%; padding: 12px 16px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; background-color: #f9fafb; color: #6b7280; cursor: not-allowed;">
                        </div>
                    </div>
                    
                    <!-- Info Message -->
                    <div style="background: #eff6ff; border-left: 4px solid #3b82f6; padding: 12px 16px; border-radius: 8px; margin-top: 20px;">
                        <p style="margin: 0; color: #1e40af; font-size: 13px; display: flex; align-items: start; gap: 8px;">
                            <i class="fas fa-info-circle" style="margin-top: 2px;"></i>
                            <span>This information is view-only. Contact the system administrator to update your profile details.</span>
                        </p>
                    </div>
                </form>
            </div>
            
            <!-- Modal Footer -->
            <div class="modal-footer" style="padding: 20px 28px; border-top: 1px solid #e5e7eb; display: flex; justify-content: flex-end; gap: 12px; border-radius: 0 0 16px 16px;">
                <button type="button" class="btn btn-secondary" id="cancelProfileSettings" style="padding: 10px 24px; border: 1px solid #d1d5db; background: white; color: #374151; border-radius: 8px; font-weight: 500; cursor: pointer; transition: all 0.2s;">Close</button>
            </div>
        </div>
    </div>

    <!-- Logout Confirmation Modal -->
    <div id="logoutModal" class="modal" style="display: none;">
        <div class="modal-content logout-modal">
            <div class="modal-header">
                <h2><i class="fas fa-sign-out-alt"></i> Confirm Logout</h2>
            </div>
            <div class="modal-body">
                <div class="logout-message">
                    <i class="fas fa-question-circle"></i>
                    <p>Are you sure you want to logout from ChurchEase?</p>
                    <p class="logout-subtitle">You will need to login again to access the system.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelLogout">No, Stay Logged In</button>
                <button type="button" class="btn btn-danger" id="confirmLogout">Yes, Logout</button>
            </div>
        </div>
    </div>

    <!-- Calendar Event Details Modal -->
    <div id="calendarEventModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); z-index: 9999; justify-content: center; align-items: center; animation: fadeIn 0.2s ease-out;">
        <div class="modal-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></div>
        <div class="modal-container" style="position: relative; background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 20px; max-width: 480px; width: 90%; box-shadow: 0 25px 50px rgba(0,0,0,0.15), 0 0 0 1px rgba(255,255,255,0.8); transform: scale(1); animation: slideUp 0.3s ease-out;">
            
            <!-- Enhanced Header with Gradient -->
            <div class="modal-header" style="background: linear-gradient(135deg, #1e40af 0%, #0369a1 100%); padding: 28px 28px 24px 28px; text-align: center; border-radius: 20px 20px 0 0; position: relative; overflow: hidden;">
                <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.1); opacity: 0.3;"></div>
                <h3 style="margin: 0 0 8px 0; color: white; font-size: 24px; font-weight: 700; text-shadow: 0 2px 4px rgba(0,0,0,0.2); position: relative; z-index: 1;">
                    <i class="fas fa-calendar-check" style="margin-right: 8px; opacity: 0.9;"></i>
                    Reservation Details
                </h3>
                <button type="button" class="modal-close" id="closeCalendarEventModal" style="position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.2); border: none; font-size: 18px; cursor: pointer; color: white; padding: 8px; border-radius: 50%; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; z-index: 2;">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-body" style="padding: 28px;">
                <!-- Service Badge and Date/Time -->
                <div style="text-align: center; margin-bottom: 24px;">
                    <div id="calendar-detail-service" style="margin-bottom: 12px; transform: scale(1.1);"></div>
                    <div style="color: #64748b; font-size: 15px; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <i class="fas fa-calendar-alt" style="color: #8b5cf6; font-size: 14px;"></i>
                        <span id="calendar-detail-date"></span>
                        <span style="color: #cbd5e1;">â€¢</span>
                        <i class="fas fa-clock" style="color: #8b5cf6; font-size: 14px;"></i>
                        <span id="calendar-detail-time"></span>
                    </div>
                </div>
                
                <!-- Client Information Card -->
                <div style="background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%); border-radius: 16px; padding: 20px; margin-bottom: 20px; border: 1px solid rgba(148, 163, 184, 0.2); position: relative; overflow: hidden;">
                    <div style="position: absolute; top: -10px; right: -10px; width: 60px; height: 60px; background: linear-gradient(135deg, #8b5cf6, #ec4899); border-radius: 50%; opacity: 0.1;"></div>
                    <h4 style="margin: 0 0 16px 0; color: #334155; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-user-circle" style="color: #8b5cf6;"></i>
                        Client Information
                    </h4>
                    
                    <div style="display: grid; gap: 12px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="background: #8b5cf6; color: white; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px;">
                                <i class="fas fa-user"></i>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Name</div>
                                <div id="calendar-detail-client" style="color: #1e293b; font-weight: 600; font-size: 15px;"></div>
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="background: #10b981; color: white; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px;">
                                <i class="fas fa-phone"></i>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Phone</div>
                                <div id="calendar-detail-phone" style="color: #1e293b; font-weight: 600; font-size: 15px;"></div>
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="background: #f59e0b; color: white; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px;">
                                <i class="fas fa-info-circle"></i>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Status</div>
                                <div id="calendar-detail-status"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Service-Specific Details Card -->
                <div id="calendar-service-specific-details" style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-radius: 16px; padding: 20px; margin-bottom: 20px; border: 1px solid rgba(59, 130, 246, 0.2); position: relative; overflow: hidden;">
                    <div style="position: absolute; top: -10px; left: -10px; width: 60px; height: 60px; background: linear-gradient(135deg, #3b82f6, #1d4ed8); border-radius: 50%; opacity: 0.1;"></div>
                    <!-- Service-specific content will be populated here -->
                </div>
            </div>

            <!-- Enhanced Footer with Better Buttons -->
            <div class="modal-footer" style="padding: 20px 28px 28px 28px; display: flex; gap: 12px; justify-content: center; border-top: 1px solid rgba(148, 163, 184, 0.1);">
                <button type="button" class="btn btn-secondary" id="closeCalendarModal" style="padding: 12px 24px; border: 2px solid #e2e8f0; background: white; color: #64748b; border-radius: 12px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.2s ease; display: flex; align-items: center; gap: 8px; min-width: 100px; justify-content: center;">
                    <i class="fas fa-times" style="font-size: 12px;"></i>
                    Close
                </button>
            </div>
        </div>
    </div>

    <style>
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        #calendarEventModal .modal-close:hover {
            background: rgba(255,255,255,0.3) !important;
            transform: scale(1.1);
        }
        
        #calendarEventModal .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        #calendarEventModal .btn-secondary:hover {
            border-color: #cbd5e1;
            background: #f8fafc;
        }
        
        #calendarEventModal .btn-danger:hover {
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='tailwind-compiled.css') }}">
    
    <!-- FullCalendar CSS and JS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.5/main.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.5/main.min.js"></script>
    
    <script src="{{ url_for('static', filename='philippine-holidays.js') }}"></script>
    <script src="{{ url_for('static', filename='mobile-navigation.js') }}"></script>
    <script src="{{ url_for('static', filename='reservation-table.js') }}"></script>
    <script src="{{ url_for('static', filename='calendar-reservation.js') }}"></script>
    <script>
        // Initialize Calendar Reservation System
        let calendarReservationSystem;
        let eventsCalendarSystem;
        
        // Initialize Admin Dashboard with correct titles
        function initializeAdminDashboard() {
            console.log('Initializing Admin Dashboard...');
            
            // Set correct page titles
            const pageTitle = document.querySelector('.page-title');
            const pageSubtitle = document.querySelector('.page-subtitle');
            const breadcrumbCurrent = document.getElementById('breadcrumb-current');
            
            if (pageTitle) {
                pageTitle.textContent = 'Admin Dashboard';
                console.log('Set page title to: Admin Dashboard');
            }
            
            if (pageSubtitle) {
                pageSubtitle.textContent = 'Welcome back, Administrator! Manage your church operations and oversee all activities.';
                console.log('Set page subtitle');
            }
            
            if (breadcrumbCurrent) {
                breadcrumbCurrent.textContent = 'Dashboard';
                console.log('Set breadcrumb to: Dashboard');
            }
            
            // Ensure dashboard is active by default
            const dashboardNavLink = document.querySelector('a[data-page="dashboard"]');
            if (dashboardNavLink) {
                dashboardNavLink.classList.add('active');
                console.log('Set dashboard nav as active');
            }
            
            // Make sure dashboard content is visible
            const dashboardContent = document.getElementById('dashboardContent');
            if (dashboardContent) {
                dashboardContent.style.display = 'block';
                console.log('Dashboard content set to visible');
            }
            
            // Hide all other modules
            const modules = document.querySelectorAll('.module-content');
            modules.forEach(module => {
                module.style.display = 'none';
            });
            
            console.log('Admin Dashboard initialization complete');
        }
        
        // Load Dashboard Data from Database
        async function loadDashboardData() {
            try {
                console.log('ðŸ”„ Loading Admin Dashboard data from database...');
                
                // Load Total Reservations (this month)
                const reservationsResponse = await fetch('/api/reservations/all');
                console.log('ðŸ“¡ Reservations API Response:', reservationsResponse.status);
                
                const reservationsResult = await reservationsResponse.json();
                console.log('ðŸ“Š Reservations Data:', reservationsResult);
                
                if (reservationsResult.success) {
                    // Get ALL reservations (not filtered by month)
                    const allReservations = reservationsResult.data || [];
                    
                    console.log('ðŸ“Š Received reservations from API:', allReservations.length);
                    console.log('ðŸ“Š First 3 reservations:', allReservations.slice(0, 3));
                    
                    // Count pending approvals (status = 'pending' or 'waiting_priest_approval')
                    const pendingApprovals = allReservations.filter(res => 
                        res.status === 'pending' || res.status === 'waiting_priest_approval'
                    ).length;
                    
                    // Update dashboard stats
                    document.getElementById('dashTotalReservations').textContent = allReservations.length;
                    document.getElementById('dashPendingApprovals').textContent = pendingApprovals;
                    
                    console.log('ðŸ“Š Admin Dashboard Stats:', {
                        totalReservations: allReservations.length,
                        pendingApprovals: pendingApprovals,
                        approvedReservations: allReservations.filter(r => r.status === 'approved').length,
                        completedReservations: allReservations.filter(r => r.status === 'completed').length
                    });
                    
                    // Initialize dashboard charts with ALL reservations
                    console.log('ðŸ“Š Calling initializeDashboardCharts with', allReservations.length, 'reservations');
                    initializeDashboardCharts(allReservations);
                } else {
                    console.error('âŒ Failed to load reservations:', reservationsResult);
                    // Initialize charts with empty data
                    initializeDashboardCharts([]);
                }
                
                // Load Total Users
                const usersResponse = await fetch('/api/users');
                const usersResult = await usersResponse.json();
                
                if (usersResult.success && usersResult.data) {
                    document.getElementById('dashTotalUsers').textContent = usersResult.data.length;
                }
                
                // Load Priests Information
                const priestsResponse = await fetch('/api/priests');
                const priestsResult = await priestsResponse.json();
                
                if (priestsResult.success && priestsResult.data) {
                    const priestsCount = priestsResult.data.length;
                    document.getElementById('dashTotalPriests').textContent = priestsCount;
                    
                    // Update label to singular/plural
                    const labelElement = document.getElementById('dashPriestsLabel');
                    if (labelElement) {
                        labelElement.textContent = priestsCount === 1 ? 'Priest' : 'Priests';
                    }
                    
                    // Show priest names (first 2 if multiple)
                    const namesElement = document.getElementById('dashPriestsNames');
                    if (namesElement && priestsResult.data.length > 0) {
                        if (priestsCount === 1) {
                            namesElement.textContent = priestsResult.data[0].name || 'Active';
                        } else if (priestsCount === 2) {
                            namesElement.textContent = `${priestsResult.data[0].name}, ${priestsResult.data[1].name}`;
                        } else {
                            namesElement.textContent = `${priestsResult.data[0].name} +${priestsCount - 1} more`;
                        }
                    }
                }
                
                console.log('âœ… Dashboard data loaded from database');
            } catch (error) {
                console.error('âŒ Error loading dashboard data:', error);
                // Set error state
                document.getElementById('dashTotalReservations').textContent = 'Error';
                document.getElementById('dashPendingApprovals').textContent = 'Error';
                document.getElementById('dashTotalUsers').textContent = 'Error';
                document.getElementById('dashTotalPriests').textContent = 'Error';
            }
        }
        
        // Initialize Dashboard Charts
        let monthlyChart = null;
        let serviceChart = null;
        
        function initializeDashboardCharts(reservations) {
            console.log('ðŸ“Š Initializing Admin Dashboard Charts with data:', reservations);
            console.log('ðŸ“Š Total reservations received:', reservations.length);
            
            // Destroy existing charts if they exist
            if (monthlyChart) monthlyChart.destroy();
            if (serviceChart) serviceChart.destroy();
            
            // Initialize Monthly Approved Reservations Chart
            initializeMonthlyReservationsChart(reservations);
            
            // Initialize Service Type Distribution Chart
            initializeServiceDistributionChart(reservations);
        }
        
        function initializeMonthlyReservationsChart(reservations) {
            const ctx = document.getElementById('monthlyReservationsChart');
            if (!ctx) {
                console.error('âŒ Chart canvas not found: monthlyReservationsChart');
                return;
            }
            
            console.log('ðŸ“ˆ Creating Monthly Reservations Chart...');
            
            // Get approved reservations from last 6 months
            const now = new Date();
            const sixMonthsAgo = new Date(now.getFullYear(), now.getMonth() - 5, 1);
            
            const approvedReservations = reservations.filter(r => 
                r.status === 'approved' || r.status === 'confirmed'
            );
            
            console.log('ðŸ“Š Approved/Confirmed reservations:', approvedReservations.length);
            console.log('ðŸ“Š Sample approved reservation:', approvedReservations[0]);
            
            // Group by month
            const monthlyData = {};
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            
            // Initialize last 6 months
            for (let i = 5; i >= 0; i--) {
                const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
                const key = `${monthNames[date.getMonth()]} ${date.getFullYear()}`;
                monthlyData[key] = 0;
            }
            
            console.log('ðŸ“Š Initialized monthly data structure:', monthlyData);
            
            // Count reservations per month
            approvedReservations.forEach(reservation => {
                // Try multiple date field names
                const dateStr = reservation.reservation_date || reservation.date || reservation.event_date;
                if (!dateStr) {
                    console.warn('âš ï¸ No date found for reservation:', reservation);
                    return;
                }
                
                const date = new Date(dateStr);
                if (isNaN(date.getTime())) {
                    console.warn('âš ï¸ Invalid date:', dateStr);
                    return;
                }
                
                if (date >= sixMonthsAgo) {
                    const key = `${monthNames[date.getMonth()]} ${date.getFullYear()}`;
                    if (monthlyData[key] !== undefined) {
                        monthlyData[key]++;
                        console.log(`âœ… Added reservation to ${key}:`, reservation.id);
                    }
                }
            });
            
            console.log('ðŸ“Š Final monthly data:', monthlyData);
            
            monthlyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Object.keys(monthlyData),
                    datasets: [{
                        label: 'Approved Reservations',
                        data: Object.values(monthlyData),
                        borderColor: '#002b5c',
                        backgroundColor: 'rgba(0, 43, 92, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 5,
                        pointHoverRadius: 7,
                        pointBackgroundColor: '#002b5c',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 43, 92, 0.9)',
                            padding: 12,
                            titleFont: { size: 14, weight: 'bold' },
                            bodyFont: { size: 13 }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                                font: { size: 12 }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            ticks: {
                                font: { size: 12 }
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }
        
        function initializeServiceDistributionChart(reservations) {
            const ctx = document.getElementById('serviceDistributionChart');
            if (!ctx) {
                console.error('âŒ Chart canvas not found: serviceDistributionChart');
                return;
            }
            
            console.log('ðŸ© Creating Service Distribution Chart...');
            
            // Count service types
            const serviceCounts = {
                'Wedding': 0,
                'Baptism': 0,
                'Funeral': 0,
                'Confirmation': 0
            };
            
            reservations.forEach(reservation => {
                const serviceType = reservation.service_type;
                if (serviceType === 'wedding') serviceCounts['Wedding']++;
                else if (serviceType === 'baptism') serviceCounts['Baptism']++;
                else if (serviceType === 'funeral') serviceCounts['Funeral']++;
                else if (serviceType === 'confirmation') serviceCounts['Confirmation']++;
            });
            
            console.log('ðŸ“Š Service type counts:', serviceCounts);
            
            serviceChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(serviceCounts),
                    datasets: [{
                        data: Object.values(serviceCounts),
                        backgroundColor: [
                            '#d4af37', // Gold for Wedding
                            '#3b82f6', // Blue for Baptism
                            '#6b7280', // Gray for Funeral
                            '#8b5cf6'  // Purple for Confirmation
                        ],
                        borderWidth: 3,
                        borderColor: '#fff',
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                font: { size: 13, weight: '600' },
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 43, 92, 0.9)',
                            padding: 12,
                            titleFont: { size: 14, weight: 'bold' },
                            bodyFont: { size: 13 },
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Helper function to get status badge
        function getStatusBadge(status) {
            const statusMap = {
                'pending': '<span class="status-badge status-pending">Pending</span>',
                'confirmed': '<span class="status-badge status-confirmed">Confirmed</span>',
                'cancelled': '<span class="status-badge status-cancelled">Cancelled</span>',
                'declined': '<span class="status-badge status-cancelled">Declined</span>'
            };
            return statusMap[status] || '<span class="status-badge">Unknown</span>';
        }
        
        // Helper function to get priest status badge
        function getPriestStatusBadge(priestStatus) {
            const statusMap = {
                'pending': '<span class="status-badge status-pending">Pending Priest</span>',
                'approved': '<span class="status-badge status-confirmed">Priest Approved</span>',
                'declined': '<span class="status-badge status-cancelled">Priest Declined</span>'
            };
            return statusMap[priestStatus] || '<span class="status-badge">N/A</span>';
        }

        // Handle reservation navigation
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded - Admin Dashboard');
            
            // Initialize page with correct Admin Dashboard title
            initializeAdminDashboard();
            
            // Load dashboard data from database
            loadDashboardData();
            
            // Initialize Admin Navigation FIRST
            initializeAdminNavigation();
            
            // Initialize Profile Functionality
            initializeProfileFunctionality();
            
            // Try to initialize calendar systems if classes exist
            try {
                if (typeof CalendarReservationSystem !== 'undefined' && typeof PhilippineHolidays !== 'undefined') {
                    calendarReservationSystem = new CalendarReservationSystem();
                    window.calendarReservationSystem = calendarReservationSystem;
                    window.calendarSystem = calendarReservationSystem;
                    console.log('Calendar system initialized');
                } else {
                    console.log('Calendar system dependencies not available');
                }
            } catch (e) {
                console.log('Calendar system not available:', e.message);
            }
            
            try {
                if (typeof EventsCalendarSystem !== 'undefined') {
                    eventsCalendarSystem = new EventsCalendarSystem();
                    window.eventsCalendarSystem = eventsCalendarSystem;
                    console.log('Events calendar system initialized');
                }
            } catch (e) {
                console.log('Events calendar system not available:', e.message);
            }
            
            // Initialize tab switching for reservation module
            if (typeof initializeReservationTabs === 'function') {
                initializeReservationTabs();
            }
            
            // Initialize reservation table manager
            setTimeout(() => {
                try {
                    if (typeof ReservationTableManager !== 'undefined') {
                        window.reservationTable = new ReservationTableManager();
                        console.log('ReservationTableManager initialized');
                    }
                } catch (e) {
                    console.log('ReservationTableManager not available:', e.message);
                }
                
                // Add direct search functionality as fallback
                const searchInput = document.getElementById('nameSearchInput');
                if (searchInput) {
                    console.log('Search input found, adding event listener');
                    searchInput.addEventListener('input', function(e) {
                        const query = e.target.value;
                        console.log('Direct search input:', query);
                        
                        if (window.reservationTable && window.reservationTable.searchReservations) {
                            window.reservationTable.searchReservations(query);
                        } else {
                            console.log('ReservationTableManager not available');
                            // Manual search fallback
                            manualSearch(query);
                        }
                        
                        // Show/hide clear button
                        const clearBtn = document.getElementById('clearSearch');
                        if (clearBtn) {
                            clearBtn.style.display = query.trim() ? 'block' : 'none';
                        }
                    });
                } else {
                    console.log('Search input not found');
                }
                
                // Clear search button
                const clearBtn = document.getElementById('clearSearch');
                if (clearBtn) {
                    clearBtn.addEventListener('click', function() {
                        const searchInput = document.getElementById('nameSearchInput');
                        if (searchInput) {
                            searchInput.value = '';
                            if (window.reservationTable && window.reservationTable.searchReservations) {
                                window.reservationTable.searchReservations('');
                            } else {
                                manualSearch('');
                            }
                            this.style.display = 'none';
                        }
                    });
                }
            }, 500);
            
            // Admin Dashboard Search Functionality
            const adminSearchInput = document.getElementById('adminReservationSearch');
            if (adminSearchInput) {
                console.log('Admin search input found, adding event listener');
                adminSearchInput.addEventListener('input', function(e) {
                    const query = e.target.value;
                    console.log('Admin search input:', query);
                    
                    filterAdminReservations(query);
                    
                    // Show/hide clear button
                    const clearBtn = document.getElementById('adminClearSearch');
                    if (clearBtn) {
                        clearBtn.style.display = query.trim() ? 'block' : 'none';
                    }
                });
            }
            
            // Admin Clear search button
            const adminClearBtn = document.getElementById('adminClearSearch');
            if (adminClearBtn) {
                adminClearBtn.addEventListener('click', function() {
                    const searchInput = document.getElementById('adminReservationSearch');
                    if (searchInput) {
                        searchInput.value = '';
                        filterAdminReservations('');
                        this.style.display = 'none';
                    }
                });
            }
            
            // Reservations Overview Search Functionality
            const overviewSearchInput = document.getElementById('overviewReservationSearch');
            if (overviewSearchInput) {
                console.log('Overview search input found, adding event listener');
                overviewSearchInput.addEventListener('input', function(e) {
                    const query = e.target.value;
                    console.log('Overview search input:', query);
                    
                    filterOverviewReservations(query);
                    
                    // Show/hide clear button
                    const clearBtn = document.getElementById('overviewClearSearch');
                    if (clearBtn) {
                        clearBtn.style.display = query.trim() ? 'block' : 'none';
                    }
                });
            }
            
            // Overview Clear search button
            const overviewClearBtn = document.getElementById('overviewClearSearch');
            if (overviewClearBtn) {
                overviewClearBtn.addEventListener('click', function() {
                    const searchInput = document.getElementById('overviewReservationSearch');
                    if (searchInput) {
                        searchInput.value = '';
                        filterOverviewReservations('');
                        this.style.display = 'none';
                    }
                });
            }
            
            // Reservations Overview Refresh Button
            const refreshOverviewBtn = document.getElementById('refreshReservationsOverviewBtn');
            if (refreshOverviewBtn) {
                refreshOverviewBtn.addEventListener('click', async function() {
                    const icon = this.querySelector('i');
                    const originalHTML = this.innerHTML;
                    
                    // Show loading state
                    this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Refreshing...';
                    this.disabled = true;
                    
                    try {
                        await loadReservationsOverviewData();
                        
                        // Show success state
                        this.innerHTML = '<i class="fas fa-check"></i> Updated!';
                        this.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                        
                        setTimeout(() => {
                            this.innerHTML = originalHTML;
                            this.style.background = '';
                            this.disabled = false;
                        }, 2000);
                    } catch (error) {
                        console.error('Error refreshing overview:', error);
                        this.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error';
                        this.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
                        
                        setTimeout(() => {
                            this.innerHTML = originalHTML;
                            this.style.background = '';
                            this.disabled = false;
                        }, 2000);
                    }
                });
            }
            
            // Manual search fallback function
            function manualSearch(query) {
                console.log('Manual search for:', query);
                const tableBody = document.getElementById('reservationsTableBody');
                if (!tableBody) return;
                
                const rows = tableBody.querySelectorAll('tr');
                rows.forEach(row => {
                    if (!query.trim()) {
                        row.style.display = '';
                        return;
                    }
                    
                    const text = row.textContent.toLowerCase();
                    const searchTerm = query.toLowerCase();
                    
                    if (text.includes(searchTerm)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            }
            
            // Initialize refresh button for reservations table
            const refreshBtn = document.getElementById('refreshReservations');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', function() {
                    // Save current scroll position
                    const scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
                    
                    // Add visual feedback to table
                    const tableContainer = document.querySelector('.reservations-table-container');
                    const table = document.querySelector('#reservationsTableBody');
                    
                    // Show loading state on button
                    this.disabled = true;
                    this.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Refreshing...</span>';
                    this.style.backgroundColor = '#3b82f6';
                    this.style.color = 'white';
                    
                    // Add loading overlay to table
                    if (tableContainer) {
                        tableContainer.style.opacity = '0.6';
                        tableContainer.style.pointerEvents = 'none';
                    }
                    
                    // Refresh only the reservations table
                    if (window.reservationTable && window.reservationTable.loadReservations) {
                        console.log('Starting refresh...');
                        window.reservationTable.loadReservations().then(() => {
                            console.log('Refresh successful');
                            
                            // Reset button state immediately to normal
                            this.disabled = false;
                            this.innerHTML = '<i class="fas fa-sync-alt"></i><span>Refresh</span>';
                            this.style.backgroundColor = '';
                            this.style.color = '';
                            
                            // Remove table loading overlay
                            if (tableContainer) {
                                tableContainer.style.opacity = '1';
                                tableContainer.style.pointerEvents = 'auto';
                            }
                            
                            // Restore scroll position
                            setTimeout(() => {
                                window.scrollTo(0, scrollPosition);
                            }, 100);
                        }).catch((error) => {
                            console.log('Refresh error:', error);
                            // Reset button state immediately to normal even on error
                            this.disabled = false;
                            this.innerHTML = '<i class="fas fa-sync-alt"></i><span>Refresh</span>';
                            this.style.backgroundColor = '';
                            this.style.color = '';
                            
                            // Remove table loading overlay
                            if (tableContainer) {
                                tableContainer.style.opacity = '1';
                                tableContainer.style.pointerEvents = 'auto';
                            }
                            
                            // Restore scroll position even on error
                            setTimeout(() => {
                                window.scrollTo(0, scrollPosition);
                            }, 100);
                        });
                    } else {
                        // Fallback: show success state even if reservationTable not found
                        console.log('reservationTable not found, showing success anyway');
                        setTimeout(() => {
                            // Reset button state immediately to normal
                            this.disabled = false;
                            this.innerHTML = '<i class="fas fa-sync-alt"></i><span>Refresh</span>';
                            this.style.backgroundColor = '';
                            this.style.color = '';
                            
                            // Remove table loading overlay
                            if (tableContainer) {
                                tableContainer.style.opacity = '1';
                                tableContainer.style.pointerEvents = 'auto';
                            }
                            
                            // Restore scroll position
                            setTimeout(() => {
                                window.scrollTo(0, scrollPosition);
                            }, 100);
                        }, 1000);
                    }
                });
            } else if (eventsModule) {
                eventsModule.style.display = 'none';
            }
            
            // Reset page title for Admin Dashboard
            document.querySelector('.page-title').textContent = 'Admin Dashboard';
                document.querySelector('.page-subtitle').textContent = 'Welcome back, Administrator! Manage your church operations and oversee all activities.';
                
                // Update breadcrumb
                const breadcrumbElement = document.getElementById('breadcrumb-current');
                if (breadcrumbElement) {
                    breadcrumbElement.textContent = 'Dashboard';
                }
            });
        
        // Initialize Admin Navigation function
        function initializeAdminNavigation() {
            console.log('Initializing Admin Navigation...');
            const navLinks = document.querySelectorAll('.nav-link[data-page]');
            const modules = document.querySelectorAll('.module-content');
            const dashboardContent = document.getElementById('dashboardContent');
            
            console.log('Found nav links:', navLinks.length);
            console.log('Found modules:', modules.length);
            console.log('Dashboard content found:', !!dashboardContent);
            const pageTitle = document.querySelector('.page-title');
            const pageSubtitle = document.querySelector('.page-subtitle');
            const breadcrumbCurrent = document.getElementById('breadcrumb-current');
            
            // Navigation titles and subtitles
            const pageInfo = {
                'dashboard': {
                    title: 'Admin Dashboard',
                    subtitle: 'Welcome back, Administrator! Manage your church operations and oversee all activities.',
                    breadcrumb: 'Dashboard'
                },
                'user-management': {
                    title: 'User Management',
                    subtitle: 'Manage user accounts, roles, and permissions for the church system.',
                    breadcrumb: 'User Management'
                },
                'priest-management': {
                    title: 'Priest Management',
                    subtitle: 'Manage church priests, their service assignments, and contact information.',
                    breadcrumb: 'Priest Management'
                },
                'reservations-management': {
                    title: 'Reservations Management',
                    subtitle: 'Oversee all church reservations, approvals, and scheduling.',
                    breadcrumb: 'Reservations Management'
                },
                'stipendium-tracking': {
                    title: 'Stipendium Tracking & Management',
                    subtitle: 'Monitor church service payments, track stipendium collections, and manage payment records.',
                    breadcrumb: 'Stipendium Tracking'
                },
                'reports': {
                    title: 'Reports & Analytics',
                    subtitle: 'Generate comprehensive reports and view church analytics.',
                    breadcrumb: 'Reports'
                },
                'calendar': {
                    title: 'Calendar',
                    subtitle: 'View all confirmed reservations and church events in calendar format.',
                    breadcrumb: 'Calendar'
                },
                'events': {
                    title: 'Events',
                    subtitle: 'View and manage all church events history.',
                    breadcrumb: 'Events'
                },
                'reservations-overview': {
                    title: 'Reservations',
                    subtitle: 'View and manage all church reservations.',
                    breadcrumb: 'Reservations'
                }
            };
            navLinks.forEach(navLink => {
                navLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const targetPage = this.getAttribute('data-page');
                    
                    // Remove active class from all nav links
                    navLinks.forEach(navLink => navLink.classList.remove('active'));
                    
                    // Add active class to clicked link
                    this.classList.add('active');
                    
                    // Hide all modules and dashboard content
                    modules.forEach(module => {
                        module.style.display = 'none';
                        console.log('Hiding module:', module.id);
                    });
                    if (dashboardContent) {
                        dashboardContent.style.display = 'none';
                        console.log('Hiding dashboard content');
                    }
                    
                    // Cleanup charts when switching modules
                    if (financialRevenueChartInstance) {
                        financialRevenueChartInstance.destroy();
                        financialRevenueChartInstance = null;
                    }
                    
                    // Reset module initialization flags
                    financialReportsInitialized = false;
                    
                    // Update page info - FORCE Admin Dashboard for dashboard page
                    if (targetPage === 'dashboard') {
                        if (pageTitle) pageTitle.textContent = 'Admin Dashboard';
                        if (pageSubtitle) pageSubtitle.textContent = 'Welcome back, Administrator! Manage your church operations and oversee all activities.';
                        if (breadcrumbCurrent) breadcrumbCurrent.textContent = 'Dashboard';
                        console.log('FORCED Admin Dashboard title update');
                    } else if (pageInfo[targetPage]) {
                        if (pageTitle) pageTitle.textContent = pageInfo[targetPage].title;
                        if (pageSubtitle) pageSubtitle.textContent = pageInfo[targetPage].subtitle;
                        if (breadcrumbCurrent) breadcrumbCurrent.textContent = pageInfo[targetPage].breadcrumb;
                    }
                    
                    // Show appropriate content
                    if (targetPage === 'dashboard') {
                        if (dashboardContent) {
                            dashboardContent.style.display = 'block';
                            console.log('Showing dashboard content');
                        }
                    } else {
                        // Map navigation pages to module IDs
                        const moduleMap = {
                            'user-management': 'userManagementModule',
                            'reservations-overview': 'reservationsOverviewModule',
                            'events': 'eventsModule',
                            'calendar': 'calendarModule',
                            'financial-reports': 'financialReportsModule',
                            'system-activity': 'systemActivityModule',
                            'settings': 'settingsModule',
                            'priest-management': 'priestManagementModule',
                            'reservations-management': 'reservationsManagementModule',
                            'stipendium-tracking': 'stipendiumTrackingModule',
                            'reports': 'reportsModule'
                        };
                        
                        const moduleId = moduleMap[targetPage];
                        const targetModule = document.getElementById(moduleId);
                        
                        if (targetModule) {
                            targetModule.style.display = 'block';
                            console.log('Showing module:', moduleId);
                            
                            // Initialize specific modules when shown
                            if (moduleId === 'userManagementModule') {
                                // User Management already initialized in DOMContentLoaded with loadUsers()
                                // No need to call separate initialization
                            } else if (moduleId === 'reservationsOverviewModule') {
                                initializeReservationsOverview();
                            } else if (moduleId === 'eventsModule') {
                                initializeEventsModule();
                            } else if (moduleId === 'calendarModule') {
                                initializeAdminCalendar();
                            } else if (moduleId === 'reservationsManagementModule') {
                                loadRecentReservationsTable();
                            } else if (moduleId === 'financialReportsModule') {
                                initializeFinancialReports();
                            } else if (moduleId === 'systemActivityModule') {
                                initializeSystemActivity();
                            } else if (moduleId === 'settingsModule') {
                                initializeSettings();
                            } else if (moduleId === 'stipendiumTrackingModule') {
                                initializeStipendiumTracking();
                            } else if (moduleId === 'reportsModule') {
                                initializeReports();
                            }
                        } else {
                            console.log('Module not found:', moduleId);
                            // List all available modules for debugging
                            console.log('Available modules:', Array.from(document.querySelectorAll('[id$="Module"]')).map(m => m.id));
                        }
                    }
                    
                    console.log('Navigated to:', targetPage);
                });
            });
        }
        
        // Initialize reservation tabs function
        function initializeReservationTabs() {
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabPanes = document.querySelectorAll('.tab-pane');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Remove active class from all tabs and panes
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabPanes.forEach(pane => pane.classList.remove('active'));
                    
                    // Add active class to clicked tab and corresponding pane
                    this.classList.add('active');
                    const targetPane = document.getElementById(targetTab);
                    if (targetPane) {
                        targetPane.classList.add('active');
                    }
                    
                    // If switching to add-reservation tab, refresh the calendar
                    if (targetTab === 'add-reservation' && calendarReservationSystem) {
                        setTimeout(() => {
                            calendarReservationSystem.calendar.render();
                        }, 100);
                    }
                });
            });
        }
    </script>


    <!-- Success Modal -->
    <div class="success-modal" id="successModal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content success-content">
            <div class="success-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="success-message">
                <h3>Reservation Created Successfully!</h3>
                <p id="successDetails">Your reservation has been submitted and is pending approval.</p>
                <div class="success-info">
                    <div class="info-item">
                        <span class="label">Reservation ID:</span>
                        <span class="value" id="reservationId">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Service:</span>
                        <span class="value" id="reservationService">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Date:</span>
                        <span class="value" id="reservationDate">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Time:</span>
                        <span class="value" id="reservationTime">-</span>
                    </div>
                </div>
            </div>
            <div class="success-actions">
                <button type="button" class="btn btn-primary" onclick="closeSuccessModal()">
                    <i class="fas fa-calendar"></i> Back to Calendar
                </button>
            </div>
        </div>
    </div>

    <!-- User Management CRUD Modals -->
    
    <!-- Add User Modal -->
    <div id="addUserModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user-plus"></i> Add New User</h2>
                <button class="close-btn" id="closeAddUserModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newUserFullName">Full Name <span class="required">*</span></label>
                            <input type="text" id="newUserFullName" name="full_name" required class="form-input">
                        </div>
                        <div class="form-group">
                            <label for="newUserUsername">Username <span class="required">*</span></label>
                            <input type="text" id="newUserUsername" name="username" required class="form-input">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newUserEmail">Email Address <span class="required">*</span></label>
                            <input type="email" id="newUserEmail" name="email" required class="form-input">
                        </div>
                        <div class="form-group">
                            <label for="newUserRole">Role <span class="required">*</span></label>
                            <select id="newUserRole" name="role" required class="form-input">
                                <option value="">Select Role</option>
                                <option value="admin">Administrator</option>
                                <option value="secretary">Secretary</option>
                                <option value="priest">Priest</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newUserPassword">Password <span class="required">*</span></label>
                            <input type="password" id="newUserPassword" name="password" required class="form-input">
                        </div>
                        <div class="form-group">
                            <label for="newUserConfirmPassword">Confirm Password <span class="required">*</span></label>
                            <input type="password" id="newUserConfirmPassword" name="confirm_password" required class="form-input">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="newUserStatus">Status</label>
                        <select id="newUserStatus" name="status" class="form-input">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelAddUser">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveNewUser">
                    <i class="fas fa-save"></i> Create User
                </button>
            </div>
        </div>
    </div>

    <!-- View User Modal -->
    <div id="viewUserModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user"></i> User Details</h2>
                <button class="close-btn" id="closeViewUserModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="user-details-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Full Name</label>
                            <div class="form-display" id="viewUserFullName">-</div>
                        </div>
                        <div class="form-group">
                            <label>Username</label>
                            <div class="form-display" id="viewUserUsername">-</div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Email Address</label>
                            <div class="form-display" id="viewUserEmail">-</div>
                        </div>
                        <div class="form-group">
                            <label>Role</label>
                            <div class="form-display" id="viewUserRole">-</div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Status</label>
                            <div class="form-display" id="viewUserStatus">-</div>
                        </div>
                        <div class="form-group">
                            <label>Created Date</label>
                            <div class="form-display" id="viewUserCreated">-</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="closeViewUser">Close</button>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div id="editUserModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user-edit"></i> Edit User</h2>
                <button class="close-btn" id="closeEditUserModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editUserForm">
                    <input type="hidden" id="editUserId" name="user_id">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editUserFullName">Full Name <span class="required">*</span></label>
                            <input type="text" id="editUserFullName" name="full_name" required class="form-input">
                        </div>
                        <div class="form-group">
                            <label for="editUserUsername">Username <span class="required">*</span></label>
                            <input type="text" id="editUserUsername" name="username" required class="form-input">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editUserEmail">Email Address <span class="required">*</span></label>
                            <input type="email" id="editUserEmail" name="email" required class="form-input">
                        </div>
                        <div class="form-group">
                            <label for="editUserRole">Role <span class="required">*</span></label>
                            <select id="editUserRole" name="role" required class="form-input">
                                <option value="admin">Administrator</option>
                                <option value="secretary">Secretary</option>
                                <option value="priest">Priest</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="editUserStatus">Status</label>
                        <select id="editUserStatus" name="status" class="form-input">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelEditUser">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveEditUser">
                    <i class="fas fa-save"></i> Update User
                </button>
            </div>
        </div>
    </div>

    <!-- Delete User Modal -->
    <div id="deleteUserModal" class="modal" style="display: none;">
        <div class="modal-content delete-modal">
            <div class="modal-header">
                <h2><i class="fas fa-exclamation-triangle"></i> Delete User</h2>
                <button class="close-btn" id="closeDeleteUserModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="delete-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>Are you sure you want to delete this user?</p>
                    <p class="delete-subtitle">This action cannot be undone.</p>
                </div>
                <div class="user-info-delete">
                    <div class="info-item">
                        <span class="label">User:</span>
                        <span class="value" id="deleteUserName">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Username:</span>
                        <span class="value" id="deleteUserUsername">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Role:</span>
                        <span class="value" id="deleteUserRole">-</span>
                    </div>
                </div>
                <input type="hidden" id="deleteUserId">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelDeleteUser">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteUser">
                    <i class="fas fa-trash"></i> Delete User
                </button>
            </div>
        </div>
    </div>

    <!-- Reset Password Modal -->
    <div id="resetPasswordModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px; padding: 32px;">
            <div class="modal-header" style="background: linear-gradient(135deg, #0891b2 0%, #0e7490 100%); color: white; margin: -32px -32px 24px -32px; padding: 24px 32px; border-radius: 12px 12px 0 0;">
                <h2 style="color: white; margin: 0;"><i class="fas fa-key"></i> Reset Password</h2>
                <button class="close-btn" id="closeResetPasswordModal" style="color: white; background: none; border: none; font-size: 28px; cursor: pointer; padding: 0; line-height: 1;">&times;</button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <!-- User Info Card -->
                <div class="reset-password-info" style="background: linear-gradient(135deg, rgba(8, 145, 178, 0.1) 0%, rgba(14, 116, 144, 0.1) 100%); border-left: 4px solid #0891b2; padding: 20px; border-radius: 12px; margin-bottom: 28px;">
                    <div style="display: flex; align-items: center; gap: 16px;">
                        <div style="width: 56px; height: 56px; background: linear-gradient(135deg, #0891b2 0%, #0e7490 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; font-weight: bold; flex-shrink: 0;">
                            <i class="fas fa-user"></i>
                        </div>
                        <div>
                            <p style="margin: 0; font-size: 13px; color: #6b7280; font-weight: 500;">Resetting password for:</p>
                            <p style="margin: 6px 0 0 0; font-size: 18px; font-weight: 600; color: #1f2937;" id="resetPasswordUserName">-</p>
                        </div>
                    </div>
                </div>

                <form id="resetPasswordForm">
                    <input type="hidden" id="resetPasswordUserId" name="user_id">
                    
                    <!-- New Password -->
                    <div class="form-group" style="margin-bottom: 24px;">
                        <label for="resetNewPassword" style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px; font-weight: 600; color: #1f2937; font-size: 14px;">
                            <i class="fas fa-lock" style="color: #0891b2;"></i>
                            New Password <span class="required" style="color: #ef4444;">*</span>
                        </label>
                        <div style="position: relative;">
                            <input type="password" id="resetNewPassword" name="new_password" required class="form-input" 
                                   placeholder="Enter new password (min. 6 characters)"
                                   style="width: 100%; padding: 12px 45px 12px 16px; border: 2px solid #cbd5e1; border-radius: 10px; transition: all 0.3s; font-size: 14px;">
                            <button type="button" class="toggle-password" onclick="togglePasswordVisibility('resetNewPassword', this)" 
                                    style="position: absolute; right: 14px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #94a3b8; cursor: pointer; padding: 6px 10px; transition: color 0.2s;">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <small style="display: block; margin-top: 8px; color: #64748b; font-size: 13px;">
                            <i class="fas fa-info-circle" style="color: #0891b2;"></i> Password must be at least 6 characters long
                        </small>
                    </div>

                    <!-- Confirm Password -->
                    <div class="form-group" style="margin-bottom: 24px;">
                        <label for="confirmNewPassword" style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px; font-weight: 600; color: #1f2937; font-size: 14px;">
                            <i class="fas fa-lock-open" style="color: #0891b2;"></i>
                            Confirm New Password <span class="required" style="color: #ef4444;">*</span>
                        </label>
                        <div style="position: relative;">
                            <input type="password" id="confirmNewPassword" name="confirm_new_password" required class="form-input" 
                                   placeholder="Re-enter new password"
                                   style="width: 100%; padding: 12px 45px 12px 16px; border: 2px solid #cbd5e1; border-radius: 10px; transition: all 0.3s; font-size: 14px;">
                            <button type="button" class="toggle-password" onclick="togglePasswordVisibility('confirmNewPassword', this)" 
                                    style="position: absolute; right: 14px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #94a3b8; cursor: pointer; padding: 6px 10px; transition: color 0.2s;">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Password Reset Info -->
                    <div class="form-group" style="margin-bottom: 0;">
                        <div style="display: flex; align-items: start; gap: 14px; padding: 18px; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-left: 4px solid #f59e0b; border-radius: 10px; box-shadow: 0 2px 8px rgba(245, 158, 11, 0.1);">
                            <i class="fas fa-exclamation-triangle" style="color: #f59e0b; font-size: 20px; margin-top: 2px;"></i>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; color: #92400e; margin-bottom: 6px; font-size: 14px;">
                                    Password Reset Notice
                                </div>
                                <div style="font-size: 13px; color: #78350f; line-height: 1.6;">
                                    The user will be able to login immediately with the new password. Make sure to inform them of the password change.
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer" style="background: #f8fafc; margin: 28px -32px -32px -32px; padding: 20px 32px; gap: 12px; display: flex; justify-content: flex-end; border-top: 1px solid #e2e8f0;">
                <button type="button" class="btn btn-secondary" id="cancelResetPassword" 
                        style="padding: 12px 24px; border-radius: 8px; font-weight: 600; transition: all 0.3s; background: white; border: 2px solid #cbd5e1; color: #475569;">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button type="button" class="btn btn-primary" id="confirmResetPassword"
                        style="background: linear-gradient(135deg, #0891b2 0%, #0e7490 100%); border: none; padding: 12px 28px; border-radius: 8px; font-weight: 600; transition: all 0.3s; box-shadow: 0 4px 12px rgba(8, 145, 178, 0.3); color: white;">
                    <i class="fas fa-key"></i> Reset Password
                </button>
            </div>
        </div>
    </div>

    <script>
        // Toggle password visibility function
        function togglePasswordVisibility(inputId, button) {
            const input = document.getElementById(inputId);
            const icon = button.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
                button.style.color = '#667eea';
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
                button.style.color = '#9ca3af';
            }
        }

        // Add focus styles for password inputs
        document.addEventListener('DOMContentLoaded', function() {
            const passwordInputs = document.querySelectorAll('#resetNewPassword, #confirmNewPassword');
            passwordInputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.style.borderColor = '#667eea';
                    this.style.boxShadow = '0 0 0 3px rgba(102, 126, 234, 0.1)';
                });
                input.addEventListener('blur', function() {
                    this.style.borderColor = '#e5e7eb';
                    this.style.boxShadow = 'none';
                });
            });
        });
    </script>

    <!-- Priest Management CRUD Modals -->
    
    <!-- Add Priest Modal -->
    <div id="addPriestModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-church"></i> Add New Priest</h2>
                <button type="button" class="close-btn" id="closeAddPriest">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addPriestForm">
                    <div class="form-group">
                        <label for="priestFullName">Full Name *</label>
                        <input type="text" id="priestFullName" name="full_name" required placeholder="Father John Doe">
                    </div>
                    <div class="form-group">
                        <label for="priestEmail">Email Address *</label>
                        <input type="email" id="priestEmail" name="email" required placeholder="priest@churchease.com">
                    </div>
                    <div class="form-group">
                        <label for="priestPhone">Phone Number</label>
                        <input type="tel" id="priestPhone" name="phone" placeholder="+63 912 345 6789">
                    </div>
                    <div class="form-group">
                        <label for="priestSpecialization">Specialization *</label>
                        <select id="priestSpecialization" name="specialization" required>
                            <option value="">Select Specialization</option>
                            <option value="All church services">All church services</option>
                            <option value="Wedding ceremonies">Wedding ceremonies</option>
                            <option value="Baptism services">Baptism services</option>
                            <option value="Funeral services">Funeral services</option>
                            <option value="Confirmation services">Confirmation services</option>
                            <option value="Youth ministry">Youth ministry</option>
                            <option value="General services">General services</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="priestStatus">Status</label>
                        <select id="priestStatus" name="status">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelAddPriest">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirmAddPriest">
                    <i class="fas fa-plus"></i> Add Priest
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Priest Modal -->
    <div id="editPriestModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> Edit Priest</h2>
                <button type="button" class="close-btn" id="closeEditPriest">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editPriestForm">
                    <input type="hidden" id="editPriestId" name="priest_id">
                    <div class="form-group">
                        <label for="editPriestFullName">Full Name *</label>
                        <input type="text" id="editPriestFullName" name="full_name" required>
                    </div>
                    <div class="form-group">
                        <label for="editPriestEmail">Email Address *</label>
                        <input type="email" id="editPriestEmail" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="editPriestPhone">Phone Number</label>
                        <input type="tel" id="editPriestPhone" name="phone">
                    </div>
                    <div class="form-group">
                        <label for="editPriestSpecialization">Specialization *</label>
                        <select id="editPriestSpecialization" name="specialization" required>
                            <option value="">Select Specialization</option>
                            <option value="All church services">All church services</option>
                            <option value="Wedding ceremonies">Wedding ceremonies</option>
                            <option value="Baptism services">Baptism services</option>
                            <option value="Funeral services">Funeral services</option>
                            <option value="Confirmation services">Confirmation services</option>
                            <option value="Youth ministry">Youth ministry</option>
                            <option value="General services">General services</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editPriestStatus">Status</label>
                        <select id="editPriestStatus" name="status">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelEditPriest">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirmEditPriest">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Priest Modal -->
    <div id="deletePriestModal" class="modal" style="display: none;">
        <div class="modal-content delete-modal">
            <div class="modal-header">
                <h2><i class="fas fa-exclamation-triangle"></i> Remove Priest</h2>
                <button type="button" class="close-btn" id="closeDeletePriest">&times;</button>
            </div>
            <div class="modal-body">
                <div class="warning-message">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>Are you sure you want to remove this priest?</p>
                    <p class="priest-info" id="deletePriestInfo">This action cannot be undone.</p>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="confirmPriestDeletion">
                        I understand that this will remove the priest from the system
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelDeletePriest">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeletePriest" disabled>
                    <i class="fas fa-trash"></i> Remove Priest
                </button>
            </div>
        </div>
    </div>

    <style>
        /* User Management CRUD Styles */
        .section-subtitle {
            color: #6b7280;
            font-size: 14px;
            margin-top: 4px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .users-table-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }

        .users-table-section .table-container {
            margin: 0;
            border-radius: 0;
            box-shadow: none;
            border: none;
        }

        @media (max-width: 768px) {
            .header-actions {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }
            
            .header-actions .btn,
            .header-actions .export-btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-left: 4px solid #3b82f6;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 10000;
            min-width: 300px;
            max-width: 400px;
            animation: slideIn 0.3s ease-out;
        }

        .notification-success {
            border-left-color: #10b981;
        }

        .notification-error {
            border-left-color: #ef4444;
        }

        .notification-info {
            border-left-color: #3b82f6;
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .notification-content i {
            font-size: 16px;
        }

        .notification-success .notification-content i {
            color: #10b981;
        }

        .notification-error .notification-content i {
            color: #ef4444;
        }

        .notification-info .notification-content i {
            color: #3b82f6;
        }

        .notification-close {
            background: none;
            border: none;
            font-size: 18px;
            color: #6b7280;
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .notification-close:hover {
            color: #374151;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* User Details Form Layout - Same as Edit User */
        .user-details-form {
            text-align: left !important;
        }

        #viewUserModal .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        #viewUserModal .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        #viewUserModal .form-group label {
            font-weight: 600;
            color: #374151;
            font-size: 14px;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            text-align: left !important;
        }

        #viewUserModal .form-display {
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 500;
            background: white;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            color: #374151;
            text-align: left !important;
            min-height: 20px;
            transition: all 0.2s ease;
        }

        #viewUserModal .form-display:hover {
            border-color: #d1d5db;
        }

        /* Special styling for role and status */
        #viewUserModal .form-display.role-badge {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-block;
            width: fit-content;
            border: none;
        }

        #viewUserModal .form-display.status-badge {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-block;
            width: fit-content;
            border: none;
        }

        #viewUserModal .form-display.email-display {
            color: #1d4ed8;
            font-weight: 500;
        }

        /* Override any inherited center alignment */
        #viewUserModal .modal-body,
        #viewUserModal .modal-body *,
        #viewUserModal .user-details-grid,
        #viewUserModal .user-details-grid *,
        #viewUserModal .detail-item,
        #viewUserModal .detail-item *,
        #viewUserModal .detail-item label,
        #viewUserModal .detail-item span {
            text-align: left !important;
            justify-content: flex-start !important;
            align-items: flex-start !important;
        }

        /* Additional specific overrides */
        .modal-content .user-details-grid .detail-item {
            align-items: flex-start !important;
            text-align: left !important;
        }

        .modal-content .user-details-grid .detail-item label,
        .modal-content .user-details-grid .detail-item span {
            text-align: left !important;
            display: block !important;
            width: 100% !important;
        }

        /* Force left alignment for View User Modal specifically */
        #viewUserModal {
            text-align: left !important;
        }

        #viewUserModal * {
            text-align: left !important;
        }

        #viewUserModal .modal-body {
            text-align: left !important;
            padding: 20px !important;
        }

        /* Ensure labels are on top and values below */
        #viewUserModal .detail-item {
            display: block !important;
            text-align: left !important;
        }

        #viewUserModal .detail-item label {
            display: block !important;
            text-align: left !important;
            margin-bottom: 6px !important;
            width: 100% !important;
        }

        #viewUserModal .detail-item span {
            display: block !important;
            text-align: left !important;
            width: 100% !important;
        }

        /* Enhanced Modal Styling - Exact same as Edit User */
        #viewUserModal .modal-content {
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border: none;
            overflow: hidden;
            max-width: 600px;
        }

        #viewUserModal .modal-header {
            background: linear-gradient(135deg, #1e40af 0%, #0369a1 100%);
            color: white;
            padding: 24px 28px;
            border-bottom: none;
        }

        #viewUserModal .modal-header h2 {
            margin: 0;
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #viewUserModal .modal-header h2 i {
            font-size: 18px;
            opacity: 0.9;
        }

        #viewUserModal .modal-body {
            background: #fafbfc;
            padding: 28px !important;
        }

        #viewUserModal .modal-footer {
            background: white;
            padding: 20px 28px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        #viewUserModal .btn {
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        #viewUserModal .btn-secondary {
            background: white;
            border: 2px solid #e5e7eb;
            color: #6b7280;
        }

        #viewUserModal .btn-secondary:hover {
            border-color: #d1d5db;
            background: #f9fafb;
        }

        /* Icon styling in labels */
        .detail-item label i {
            margin-right: 6px;
            opacity: 0.7;
            font-size: 10px;
        }

        /* Responsive design - Same as Edit User */
        @media (max-width: 768px) {
            #viewUserModal .form-row {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            #viewUserModal .modal-body {
                padding: 20px !important;
            }

            #viewUserModal .modal-footer {
                flex-direction: column;
                gap: 8px;
            }

            #viewUserModal .btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Professional Edit User Modal Styling */
        #editUserModal .modal-content {
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border: none;
            overflow: hidden;
            max-width: 600px;
        }

        #editUserModal .modal-header {
            background: linear-gradient(135deg, #1e40af 0%, #0369a1 100%);
            color: white;
            padding: 24px 28px;
            border-bottom: none;
        }

        #editUserModal .modal-header h2 {
            margin: 0;
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #editUserModal .modal-header h2 i {
            font-size: 18px;
            opacity: 0.9;
        }

        #editUserModal .modal-body {
            background: #fafbfc;
            padding: 28px !important;
        }

        #editUserModal .modal-footer {
            background: white;
            padding: 20px 28px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* Professional Form Styling */
        #editUserModal .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        #editUserModal .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        #editUserModal .form-group label {
            font-weight: 600;
            color: #374151;
            font-size: 14px;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        #editUserModal .form-input {
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 500;
            background: white;
            transition: all 0.2s ease;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        #editUserModal .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            background: #fefefe;
        }

        #editUserModal .form-input:hover {
            border-color: #d1d5db;
        }

        #editUserModal .required {
            color: #ef4444;
            font-weight: 700;
        }

        /* Enhanced Button Styling */
        #editUserModal .btn {
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        #editUserModal .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            border: none;
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        #editUserModal .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
        }

        #editUserModal .btn-secondary {
            background: white;
            border: 2px solid #e5e7eb;
            color: #6b7280;
        }

        #editUserModal .btn-secondary:hover {
            border-color: #d1d5db;
            background: #f9fafb;
        }

        /* Responsive form design */
        @media (max-width: 768px) {
            #editUserModal .form-row {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            #editUserModal .modal-body {
                padding: 20px !important;
            }

            #editUserModal .modal-footer {
                flex-direction: column;
                gap: 8px;
            }

            #editUserModal .btn {
                width: 100%;
                justify-content: center;
            }
        }

        .delete-warning {
            text-align: center;
            margin: 20px 0;
        }

        .delete-warning i {
            font-size: 48px;
            color: #ef4444;
            margin-bottom: 16px;
        }

        .delete-warning p {
            font-size: 16px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .delete-subtitle {
            font-size: 14px !important;
            font-weight: 400 !important;
            color: #6b7280 !important;
        }

        .user-info-delete {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin: 20px 0;
        }

        .user-info-delete .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .user-info-delete .info-item:last-child {
            border-bottom: none;
        }

        .user-info-delete .label {
            font-weight: 600;
            color: #374151;
        }

        .user-info-delete .value {
            color: #6b7280;
        }

        .reset-password-info {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 20px;
        }

        .reset-password-info p {
            margin: 0;
            color: #92400e;
            font-size: 14px;
        }

        .action-btn-danger {
            background-color: #ef4444;
            color: white;
        }

        .action-btn-danger:hover {
            background-color: #dc2626;
        }

        .status-badge.status-info {
            background-color: #dbeafe;
            color: #1e40af;
        }

        .required {
            color: #ef4444;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .user-details-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <script>
        // User Management CRUD JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            // Load users when page loads
            loadUsers();
            
            // Add User Modal
            const addUserBtn = document.getElementById('addUserBtn');
            const addUserModal = document.getElementById('addUserModal');
            const closeAddUserModal = document.getElementById('closeAddUserModal');
            const cancelAddUser = document.getElementById('cancelAddUser');
            const saveNewUser = document.getElementById('saveNewUser');

            if (addUserBtn) {
                addUserBtn.addEventListener('click', function() {
                    document.getElementById('addUserForm').reset();
                    addUserModal.style.display = 'flex';
                });
            }

            if (closeAddUserModal) {
                closeAddUserModal.addEventListener('click', function() {
                    addUserModal.style.display = 'none';
                });
            }

            if (cancelAddUser) {
                cancelAddUser.addEventListener('click', function() {
                    addUserModal.style.display = 'none';
                });
            }

            if (saveNewUser) {
                saveNewUser.addEventListener('click', function() {
                    createUser();
                });
            }

            // View User Modal
            const viewUserModal = document.getElementById('viewUserModal');
            const closeViewUserModal = document.getElementById('closeViewUserModal');
            const closeViewUser = document.getElementById('closeViewUser');
            
            if (closeViewUserModal) {
                closeViewUserModal.addEventListener('click', function() {
                    viewUserModal.style.display = 'none';
                });
            }
            
            if (closeViewUser) {
                closeViewUser.addEventListener('click', function() {
                    viewUserModal.style.display = 'none';
                });
            }

            // Edit User Modal
            const editUserModal = document.getElementById('editUserModal');
            const closeEditUserModal = document.getElementById('closeEditUserModal');
            const cancelEditUser = document.getElementById('cancelEditUser');
            const saveEditUser = document.getElementById('saveEditUser');
            
            if (closeEditUserModal) {
                closeEditUserModal.addEventListener('click', function() {
                    editUserModal.style.display = 'none';
                });
            }
            
            if (cancelEditUser) {
                cancelEditUser.addEventListener('click', function() {
                    editUserModal.style.display = 'none';
                });
            }
            
            if (saveEditUser) {
                saveEditUser.addEventListener('click', function() {
                    updateUser();
                });
            }

            // Delete User Modal
            const deleteUserModal = document.getElementById('deleteUserModal');
            const closeDeleteUserModal = document.getElementById('closeDeleteUserModal');
            const cancelDeleteUser = document.getElementById('cancelDeleteUser');
            const confirmDeleteUserBtn = document.getElementById('confirmDeleteUser');
            
            if (closeDeleteUserModal) {
                closeDeleteUserModal.addEventListener('click', function() {
                    deleteUserModal.style.display = 'none';
                });
            }
            
            if (cancelDeleteUser) {
                cancelDeleteUser.addEventListener('click', function() {
                    deleteUserModal.style.display = 'none';
                });
            }
            
            if (confirmDeleteUserBtn) {
                confirmDeleteUserBtn.addEventListener('click', function() {
                    confirmDeleteUser();
                });
            }

            // Reset Password Modal
            const resetPasswordModal = document.getElementById('resetPasswordModal');
            const closeResetPasswordModal = document.getElementById('closeResetPasswordModal');
            const cancelResetPassword = document.getElementById('cancelResetPassword');
            const confirmResetPassword = document.getElementById('confirmResetPassword');
            
            if (closeResetPasswordModal) {
                closeResetPasswordModal.addEventListener('click', function() {
                    resetPasswordModal.style.display = 'none';
                });
            }
            
            if (cancelResetPassword) {
                cancelResetPassword.addEventListener('click', function() {
                    resetPasswordModal.style.display = 'none';
                });
            }
            
            if (confirmResetPassword) {
                confirmResetPassword.addEventListener('click', function() {
                    confirmResetPassword();
                });
            }

            // Close modals when clicking outside
            window.addEventListener('click', function(e) {
                if (e.target === addUserModal) {
                    addUserModal.style.display = 'none';
                }
                if (e.target === viewUserModal) {
                    viewUserModal.style.display = 'none';
                }
                if (e.target === editUserModal) {
                    editUserModal.style.display = 'none';
                }
                if (e.target === deleteUserModal) {
                    deleteUserModal.style.display = 'none';
                }
                if (e.target === resetPasswordModal) {
                    resetPasswordModal.style.display = 'none';
                }
            });

            // User Table Actions
            document.addEventListener('click', function(e) {
                if (e.target.closest('[data-action="view"]')) {
                    const element = e.target.closest('[data-action="view"]');
                    const userId = element.getAttribute('data-user-id');
                    const reservationId = element.getAttribute('data-reservation-id');
                    
                    // Check if it's a user or reservation
                    if (userId) {
                        viewUser(userId);
                    } else if (reservationId) {
                        // Call the new viewReservationDetails function
                        viewReservationDetails(reservationId);
                    }
                }
                
                if (e.target.closest('[data-action="edit"]')) {
                    const userId = e.target.closest('[data-action="edit"]').getAttribute('data-user-id');
                    if (userId) {
                        editUser(userId);
                    }
                }
                
                if (e.target.closest('[data-action="delete"]')) {
                    const userId = e.target.closest('[data-action="delete"]').getAttribute('data-user-id');
                    if (userId) {
                        deleteUser(userId);
                    }
                }
                
                if (e.target.closest('[data-action="reset-password"]')) {
                    const userId = e.target.closest('[data-action="reset-password"]').getAttribute('data-user-id');
                    if (userId) {
                        resetPassword(userId);
                    }
                }
            });

            // User Search Functionality
            const userSearchInput = document.getElementById('userSearchInput');
            const clearUserSearch = document.getElementById('clearUserSearch');

            if (userSearchInput) {
                userSearchInput.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    filterUsers(searchTerm);
                    
                    if (clearUserSearch) {
                        clearUserSearch.style.display = searchTerm ? 'block' : 'none';
                    }
                });
            }

            if (clearUserSearch) {
                clearUserSearch.addEventListener('click', function() {
                    userSearchInput.value = '';
                    filterUsers('');
                    this.style.display = 'none';
                });
            }

            // Role Filter Functionality
            document.querySelectorAll('.role-filter-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.role-filter-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    const filter = this.getAttribute('data-filter');
                    filterUsersByRole(filter);
                });
            });
        });

        // API Functions
        async function loadUsers() {
            try {
                const response = await fetch('/api/users');
                const data = await response.json();
                
                if (data.success) {
                    displayUsers(data.users);
                } else {
                    console.error('Failed to load users:', data.error);
                    showNotification('Failed to load users', 'error');
                }
            } catch (error) {
                console.error('Error loading users:', error);
                showNotification('Error loading users', 'error');
            }
        }

        function displayUsers(users) {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';
            
            users.forEach((user, index) => {
                const row = document.createElement('tr');
                const formattedDate = user.created_at ? new Date(user.created_at).toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                }) : 'N/A';
                
                const roleClass = user.role === 'admin' ? 'status-confirmed' : 
                                 user.role === 'priest' ? 'status-info' : 'status-pending';
                
                row.innerHTML = `
                    <td>#${String(index + 1).padStart(3, '0')}</td>
                    <td>${user.full_name}</td>
                    <td>${user.username}</td>
                    <td>${user.email}</td>
                    <td><span class="status-badge ${roleClass}">${user.role.charAt(0).toUpperCase() + user.role.slice(1)}</span></td>
                    <td><span class="status-badge status-confirmed">${user.status.charAt(0).toUpperCase() + user.status.slice(1)}</span></td>
                    <td>${formattedDate}</td>
                    <td class="table-actions">
                        <button class="action-btn" data-action="view" data-user-id="${user.id}" title="View Details">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn" data-action="edit" data-user-id="${user.id}" title="Edit User">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn" data-action="reset-password" data-user-id="${user.id}" title="Reset Password">
                            <i class="fas fa-key"></i>
                        </button>
                        ${user.role !== 'admin' ? `
                        <button class="action-btn action-btn-danger" data-action="delete" data-user-id="${user.id}" title="Delete User">
                            <i class="fas fa-trash"></i>
                        </button>
                        ` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        async function createUser() {
            const form = document.getElementById('addUserForm');
            const formData = new FormData(form);
            
            // Get form values
            const fullName = formData.get('full_name');
            const username = formData.get('username');
            const email = formData.get('email');
            const password = formData.get('password');
            const confirmPassword = formData.get('confirm_password');
            const role = formData.get('role');
            
            // Validate required fields
            if (!fullName || !username || !email || !password || !confirmPassword || !role) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            // Validate password confirmation
            if (password !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }
            
            // Validate password strength
            if (password.length < 6) {
                showNotification('Password must be at least 6 characters long', 'error');
                return;
            }
            
            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showNotification('Please enter a valid email address', 'error');
                return;
            }
            
            const userData = {
                full_name: fullName.trim(),
                username: username.trim(),
                email: email.trim(),
                password: password,
                role: role
            };
            
            try {
                // Show loading state
                const saveButton = document.getElementById('saveNewUser');
                const originalText = saveButton.innerHTML;
                saveButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating...';
                saveButton.disabled = true;
                
                console.log('Creating new user:', userData.username, userData.email, userData.role);
                
                const response = await fetch('/api/users', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });
                
                const data = await response.json();
                console.log('User creation response:', data);
                
                // Restore button state
                saveButton.innerHTML = originalText;
                saveButton.disabled = false;
                
                if (data.success) {
                    document.getElementById('addUserModal').style.display = 'none';
                    showNotification(`User "${userData.full_name}" created successfully! They can now login with username "${userData.username}".`, 'success');
                    form.reset(); // Clear the form
                    loadUsers(); // Reload users table
                } else {
                    showNotification(data.error || 'Failed to create user', 'error');
                }
            } catch (error) {
                console.error('Error creating user:', error);
                showNotification('Network error: Unable to create user', 'error');
                
                // Restore button state on error
                const saveButton = document.getElementById('saveNewUser');
                saveButton.innerHTML = '<i class="fas fa-save"></i> Create User';
                saveButton.disabled = false;
            }
        }


        async function viewUser(userId) {
            try {
                const response = await fetch(`/api/users/${userId}`);
                const data = await response.json();
                
                if (data.success) {
                    const user = data.user;
                    
                    // Populate view modal with user data
                    document.getElementById('viewUserFullName').textContent = user.full_name || '-';
                    document.getElementById('viewUserUsername').textContent = user.username || '-';
                    document.getElementById('viewUserEmail').textContent = user.email || '-';
                    
                    // Format role with proper styling
                    const roleElement = document.getElementById('viewUserRole');
                    roleElement.textContent = user.role ? user.role.charAt(0).toUpperCase() + user.role.slice(1) : '-';
                    roleElement.className = 'form-display role-badge';
                    
                    // Format status with proper styling
                    const statusElement = document.getElementById('viewUserStatus');
                    statusElement.textContent = user.status ? user.status.charAt(0).toUpperCase() + user.status.slice(1) : '-';
                    statusElement.className = 'form-display status-badge';
                    
                    // Format created date
                    const createdDate = user.created_at ? new Date(user.created_at).toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    }) : 'Not Available';
                    document.getElementById('viewUserCreated').textContent = createdDate;
                    
                    // Add email styling
                    const emailElement = document.getElementById('viewUserEmail');
                    emailElement.className = 'form-display email-display';
                    
                    document.getElementById('viewUserModal').style.display = 'flex';
                } else {
                    showNotification(data.error || 'Failed to load user details', 'error');
                }
            } catch (error) {
                console.error('Error loading user:', error);
                showNotification('Error loading user details', 'error');
            }
        }

        async function editUser(userId) {
            try {
                const response = await fetch(`/api/users/${userId}`);
                const data = await response.json();
                
                if (data.success) {
                    const user = data.user;
                    
                    document.getElementById('editUserId').value = user.id;
                    document.getElementById('editUserFullName').value = user.full_name;
                    document.getElementById('editUserUsername').value = user.username;
                    document.getElementById('editUserEmail').value = user.email;
                    document.getElementById('editUserRole').value = user.role;
                    document.getElementById('editUserStatus').value = user.status;
                    
                    document.getElementById('editUserModal').style.display = 'flex';
                } else {
                    showNotification(data.error || 'Failed to load user details', 'error');
                }
            } catch (error) {
                console.error('Error loading user:', error);
                showNotification('Error loading user details', 'error');
            }
        }

        async function deleteUser(userId) {
            try {
                const response = await fetch(`/api/users/${userId}`);
                const data = await response.json();
                
                if (data.success) {
                    const user = data.user;
                    
                    document.getElementById('deleteUserId').value = user.id;
                    document.getElementById('deleteUserName').textContent = user.full_name;
                    document.getElementById('deleteUserUsername').textContent = user.username;
                    document.getElementById('deleteUserRole').textContent = user.role.charAt(0).toUpperCase() + user.role.slice(1);
                    
                    document.getElementById('deleteUserModal').style.display = 'flex';
                } else {
                    showNotification(data.error || 'Failed to load user details', 'error');
                }
            } catch (error) {
                console.error('Error loading user:', error);
                showNotification('Error loading user details', 'error');
            }
        }

        async function resetPassword(userId) {
            try {
                const response = await fetch(`/api/users/${userId}`);
                const data = await response.json();
                
                if (data.success) {
                    const user = data.user;
                    
                    document.getElementById('resetPasswordUserId').value = user.id;
                    document.getElementById('resetPasswordUserName').textContent = user.full_name;
                    
                    document.getElementById('resetPasswordModal').style.display = 'flex';
                } else {
                    showNotification(data.error || 'Failed to load user details', 'error');
                }
            } catch (error) {
                console.error('Error loading user:', error);
                showNotification('Error loading user details', 'error');
            }
        }

        // Additional CRUD Operations
        async function updateUser() {
            const userId = document.getElementById('editUserId').value;
            const form = document.getElementById('editUserForm');
            const formData = new FormData(form);
            
            // Validate required fields
            const fullName = formData.get('full_name');
            const username = formData.get('username');
            const email = formData.get('email');
            const role = formData.get('role');
            
            if (!fullName || !username || !email || !role) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showNotification('Please enter a valid email address', 'error');
                return;
            }
            
            const userData = {
                full_name: fullName.trim(),
                username: username.trim(),
                email: email.trim(),
                role: role,
                status: formData.get('status') || 'active'
            };
            
            try {
                // Show loading state
                const saveButton = document.getElementById('saveEditUser');
                const originalText = saveButton.innerHTML;
                saveButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';
                saveButton.disabled = true;
                
                const response = await fetch(`/api/users/${userId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });
                
                const data = await response.json();
                
                // Restore button state
                saveButton.innerHTML = originalText;
                saveButton.disabled = false;
                
                if (data.success) {
                    document.getElementById('editUserModal').style.display = 'none';
                    showNotification('User updated successfully!', 'success');
                    loadUsers(); // Reload users table
                } else {
                    showNotification(data.error || 'Failed to update user', 'error');
                }
            } catch (error) {
                console.error('Error updating user:', error);
                showNotification('Network error: Unable to update user', 'error');
                
                // Restore button state on error
                const saveButton = document.getElementById('saveEditUser');
                saveButton.innerHTML = '<i class="fas fa-save"></i> Update User';
                saveButton.disabled = false;
            }
        }

        async function confirmDeleteUser() {
            const userId = document.getElementById('deleteUserId').value;
            
            try {
                const response = await fetch(`/api/users/${userId}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('deleteUserModal').style.display = 'none';
                    showNotification('User deleted successfully', 'success');
                    loadUsers(); // Reload users table
                } else {
                    showNotification(data.error || 'Failed to delete user', 'error');
                }
            } catch (error) {
                console.error('Error deleting user:', error);
                showNotification('Error deleting user', 'error');
            }
        }

        async function confirmResetPassword() {
            const userId = document.getElementById('resetPasswordUserId').value;
            const form = document.getElementById('resetPasswordForm');
            const formData = new FormData(form);
            
            const newPassword = formData.get('new_password');
            const confirmPassword = formData.get('confirm_new_password');
            
            // Validate required fields
            if (!newPassword || !confirmPassword) {
                showNotification('Please fill in all password fields', 'error');
                return;
            }
            
            // Validate password match
            if (newPassword !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }
            
            // Validate password strength
            if (newPassword.length < 6) {
                showNotification('Password must be at least 6 characters long', 'error');
                return;
            }
            
            const resetData = {
                new_password: newPassword
            };
            
            try {
                // Show loading state
                const resetButton = document.getElementById('confirmResetPassword');
                const originalText = resetButton.innerHTML;
                resetButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Resetting...';
                resetButton.disabled = true;
                
                console.log('Sending password reset request for user:', userId);
                
                const response = await fetch(`/api/users/${userId}/reset-password`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(resetData)
                });
                
                const data = await response.json();
                console.log('Password reset response:', data);
                
                // Restore button state
                resetButton.innerHTML = originalText;
                resetButton.disabled = false;
                
                if (data.success) {
                    document.getElementById('resetPasswordModal').style.display = 'none';
                    showNotification('Password reset successfully! User can now login with the new password.', 'success');
                    form.reset();
                    
                    // Refresh users table to show updated timestamp
                    loadUsers();
                } else {
                    showNotification(data.error || 'Failed to reset password', 'error');
                }
            } catch (error) {
                console.error('Error resetting password:', error);
                showNotification('Network error: Unable to reset password', 'error');
                
                // Restore button state on error
                const resetButton = document.getElementById('confirmResetPassword');
                resetButton.innerHTML = '<i class="fas fa-key"></i> Reset Password';
                resetButton.disabled = false;
            }
        }

        // Notification System
        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                    <span>${message}</span>
                </div>
                <button class="notification-close">&times;</button>
            `;
            
            // Add to page
            document.body.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
            
            // Close button functionality
            notification.querySelector('.notification-close').addEventListener('click', () => {
                notification.remove();
            });
        }

        // Refresh functionality
        function refreshUsers() {
            loadUsers();
            showNotification('Users refreshed', 'success');
        }

        function filterUsers(searchTerm) {
            const rows = document.querySelectorAll('#usersTableBody tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function filterUsersByRole(role) {
            const rows = document.querySelectorAll('#usersTableBody tr');
            rows.forEach(row => {
                if (role === 'all') {
                    row.style.display = '';
                } else {
                    const roleCell = row.querySelector('td:nth-child(5)');
                    const userRole = roleCell ? roleCell.textContent.toLowerCase() : '';
                    row.style.display = userRole.includes(role) ? '' : 'none';
                }
            });
        }

        // Event Listeners for Modal Actions
        document.addEventListener('DOMContentLoaded', function() {
            // Save Edit User
            const saveEditUser = document.getElementById('saveEditUser');
            if (saveEditUser) {
                saveEditUser.addEventListener('click', updateUser);
            }
            
            // Confirm Delete User
            const confirmDeleteUserBtn = document.getElementById('confirmDeleteUser');
            if (confirmDeleteUserBtn) {
                confirmDeleteUserBtn.addEventListener('click', confirmDeleteUser);
            }
            
            // Confirm Reset Password
            const confirmResetPasswordBtn = document.getElementById('confirmResetPassword');
            if (confirmResetPasswordBtn) {
                confirmResetPasswordBtn.addEventListener('click', confirmResetPassword);
            }
            
            // Refresh Users Button
            const refreshUsersBtn = document.getElementById('refreshUsersBtn');
            if (refreshUsersBtn) {
                refreshUsersBtn.addEventListener('click', refreshUsers);
            }
        });

        // ============================================================================
        // STIPENDIUM TRACKING FUNCTIONALITY
        // ============================================================================

        let stipendiumChart = null;

        // Load stipendium summary data
        async function loadStipendiumSummary() {
            try {
                const response = await fetch('/api/stipendium/summary');
                const data = await response.json();
                
                if (data.success) {
                    const summary = data.data;
                    
                    // Update summary cards
                    document.querySelector('#stipendiumTrackingModule .stat-card:nth-child(1) .stat-value').textContent = `â‚±${summary.total_stipendium.toLocaleString()}`;
                    document.querySelector('#stipendiumTrackingModule .stat-card:nth-child(1) .stat-trend').textContent = `${summary.stipendium_growth >= 0 ? '+' : ''}${summary.stipendium_growth}%`;
                    document.querySelector('#stipendiumTrackingModule .stat-card:nth-child(1) .stat-trend').className = `stat-trend ${summary.stipendium_growth >= 0 ? 'trend-up' : 'trend-down'}`;
                    
                    document.querySelector('#stipendiumTrackingModule .stat-card:nth-child(2) .stat-value').textContent = summary.paid_reservations;
                    document.querySelector('#stipendiumTrackingModule .stat-card:nth-child(3) .stat-value').textContent = summary.pending_payments;
                    document.querySelector('#stipendiumTrackingModule .stat-card:nth-child(4) .stat-value').textContent = `â‚±${summary.average_payment.toLocaleString()}`;
                }
            } catch (error) {
                console.error('Error loading stipendium summary:', error);
            }
        }

        // Load payment records table
        async function loadStipendiumPayments() {
            try {
                const response = await fetch('/api/stipendium/payments');
                const data = await response.json();
                
                if (data.success) {
                    const payments = data.data;
                    const tableBody = document.getElementById('stipendiumTableBody');
                    
                    if (tableBody) {
                        tableBody.innerHTML = '';
                        
                        payments.forEach(payment => {
                            const row = document.createElement('tr');
                            
                            // Format payment status
                            let statusClass = 'status-pending';
                            let statusText = payment.payment_status;
                            
                            if (payment.payment_status === 'Paid') {
                                statusClass = 'status-confirmed';
                                statusText = 'Fully Paid';
                            } else if (payment.payment_status === 'Partial') {
                                statusClass = 'status-pending';
                                statusText = 'Partial Payment';
                            } else {
                                statusClass = 'status-cancelled';
                                statusText = 'Pending Payment';
                            }
                            
                            // Format service badge
                            const serviceBadge = `<span class="service-badge ${payment.service_type.toLowerCase()}">${payment.service_type.charAt(0).toUpperCase() + payment.service_type.slice(1)}</span>`;
                            
                            // Format date
                            const date = new Date(payment.created_at).toLocaleDateString('en-US', {
                                year: 'numeric',
                                month: 'short',
                                day: 'numeric'
                            });
                            
                            row.innerHTML = `
                                <td>#${payment.payment_id.substring(0, 8)}</td>
                                <td>${payment.client_name || 'N/A'}</td>
                                <td>${serviceBadge}</td>
                                <td>â‚±${payment.amount_paid.toLocaleString()}</td>
                                <td>â‚±${payment.amount_due.toLocaleString()}</td>
                                <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                                <td>${payment.payment_method || '-'}</td>
                                <td>${date}</td>
                                <td class="table-actions">
                                    <button class="action-btn" data-action="view" title="View Details">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="action-btn" data-action="receipt" title="Print Receipt">
                                        <i class="fas fa-receipt"></i>
                                    </button>
                                    <button class="action-btn" data-action="edit" title="Edit Payment">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </td>
                            `;
                            
                            tableBody.appendChild(row);
                        });
                    }
                }
            } catch (error) {
                console.error('Error loading stipendium payments:', error);
            }
        }

        // Load service breakdown chart
        async function loadStipendiumChart() {
            try {
                const response = await fetch('/api/stipendium/service-breakdown');
                const data = await response.json();
                
                if (data.success) {
                    const chartData = data.data;
                    const ctx = document.getElementById('stipendiumServiceChart');
                    
                    if (ctx) {
                        // Destroy existing chart if it exists
                        if (stipendiumChart) {
                            stipendiumChart.destroy();
                        }
                        
                        stipendiumChart = new Chart(ctx, {
                            type: 'doughnut',
                            data: {
                                labels: chartData.labels,
                                datasets: [{
                                    data: chartData.amounts,
                                    backgroundColor: [
                                        '#fbbf24', // Wedding - Gold
                                        '#60a5fa', // Baptism - Blue
                                        '#9ca3af', // Funeral - Gray
                                        '#c084fc'  // Confirmation - Purple
                                    ],
                                    borderWidth: 2,
                                    borderColor: '#ffffff'
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'bottom',
                                        labels: {
                                            padding: 20,
                                            usePointStyle: true
                                        }
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                const label = context.label || '';
                                                const value = context.parsed;
                                                return `${label}: â‚±${value.toLocaleString()}`;
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }
                }
            } catch (error) {
                console.error('Error loading stipendium chart:', error);
            }
        }

        // Load payment summary
        async function loadPaymentSummary() {
            try {
                const [serviceResponse, collectionResponse] = await Promise.all([
                    fetch('/api/stipendium/service-breakdown'),
                    fetch('/api/stipendium/collection-rate')
                ]);
                
                const serviceData = await serviceResponse.json();
                const collectionData = await collectionResponse.json();
                
                if (serviceData.success && collectionData.success) {
                    const services = serviceData.data;
                    const collection = collectionData.data;
                    
                    // Update payment summary
                    const summaryItems = document.querySelectorAll('#stipendiumTrackingModule .summary-item');
                    if (summaryItems.length >= 4) {
                        summaryItems[0].querySelector('.summary-value').textContent = `â‚±${services.amounts[0].toLocaleString()}`;
                        summaryItems[1].querySelector('.summary-value').textContent = `â‚±${services.amounts[1].toLocaleString()}`;
                        summaryItems[2].querySelector('.summary-value').textContent = `â‚±${services.amounts[2].toLocaleString()}`;
                        summaryItems[3].querySelector('.summary-value').textContent = `${collection.collection_rate}%`;
                    }
                }
            } catch (error) {
                console.error('Error loading payment summary:', error);
            }
        }

        // Refresh stipendium data
        async function refreshStipendiumData() {
            const refreshBtn = document.getElementById('refreshStipendiumBtn');
            if (refreshBtn) {
                const originalContent = refreshBtn.innerHTML;
                refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> <span>Refreshing...</span>';
                refreshBtn.disabled = true;
                
                try {
                    await Promise.all([
                        loadStipendiumSummary(),
                        loadStipendiumPayments(),
                        loadStipendiumChart(),
                        loadPaymentSummary()
                    ]);
                    
                    // Show success state
                    refreshBtn.innerHTML = '<i class="fas fa-check"></i> <span>Updated!</span>';
                    refreshBtn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                    
                    setTimeout(() => {
                        refreshBtn.innerHTML = originalContent;
                        refreshBtn.style.background = '';
                        refreshBtn.disabled = false;
                    }, 2000);
                    
                } catch (error) {
                    console.error('Error refreshing stipendium data:', error);
                    refreshBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> <span>Error</span>';
                    refreshBtn.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
                    
                    setTimeout(() => {
                        refreshBtn.innerHTML = originalContent;
                        refreshBtn.style.background = '';
                        refreshBtn.disabled = false;
                    }, 3000);
                }
            }
        }

        // Initialize stipendium tracking when module is shown
        function initializeStipendiumTracking() {
            loadStipendiumSummary();
            loadStipendiumPayments();
            loadStipendiumChart();
            loadPaymentSummary();
            
            // Add refresh button event listener
            const refreshBtn = document.getElementById('refreshStipendiumBtn');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', refreshStipendiumData);
            }
        }

        // ============================================================================
        // REPORTS MODULE FUNCTIONALITY
        // ============================================================================

        let reportsCharts = {
            monthlyReservations: null,
            serviceDistribution: null,
            revenueTrends: null,
            paymentStatus: null
        };

        // Load reports summary data
        async function loadReportsSummary() {
            try {
                const response = await fetch('/api/reports/summary');
                const data = await response.json();
                
                if (data.success) {
                    const summary = data.data;
                    
                    // Update summary cards
                    document.getElementById('total-reservations').textContent = summary.total_reservations;
                    document.getElementById('total-revenue').textContent = `â‚±${summary.total_revenue.toLocaleString()}`;
                    document.getElementById('pending-approvals').textContent = summary.pending_approvals;
                    
                    // Update growth indicators
                    document.getElementById('reservations-growth').textContent = `${summary.reservation_growth >= 0 ? '+' : ''}${summary.reservation_growth}%`;
                    document.getElementById('revenue-growth').textContent = `${summary.revenue_growth >= 0 ? '+' : ''}${summary.revenue_growth}%`;
                    
                    // Update trend classes
                    document.getElementById('reservations-growth').className = `stat-trend ${summary.reservation_growth >= 0 ? 'trend-up' : 'trend-down'}`;
                    document.getElementById('revenue-growth').className = `stat-trend ${summary.revenue_growth >= 0 ? 'trend-up' : 'trend-down'}`;
                }
            } catch (error) {
                console.error('Error loading reports summary:', error);
            }
        }

        // Load monthly reservations chart
        async function loadMonthlyReservationsChart() {
            try {
                const response = await fetch('/api/reports/monthly-reservations');
                const data = await response.json();
                
                if (data.success) {
                    const chartData = data.data;
                    const ctx = document.getElementById('monthlyReservationsChart');
                    
                    if (ctx) {
                        // Destroy existing chart
                        if (reportsCharts.monthlyReservations) {
                            reportsCharts.monthlyReservations.destroy();
                        }
                        
                        reportsCharts.monthlyReservations = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: chartData.labels,
                                datasets: [{
                                    label: 'Reservations',
                                    data: chartData.counts,
                                    borderColor: '#3b82f6',
                                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                    borderWidth: 3,
                                    fill: true,
                                    tension: 0.4,
                                    pointBackgroundColor: '#3b82f6',
                                    pointBorderColor: '#ffffff',
                                    pointBorderWidth: 2,
                                    pointRadius: 6
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        display: false
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        grid: {
                                            color: '#f1f5f9'
                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        }
                                    }
                                }
                            }
                        });
                    }
                }
            } catch (error) {
                console.error('Error loading monthly reservations chart:', error);
            }
        }

        // Load service distribution chart
        async function loadServiceDistributionChart() {
            try {
                const response = await fetch('/api/reports/service-distribution');
                const data = await response.json();
                
                if (data.success) {
                    const chartData = data.data;
                    const ctx = document.getElementById('serviceDistributionChart');
                    
                    if (ctx) {
                        // Destroy existing chart
                        if (reportsCharts.serviceDistribution) {
                            reportsCharts.serviceDistribution.destroy();
                        }
                        
                        reportsCharts.serviceDistribution = new Chart(ctx, {
                            type: 'doughnut',
                            data: {
                                labels: chartData.labels,
                                datasets: [{
                                    data: chartData.counts,
                                    backgroundColor: [
                                        '#fbbf24', // Wedding
                                        '#60a5fa', // Baptism
                                        '#9ca3af', // Funeral
                                        '#c084fc'  // Confirmation
                                    ],
                                    borderWidth: 0
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        display: false
                                    }
                                }
                            }
                        });
                    }
                }
            } catch (error) {
                console.error('Error loading service distribution chart:', error);
            }
        }

        // Load revenue trends chart
        async function loadRevenueTrendsChart() {
            try {
                const response = await fetch('/api/reports/revenue-trends');
                const data = await response.json();
                
                if (data.success) {
                    const chartData = data.data;
                    const ctx = document.getElementById('revenueTrendsChart');
                    
                    if (ctx) {
                        // Destroy existing chart
                        if (reportsCharts.revenueTrends) {
                            reportsCharts.revenueTrends.destroy();
                        }
                        
                        reportsCharts.revenueTrends = new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: chartData.labels,
                                datasets: [{
                                    label: 'Revenue',
                                    data: chartData.amounts,
                                    backgroundColor: 'rgba(16, 185, 129, 0.8)',
                                    borderColor: '#10b981',
                                    borderWidth: 1,
                                    borderRadius: 8
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        display: false
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                return `Revenue: â‚±${context.parsed.y.toLocaleString()}`;
                                            }
                                        }
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        grid: {
                                            color: '#f1f5f9'
                                        },
                                        ticks: {
                                            callback: function(value) {
                                                return 'â‚±' + value.toLocaleString();
                                            }
                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        }
                                    }
                                }
                            }
                        });
                    }
                }
            } catch (error) {
                console.error('Error loading revenue trends chart:', error);
            }
        }

        // Load payment status chart
        async function loadPaymentStatusChart() {
            try {
                const response = await fetch('/api/reports/payment-status');
                const data = await response.json();
                
                if (data.success) {
                    const chartData = data.data;
                    const ctx = document.getElementById('paymentStatusChart');
                    
                    if (ctx) {
                        // Destroy existing chart
                        if (reportsCharts.paymentStatus) {
                            reportsCharts.paymentStatus.destroy();
                        }
                        
                        reportsCharts.paymentStatus = new Chart(ctx, {
                            type: 'pie',
                            data: {
                                labels: chartData.labels,
                                datasets: [{
                                    data: chartData.counts,
                                    backgroundColor: [
                                        '#10b981', // Fully Paid
                                        '#f59e0b', // Partial Payment
                                        '#ef4444', // Pending Payment
                                        '#6b7280'  // No Payment Required
                                    ],
                                    borderWidth: 2,
                                    borderColor: '#ffffff'
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        display: false
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                const label = context.label || '';
                                                const value = context.parsed;
                                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                                const percentage = ((value / total) * 100).toFixed(1);
                                                return `${label}: ${value} (${percentage}%)`;
                                            }
                                        }
                                    }
                                }
                            }
                        });
                        
                        // Calculate completion rate
                        const totalPaid = chartData.counts[0] + chartData.counts[1]; // Fully Paid + Partial
                        const totalPayments = chartData.counts.reduce((a, b) => a + b, 0);
                        const completionRate = totalPayments > 0 ? ((totalPaid / totalPayments) * 100).toFixed(1) : 0;
                        document.getElementById('payment-completion-rate').textContent = `${completionRate}%`;
                    }
                }
            } catch (error) {
                console.error('Error loading payment status chart:', error);
            }
        }

        // Load recent activity data
        async function loadRecentActivity() {
            try {
                // Get recent reservations and payments
                const [reservationsResponse, paymentsResponse] = await Promise.all([
                    fetch('/api/reservations'),
                    fetch('/api/stipendium/payments')
                ]);
                
                const reservationsData = await reservationsResponse.json();
                const paymentsData = await paymentsResponse.json();
                
                const tableBody = document.getElementById('reportsActivityTableBody');
                if (tableBody) {
                    tableBody.innerHTML = '';
                    
                    // Combine and sort activities
                    const activities = [];
                    
                    // Add recent reservations
                    if (reservationsData.success) {
                        reservationsData.data.slice(0, 5).forEach(reservation => {
                            activities.push({
                                date: new Date(reservation.created_at),
                                type: 'Reservation',
                                service: reservation.service_type,
                                client: reservation.contact_name || 'N/A',
                                amount: '-',
                                status: reservation.status
                            });
                        });
                    }
                    
                    // Add recent payments
                    if (paymentsData.success) {
                        paymentsData.data.slice(0, 5).forEach(payment => {
                            activities.push({
                                date: new Date(payment.created_at),
                                type: 'Payment',
                                service: payment.service_type,
                                client: payment.client_name || 'N/A',
                                amount: `â‚±${payment.amount_paid.toLocaleString()}`,
                                status: payment.payment_status
                            });
                        });
                    }
                    
                    // Sort by date (newest first)
                    activities.sort((a, b) => b.date - a.date);
                    
                    // Display top 10 activities
                    activities.slice(0, 10).forEach(activity => {
                        const row = document.createElement('tr');
                        
                        const statusClass = activity.status === 'approved' || activity.status === 'Paid' ? 'status-confirmed' :
                                          activity.status === 'pending' || activity.status === 'Pending' ? 'status-pending' :
                                          activity.status === 'Partial' ? 'status-warning' : 'status-cancelled';
                        
                        row.innerHTML = `
                            <td>${activity.date.toLocaleDateString()}</td>
                            <td>${activity.type}</td>
                            <td><span class="service-badge ${activity.service.toLowerCase()}">${activity.service.charAt(0).toUpperCase() + activity.service.slice(1)}</span></td>
                            <td>${activity.client}</td>
                            <td>${activity.amount}</td>
                            <td><span class="status-badge ${statusClass}">${activity.status}</span></td>
                        `;
                        
                        tableBody.appendChild(row);
                    });
                    
                    if (activities.length === 0) {
                        tableBody.innerHTML = `
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 40px; color: #64748b;">
                                    No recent activity found
                                </td>
                            </tr>
                        `;
                    }
                }
            } catch (error) {
                console.error('Error loading recent activity:', error);
                const tableBody = document.getElementById('reportsActivityTableBody');
                if (tableBody) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px; color: #ef4444;">
                                Error loading activity data
                            </td>
                        </tr>
                    `;
                }
            }
        }

        // Generate insights
        async function generateInsights() {
            try {
                const [summaryResponse, serviceResponse] = await Promise.all([
                    fetch('/api/reports/summary'),
                    fetch('/api/reports/service-distribution')
                ]);
                
                const summaryData = await summaryResponse.json();
                const serviceData = await serviceResponse.json();
                
                if (summaryData.success && serviceData.success) {
                    const summary = summaryData.data;
                    const services = serviceData.data;
                    
                    // Growth insight
                    const growthInsight = summary.reservation_growth >= 10 ? 
                        `Excellent growth! Reservations increased by ${summary.reservation_growth}% this month.` :
                        summary.reservation_growth >= 0 ?
                        `Steady progress with ${summary.reservation_growth}% growth in reservations.` :
                        `Reservations decreased by ${Math.abs(summary.reservation_growth)}%. Consider promotional activities.`;
                    
                    document.getElementById('growth-insight').textContent = growthInsight;
                    
                    // Popular services insight
                    const maxIndex = services.counts.indexOf(Math.max(...services.counts));
                    const popularService = services.labels[maxIndex];
                    const popularCount = services.counts[maxIndex];
                    
                    document.getElementById('popular-services-insight').textContent = 
                        `${popularService} is the most popular service with ${popularCount} reservations.`;
                    
                    // Revenue insight
                    const revenueInsight = summary.revenue_growth >= 15 ?
                        `Outstanding revenue growth of ${summary.revenue_growth}%! Financial performance is excellent.` :
                        summary.revenue_growth >= 0 ?
                        `Revenue increased by ${summary.revenue_growth}%. Continue current strategies.` :
                        `Revenue declined by ${Math.abs(summary.revenue_growth)}%. Review pricing and collection processes.`;
                    
                    document.getElementById('revenue-insight').textContent = revenueInsight;
                }
            } catch (error) {
                console.error('Error generating insights:', error);
            }
        }

        // Refresh all reports data
        async function refreshReportsData() {
            const refreshBtn = document.getElementById('refreshReportsBtn');
            if (refreshBtn) {
                const originalContent = refreshBtn.innerHTML;
                refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Refreshing...';
                refreshBtn.disabled = true;
                
                try {
                    await Promise.all([
                        loadReportsSummary(),
                        loadMonthlyReservationsChart(),
                        loadServiceDistributionChart(),
                        loadRevenueTrendsChart(),
                        loadPaymentStatusChart(),
                        loadRecentActivity(),
                        generateInsights()
                    ]);
                    
                    // Show success state
                    refreshBtn.innerHTML = '<i class="fas fa-check"></i> Updated!';
                    refreshBtn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                    
                    setTimeout(() => {
                        refreshBtn.innerHTML = originalContent;
                        refreshBtn.style.background = '';
                        refreshBtn.disabled = false;
                    }, 2000);
                    
                } catch (error) {
                    console.error('Error refreshing reports data:', error);
                    refreshBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error';
                    refreshBtn.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
                    
                    setTimeout(() => {
                        refreshBtn.innerHTML = originalContent;
                        refreshBtn.style.background = '';
                        refreshBtn.disabled = false;
                    }, 3000);
                }
            }
        }

        // Initialize reports when module is shown
        function initializeReports() {
            loadReportsSummary();
            loadMonthlyReservationsChart();
            loadServiceDistributionChart();
            loadRevenueTrendsChart();
            loadPaymentStatusChart();
            loadRecentActivity();
            generateInsights();
            
            // Add refresh button event listener
            const refreshBtn = document.getElementById('refreshReportsBtn');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', refreshReportsData);
            }
        }

        // ============================================================================
        // ADMIN CALENDAR FUNCTIONALITY (Same as Secretary Events Calendar)
        // ============================================================================
        
        let adminCalendarInstance = null;
        let adminReservations = [];
        let adminEvents = [];
        
        // Initialize Admin Calendar (Same as Secretary)
        async function initializeAdminCalendar() {
            console.log('Initializing Admin Calendar...');
            
            // Destroy existing calendar if it exists
            if (adminCalendarInstance) {
                adminCalendarInstance.destroy();
                adminCalendarInstance = null;
            }
            
            const calendarEl = document.getElementById('adminCalendar');
            if (!calendarEl) {
                console.error('Admin calendar element not found');
                return;
            }
            
            // Load reservations and events
            await loadAdminCalendarData();
            
            // Initialize FullCalendar
            adminCalendarInstance = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                height: 'auto',
                aspectRatio: 1.35,
                dayMaxEvents: true,
                weekends: true,
                themeSystem: 'standard',
                eventDisplay: 'block',
                displayEventTime: true,
                displayEventEnd: false,
                events: [],
                eventClick: function(info) {
                    showAdminEventDetails(info.event);
                },
                eventTimeFormat: {
                    hour: '2-digit',
                    minute: '2-digit',
                    meridiem: 'short'
                }
            });
            
            adminCalendarInstance.render();
            
            // Load events after calendar is rendered
            setTimeout(() => {
                refreshAdminCalendarEvents();
            }, 200);
            
            // Setup refresh button
            const refreshBtn = document.getElementById('refreshAdminCalendarBtn');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', async () => {
                    refreshBtn.disabled = true;
                    refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Refreshing...</span>';
                    
                    await loadAdminCalendarData();
                    refreshAdminCalendarEvents();
                    
                    refreshBtn.disabled = false;
                    refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i><span>Refresh</span>';
                });
            }
            
            // Setup type filter (Events/Reservations)
            const typeFilter = document.getElementById('adminTypeFilter');
            if (typeFilter) {
                typeFilter.addEventListener('change', () => {
                    refreshAdminCalendarEvents();
                });
            }
            
            // Setup service filter
            const serviceFilter = document.getElementById('adminServiceFilter');
            if (serviceFilter) {
                serviceFilter.addEventListener('change', () => {
                    refreshAdminCalendarEvents();
                });
            }
            
            // Auto-refresh every 30 seconds for real-time updates
            setInterval(async () => {
                console.log('Admin Calendar: Auto-refreshing data...');
                await loadAdminCalendarData();
                refreshAdminCalendarEvents();
            }, 30000); // 30 seconds
            
            // Setup print button
            const printBtn = document.getElementById('printAdminCalendarBtn');
            if (printBtn) {
                printBtn.addEventListener('click', printAdminCalendar);
            }
            
            console.log('âœ… Admin Calendar initialized with auto-refresh');
        }
        
        // Load reservations and events data
        async function loadAdminCalendarData() {
            try {
                // Load reservations
                const resResponse = await fetch('/api/reservations/all');
                const resResult = await resResponse.json();
                
                if (resResult.success) {
                    adminReservations = resResult.data || [];
                    console.log('Admin Calendar: Loaded reservations:', adminReservations.length);
                }
                
                // Load events
                const eventsResponse = await fetch('/api/events');
                const eventsResult = await eventsResponse.json();
                
                if (eventsResult.success) {
                    adminEvents = eventsResult.data || [];
                    console.log('Admin Calendar: Loaded events:', adminEvents.length);
                }
            } catch (error) {
                console.error('Admin Calendar: Error loading data:', error);
            }
        }
        
        // Refresh calendar events
        function refreshAdminCalendarEvents() {
            const events = getAdminCalendarEvents();
            console.log('=== REFRESHING ADMIN CALENDAR ===');
            console.log('Total events to add:', events.length);
            console.log('Events:', events);
            
            if (adminCalendarInstance) {
                // Remove all existing events
                adminCalendarInstance.removeAllEvents();
                console.log('âœ… Cleared existing events');
                
                // Add each event
                events.forEach((event, index) => {
                    try {
                        adminCalendarInstance.addEvent(event);
                        console.log(`âœ… Added event ${index + 1}:`, event.title);
                    } catch (error) {
                        console.error(`âŒ Failed to add event ${index + 1}:`, error);
                        console.error('Event data:', event);
                    }
                });
                
                // Force re-render
                adminCalendarInstance.render();
                console.log('âœ… Calendar rendered with', events.length, 'events');
            } else {
                console.error('âŒ Calendar instance not found!');
            }
            console.log('=================================');
        }
        
        // Get calendar events (confirmed reservations + confirmed events)
        function getAdminCalendarEvents() {
            const serviceColors = {
                'wedding': '#FFD700',
                'baptism': '#3B82F6',
                'funeral': '#6B7280',
                'confirmation': '#8B5CF6'
            };
            
            // Get selected filters
            const typeFilter = document.getElementById('adminTypeFilter');
            const serviceFilter = document.getElementById('adminServiceFilter');
            const selectedType = typeFilter ? typeFilter.value : 'all';
            const selectedService = serviceFilter ? serviceFilter.value : 'all';
            
            // Filter APPROVED reservations (status = 'approved')
            let confirmedReservations = adminReservations.filter(res => {
                const status = res.status ? res.status.toLowerCase() : '';
                return status === 'approved';
            });
            
            // Apply service filter to reservations
            if (selectedService !== 'all') {
                confirmedReservations = confirmedReservations.filter(res => 
                    res.service_type && res.service_type.toLowerCase() === selectedService.toLowerCase()
                );
            }
            
            // Filter confirmed events (status = 'active' or 'confirmed')
            let confirmedEvents = adminEvents.filter(event => {
                const status = event.status ? event.status.toLowerCase() : '';
                return status === 'active' || status === 'confirmed';
            });
            
            console.log('=== ADMIN CALENDAR DEBUG ===');
            console.log('Total reservations loaded:', adminReservations.length);
            console.log('All reservation statuses:', adminReservations.map(r => ({id: r.id, status: r.status})));
            console.log('Approved reservations (status=approved):', confirmedReservations.length);
            console.log('Type filter:', selectedType);
            console.log('Service filter:', selectedService);
            console.log('Total events loaded:', adminEvents.length);
            console.log('All event statuses:', adminEvents.map(e => ({id: e.id, status: e.status})));
            console.log('Active/Confirmed events:', confirmedEvents.length);
            console.log('===========================');
            
            // Map reservations to calendar events
            const reservationItems = confirmedReservations.map(res => {
                // Get client name from API response
                const clientName = res.contact_name || 'Unknown Client';
                
                // Get service type
                const serviceType = res.service_type ? res.service_type.charAt(0).toUpperCase() + res.service_type.slice(1) : null;
                
                // Get date and time - API returns 'date' and 'time_slot'
                const reservationDate = res.date;
                const reservationTime = res.time_slot || res.time;
                
                console.log('Processing reservation:', {
                    id: res.id,
                    clientName,
                    serviceType,
                    date: reservationDate,
                    time: reservationTime,
                    status: res.status
                });
                
                if (!reservationDate || !reservationTime || !clientName || !serviceType) {
                    console.log('âŒ Skipping reservation - missing required fields:', {
                        hasDate: !!reservationDate,
                        hasTime: !!reservationTime,
                        hasClient: !!clientName,
                        hasService: !!serviceType
                    });
                    return null;
                }
                
                const displayTime = formatTime12Hour(reservationTime);
                const serviceColor = serviceColors[res.service_type?.toLowerCase()] || '#6B7280';
                
                // Convert time to proper format for FullCalendar
                // Time from API is already in HH:MM:SS format (e.g., "09:00:00")
                let formattedTime = reservationTime;
                
                // Remove seconds if present (09:00:00 -> 09:00)
                if (formattedTime.includes(':')) {
                    const parts = formattedTime.split(':');
                    formattedTime = `${parts[0]}:${parts[1]}`;
                }
                
                const calendarEvent = {
                    id: res.id,
                    title: `${displayTime}, ${clientName}, ${serviceType}`,
                    start: `${reservationDate}T${formattedTime}:00`,
                    backgroundColor: '#FFFFFF',
                    borderColor: serviceColor,
                    textColor: '#000000',
                    className: 'confirmed-event',
                    extendedProps: {
                        type: 'reservation',
                        clientName: clientName,
                        serviceType: serviceType,
                        time: displayTime,
                        date: reservationDate,
                        status: res.status,
                        serviceColor: serviceColor
                    }
                };
                
                console.log('âœ… Created calendar event:', {
                    title: calendarEvent.title,
                    start: calendarEvent.start,
                    color: serviceColor
                });
                
                return calendarEvent;
            }).filter(event => event !== null);
            
            // Map events to calendar events
            const eventItems = confirmedEvents.map(event => {
                if (!event.event_date || !event.start_time) {
                    return null;
                }
                
                const eventName = event.event_name || event.description || 'Church Event';
                const displayTime = formatTime12Hour(event.start_time);
                const eventTypeColor = '#8B5CF6'; // Purple for events
                
                return {
                    id: `event_${event.id}`,
                    title: `${displayTime}, ${eventName}`,
                    start: `${event.event_date}T${event.start_time}`,
                    backgroundColor: '#FFFFFF',
                    borderColor: eventTypeColor,
                    textColor: '#000000',
                    className: 'confirmed-event',
                    extendedProps: {
                        type: 'event',
                        eventName: eventName,
                        eventType: event.event_type || 'other',
                        time: displayTime,
                        date: event.event_date,
                        status: event.status,
                        eventTypeColor: eventTypeColor
                    }
                };
            }).filter(event => event !== null);
            
            // Apply type filter - decide what to return
            if (selectedType === 'reservations') {
                console.log('ðŸ“‹ Showing RESERVATIONS ONLY:', reservationItems.length);
                return reservationItems;
            } else if (selectedType === 'events') {
                console.log('ðŸ“… Showing EVENTS ONLY:', eventItems.length);
                return eventItems;
            } else {
                console.log('ðŸ”„ Showing ALL (Reservations + Events):', reservationItems.length + eventItems.length);
                return [...reservationItems, ...eventItems];
            }
        }
        
        // Format time to 12-hour format
        function formatTime12Hour(timeString) {
            if (!timeString) return '';
            
            try {
                if (timeString.includes('AM') || timeString.includes('PM')) {
                    return timeString;
                }
                
                const timeParts = timeString.split(':');
                let hours = parseInt(timeParts[0]);
                const minutes = timeParts[1] || '00';
                
                const ampm = hours >= 12 ? 'PM' : 'AM';
                let displayHours = hours % 12;
                displayHours = displayHours === 0 ? 12 : displayHours;
                
                return `${displayHours}:${minutes.padStart(2, '0')} ${ampm}`;
            } catch (error) {
                return timeString;
            }
        }
        
        // Show event details in modal
        function showAdminEventDetails(event) {
            const props = event.extendedProps;
            const modal = document.getElementById('adminCalendarEventModal');
            
            if (props.type === 'event') {
                // Show Event Details
                document.getElementById('adminModalTitle').textContent = 'Event Details';
                document.getElementById('admin-calendar-info-title').innerHTML = '<i class="fas fa-calendar-check" style="color: #002b5c;"></i> Event Information';
                
                // Event badge
                const eventTypeColors = {
                    'worship': '#8B5CF6',
                    'prayer': '#F59E0B',
                    'youth': '#3B82F6',
                    'outreach': '#10B981',
                    'special': '#EF4444',
                    'other': '#6B7280'
                };
                const eventColor = eventTypeColors[props.eventType] || '#6B7280';
                document.getElementById('admin-calendar-detail-badge').innerHTML = `
                    <span style="display: inline-flex; align-items: center; padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; gap: 6px; background: ${eventColor}; color: white; border: 1px solid ${eventColor};">
                        <i class="fas fa-calendar-alt"></i>
                        ${props.eventType}
                    </span>
                `;
                
                // Date and time
                document.getElementById('admin-calendar-detail-date').textContent = props.date;
                document.getElementById('admin-calendar-detail-time').textContent = props.time;
                
                // Event details
                document.getElementById('admin-calendar-detail-content').innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="background: #002b5c; color: white; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px;">
                            <i class="fas fa-tag"></i>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Event Name</div>
                            <div style="color: #1e293b; font-weight: 600; font-size: 15px;">${props.eventName}</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="background: #d4af37; color: white; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px;">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Status</div>
                            <div style="color: #1e293b; font-weight: 600; font-size: 15px;">${props.status}</div>
                        </div>
                    </div>
                `;
            } else {
                // Show Reservation Details
                document.getElementById('adminModalTitle').textContent = 'Reservation Details';
                document.getElementById('admin-calendar-info-title').innerHTML = '<i class="fas fa-user-circle" style="color: #002b5c;"></i> Client Information';
                
                // Service badge
                const serviceColors = {
                    'Wedding': '#FFD700',
                    'Baptism': '#3B82F6',
                    'Funeral': '#6B7280',
                    'Confirmation': '#8B5CF6'
                };
                const serviceColor = serviceColors[props.serviceType] || '#6B7280';
                document.getElementById('admin-calendar-detail-badge').innerHTML = `
                    <span style="display: inline-flex; align-items: center; padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; gap: 6px; background: ${serviceColor}; color: white; border: 1px solid ${serviceColor};">
                        <i class="fas fa-church"></i>
                        ${props.serviceType}
                    </span>
                `;
                
                // Date and time
                document.getElementById('admin-calendar-detail-date').textContent = props.date;
                document.getElementById('admin-calendar-detail-time').textContent = props.time;
                
                // Client details
                document.getElementById('admin-calendar-detail-content').innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="background: #002b5c; color: white; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px;">
                            <i class="fas fa-user"></i>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Client Name</div>
                            <div style="color: #1e293b; font-weight: 600; font-size: 15px;">${props.clientName}</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="background: #d4af37; color: white; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px;">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Status</div>
                            <div style="color: #1e293b; font-weight: 600; font-size: 15px;">${props.status}</div>
                        </div>
                    </div>
                `;
            }
            
            // Show modal
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        // Close modal function
        function closeAdminCalendarEventModal() {
            const modal = document.getElementById('adminCalendarEventModal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        // Setup modal close handlers
        document.addEventListener('DOMContentLoaded', function() {
            const closeBtn1 = document.getElementById('closeAdminCalendarModal');
            const closeBtn2 = document.getElementById('closeAdminCalendarModalBtn');
            const overlay = document.querySelector('#adminCalendarEventModal .modal-overlay');
            
            if (closeBtn1) closeBtn1.addEventListener('click', closeAdminCalendarEventModal);
            if (closeBtn2) closeBtn2.addEventListener('click', closeAdminCalendarEventModal);
            if (overlay) overlay.addEventListener('click', closeAdminCalendarEventModal);
            
            // ESC key to close
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    const modal = document.getElementById('adminCalendarEventModal');
                    if (modal && modal.style.display === 'flex') {
                        closeAdminCalendarEventModal();
                    }
                }
            });
        });
        
        // ============================================================================
        // PRINT CALENDAR FUNCTIONALITY (Same as Reports Print)
        // ============================================================================
        
        function generateCalendarGrid(year, month, events) {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            
            // Get first day of month and total days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Group events by date
            const eventsByDate = {};
            events.forEach(event => {
                const eventDate = new Date(event.start);
                if (eventDate.getMonth() === month && eventDate.getFullYear() === year) {
                    const dateKey = eventDate.getDate();
                    if (!eventsByDate[dateKey]) {
                        eventsByDate[dateKey] = [];
                    }
                    eventsByDate[dateKey].push(event);
                }
            });
            
            let html = `
                <div style="text-align: center; margin-bottom: 10px; font-size: 12px; font-weight: bold;">
                    ${monthNames[month]} ${year}
                </div>
                <table style="width: 100%; border-collapse: collapse; border: 2px solid #000;">
                    <thead>
                        <tr>
            `;
            
            // Day headers
            dayNames.forEach(day => {
                html += `<th style="border: 1px solid #000; padding: 5px; background: #e0e0e0; font-size: 9px; font-weight: bold;">${day}</th>`;
            });
            
            html += `
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            // Calendar grid
            let dayCounter = 1;
            let weekRow = '<tr>';
            
            // Empty cells before first day
            for (let i = 0; i < firstDay; i++) {
                weekRow += '<td style="border: 1px solid #000; height: 70px; vertical-align: top; padding: 3px; background: #f5f5f5;"></td>';
            }
            
            // Days of month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayOfWeek = (firstDay + day - 1) % 7;
                
                weekRow += '<td style="border: 1px solid #000; height: 70px; vertical-align: top; padding: 3px;">';
                weekRow += `<div style="font-weight: bold; font-size: 9px; margin-bottom: 3px; text-align: center;">${day}</div>`;
                
                // Add events for this day
                if (eventsByDate[day]) {
                    eventsByDate[day].forEach(event => {
                        const color = event.borderColor || '#3788d8';
                        weekRow += `<div style="background: ${color}; color: white; font-size: 6px; padding: 1px 2px; margin: 1px 0; border-radius: 2px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${event.title}</div>`;
                    });
                }
                
                weekRow += '</td>';
                
                // End of week
                if (dayOfWeek === 6) {
                    weekRow += '</tr>';
                    html += weekRow;
                    weekRow = '<tr>';
                }
            }
            
            // Fill remaining cells
            const remainingCells = (7 - ((firstDay + daysInMonth) % 7)) % 7;
            for (let i = 0; i < remainingCells; i++) {
                weekRow += '<td style="border: 1px solid #000; height: 70px; vertical-align: top; padding: 3px; background: #f5f5f5;"></td>';
            }
            
            if (weekRow !== '<tr>') {
                weekRow += '</tr>';
                html += weekRow;
            }
            
            html += `
                    </tbody>
                </table>
            `;
            
            return html;
        }
        
        function printAdminCalendar() {
            console.log('ðŸ–¨ï¸ Printing Admin Calendar...');
            
            // Get the calendar instance
            if (!adminCalendarInstance) {
                alert('Calendar not initialized');
                return;
            }
            
            // Get current filter selections
            const typeFilter = document.getElementById('adminTypeFilter');
            const serviceFilter = document.getElementById('adminServiceFilter');
            const selectedType = typeFilter ? typeFilter.value : 'all';
            const selectedService = serviceFilter ? serviceFilter.value : 'all';
            
            // Get filtered events
            const events = getAdminCalendarEvents();
            
            // Get current month/year from calendar
            const currentDate = adminCalendarInstance.getDate();
            const currentMonth = currentDate.getMonth();
            const currentYear = currentDate.getFullYear();
            
            // Generate calendar grid HTML
            const calendarHTML = generateCalendarGrid(currentYear, currentMonth, events);
            
            // Get month name
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                               'July', 'August', 'September', 'October', 'November', 'December'];
            const monthName = monthNames[currentMonth];
            
            // Determine title based on filters
            let reportTitle = `${monthName} ${currentYear} Church Calendar Report`;
            if (selectedType === 'reservations') {
                reportTitle = `${monthName} ${currentYear} Reservations Calendar Report`;
            } else if (selectedType === 'events') {
                reportTitle = `${monthName} ${currentYear} Events Calendar Report`;
            }
            
            if (selectedService !== 'all') {
                reportTitle += ` - ${selectedService.charAt(0).toUpperCase() + selectedService.slice(1)}`;
            }
            
            // Filter events to only show current month
            const filteredEvents = events.filter(event => {
                const eventDate = new Date(event.start);
                return eventDate.getMonth() === currentMonth && eventDate.getFullYear() === currentYear;
            });
            
            console.log(`ðŸ” Filtering events for ${currentYear}-${currentMonth + 1}: Found ${filteredEvents.length} events`);
            
            // Group events by date
            const eventsByDate = {};
            filteredEvents.forEach(event => {
                const date = event.start.split('T')[0];
                if (!eventsByDate[date]) {
                    eventsByDate[date] = [];
                }
                eventsByDate[date].push(event);
            });
            
            // Sort dates
            const sortedDates = Object.keys(eventsByDate).sort();
            
            // Generate print content
            let printContent = '';
            
            sortedDates.forEach(date => {
                const dateObj = new Date(date);
                const formattedDate = dateObj.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                
                printContent += `
                    <div class="date-section">
                        <div class="date-header">${formattedDate}</div>
                `;
                
                // Sort events by time
                eventsByDate[date].sort((a, b) => {
                    const timeA = a.start.split('T')[1];
                    const timeB = b.start.split('T')[1];
                    return timeA.localeCompare(timeB);
                });
                
                eventsByDate[date].forEach(event => {
                    const props = event.extendedProps;
                    const isReservation = props.type === 'reservation';
                    
                    printContent += `
                        <div class="event-item">
                            <div class="event-header">
                                <div>
                                    <div class="event-title">${event.title}</div>
                                    <div class="event-type">${isReservation ? 'RESERVATION' : 'EVENT'} - ${isReservation ? props.serviceType : props.eventType}</div>
                                </div>
                                <div class="event-time">${props.time}</div>
                            </div>
                            ${isReservation ? `
                                <div class="event-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Client:</span>
                                        <span>${props.clientName}</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Status:</span>
                                        <span>${props.status.toUpperCase()}</span>
                                    </div>
                                </div>
                            ` : `
                                <div class="event-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Event Name:</span>
                                        <span>${props.eventName}</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Status:</span>
                                        <span>${props.status.toUpperCase()}</span>
                                    </div>
                                </div>
                            `}
                        </div>
                    `;
                });
                
                printContent += `
                    </div>
                `;
            });
            
            if (sortedDates.length === 0) {
                printContent = `
                    <div style="text-align: center; padding: 40px; border: 2px solid #000; margin: 20px 0;">
                        <p style="font-size: 14px; font-weight: bold;">NO DATA AVAILABLE</p>
                        <p style="font-size: 12px; margin-top: 10px;">No events or reservations found for the selected filters.</p>
                    </div>
                `;
            }
            
            // Get current date and time
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            const timeStr = now.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Create hidden iframe for printing (same as Reports)
            const iframe = document.createElement('iframe');
            iframe.style.position = 'fixed';
            iframe.style.right = '0';
            iframe.style.bottom = '0';
            iframe.style.width = '0';
            iframe.style.height = '0';
            iframe.style.border = 'none';
            document.body.appendChild(iframe);
            
            const iframeDoc = iframe.contentWindow.document;
            
            // Write HTML content to iframe
            iframeDoc.open();
            iframeDoc.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${reportTitle} - ChurchEase Report</title>
                    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
                    <style>
                        @page {
                            size: A4 portrait;
                            margin: 15mm;
                        }
                        
                        * {
                            margin: 0;
                            padding: 0;
                            box-sizing: border-box;
                        }
                        
                        body {
                            font-family: 'Times New Roman', Times, serif;
                            background: white;
                            color: #000;
                        }
                        
                        .document {
                            max-width: 210mm;
                            margin: 0 auto;
                            padding: 0;
                        }
                        
                        /* Official Header */
                        .official-header {
                            text-align: center;
                            border-bottom: 4px double #000;
                            padding-bottom: 10px;
                            margin-bottom: 15px;
                        }
                        
                        .church-logo {
                            width: 50px;
                            height: 50px;
                            margin: 0 auto 8px;
                        }
                        
                        .church-name {
                            font-size: 18px;
                            font-weight: bold;
                            color: #000;
                            margin-bottom: 3px;
                            letter-spacing: 1px;
                        }
                        
                        .church-address {
                            font-size: 9px;
                            color: #333;
                            margin: 1px 0;
                        }
                        
                        .document-title {
                            font-size: 14px;
                            font-weight: bold;
                            color: #000;
                            margin-top: 8px;
                            text-transform: uppercase;
                            letter-spacing: 1.5px;
                            border-top: 1px solid #000;
                            border-bottom: 1px solid #000;
                            padding: 6px 0;
                        }
                        
                        /* Document Info */
                        .document-info {
                            margin: 12px 0;
                            font-size: 9px;
                            border: 1px solid #ddd;
                            padding: 8px;
                            background: #f9f9f9;
                        }
                        
                        .info-row {
                            display: flex;
                            justify-content: space-between;
                            margin: 4px 0;
                        }
                        
                        .info-label {
                            font-weight: bold;
                            color: #333;
                        }
                        
                        .info-value {
                            color: #000;
                        }
                        
                        /* Content Sections */
                        .date-section {
                            margin-bottom: 25px;
                            page-break-inside: avoid;
                        }
                        
                        .date-header {
                            font-size: 14px;
                            font-weight: bold;
                            border-bottom: 2px solid #000;
                            padding-bottom: 5px;
                            margin-bottom: 12px;
                        }
                        
                        .event-item {
                            border: 1px solid #000;
                            padding: 12px;
                            margin-bottom: 10px;
                            page-break-inside: avoid;
                        }
                        
                        .event-header {
                            display: flex;
                            justify-content: space-between;
                            align-items: start;
                            margin-bottom: 8px;
                            border-bottom: 1px solid #ccc;
                            padding-bottom: 8px;
                        }
                        
                        .event-title {
                            font-size: 13px;
                            font-weight: bold;
                        }
                        
                        .event-time {
                            font-size: 12px;
                            font-weight: bold;
                            background: #000;
                            color: #fff;
                            padding: 4px 10px;
                            border-radius: 3px;
                        }
                        
                        .event-type {
                            font-size: 11px;
                            color: #555;
                            margin-bottom: 5px;
                        }
                        
                        .event-details {
                            font-size: 11px;
                            margin-top: 8px;
                            padding-top: 8px;
                            border-top: 1px dashed #ccc;
                        }
                        
                        .detail-row {
                            margin-bottom: 3px;
                        }
                        
                        .detail-label {
                            font-weight: bold;
                            display: inline-block;
                            width: 80px;
                        }
                        
                        /* Signature Section */
                        .signature-section {
                            margin-top: 30px;
                            display: flex;
                            justify-content: space-between;
                            page-break-inside: avoid;
                        }
                        
                        .signature-box {
                            text-align: center;
                            width: 45%;
                        }
                        
                        .signature-line {
                            border-top: 1px solid #000;
                            margin-top: 40px;
                            padding-top: 5px;
                        }
                        
                        .signature-name {
                            font-size: 10px;
                            font-weight: bold;
                            color: #000;
                        }
                        
                        .signature-title {
                            font-size: 8px;
                            color: #666;
                            margin-top: 2px;
                            text-transform: uppercase;
                        }
                        
                        /* Footer */
                        .document-footer {
                            margin-top: 15px;
                            padding-top: 10px;
                            border-top: 2px solid #000;
                            text-align: center;
                            font-size: 8px;
                            color: #666;
                        }
                        
                        .footer-note {
                            margin: 2px 0;
                            font-style: italic;
                        }
                        
                        /* Visual Calendar Styles */
                        .visual-calendar {
                            page-break-inside: avoid;
                        }
                        
                        .visual-calendar .fc-toolbar {
                            margin-bottom: 10px !important;
                        }
                        
                        .visual-calendar .fc-toolbar-chunk:first-child,
                        .visual-calendar .fc-toolbar-chunk:last-child {
                            display: none !important;
                        }
                        
                        .visual-calendar .fc-toolbar-title {
                            font-size: 12px !important;
                            font-weight: bold !important;
                            color: #000 !important;
                        }
                        
                        .visual-calendar .fc-col-header-cell {
                            font-size: 8px !important;
                            padding: 5px 2px !important;
                            background: #e0e0e0 !important;
                            border: 1px solid #000 !important;
                            font-weight: bold !important;
                        }
                        
                        .visual-calendar .fc-daygrid-day {
                            border: 1px solid #000 !important;
                            min-height: 60px !important;
                        }
                        
                        .visual-calendar .fc-daygrid-day-number {
                            font-size: 9px !important;
                            padding: 3px !important;
                            font-weight: bold !important;
                        }
                        
                        .visual-calendar .fc-daygrid-day-top {
                            justify-content: center !important;
                        }
                        
                        .visual-calendar .fc-event {
                            font-size: 6px !important;
                            padding: 1px 3px !important;
                            margin: 1px 2px !important;
                            border-radius: 2px !important;
                            white-space: nowrap !important;
                            overflow: hidden !important;
                            text-overflow: ellipsis !important;
                        }
                        
                        .visual-calendar .fc-daygrid-event-harness {
                            margin: 1px 0 !important;
                        }
                        
                        .visual-calendar .fc-button {
                            display: none !important;
                        }
                        
                        .visual-calendar .fc-scrollgrid {
                            border: 2px solid #000 !important;
                        }
                        
                        .visual-calendar .fc-day-today {
                            background: #fff !important;
                        }
                        
                        @media print {
                            body {
                                print-color-adjust: exact;
                                -webkit-print-color-adjust: exact;
                            }
                        }
                    </style>
                </head>
                <body>
                    <div class="document">
                        <!-- Official Header -->
                        <div class="official-header">
                            <div class="church-logo">
                                <img src="/static/ChurchLogo.jpg" alt="Church Logo" style="width: 100%; height: 100%; object-fit: contain;">
                            </div>
                            <div class="church-name">SAINT ANDREW THE APOSTLE PARISH</div>
                            <div class="church-address">Norzagaray, Bulacan</div>
                            <div class="church-address">H. Bernabe Street, Poblacion, Norzagaray, 3013 Bulacan</div>
                            <div class="church-address">Tel: 0995 770 5637</div>
                            <div class="church-address">Office Hours: Tuesday - Sunday, 8:00 AM - 5:00 PM (Closed Mondays)</div>
                            <div class="document-title">${reportTitle}</div>
                        </div>
                        
                        <!-- Document Information -->
                        <div class="document-info">
                            <div class="info-row">
                                <span class="info-label">Document Type:</span>
                                <span class="info-value">Calendar Report</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Report Period:</span>
                                <span class="info-value">All Scheduled Events & Reservations</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Generated Date:</span>
                                <span class="info-value">${dateStr}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Generated Time:</span>
                                <span class="info-value">${timeStr}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Total Items:</span>
                                <span class="info-value">${events.length}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Prepared By:</span>
                                <span class="info-value">ChurchEase Management System</span>
                            </div>
                        </div>
                        
                        <!-- Visual Calendar -->
                        <div style="margin-bottom: 30px; padding: 10px; page-break-inside: avoid;">
                            <h3 style="font-size: 12px; font-weight: bold; text-align: center; margin-bottom: 15px; text-transform: uppercase; border-bottom: 2px solid #000; padding-bottom: 8px;">Calendar View</h3>
                            ${calendarHTML}
                        </div>
                        
                        <!-- Detailed Events List -->
                        <div class="calendar-content">
                            <h3 style="font-size: 12px; font-weight: bold; text-align: center; margin-bottom: 15px; text-transform: uppercase; border-bottom: 1px solid #000; padding-bottom: 8px;">Detailed Schedule</h3>
                            ${printContent}
                        </div>
                        
                        <!-- Signature Section -->
                        <div class="signature-section">
                            <div class="signature-box">
                                <div class="signature-line">
                                    <div class="signature-name">_____________________</div>
                                    <div class="signature-title">Prepared By</div>
                                </div>
                            </div>
                            <div class="signature-box">
                                <div class="signature-line">
                                    <div class="signature-name">_____________________</div>
                                    <div class="signature-title">Approved By</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Document Footer -->
                        <div class="document-footer">
                            <p class="footer-note"><strong>Saint Andrew the Apostle Parish Â© ${new Date().getFullYear()}. All Rights Reserved.</strong></p>
                            <p class="footer-note">This is a computer-generated document.</p>
                        </div>
                    </div>
                </body>
                </html>
            `);
            
            iframeDoc.close();
            
            // Wait for content to load, then print (same as Reports)
            iframe.onload = function() {
                setTimeout(function() {
                    iframe.contentWindow.focus();
                    iframe.contentWindow.print();
                    
                    // Remove iframe after printing
                    setTimeout(function() {
                        document.body.removeChild(iframe);
                    }, 1000);
                }, 250);
            };
        }

        // ============================================================================
        // PROFILE FUNCTIONALITY (Same as Secretary Dashboard)
        // ============================================================================

        // Initialize profile functionality
        function initializeProfileFunctionality() {
            // Sidebar User Profile Dropdown
            const sidebarUserProfile = document.getElementById('sidebarUserProfile');
            const sidebarUserDropdown = document.getElementById('sidebarUserDropdown');
            
            if (sidebarUserProfile && sidebarUserDropdown) {
                const dropdownArrow = document.getElementById('dropdownArrow');
                
                sidebarUserProfile.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const isShowing = sidebarUserDropdown.style.display === 'block';
                    
                    // Close all dropdowns first
                    closeAllDropdowns();
                    
                    if (!isShowing) {
                        sidebarUserDropdown.style.display = 'block';
                        // Rotate arrow down when dropdown is open
                        if (dropdownArrow) {
                            dropdownArrow.style.transform = 'rotate(180deg)';
                        }
                        console.log('Sidebar user dropdown opened');
                    } else {
                        // Rotate arrow back up when dropdown is closed
                        if (dropdownArrow) {
                            dropdownArrow.style.transform = 'rotate(0deg)';
                        }
                    }
                });
            }

            // Profile Settings Modal
            const profileSettingsModal = document.getElementById('profileSettingsModal');
            const logoutModal = document.getElementById('logoutModal');
            
            // Handle dropdown item clicks
            document.addEventListener('click', function(e) {
                // My Profile click
                if (e.target.closest('#myProfileBtn') || 
                    (e.target.closest('.dropdown-item') && e.target.textContent.includes('My Profile'))) {
                    e.preventDefault();
                    closeAllDropdowns();
                    showModal(profileSettingsModal);
                    console.log('Profile settings modal opened');
                }
                
                // Logout click
                if (e.target.closest('.dropdown-item') && e.target.textContent.includes('Logout')) {
                    e.preventDefault();
                    closeAllDropdowns();
                    showModal(logoutModal);
                    console.log('Logout modal opened');
                }
            });

            // Profile Settings Modal Controls
            const closeProfileModal = document.getElementById('closeProfileModal');
            const cancelProfileSettings = document.getElementById('cancelProfileSettings');

            if (closeProfileModal) {
                closeProfileModal.addEventListener('click', () => hideModal(profileSettingsModal));
            }
            if (cancelProfileSettings) {
                cancelProfileSettings.addEventListener('click', () => hideModal(profileSettingsModal));
            }

            // Logout Modal Controls
            const cancelLogout = document.getElementById('cancelLogout');
            const confirmLogout = document.getElementById('confirmLogout');

            if (cancelLogout) {
                cancelLogout.addEventListener('click', () => hideModal(logoutModal));
            }
            if (confirmLogout) {
                confirmLogout.addEventListener('click', function() {
                    // Redirect to login page
                    window.location.href = '/';
                });
            }

            // Modal utility functions
            function showModal(modal) {
                if (modal) {
                    modal.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                }
            }

            function hideModal(modal) {
                if (modal) {
                    modal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            }

            // Close modal when clicking outside
            window.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    hideModal(e.target);
                }
            });
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.user-dropdown') && !e.target.closest('#sidebarUserProfile')) {
                    closeAllDropdowns();
                }
            });
            
            // Helper function to close all dropdowns
            function closeAllDropdowns() {
                if (sidebarUserDropdown) sidebarUserDropdown.style.display = 'none';
                // Reset arrow rotation
                const dropdownArrow = document.getElementById('dropdownArrow');
                if (dropdownArrow) {
                    dropdownArrow.style.transform = 'rotate(0deg)';
                }
            }
            
            // Add keyboard navigation for dropdowns
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeAllDropdowns();
                    hideModal(profileSettingsModal);
                    hideModal(logoutModal);
                }
            });

            console.log('Profile functionality initialized');
        }

        // Close modals when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });

        // Close modal buttons
        document.querySelectorAll('.close-btn, [id^="close"], [id^="cancel"]').forEach(btn => {
            btn.addEventListener('click', function() {
                const modal = this.closest('.modal');
                if (modal) {
                    modal.style.display = 'none';
                }
            });
        });

        // ============================================================================
        // PRIEST MANAGEMENT FUNCTIONALITY
        // ============================================================================

        // Initialize Priest Management
        function initializePriestManagement() {
            console.log('Initializing Priest Management...');
            
            // Add Priest Modal Event Listeners
            const addPriestBtn = document.getElementById('addPriestBtn');
            const addPriestModal = document.getElementById('addPriestModal');
            const closeAddPriest = document.getElementById('closeAddPriest');
            const cancelAddPriest = document.getElementById('cancelAddPriest');
            const confirmAddPriest = document.getElementById('confirmAddPriest');

            if (addPriestBtn) {
                addPriestBtn.addEventListener('click', function() {
                    document.getElementById('addPriestForm').reset();
                    addPriestModal.style.display = 'flex';
                });
            }

            if (closeAddPriest) {
                closeAddPriest.addEventListener('click', function() {
                    addPriestModal.style.display = 'none';
                });
            }

            if (cancelAddPriest) {
                cancelAddPriest.addEventListener('click', function() {
                    addPriestModal.style.display = 'none';
                });
            }

            if (confirmAddPriest) {
                confirmAddPriest.addEventListener('click', function() {
                    addNewPriest();
                });
            }

            // Edit Priest Modal Event Listeners
            const editPriestModal = document.getElementById('editPriestModal');
            const closeEditPriest = document.getElementById('closeEditPriest');
            const cancelEditPriest = document.getElementById('cancelEditPriest');
            const confirmEditPriest = document.getElementById('confirmEditPriest');

            if (closeEditPriest) {
                closeEditPriest.addEventListener('click', function() {
                    editPriestModal.style.display = 'none';
                });
            }

            if (cancelEditPriest) {
                cancelEditPriest.addEventListener('click', function() {
                    editPriestModal.style.display = 'none';
                });
            }

            if (confirmEditPriest) {
                confirmEditPriest.addEventListener('click', function() {
                    updatePriest();
                });
            }

            // Delete Priest Modal Event Listeners
            const deletePriestModal = document.getElementById('deletePriestModal');
            const closeDeletePriest = document.getElementById('closeDeletePriest');
            const cancelDeletePriest = document.getElementById('cancelDeletePriest');
            const confirmDeletePriest = document.getElementById('confirmDeletePriest');
            const confirmPriestDeletion = document.getElementById('confirmPriestDeletion');

            if (closeDeletePriest) {
                closeDeletePriest.addEventListener('click', function() {
                    deletePriestModal.style.display = 'none';
                });
            }

            if (cancelDeletePriest) {
                cancelDeletePriest.addEventListener('click', function() {
                    deletePriestModal.style.display = 'none';
                });
            }

            if (confirmPriestDeletion) {
                confirmPriestDeletion.addEventListener('change', function() {
                    confirmDeletePriest.disabled = !this.checked;
                });
            }

            if (confirmDeletePriest) {
                confirmDeletePriest.addEventListener('click', function() {
                    confirmDeletePriestAction();
                });
            }

            // Refresh Priests Button
            const refreshPriestsBtn = document.getElementById('refreshPriestsBtn');
            if (refreshPriestsBtn) {
                refreshPriestsBtn.addEventListener('click', function() {
                    refreshPriests();
                });
            }

            // Search functionality
            const priestSearchInput = document.getElementById('priestSearchInput');
            const clearPriestSearch = document.getElementById('clearPriestSearch');

            if (priestSearchInput) {
                priestSearchInput.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    filterPriests(searchTerm);
                    
                    if (clearPriestSearch) {
                        clearPriestSearch.style.display = searchTerm ? 'block' : 'none';
                    }
                });
            }

            if (clearPriestSearch) {
                clearPriestSearch.addEventListener('click', function() {
                    priestSearchInput.value = '';
                    filterPriests('');
                    this.style.display = 'none';
                });
            }
        }

        // Add New Priest Function
        function addNewPriest() {
            const form = document.getElementById('addPriestForm');
            const formData = new FormData(form);
            
            const priestData = {
                full_name: formData.get('full_name'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                specialization: formData.get('specialization'),
                status: formData.get('status') || 'active'
            };

            console.log('Adding new priest:', priestData);
            
            // TODO: Send to backend API
            // For now, show success message
            showNotification('Priest added successfully!', 'success');
            document.getElementById('addPriestModal').style.display = 'none';
            refreshPriests();
        }

        // Edit Priest Function
        function editPriest(priestId) {
            console.log('Editing priest:', priestId);
            
            // TODO: Fetch priest data from backend
            // For now, populate with current data
            document.getElementById('editPriestId').value = priestId;
            document.getElementById('editPriestFullName').value = 'Father Antonio Rodriguez';
            document.getElementById('editPriestEmail').value = 'antonio.rodriguez@churchease.com';
            document.getElementById('editPriestPhone').value = '+63 912 345 6789';
            document.getElementById('editPriestSpecialization').value = 'All church services';
            document.getElementById('editPriestStatus').value = 'active';
            
            document.getElementById('editPriestModal').style.display = 'flex';
        }

        // Update Priest Function
        function updatePriest() {
            const form = document.getElementById('editPriestForm');
            const formData = new FormData(form);
            
            const priestData = {
                priest_id: formData.get('priest_id'),
                full_name: formData.get('full_name'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                specialization: formData.get('specialization'),
                status: formData.get('status')
            };

            console.log('Updating priest:', priestData);
            
            // TODO: Send to backend API
            // For now, show success message
            showNotification('Priest updated successfully!', 'success');
            document.getElementById('editPriestModal').style.display = 'none';
            refreshPriests();
        }

        // Remove Priest Function
        function removePriest(priestId) {
            console.log('Removing priest:', priestId);
            
            // Set priest info in delete modal
            document.getElementById('deletePriestInfo').textContent = 'This will permanently remove Father Antonio Rodriguez from the system.';
            
            // Store priest ID for deletion
            document.getElementById('deletePriestModal').setAttribute('data-priest-id', priestId);
            document.getElementById('deletePriestModal').style.display = 'flex';
            
            // Reset checkbox
            document.getElementById('confirmPriestDeletion').checked = false;
            document.getElementById('confirmDeletePriest').disabled = true;
        }

        // Confirm Delete Priest Function
        function confirmDeletePriestAction() {
            const priestId = document.getElementById('deletePriestModal').getAttribute('data-priest-id');
            
            console.log('Confirming priest deletion:', priestId);
            
            // TODO: Send delete request to backend API
            // For now, show success message
            showNotification('Priest removed successfully!', 'success');
            document.getElementById('deletePriestModal').style.display = 'none';
            refreshPriests();
        }

        // Refresh Priests Function
        function refreshPriests() {
            console.log('Refreshing priests data...');
            
            const refreshBtn = document.getElementById('refreshPriestsBtn');
            if (refreshBtn) {
                refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Refreshing...';
                refreshBtn.disabled = true;
                
                // TODO: Fetch from backend API
                setTimeout(() => {
                    refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh';
                    refreshBtn.disabled = false;
                    showNotification('Priests data refreshed!', 'success');
                }, 1000);
            }
        }

        // Filter Priests Function
        function filterPriests(searchTerm) {
            const tableRows = document.querySelectorAll('#priestsTableBody tr');
            
            tableRows.forEach(row => {
                const priestName = row.querySelector('.user-name')?.textContent.toLowerCase() || '';
                const priestEmail = row.querySelector('.user-email')?.textContent.toLowerCase() || '';
                const specialization = row.querySelector('.service-badge')?.textContent.toLowerCase() || '';
                
                const matches = priestName.includes(searchTerm) || 
                              priestEmail.includes(searchTerm) || 
                              specialization.includes(searchTerm);
                
                row.style.display = matches ? '' : 'none';
            });
        }

        // Load priests data from database
        function loadPriestsData() {
            console.log('Loading priests data from database...');
            
            fetch('/api/priests/all')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        console.log('Priests data loaded:', data.data);
                        populatePriestsTable(data.data);
                        updatePriestsCount(data.count);
                    } else {
                        console.error('Failed to load priests:', data.error);
                        showNotification('Failed to load priests data', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error loading priests:', error);
                    showNotification('Error loading priests data', 'error');
                });
        }

        // Populate priests table with real data
        function populatePriestsTable(priests) {
            const tableBody = document.getElementById('priestsTableBody');
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            if (priests.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #6b7280;">
                            <i class="fas fa-church" style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;"></i>
                            <p>No priests found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            priests.forEach(priest => {
                const row = document.createElement('tr');
                
                // Get initials for avatar
                const fullName = priest.full_name || 'Unknown';
                const nameParts = fullName.split(' ');
                const initials = nameParts.length >= 2 
                    ? nameParts[0][0] + nameParts[1][0] 
                    : nameParts[0][0] + (nameParts[0][1] || '');
                
                // Format date
                const dateAdded = priest.created_at ? new Date(priest.created_at).toLocaleDateString() : 'N/A';
                
                // Get specialization class for badge
                const specialization = priest.specialization || 'general-services';
                const specializationClass = specialization.toLowerCase().replace(/\s+/g, '-');
                const email = priest.email || 'No email';
                const status = priest.status || 'active';
                
                row.innerHTML = `
                    <td>
                        <div class="user-info">
                            <div class="user-avatar">${initials.toUpperCase()}</div>
                            <div class="user-details">
                                <div class="user-name">${fullName}</div>
                                <div class="user-email">${email}</div>
                            </div>
                        </div>
                    </td>
                    <td>${email}</td>
                    <td>
                        <span class="service-badge ${specializationClass}">${specialization}</span>
                    </td>
                    <td>
                        <span class="status-badge ${status}">${status.charAt(0).toUpperCase() + status.slice(1)}</span>
                    </td>
                    <td>${dateAdded}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn edit" title="Edit Priest" onclick="editPriest('${priest.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" title="Remove Priest" onclick="removePriest('${priest.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // Update priests count
        function updatePriestsCount(count) {
            const countElement = document.getElementById('priestsCount');
            if (countElement) {
                countElement.textContent = `${count} ${count === 1 ? 'Priest' : 'Priests'}`;
            }
        }

        // Add New Priest Function - Updated to use API
        function addNewPriest() {
            const form = document.getElementById('addPriestForm');
            const formData = new FormData(form);
            
            const priestData = {
                full_name: formData.get('full_name'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                specialization: formData.get('specialization'),
                status: formData.get('status') || 'active'
            };

            console.log('Adding new priest:', priestData);
            
            // Show loading state
            const confirmBtn = document.getElementById('confirmAddPriest');
            const originalText = confirmBtn.innerHTML;
            confirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
            confirmBtn.disabled = true;
            
            fetch('/api/priests', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(priestData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Priest added successfully!', 'success');
                    document.getElementById('addPriestModal').style.display = 'none';
                    loadPriestsData(); // Reload data
                } else {
                    showNotification(data.error || 'Failed to add priest', 'error');
                }
            })
            .catch(error => {
                console.error('Error adding priest:', error);
                showNotification('Error adding priest', 'error');
            })
            .finally(() => {
                confirmBtn.innerHTML = originalText;
                confirmBtn.disabled = false;
            });
        }

        // Edit Priest Function - Updated to fetch real data
        function editPriest(priestId) {
            console.log('Editing priest:', priestId);
            
            fetch(`/api/priests/${priestId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const priest = data.data;
                        
                        // Populate edit form with real data
                        document.getElementById('editPriestId').value = priest.id;
                        document.getElementById('editPriestFullName').value = priest.full_name;
                        document.getElementById('editPriestEmail').value = priest.email;
                        document.getElementById('editPriestPhone').value = priest.phone || '';
                        document.getElementById('editPriestSpecialization').value = priest.specialization;
                        document.getElementById('editPriestStatus').value = priest.status;
                        
                        document.getElementById('editPriestModal').style.display = 'flex';
                    } else {
                        showNotification(data.error || 'Failed to load priest data', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error loading priest data:', error);
                    showNotification('Error loading priest data', 'error');
                });
        }

        // Update Priest Function - Updated to use API
        function updatePriest() {
            const form = document.getElementById('editPriestForm');
            const formData = new FormData(form);
            
            const priestId = formData.get('priest_id');
            const priestData = {
                full_name: formData.get('full_name'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                specialization: formData.get('specialization'),
                status: formData.get('status')
            };

            console.log('Updating priest:', priestData);
            
            // Show loading state
            const confirmBtn = document.getElementById('confirmEditPriest');
            const originalText = confirmBtn.innerHTML;
            confirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            confirmBtn.disabled = true;
            
            fetch(`/api/priests/${priestId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(priestData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Priest updated successfully!', 'success');
                    document.getElementById('editPriestModal').style.display = 'none';
                    loadPriestsData(); // Reload data
                } else {
                    showNotification(data.error || 'Failed to update priest', 'error');
                }
            })
            .catch(error => {
                console.error('Error updating priest:', error);
                showNotification('Error updating priest', 'error');
            })
            .finally(() => {
                confirmBtn.innerHTML = originalText;
                confirmBtn.disabled = false;
            });
        }

        // Remove Priest Function - Updated to use API
        function removePriest(priestId) {
            console.log('Removing priest:', priestId);
            
            // Fetch priest data to show in confirmation
            fetch(`/api/priests/${priestId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const priest = data.data;
                        
                        // Set priest info in delete modal
                        document.getElementById('deletePriestInfo').textContent = 
                            `This will permanently remove ${priest.full_name} from the system.`;
                        
                        // Store priest ID for deletion
                        document.getElementById('deletePriestModal').setAttribute('data-priest-id', priestId);
                        document.getElementById('deletePriestModal').style.display = 'flex';
                        
                        // Reset checkbox
                        document.getElementById('confirmPriestDeletion').checked = false;
                        document.getElementById('confirmDeletePriest').disabled = true;
                    } else {
                        showNotification('Failed to load priest data', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error loading priest data:', error);
                    showNotification('Error loading priest data', 'error');
                });
        }

        // Confirm Delete Priest Function - Updated to use API
        function confirmDeletePriestAction() {
            const priestId = document.getElementById('deletePriestModal').getAttribute('data-priest-id');
            
            console.log('Confirming priest deletion:', priestId);
            
            // Show loading state
            const confirmBtn = document.getElementById('confirmDeletePriest');
            const originalText = confirmBtn.innerHTML;
            confirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Removing...';
            confirmBtn.disabled = true;
            
            fetch(`/api/priests/${priestId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Priest removed successfully!', 'success');
                    document.getElementById('deletePriestModal').style.display = 'none';
                    loadPriestsData(); // Reload data
                } else {
                    showNotification(data.error || 'Failed to remove priest', 'error');
                }
            })
            .catch(error => {
                console.error('Error removing priest:', error);
                showNotification('Error removing priest', 'error');
            })
            .finally(() => {
                confirmBtn.innerHTML = originalText;
                confirmBtn.disabled = false;
            });
        }

        // Refresh Priests Function - Updated to reload from database
        function refreshPriests() {
            console.log('Refreshing priests data...');
            
            const refreshBtn = document.getElementById('refreshPriestsBtn');
            if (refreshBtn) {
                refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Refreshing...';
                refreshBtn.disabled = true;
                
                loadPriestsData();
                
                setTimeout(() => {
                    refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh';
                    refreshBtn.disabled = false;
                }, 1000);
            }
        }

        // Initialize priest management when the module is shown
        document.addEventListener('DOMContentLoaded', function() {
            initializePriestManagement();
            
            // Load priests data when page loads
            loadPriestsData();
            
            // Load dashboard data on page load
            loadAdminDashboardData();
        });

        // Admin Dashboard Data Loading Functions
        async function loadAdminDashboardData() {
            if (dashboardDataLoaded) {
                console.log('Dashboard data already loaded, skipping...');
                return;
            }
            
            try {
                console.log('Loading admin dashboard data...');
                const response = await fetch('/api/admin/dashboard-stats');
                const result = await response.json();
                
                if (result.success) {
                    const data = result.data;
                    
                    // Update stat cards (with null checks)
                    const totalReservationsEl = document.getElementById('totalReservations');
                    if (totalReservationsEl) totalReservationsEl.textContent = data.total_reservations;
                    
                    const approvedReservationsEl = document.getElementById('approvedReservations');
                    if (approvedReservationsEl) approvedReservationsEl.textContent = data.approved_reservations;
                    
                    const pendingApprovalsEl = document.getElementById('pendingApprovals');
                    if (pendingApprovalsEl) pendingApprovalsEl.textContent = data.pending_reservations;
                    
                    const totalRevenueEl = document.getElementById('totalRevenue');
                    if (totalRevenueEl) totalRevenueEl.textContent = `â‚±${data.total_revenue.toLocaleString()}`;
                    
                    // Update navigation badges (with null checks)
                    const userCountBadgeEl = document.getElementById('userCountBadge');
                    if (userCountBadgeEl) userCountBadgeEl.textContent = data.total_secretaries;
                    
                    const pendingReservationsBadgeEl = document.getElementById('pendingReservationsBadge');
                    if (pendingReservationsBadgeEl) pendingReservationsBadgeEl.textContent = data.pending_reservations;
                    
                    // Update trends (with null checks)
                    const growthTrend = data.monthly_growth >= 0 ? 'trend-up' : 'trend-down';
                    const growthIcon = data.monthly_growth >= 0 ? '+' : '';
                    const reservationsTrendEl = document.getElementById('reservationsTrend');
                    if (reservationsTrendEl) {
                        reservationsTrendEl.textContent = `${growthIcon}${data.monthly_growth}%`;
                        reservationsTrendEl.className = `stat-trend ${growthTrend}`;
                    }
                    
                    // Update subtexts (with null checks)
                    const reservationsSubtextEl = document.getElementById('reservationsSubtext');
                    if (reservationsSubtextEl) reservationsSubtextEl.textContent = `This month: ${data.current_month_reservations}`;
                    
                    const approvedSubtextEl = document.getElementById('approvedSubtext');
                    if (approvedSubtextEl) approvedSubtextEl.textContent = `Success rate: ${Math.round((data.approved_reservations / data.total_reservations) * 100)}%`;
                    
                    const revenueSubtextEl = document.getElementById('revenueSubtext');
                    if (revenueSubtextEl) revenueSubtextEl.textContent = `From ${data.total_reservations} reservations`;
                    
                    // Update progress bars (with null checks)
                    const reservationProgress = Math.min((data.current_month_reservations / 50) * 100, 100);
                    const approvedProgress = (data.approved_reservations / data.total_reservations) * 100;
                    const pendingProgress = (data.pending_reservations / data.total_reservations) * 100;
                    const revenueProgress = Math.min((data.total_revenue / 100000) * 100, 100);
                    
                    const reservationsProgressEl = document.getElementById('reservationsProgress');
                    if (reservationsProgressEl) reservationsProgressEl.style.width = `${reservationProgress}%`;
                    
                    const approvedProgressEl = document.getElementById('approvedProgress');
                    if (approvedProgressEl) approvedProgressEl.style.width = `${approvedProgress}%`;
                    
                    const pendingProgressEl = document.getElementById('pendingProgress');
                    if (pendingProgressEl) pendingProgressEl.style.width = `${pendingProgress}%`;
                    
                    const revenueProgressEl = document.getElementById('revenueProgress');
                    if (revenueProgressEl) revenueProgressEl.style.width = `${revenueProgress}%`;
                    
                    console.log('âœ… Admin dashboard data loaded successfully');
                    dashboardDataLoaded = true;
                } else {
                    console.error('Failed to load dashboard data:', result.error);
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        // User Management Module Functions
        // REMOVED DUPLICATE: initializeUserManagement() and loadUsersData()
        // Using loadUsers() function instead (defined above in DOMContentLoaded)

        // Reservations Overview Module Functions
        let allOverviewReservations = []; // Store all reservations for filtering
        
        async function initializeReservationsOverview() {
            console.log('Initializing Reservations Overview module...');
            await loadReservationsOverviewData();
        }

        async function loadReservationsOverviewData() {
            try {
                // Load dashboard stats for overview cards
                const statsResponse = await fetch('/api/admin/dashboard-stats');
                const statsResult = await statsResponse.json();
                
                if (statsResult.success) {
                    const data = statsResult.data;
                    document.getElementById('overview-total-reservations').textContent = data.total_reservations;
                    document.getElementById('overview-approved-reservations').textContent = data.approved_reservations;
                    document.getElementById('overview-pending-reservations').textContent = data.pending_reservations;
                }
                
                // Load reservations table data
                const reservationsResponse = await fetch('/api/reservations/all');
                const reservationsResult = await reservationsResponse.json();
                
                if (reservationsResult.success) {
                    allOverviewReservations = reservationsResult.data; // Store all reservations
                    displayOverviewReservations(allOverviewReservations.slice(0, 20)); // Show latest 20
                    updateOverviewSearchCount(allOverviewReservations.length, allOverviewReservations.length);
                }
            } catch (error) {
                console.error('Error loading reservations overview data:', error);
            }
        }
        
        function displayOverviewReservations(reservations) {
            const tableBody = document.getElementById('reservationsOverviewTableBody');
            
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            if (reservations.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="11" style="text-align: center; padding: 40px; color: #6b7280;">
                            <i class="fas fa-search" style="font-size: 24px;"></i>
                            <p style="margin-top: 12px;">No matching reservations found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            reservations.forEach(reservation => {
                const row = document.createElement('tr');
                
                // Get stipendium badge
                const stipendiumBadge = getOverviewStipendiumBadge(reservation);
                
                // Get attendance badge
                const attendanceBadge = getOverviewAttendanceBadge(reservation.attendance_status || 'pending');
                
                row.innerHTML = `
                    <td>${reservation.reservation_id || reservation.id}</td>
                    <td>${reservation.contact_name}</td>
                    <td><span class="service-badge ${reservation.service_type}">${reservation.service_type}</span></td>
                    <td>${new Date(reservation.date).toLocaleDateString()}</td>
                    <td>${reservation.time_slot || reservation.time}</td>
                    <td>${reservation.priest_name || 'Not Assigned'}</td>
                    <td><span class="status-badge status-${reservation.status}">${reservation.status.toUpperCase()}</span></td>
                    <td>${stipendiumBadge}</td>
                    <td>${attendanceBadge}</td>
                    <td>${reservation.created_by_secretary || 'System'}</td>
                    <td class="table-actions">
                        <button class="action-btn" data-action="view" data-reservation-id="${reservation.id}" title="View Details">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            console.log(`âœ… Displayed ${reservations.length} reservations in overview`);
        }
        
        function updateOverviewSearchCount(showing, total) {
            const countElement = document.getElementById('overviewSearchResultCount');
            if (countElement) {
                if (showing === total) {
                    countElement.textContent = `Showing ${showing} of ${total} reservations`;
                } else {
                    countElement.textContent = `Found ${showing} of ${total} reservations`;
                }
            }
        }
        
        // Helper function to get stipendium badge
        function getOverviewStipendiumBadge(reservation) {
            // Check if this is a Confirmation service - ALWAYS show N/A
            if (reservation.service_type === 'confirmation') {
                return `<span class="stipendium-badge stipendium-na"><i class="fas fa-minus"></i> N/A</span>`;
            }
            
            // For other services, check payment information
            let hasPaymentInfo = false;
            let stipendiumStatus = 'Pending';
            let stipendiumClass = 'stipendium-pending';
            let stipendiumIcon = 'fas fa-clock';
            
            if (reservation.payment_status) {
                hasPaymentInfo = true;
                stipendiumStatus = reservation.payment_status;
            } else if (reservation.amount_paid && reservation.total_amount) {
                hasPaymentInfo = true;
                const amountPaid = parseFloat(reservation.amount_paid);
                const totalAmount = parseFloat(reservation.total_amount);
                
                if (amountPaid >= totalAmount) {
                    stipendiumStatus = 'Paid';
                } else if (amountPaid > 0) {
                    stipendiumStatus = 'Partial';
                }
            } else if (reservation.payment_method || reservation.payment_type || reservation.gcash_reference) {
                hasPaymentInfo = true;
                if (reservation.status === 'confirmed' || reservation.status === 'completed') {
                    stipendiumStatus = 'Paid';
                }
            }
            
            // Set appropriate class and icon based on status
            switch (stipendiumStatus.toLowerCase()) {
                case 'paid':
                    stipendiumClass = 'stipendium-paid';
                    stipendiumIcon = 'fas fa-check-circle';
                    stipendiumStatus = 'FULL STIPENDIUM';
                    break;
                case 'partial':
                    stipendiumClass = 'stipendium-partial';
                    stipendiumIcon = 'fas fa-exclamation-triangle';
                    stipendiumStatus = 'PARTIAL STIPENDIUM';
                    break;
                case 'pending':
                default:
                    stipendiumClass = 'stipendium-pending';
                    stipendiumIcon = 'fas fa-clock';
                    stipendiumStatus = 'PENDING STIPENDIUM';
                    break;
            }
            
            return `<span class="stipendium-badge ${stipendiumClass}"><i class="${stipendiumIcon}"></i> ${stipendiumStatus}</span>`;
        }
        
        // Helper function to get attendance badge
        function getOverviewAttendanceBadge(status) {
            switch(status) {
                case 'attended':
                    return '<span class="attendance-badge attended"><i class="fas fa-check"></i> ATTENDED</span>';
                case 'no_show':
                    return '<span class="attendance-badge no-show"><i class="fas fa-times"></i> NO-SHOW</span>';
                case 'cancelled':
                    return '<span class="attendance-badge cancelled"><i class="fas fa-ban"></i> CANCELLED</span>';
                case 'pending':
                default:
                    return '<span class="attendance-badge pending"><i class="fas fa-clock"></i> PENDING</span>';
            }
        }
        
        function filterOverviewReservations(searchTerm) {
            console.log('ðŸ” Overview search term:', searchTerm);
            
            if (!searchTerm || searchTerm.trim() === '') {
                // Show all reservations (latest 20)
                displayOverviewReservations(allOverviewReservations.slice(0, 20));
                updateOverviewSearchCount(allOverviewReservations.length, allOverviewReservations.length);
                return;
            }
            
            const term = searchTerm.toLowerCase().trim();
            
            const filtered = allOverviewReservations.filter(reservation => {
                // Search in client name
                const clientName = (reservation.contact_name || '').toString().toLowerCase();
                
                // Search in phone number
                const phone = (reservation.contact_phone || '').toString().toLowerCase();
                
                // Search in service type
                const serviceType = (reservation.service_type || '').toString().toLowerCase();
                
                // Search in reservation ID
                const reservationId = (reservation.reservation_id || reservation.id || '').toString().toLowerCase();
                
                // Search in priest name
                const priestName = (reservation.priest_name || '').toString().toLowerCase();
                
                // Search in created by
                const createdBy = (reservation.created_by_secretary || '').toString().toLowerCase();
                
                return clientName.includes(term) || 
                       phone.includes(term) || 
                       serviceType.includes(term) || 
                       reservationId.includes(term) ||
                       priestName.includes(term) ||
                       createdBy.includes(term);
            });
            
            console.log(`âœ… Found ${filtered.length} matching reservations`);
            displayOverviewReservations(filtered);
            updateOverviewSearchCount(filtered.length, allOverviewReservations.length);
        }

        // Reservations Management Module Functions
        let allAdminReservations = []; // Store all reservations for filtering
        
        async function loadRecentReservationsTable() {
            try {
                console.log('Loading recent reservations table...');
                const response = await fetch('/api/reservations/all');
                const result = await response.json();
                
                if (result.success) {
                    allAdminReservations = result.data; // Store all reservations
                    displayAdminReservations(allAdminReservations.slice(0, 10)); // Show latest 10
                    updateAdminSearchCount(allAdminReservations.length, allAdminReservations.length);
                    
                    // Load stats cards for Reservations Management module
                    loadReservationsMgmtStats(result.data);
                } else {
                    console.error('Failed to load reservations:', result.error);
                }
            } catch (error) {
                console.error('Error loading recent reservations table:', error);
                const tableBody = document.getElementById('recentReservationsTableBody');
                if (tableBody) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="9" style="text-align: center; padding: 40px; color: #ef4444;">
                                <i class="fas fa-exclamation-triangle" style="font-size: 24px;"></i>
                                <p style="margin-top: 12px;">Failed to load reservations. Please try again.</p>
                            </td>
                        </tr>
                    `;
                }
            }
        }
        
        // Load Reservations Management Stats Cards
        function loadReservationsMgmtStats(reservations) {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            // Calculate week start (Sunday)
            const weekStart = new Date(now);
            weekStart.setDate(now.getDate() - now.getDay());
            weekStart.setHours(0, 0, 0, 0);
            
            // Total reservations
            const totalReservations = reservations.length;
            
            // Pending approvals
            const pendingApprovals = reservations.filter(r => r.status === 'pending').length;
            
            // Confirmed this month
            const confirmedThisMonth = reservations.filter(r => {
                const resDate = new Date(r.reservation_date || r.date);
                return (r.status === 'approved' || r.status === 'confirmed') &&
                       resDate.getMonth() === currentMonth &&
                       resDate.getFullYear() === currentYear;
            }).length;
            
            // This week's upcoming reservations
            const thisWeekReservations = reservations.filter(r => {
                const resDate = new Date(r.reservation_date || r.date);
                return resDate >= weekStart && resDate >= now;
            }).length;
            
            // Calculate growth (current month vs previous month)
            const prevMonth = currentMonth === 0 ? 11 : currentMonth - 1;
            const prevYear = currentMonth === 0 ? currentYear - 1 : currentYear;
            
            const currentMonthCount = reservations.filter(r => {
                if (!r.created_at) return false;
                const createdDate = new Date(r.created_at);
                return createdDate.getMonth() === currentMonth && createdDate.getFullYear() === currentYear;
            }).length;
            
            const prevMonthCount = reservations.filter(r => {
                if (!r.created_at) return false;
                const createdDate = new Date(r.created_at);
                return createdDate.getMonth() === prevMonth && createdDate.getFullYear() === prevYear;
            }).length;
            
            const growthRate = prevMonthCount > 0 ? 
                ((currentMonthCount - prevMonthCount) / prevMonthCount * 100).toFixed(1) : 0;
            
            // Update stat cards
            document.getElementById('reservationsMgmt-total').textContent = totalReservations;
            document.getElementById('reservationsMgmt-pending').textContent = pendingApprovals;
            document.getElementById('reservationsMgmt-confirmed').textContent = confirmedThisMonth;
            document.getElementById('reservationsMgmt-thisWeek').textContent = thisWeekReservations;
            
            // Update growth indicator
            const growthElement = document.getElementById('reservationsMgmt-growth');
            if (growthElement) {
                growthElement.textContent = `${growthRate > 0 ? '+' : ''}${growthRate}%`;
                growthElement.className = `stat-trend ${growthRate >= 0 ? 'trend-up' : 'trend-down'}`;
            }
            
            console.log('âœ… Reservations Management stats loaded from database');
        }
        
        function displayAdminReservations(reservations) {
            const tableBody = document.getElementById('recentReservationsTableBody');
            
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            if (reservations.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 40px; color: #6b7280;">
                            <i class="fas fa-search" style="font-size: 24px;"></i>
                            <p style="margin-top: 12px;">No matching reservations found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            reservations.forEach(reservation => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${reservation.reservation_id || reservation.id}</td>
                    <td>${reservation.contact_name}</td>
                    <td><span class="service-badge ${reservation.service_type}">${reservation.service_type}</span></td>
                    <td>${new Date(reservation.date).toLocaleDateString()}</td>
                    <td>${reservation.time_slot || reservation.time}</td>
                    <td>${reservation.priest_name || 'Not Assigned'}</td>
                    <td><span class="status-badge status-${reservation.status}">${reservation.status.toUpperCase()}</span></td>
                    <td><strong>${reservation.created_by_secretary || 'System'}</strong></td>
                    <td class="table-actions">
                        <button class="action-btn" data-action="view" data-reservation-id="${reservation.id}" title="View Details">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn" data-action="edit" data-reservation-id="${reservation.id}" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            console.log(`âœ… Displayed ${reservations.length} reservations`);
        }
        
        function updateAdminSearchCount(showing, total) {
            const countElement = document.getElementById('adminSearchResultCount');
            if (countElement) {
                if (showing === total) {
                    countElement.textContent = `Showing ${showing} of ${total} reservations`;
                } else {
                    countElement.textContent = `Found ${showing} of ${total} reservations`;
                }
            }
        }
        
        function filterAdminReservations(searchTerm) {
            console.log('ðŸ” Admin search term:', searchTerm);
            
            if (!searchTerm || searchTerm.trim() === '') {
                // Show all reservations (latest 10)
                displayAdminReservations(allAdminReservations.slice(0, 10));
                updateAdminSearchCount(allAdminReservations.length, allAdminReservations.length);
                return;
            }
            
            const term = searchTerm.toLowerCase().trim();
            
            const filtered = allAdminReservations.filter(reservation => {
                // Search in client name
                const clientName = (reservation.contact_name || '').toString().toLowerCase();
                
                // Search in phone number
                const phone = (reservation.contact_phone || '').toString().toLowerCase();
                
                // Search in service type
                const serviceType = (reservation.service_type || '').toString().toLowerCase();
                
                // Search in reservation ID
                const reservationId = (reservation.reservation_id || reservation.id || '').toString().toLowerCase();
                
                // Search in priest name
                const priestName = (reservation.priest_name || '').toString().toLowerCase();
                
                // Search in created by
                const createdBy = (reservation.created_by_secretary || '').toString().toLowerCase();
                
                return clientName.includes(term) || 
                       phone.includes(term) || 
                       serviceType.includes(term) || 
                       reservationId.includes(term) ||
                       priestName.includes(term) ||
                       createdBy.includes(term);
            });
            
            console.log(`âœ… Found ${filtered.length} matching reservations`);
            displayAdminReservations(filtered);
            updateAdminSearchCount(filtered.length, allAdminReservations.length);
        }

        // Financial Reports Module Functions
        let monthlyReservationsChartInstance = null;
        let serviceDistributionChartInstance = null;
        let revenueTrendsChartInstance = null;
        let paymentStatusChartInstance = null;
        
        async function initializeFinancialReports() {
            if (financialReportsInitialized) {
                console.log('ðŸ“Š Financial Reports already initialized, skipping...');
                return;
            }
            console.log('ðŸ“Š Initializing Financial Reports module...');
            try {
                await loadReportsData();
                await loadFinancialSummaryData(); // Load financial summary cards
                financialReportsInitialized = true;
                console.log('âœ… Financial Reports initialized successfully');
            } catch (error) {
                console.error('âŒ Error initializing Financial Reports:', error);
            }
        }

        async function loadReportsData() {
            try {
                console.log('ðŸ“Š Loading all reports data...');
                // Load all reports data
                await Promise.all([
                    loadReportsSummary(),
                    loadMonthlyReservationsChart(),
                    loadServiceDistributionChart(),
                    loadRevenueTrendsChart(),
                    loadAttendanceRateChart(),
                    loadPopularServicesTable()
                ]);
                
                console.log('âœ… All reports data loaded successfully');
            } catch (error) {
                console.error('âŒ Error loading reports data:', error);
                console.error('Error details:', error.message, error.stack);
            }
        }
        
        // Load Financial Summary Data from Database
        async function loadFinancialSummaryData() {
            try {
                // Get payments data for financial calculations
                const paymentsResponse = await fetch('/api/reservations/all');
                const paymentsResult = await paymentsResponse.json();
                
                if (paymentsResult.success) {
                    const reservations = paymentsResult.data;
                    
                    // Calculate total revenue from all payments
                    let totalRevenue = 0;
                    let monthlyRevenue = 0;
                    let pendingPayments = 0;
                    
                    const now = new Date();
                    const currentMonth = now.getMonth();
                    const currentYear = now.getFullYear();
                    
                    reservations.forEach(reservation => {
                        const amountPaid = parseFloat(reservation.amount_paid || 0);
                        const totalAmount = parseFloat(reservation.total_amount || 0);
                        
                        // Add to total revenue
                        totalRevenue += amountPaid;
                        
                        // Check if this month's payment
                        if (reservation.created_at) {
                            const resDate = new Date(reservation.created_at);
                            if (resDate.getMonth() === currentMonth && resDate.getFullYear() === currentYear) {
                                monthlyRevenue += amountPaid;
                            }
                        }
                        
                        // Calculate pending payments (total_amount - amount_paid)
                        if (totalAmount > amountPaid && reservation.service_type !== 'confirmation') {
                            pendingPayments += (totalAmount - amountPaid);
                        }
                    });
                    
                    // Update financial summary cards
                    document.getElementById('financial-total-revenue').textContent = `â‚±${totalRevenue.toLocaleString()}`;
                    document.getElementById('financial-monthly-revenue').textContent = `â‚±${monthlyRevenue.toLocaleString()}`;
                    document.getElementById('financial-pending-payments').textContent = `â‚±${pendingPayments.toLocaleString()}`;
                    
                    console.log('âœ… Financial summary data loaded from database');
                }
            } catch (error) {
                console.error('Error loading financial summary data:', error);
                document.getElementById('financial-total-revenue').textContent = 'â‚±0';
                document.getElementById('financial-monthly-revenue').textContent = 'â‚±0';
                document.getElementById('financial-pending-payments').textContent = 'â‚±0';
            }
        }
        
        // Load Summary Statistics
        async function loadReportsSummary() {
            try {
                const response = await fetch('/api/reports/summary');
                const result = await response.json();
                
                if (result.success) {
                    const data = result.data;
                    
                    // Update summary cards
                    document.getElementById('reportTotalReservations').textContent = data.total_reservations || 0;
                    document.getElementById('reportTotalRevenue').textContent = `â‚±${(data.total_revenue || 0).toLocaleString()}`;
                    document.getElementById('reportPendingApprovals').textContent = data.pending_approvals || 0;
                    
                    // Update growth indicators
                    const reservationGrowth = data.reservation_growth || 0;
                    const trendElement = document.querySelector('#reportTotalReservations').closest('.stat-card').querySelector('.stat-trend');
                    if (trendElement) {
                        trendElement.textContent = `${reservationGrowth > 0 ? '+' : ''}${reservationGrowth}%`;
                        trendElement.className = `stat-trend ${reservationGrowth >= 0 ? 'trend-up' : 'trend-down'}`;
                    }
                    
                    console.log('âœ… Reports summary loaded');
                }
            } catch (error) {
                console.error('Error loading reports summary:', error);
            }
        }
        
        // Load Monthly Reservations Chart
        async function loadMonthlyReservationsChart() {
            try {
                console.log('ðŸ“ˆ Loading Monthly Reservations Chart...');
                const response = await fetch('/api/reports/monthly-reservations');
                console.log('ðŸ“¡ API Response status:', response.status);
                
                const result = await response.json();
                console.log('ðŸ“Š Monthly Reservations Data:', result);
                
                if (result.success) {
                    const data = result.data;
                    console.log('ðŸ“Š Chart data - Labels:', data.labels, 'Counts:', data.counts);
                    
                    const ctx = document.getElementById('reportsMonthlyReservationsChart');
                    
                    if (!ctx) {
                        console.error('âŒ Chart canvas not found: reportsMonthlyReservationsChart');
                        return;
                    }
                    
                    if (ctx) {
                        if (monthlyReservationsChartInstance) {
                            monthlyReservationsChartInstance.destroy();
                        }
                        
                        monthlyReservationsChartInstance = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: data.labels,
                                datasets: [{
                                    label: 'Reservations',
                                    data: data.counts,
                                    borderColor: '#3b82f6',
                                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                    borderWidth: 3,
                                    fill: true,
                                    tension: 0.4,
                                    pointBackgroundColor: '#ffffff',
                                    pointBorderColor: '#3b82f6',
                                    pointBorderWidth: 2,
                                    pointRadius: 4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        display: false
                                    },
                                    tooltip: {
                                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                        padding: 12,
                                        titleColor: '#fff',
                                        bodyColor: '#fff',
                                        borderColor: '#3b82f6',
                                        borderWidth: 1
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        ticks: {
                                            stepSize: 1,
                                            color: '#6b7280'
                                        },
                                        grid: {
                                            color: 'rgba(0, 0, 0, 0.05)'
                                        }
                                    },
                                    x: {
                                        ticks: {
                                            color: '#6b7280'
                                        },
                                        grid: {
                                            display: false
                                        }
                                    }
                                }
                            }
                        });
                        
                        console.log('âœ… Monthly reservations chart created successfully');
                    }
                } else {
                    console.error('âŒ API returned error:', result.error || 'Unknown error');
                }
            } catch (error) {
                console.error('âŒ Error loading monthly reservations chart:', error);
                console.error('Error details:', error.message, error.stack);
            }
        }
        
        // Load Service Distribution Chart
        async function loadServiceDistributionChart() {
            try {
                console.log('ðŸ© Loading Service Distribution Chart...');
                const response = await fetch('/api/reports/service-distribution');
                console.log('ðŸ“¡ API Response status:', response.status);
                
                const result = await response.json();
                console.log('ðŸ“Š Service Distribution Data:', result);
                
                if (result.success) {
                    const data = result.data;
                    console.log('ðŸ“Š Chart data - Labels:', data.labels, 'Counts:', data.counts);
                    
                    const ctx = document.getElementById('reportsServiceDistributionChart');
                    
                    if (!ctx) {
                        console.error('âŒ Chart canvas not found: reportsServiceDistributionChart');
                        return;
                    }
                    
                    if (ctx) {
                        if (serviceDistributionChartInstance) {
                            serviceDistributionChartInstance.destroy();
                        }
                        
                        serviceDistributionChartInstance = new Chart(ctx, {
                            type: 'doughnut',
                            data: {
                                labels: data.labels,
                                datasets: [{
                                    data: data.counts,
                                    backgroundColor: [
                                        '#fbbf24', // Wedding - Gold
                                        '#60a5fa', // Baptism - Blue
                                        '#9ca3af', // Funeral - Gray
                                        '#c084fc'  // Confirmation - Purple
                                    ],
                                    borderWidth: 2,
                                    borderColor: '#ffffff'
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'bottom',
                                        labels: {
                                            padding: 15,
                                            font: {
                                                size: 12
                                            }
                                        }
                                    },
                                    tooltip: {
                                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                        padding: 12,
                                        callbacks: {
                                            label: function(context) {
                                                const label = context.label || '';
                                                const value = context.parsed || 0;
                                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                                const percentage = ((value / total) * 100).toFixed(1);
                                                return `${label}: ${value} (${percentage}%)`;
                                            }
                                        }
                                    }
                                }
                            }
                        });
                        
                        console.log('âœ… Service distribution chart created successfully');
                    }
                } else {
                    console.error('âŒ API returned error:', result.error || 'Unknown error');
                }
            } catch (error) {
                console.error('âŒ Error loading service distribution chart:', error);
                console.error('Error details:', error.message, error.stack);
            }
        }
        
        // Load Revenue Trends Chart
        async function loadRevenueTrendsChart() {
            try {
                console.log('ðŸ’° Loading Revenue Trends Chart...');
                const response = await fetch('/api/reports/revenue-trends');
                console.log('ðŸ“¡ API Response status:', response.status);
                
                const result = await response.json();
                console.log('ðŸ“Š Revenue Trends Data:', result);
                
                if (result.success) {
                    const data = result.data;
                    console.log('ðŸ“Š Chart data - Labels:', data.labels, 'Revenue:', data.revenue);
                    
                    const ctx = document.getElementById('reportsRevenueTrendsChart');
                    
                    if (!ctx) {
                        console.error('âŒ Chart canvas not found: reportsRevenueTrendsChart');
                        return;
                    }
                    
                    if (ctx) {
                        if (revenueTrendsChartInstance) {
                            revenueTrendsChartInstance.destroy();
                        }
                        
                        revenueTrendsChartInstance = new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: data.labels,
                                datasets: [{
                                    label: 'Stipendium',
                                    data: data.revenue,
                                    backgroundColor: 'rgba(16, 185, 129, 0.8)',
                                    borderColor: '#10b981',
                                    borderWidth: 1,
                                    borderRadius: 6
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        display: false
                                    },
                                    tooltip: {
                                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                        padding: 12,
                                        callbacks: {
                                            label: function(context) {
                                                return 'Stipendium: â‚±' + context.parsed.y.toLocaleString();
                                            }
                                        }
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        ticks: {
                                            callback: function(value) {
                                                return 'â‚±' + value.toLocaleString();
                                            },
                                            color: '#6b7280'
                                        },
                                        grid: {
                                            color: 'rgba(0, 0, 0, 0.05)'
                                        }
                                    },
                                    x: {
                                        ticks: {
                                            color: '#6b7280'
                                        },
                                        grid: {
                                            display: false
                                        }
                                    }
                                }
                            }
                        });
                        
                        console.log('âœ… Revenue trends chart created successfully');
                    }
                } else {
                    console.error('âŒ API returned error:', result.error || 'Unknown error');
                }
            } catch (error) {
                console.error('âŒ Error loading revenue trends chart:', error);
                console.error('Error details:', error.message, error.stack);
            }
        }
        
        // Load Payment Status Chart
        async function loadPaymentStatusChart() {
            try {
                const response = await fetch('/api/reports/payment-status');
                const result = await response.json();
                
                if (result.success) {
                    const data = result.data;
                    const ctx = document.getElementById('paymentStatusChart');
                    
                    if (ctx) {
                        if (paymentStatusChartInstance) {
                            paymentStatusChartInstance.destroy();
                        }
                        
                        paymentStatusChartInstance = new Chart(ctx, {
                            type: 'pie',
                            data: {
                                labels: data.labels,
                                datasets: [{
                                    data: data.counts,
                                    backgroundColor: [
                                        '#10b981', // Fully Paid - Green
                                        '#f59e0b', // Partial - Orange
                                        '#ef4444', // Pending - Red
                                        '#6b7280'  // No Payment - Gray
                                    ],
                                    borderWidth: 2,
                                    borderColor: '#ffffff'
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'bottom',
                                        labels: {
                                            padding: 15,
                                            font: {
                                                size: 12
                                            }
                                        }
                                    },
                                    tooltip: {
                                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                        padding: 12,
                                        callbacks: {
                                            label: function(context) {
                                                const label = context.label || '';
                                                const value = context.parsed || 0;
                                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                                const percentage = ((value / total) * 100).toFixed(1);
                                                return `${label}: ${value} (${percentage}%)`;
                                            }
                                        }
                                    }
                                }
                            }
                        });
                        
                        console.log('âœ… Payment status chart loaded');
                    }
                }
            } catch (error) {
                console.error('Error loading payment status chart:', error);
            }
        }
        
        // Load Attendance Rate Chart
        let attendanceRateChartInstance = null;
        
        async function loadAttendanceRateChart() {
            try {
                console.log('ðŸ“Š Loading Attendance Rate Chart...');
                // Fetch attendance data from reservations
                const response = await fetch('/api/reservations/all');
                console.log('ðŸ“¡ API Response status:', response.status);
                
                const result = await response.json();
                console.log('ðŸ“Š Attendance Data:', result);
                
                if (result.success) {
                    const reservations = result.data;
                    
                    // Count attendance statuses
                    let attended = 0;
                    let noShow = 0;
                    let cancelled = 0;
                    let pending = 0;
                    
                    reservations.forEach(reservation => {
                        const status = reservation.attendance_status || 'pending';
                        switch(status) {
                            case 'attended':
                                attended++;
                                break;
                            case 'no_show':
                                noShow++;
                                break;
                            case 'cancelled':
                                cancelled++;
                                break;
                            case 'pending':
                            default:
                                pending++;
                                break;
                        }
                    });
                    
                    const ctx = document.getElementById('reportsAttendanceRateChart');
                    
                    if (!ctx) {
                        console.error('âŒ Chart canvas not found: reportsAttendanceRateChart');
                        return;
                    }
                    
                    if (ctx) {
                        if (attendanceRateChartInstance) {
                            attendanceRateChartInstance.destroy();
                        }
                        
                        attendanceRateChartInstance = new Chart(ctx, {
                            type: 'doughnut',
                            data: {
                                labels: ['Attended', 'No-Show', 'Pending', 'Cancelled'],
                                datasets: [{
                                    data: [attended, noShow, pending, cancelled],
                                    backgroundColor: [
                                        '#10b981', // Attended - Green
                                        '#ef4444', // No-Show - Red
                                        '#f59e0b', // Pending - Orange
                                        '#6b7280'  // Cancelled - Gray
                                    ],
                                    borderWidth: 2,
                                    borderColor: '#ffffff'
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'bottom',
                                        labels: {
                                            padding: 15,
                                            font: {
                                                size: 12
                                            }
                                        }
                                    },
                                    tooltip: {
                                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                        padding: 12,
                                        callbacks: {
                                            label: function(context) {
                                                const label = context.label || '';
                                                const value = context.parsed || 0;
                                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                                const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                                return `${label}: ${value} (${percentage}%)`;
                                            }
                                        }
                                    }
                                }
                            }
                        });
                        
                        console.log('âœ… Attendance rate chart loaded');
                    }
                }
            } catch (error) {
                console.error('Error loading attendance rate chart:', error);
            }
        }
        
        // Print Individual Chart Function
        function printChart(chartId, chartTitle) {
            // Get the chart canvas
            const canvas = document.getElementById(chartId);
            if (!canvas) {
                console.error('Chart not found:', chartId);
                return;
            }
            
            // Get chart image as base64
            const chartImage = canvas.toDataURL('image/png');
            
            // Get current date
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            const timeStr = now.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Get chart-specific summary data
            let summaryHTML = '';
            
            if (chartId === 'monthlyReservationsChart') {
                // Monthly Reservations Summary
                const chartInstance = monthlyReservationsChartInstance;
                if (chartInstance) {
                    const data = chartInstance.data.datasets[0].data;
                    const total = data.reduce((a, b) => a + b, 0);
                    const average = (total / data.length).toFixed(1);
                    const highest = Math.max(...data);
                    summaryHTML = `
                        <div class="summary-item">
                            <div class="summary-value">${total}</div>
                            <div class="summary-label">Total Approved</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">${average}</div>
                            <div class="summary-label">Monthly Average</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">${highest}</div>
                            <div class="summary-label">Highest Month</div>
                        </div>
                    `;
                }
            } else if (chartId === 'serviceDistributionChart') {
                // Service Distribution Summary
                const chartInstance = serviceDistributionChartInstance;
                if (chartInstance) {
                    const data = chartInstance.data.datasets[0].data;
                    const labels = chartInstance.data.labels;
                    const total = data.reduce((a, b) => a + b, 0);
                    const maxIndex = data.indexOf(Math.max(...data));
                    const mostPopular = labels[maxIndex];
                    summaryHTML = `
                        <div class="summary-item">
                            <div class="summary-value">${total}</div>
                            <div class="summary-label">Total Services</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">${mostPopular}</div>
                            <div class="summary-label">Most Popular</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">${data[maxIndex]}</div>
                            <div class="summary-label">Top Count</div>
                        </div>
                    `;
                }
            } else if (chartId === 'revenueTrendsChart') {
                // Stipendium Trends Summary
                const chartInstance = revenueTrendsChartInstance;
                if (chartInstance) {
                    const data = chartInstance.data.datasets[0].data;
                    const total = data.reduce((a, b) => a + b, 0);
                    const average = (total / data.length).toFixed(0);
                    const highest = Math.max(...data);
                    summaryHTML = `
                        <div class="summary-item">
                            <div class="summary-value">â‚±${total.toLocaleString()}</div>
                            <div class="summary-label">Total Stipendium</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">â‚±${parseInt(average).toLocaleString()}</div>
                            <div class="summary-label">Monthly Average</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">â‚±${highest.toLocaleString()}</div>
                            <div class="summary-label">Highest Month</div>
                        </div>
                    `;
                }
            } else if (chartId === 'attendanceRateChart') {
                // Attendance Rate Summary
                const chartInstance = attendanceRateChartInstance;
                if (chartInstance) {
                    const data = chartInstance.data.datasets[0].data;
                    const labels = chartInstance.data.labels;
                    const total = data.reduce((a, b) => a + b, 0);
                    const attendedIndex = labels.indexOf('Attended');
                    const attended = data[attendedIndex] || 0;
                    const rate = total > 0 ? ((attended / total) * 100).toFixed(1) : 0;
                    summaryHTML = `
                        <div class="summary-item">
                            <div class="summary-value">${total}</div>
                            <div class="summary-label">Total Records</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">${attended}</div>
                            <div class="summary-label">Attended</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">${rate}%</div>
                            <div class="summary-label">Attendance Rate</div>
                        </div>
                    `;
                }
            }
            
            // Create hidden iframe for printing
            const iframe = document.createElement('iframe');
            iframe.style.position = 'fixed';
            iframe.style.right = '0';
            iframe.style.bottom = '0';
            iframe.style.width = '0';
            iframe.style.height = '0';
            iframe.style.border = 'none';
            document.body.appendChild(iframe);
            
            const iframeDoc = iframe.contentWindow.document;
            
            // Write HTML content to iframe
            iframeDoc.open();
            iframeDoc.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${chartTitle} - ChurchEase Report</title>
                    <style>
                        @page {
                            size: A4 portrait;
                            margin: 15mm;
                        }
                        
                        * {
                            margin: 0;
                            padding: 0;
                            box-sizing: border-box;
                        }
                        
                        body {
                            font-family: 'Times New Roman', Times, serif;
                            background: white;
                            color: #000;
                        }
                        
                        .document {
                            max-width: 210mm;
                            margin: 0 auto;
                            padding: 0;
                        }
                        
                        /* Official Header */
                        .official-header {
                            text-align: center;
                            border-bottom: 4px double #000;
                            padding-bottom: 10px;
                            margin-bottom: 15px;
                        }
                        
                        .church-logo {
                            width: 50px;
                            height: 50px;
                            margin: 0 auto 8px;
                        }
                        
                        .church-name {
                            font-size: 18px;
                            font-weight: bold;
                            color: #000;
                            margin-bottom: 3px;
                            letter-spacing: 1px;
                        }
                        
                        .church-address {
                            font-size: 9px;
                            color: #333;
                            margin: 1px 0;
                        }
                        
                        .document-title {
                            font-size: 14px;
                            font-weight: bold;
                            color: #000;
                            margin-top: 8px;
                            text-transform: uppercase;
                            letter-spacing: 1.5px;
                            border-top: 1px solid #000;
                            border-bottom: 1px solid #000;
                            padding: 6px 0;
                        }
                        
                        /* Document Info */
                        .document-info {
                            margin: 12px 0;
                            font-size: 9px;
                            border: 1px solid #ddd;
                            padding: 8px;
                            background: #f9f9f9;
                        }
                        
                        .info-row {
                            display: flex;
                            justify-content: space-between;
                            margin: 4px 0;
                        }
                        
                        .info-label {
                            font-weight: bold;
                            color: #333;
                        }
                        
                        .info-value {
                            color: #000;
                        }
                        
                        /* Summary Section */
                        .summary-section {
                            margin: 12px 0;
                            border: 2px solid #000;
                            padding: 10px;
                        }
                        
                        .summary-title {
                            font-size: 12px;
                            font-weight: bold;
                            color: #000;
                            margin-bottom: 8px;
                            text-align: center;
                            text-transform: uppercase;
                            letter-spacing: 1px;
                            border-bottom: 1px solid #000;
                            padding-bottom: 5px;
                        }
                        
                        .summary-grid {
                            display: grid;
                            grid-template-columns: repeat(3, 1fr);
                            gap: 8px;
                            margin-top: 8px;
                        }
                        
                        .summary-item {
                            text-align: center;
                            padding: 8px;
                            border: 1px solid #ddd;
                            background: #fff;
                        }
                        
                        .summary-value {
                            font-size: 16px;
                            font-weight: bold;
                            color: #000;
                            margin-bottom: 3px;
                        }
                        
                        .summary-label {
                            font-size: 9px;
                            color: #666;
                            text-transform: uppercase;
                            letter-spacing: 0.5px;
                        }
                        
                        /* Chart Section */
                        .chart-section {
                            margin: 12px 0;
                            page-break-inside: avoid;
                        }
                        
                        .section-title {
                            font-size: 11px;
                            font-weight: bold;
                            color: #000;
                            margin-bottom: 10px;
                            text-align: center;
                            text-transform: uppercase;
                            letter-spacing: 1px;
                            border-bottom: 2px solid #000;
                            padding-bottom: 5px;
                        }
                        
                        .chart-container {
                            text-align: center;
                            border: 2px solid #000;
                            padding: 10px;
                            background: #fff;
                        }
                        
                        .chart-image {
                            max-width: 100%;
                            height: auto;
                            display: block;
                            margin: 0 auto;
                        }
                        
                        /* Signature Section */
                        .signature-section {
                            margin-top: 20px;
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            gap: 30px;
                            page-break-inside: avoid;
                        }
                        
                        .signature-box {
                            text-align: center;
                        }
                        
                        .signature-line {
                            border-top: 2px solid #000;
                            margin-top: 30px;
                            padding-top: 5px;
                            font-size: 10px;
                            font-weight: bold;
                        }
                        
                        .signature-title {
                            font-size: 8px;
                            color: #666;
                            margin-top: 2px;
                            text-transform: uppercase;
                        }
                        
                        /* Footer */
                        .document-footer {
                            margin-top: 15px;
                            padding-top: 10px;
                            border-top: 2px solid #000;
                            text-align: center;
                            font-size: 8px;
                            color: #666;
                        }
                        
                        .footer-note {
                            margin: 2px 0;
                            font-style: italic;
                        }
                    </style>
                </head>
                <body>
                    <div class="document">
                        <!-- Official Header -->
                        <div class="official-header">
                            <div class="church-logo">
                                <img src="/static/ChurchLogo.jpg" alt="Church Logo" style="width: 100%; height: 100%; object-fit: contain;">
                            </div>
                            <div class="church-name">SAINT ANDREW THE APOSTLE PARISH</div>
                            <div class="church-address">Norzagaray, Bulacan</div>
                            <div class="church-address">H. Bernabe Street, Poblacion, Norzagaray, 3013 Bulacan</div>
                            <div class="church-address">Tel: 0995 770 5637</div>
                            <div class="church-address">Office Hours: Tuesday - Sunday, 8:00 AM - 5:00 PM (Closed Mondays)</div>
                            <div class="document-title">Official Report - ${chartTitle}</div>
                        </div>
                        
                        <!-- Document Information -->
                        <div class="document-info">
                            <div class="info-row">
                                <span class="info-label">Document Type:</span>
                                <span class="info-value">Statistical Report</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Report Category:</span>
                                <span class="info-value">${chartTitle}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Generated Date:</span>
                                <span class="info-value">${dateStr}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Generated Time:</span>
                                <span class="info-value">${timeStr}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Prepared By:</span>
                                <span class="info-value">ChurchEase Management System</span>
                            </div>
                        </div>
                        
                        <!-- Summary Statistics -->
                        <div class="summary-section">
                            <div class="summary-title">Report Summary</div>
                            <div class="summary-grid">
                                ${summaryHTML}
                            </div>
                        </div>
                        
                        <!-- Chart Section -->
                        <div class="chart-section">
                            <div class="section-title">${chartTitle} - Detailed Analysis</div>
                            <div class="chart-container">
                                <img src="${chartImage}" alt="${chartTitle}" class="chart-image">
                            </div>
                        </div>
                        
                        <!-- Signature Section -->
                        <div class="signature-section">
                            <div class="signature-box">
                                <div class="signature-line">_______________________</div>
                                <div class="signature-title">Administrator</div>
                                <div class="signature-title">Prepared By</div>
                            </div>
                            <div class="signature-box">
                                <div class="signature-line">_______________________</div>
                                <div class="signature-title">Parish Priest</div>
                                <div class="signature-title">Reviewed & Approved By</div>
                            </div>
                        </div>
                        
                        <!-- Footer -->
                        <div class="document-footer">
                            <p class="footer-note">This is an official computer-generated report from Saint Andrew the Apostle Parish.</p>
                            <p class="footer-note">No signature is required for system-generated documents.</p>
                            <p style="margin-top: 8px;"><strong>Saint Andrew the Apostle Parish Â© 2024. All Rights Reserved.</strong></p>
                        </div>
                    </div>
                </body>
                </html>
            `);
            iframeDoc.close();
            
            // Wait for content to load, then print
            iframe.onload = function() {
                setTimeout(function() {
                    iframe.contentWindow.focus();
                    iframe.contentWindow.print();
                    
                    // Remove iframe after printing
                    setTimeout(function() {
                        document.body.removeChild(iframe);
                    }, 1000);
                }, 250);
            };
        }
        
        // Print Reservation Details Function
        function printReservationDetails() {
            // Get all reservation details from the modal
            const reservationId = document.getElementById('detail-id').textContent;
            const serviceType = document.getElementById('detail-service-type').textContent;
            const date = document.getElementById('detail-date').textContent;
            const time = document.getElementById('detail-time').textContent;
            const status = document.getElementById('detail-status').textContent;
            const createdDate = document.getElementById('detail-created').textContent;
            const createdBy = document.getElementById('detail-created-by').textContent;
            
            // Contact Information
            const contactName = document.getElementById('detail-contact-name').textContent;
            const contactPhone = document.getElementById('detail-contact-phone').textContent;
            const contactEmail = document.getElementById('detail-contact-email').textContent;
            const contactAddress = document.getElementById('detail-contact-address').textContent;
            
            // Additional Information
            const priestName = document.getElementById('detail-priest-name').textContent;
            const specialRequests = document.getElementById('detail-special-requests').textContent;
            const notes = document.getElementById('detail-notes').textContent;
            
            // Stipendium Information
            const paymentStatus = document.getElementById('detail-payment-status').textContent;
            const paymentType = document.getElementById('detail-payment-type').textContent;
            const basePrice = document.getElementById('detail-base-price').textContent;
            const amountDue = document.getElementById('detail-amount-due').textContent;
            const amountPaid = document.getElementById('detail-amount-paid').textContent;
            const balance = document.getElementById('detail-balance').textContent;
            const paymentMethod = document.getElementById('detail-payment-method').textContent;
            
            // Get service-specific details
            const serviceDetailsElement = document.getElementById('service-specific-details');
            let serviceDetailsHTML = '';
            if (serviceDetailsElement) {
                const detailItems = serviceDetailsElement.querySelectorAll('.detail-item');
                detailItems.forEach(item => {
                    const label = item.querySelector('label')?.textContent || '';
                    const value = item.querySelector('span')?.textContent || '-';
                    if (label && value !== '-') {
                        serviceDetailsHTML += `
                            <div class="info-row">
                                <span class="info-label">${label}</span>
                                <span class="info-value">${value}</span>
                            </div>
                        `;
                    }
                });
            }
            
            // Get current date and time
            const now = new Date();
            const printDate = now.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            const printTime = now.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Create hidden iframe for printing
            const iframe = document.createElement('iframe');
            iframe.style.position = 'fixed';
            iframe.style.right = '0';
            iframe.style.bottom = '0';
            iframe.style.width = '0';
            iframe.style.height = '0';
            iframe.style.border = 'none';
            document.body.appendChild(iframe);
            
            const iframeDoc = iframe.contentWindow.document;
            
            // Write HTML content to iframe
            iframeDoc.open();
            iframeDoc.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Reservation Details - ${reservationId}</title>
                    <style>
                        @page {
                            size: A4 portrait;
                            margin: 15mm;
                        }
                        
                        * {
                            margin: 0;
                            padding: 0;
                            box-sizing: border-box;
                        }
                        
                        body {
                            font-family: 'Times New Roman', Times, serif;
                            background: white;
                            color: #000;
                        }
                        
                        .document {
                            max-width: 210mm;
                            margin: 0 auto;
                            padding: 0;
                        }
                        
                        /* Official Header */
                        .official-header {
                            text-align: center;
                            border-bottom: 4px double #000;
                            padding-bottom: 10px;
                            margin-bottom: 15px;
                        }
                        
                        .church-logo {
                            width: 50px;
                            height: 50px;
                            margin: 0 auto 8px;
                        }
                        
                        .church-name {
                            font-size: 18px;
                            font-weight: bold;
                            color: #000;
                            margin-bottom: 3px;
                            letter-spacing: 1px;
                        }
                        
                        .church-address {
                            font-size: 9px;
                            color: #333;
                            margin: 1px 0;
                        }
                        
                        .document-title {
                            font-size: 14px;
                            font-weight: bold;
                            color: #000;
                            margin-top: 8px;
                            text-transform: uppercase;
                            letter-spacing: 1.5px;
                            border-top: 1px solid #000;
                            border-bottom: 1px solid #000;
                            padding: 6px 0;
                        }
                        
                        /* Document Info */
                        .document-info {
                            margin: 12px 0;
                            font-size: 9px;
                            border: 1px solid #ddd;
                            padding: 8px;
                            background: #f9f9f9;
                        }
                        
                        .info-row {
                            display: flex;
                            justify-content: space-between;
                            margin: 4px 0;
                            padding: 2px 0;
                        }
                        
                        .info-label {
                            font-weight: bold;
                            color: #333;
                            flex: 0 0 40%;
                        }
                        
                        .info-value {
                            color: #000;
                            flex: 1;
                            text-align: right;
                        }
                        
                        /* Section Styles */
                        .details-section {
                            margin: 12px 0;
                            border: 2px solid #000;
                            padding: 10px;
                            page-break-inside: avoid;
                        }
                        
                        .section-title {
                            font-size: 12px;
                            font-weight: bold;
                            color: #000;
                            margin-bottom: 8px;
                            text-align: center;
                            text-transform: uppercase;
                            letter-spacing: 1px;
                            border-bottom: 1px solid #000;
                            padding-bottom: 5px;
                        }
                        
                        .details-grid {
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            gap: 8px;
                            margin-top: 8px;
                        }
                        
                        .detail-item {
                            padding: 6px;
                            border: 1px solid #ddd;
                            background: #fff;
                        }
                        
                        .detail-item.full-width {
                            grid-column: 1 / -1;
                        }
                        
                        .detail-label {
                            font-size: 9px;
                            font-weight: bold;
                            color: #666;
                            display: block;
                            margin-bottom: 3px;
                        }
                        
                        .detail-value {
                            font-size: 11px;
                            color: #000;
                            font-weight: 600;
                        }
                        
                        /* Signature Section */
                        .signature-section {
                            margin-top: 20px;
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            gap: 30px;
                            page-break-inside: avoid;
                        }
                        
                        .signature-box {
                            text-align: center;
                        }
                        
                        .signature-line {
                            border-top: 2px solid #000;
                            margin-top: 30px;
                            padding-top: 5px;
                            font-size: 10px;
                            font-weight: bold;
                        }
                        
                        .signature-title {
                            font-size: 8px;
                            color: #666;
                            margin-top: 2px;
                            text-transform: uppercase;
                        }
                        
                        /* Footer */
                        .document-footer {
                            margin-top: 15px;
                            padding-top: 10px;
                            border-top: 2px solid #000;
                            text-align: center;
                            font-size: 8px;
                            color: #666;
                        }
                        
                        .footer-note {
                            margin: 2px 0;
                            font-style: italic;
                        }
                    </style>
                </head>
                <body>
                    <div class="document">
                        <!-- Official Header -->
                        <div class="official-header">
                            <div class="church-logo">
                                <img src="/static/ChurchLogo.jpg" alt="Church Logo" style="width: 100%; height: 100%; object-fit: contain;">
                            </div>
                            <div class="church-name">SAINT ANDREW THE APOSTLE PARISH</div>
                            <div class="church-address">Norzagaray, Bulacan</div>
                            <div class="church-address">H. Bernabe Street, Poblacion, Norzagaray, 3013 Bulacan</div>
                            <div class="church-address">Tel: 0995 770 5637</div>
                            <div class="church-address">Office Hours: Tuesday - Sunday, 8:00 AM - 5:00 PM (Closed Mondays)</div>
                            <div class="document-title">Official Reservation Document</div>
                        </div>
                        
                        <!-- Document Information -->
                        <div class="document-info">
                            <div class="info-row">
                                <span class="info-label">Document Type:</span>
                                <span class="info-value">Reservation Confirmation</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Reservation ID:</span>
                                <span class="info-value">${reservationId}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Service Type:</span>
                                <span class="info-value">${serviceType}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Printed Date:</span>
                                <span class="info-value">${printDate}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Printed Time:</span>
                                <span class="info-value">${printTime}</span>
                            </div>
                        </div>
                        
                        <!-- Reservation Summary -->
                        <div class="details-section">
                            <div class="section-title">Reservation Summary</div>
                            <div class="details-grid">
                                <div class="detail-item">
                                    <span class="detail-label">Service Type:</span>
                                    <span class="detail-value">${serviceType}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Date:</span>
                                    <span class="detail-value">${date}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Time:</span>
                                    <span class="detail-value">${time}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Status:</span>
                                    <span class="detail-value">${status}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Created Date:</span>
                                    <span class="detail-value">${createdDate}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Created By:</span>
                                    <span class="detail-value">${createdBy}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Contact Information -->
                        <div class="details-section">
                            <div class="section-title">Contact Information</div>
                            <div class="details-grid">
                                <div class="detail-item">
                                    <span class="detail-label">Full Name:</span>
                                    <span class="detail-value">${contactName}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Phone Number:</span>
                                    <span class="detail-value">${contactPhone}</span>
                                </div>
                                <div class="detail-item full-width">
                                    <span class="detail-label">Email Address:</span>
                                    <span class="detail-value">${contactEmail}</span>
                                </div>
                                <div class="detail-item full-width">
                                    <span class="detail-label">Address:</span>
                                    <span class="detail-value">${contactAddress}</span>
                                </div>
                            </div>
                        </div>
                        
                        ${serviceDetailsHTML ? `
                        <!-- Service-Specific Details -->
                        <div class="details-section">
                            <div class="section-title">Service Details</div>
                            <div class="document-info">
                                ${serviceDetailsHTML}
                            </div>
                        </div>
                        ` : ''}
                        
                        <!-- Additional Information -->
                        <div class="details-section">
                            <div class="section-title">Additional Information</div>
                            <div class="details-grid">
                                <div class="detail-item full-width">
                                    <span class="detail-label">Assigned Priest:</span>
                                    <span class="detail-value">${priestName}</span>
                                </div>
                                ${specialRequests !== '-' && specialRequests !== 'None' ? `
                                <div class="detail-item full-width">
                                    <span class="detail-label">Special Requests:</span>
                                    <span class="detail-value">${specialRequests}</span>
                                </div>
                                ` : ''}
                                ${notes !== '-' && notes !== 'None' ? `
                                <div class="detail-item full-width">
                                    <span class="detail-label">Notes:</span>
                                    <span class="detail-value">${notes}</span>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <!-- Stipendium Information -->
                        <div class="details-section">
                            <div class="section-title">Stipendium Information</div>
                            <div class="details-grid">
                                <div class="detail-item">
                                    <span class="detail-label">Payment Status:</span>
                                    <span class="detail-value">${paymentStatus}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Payment Type:</span>
                                    <span class="detail-value">${paymentType}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Base Price:</span>
                                    <span class="detail-value">${basePrice}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Amount Due:</span>
                                    <span class="detail-value">${amountDue}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Amount Paid:</span>
                                    <span class="detail-value">${amountPaid}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Balance:</span>
                                    <span class="detail-value">${balance}</span>
                                </div>
                                <div class="detail-item full-width">
                                    <span class="detail-label">Payment Method:</span>
                                    <span class="detail-value">${paymentMethod}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Signature Section -->
                        <div class="signature-section">
                            <div class="signature-box">
                                <div class="signature-line">_______________________</div>
                                <div class="signature-title">Client Signature</div>
                                <div class="signature-title">Over Printed Name</div>
                            </div>
                            <div class="signature-box">
                                <div class="signature-line">_______________________</div>
                                <div class="signature-title">Parish Secretary</div>
                                <div class="signature-title">Verified By</div>
                            </div>
                        </div>
                        
                        <!-- Footer -->
                        <div class="document-footer">
                            <p class="footer-note">This is an official computer-generated document from Saint Andrew the Apostle Parish.</p>
                            <p class="footer-note">Please present this document on the scheduled date and time.</p>
                            <p style="margin-top: 8px;"><strong>Saint Andrew the Apostle Parish Â© 2024. All Rights Reserved.</strong></p>
                        </div>
                    </div>
                </body>
                </html>
            `);
            iframeDoc.close();
            
            // Wait for content to load, then print
            iframe.onload = function() {
                setTimeout(function() {
                    iframe.contentWindow.focus();
                    iframe.contentWindow.print();
                    
                    // Remove iframe after printing
                    setTimeout(function() {
                        document.body.removeChild(iframe);
                    }, 1000);
                }, 250);
            };
        }
        
        // Load Popular Services Table
        async function loadPopularServicesTable() {
            try {
                const response = await fetch('/api/reports/service-distribution');
                const result = await response.json();
                
                if (result.success) {
                    const data = result.data;
                    const tableBody = document.querySelector('#financialReportsModule .data-table tbody');
                    
                    if (tableBody) {
                        tableBody.innerHTML = '';
                        
                        // Combine service data with revenue
                        const services = data.labels.map((label, index) => ({
                            name: label,
                            count: data.counts[index],
                            revenue: data.revenue ? data.revenue[index] : 0
                        }));
                        
                        // Sort by count descending
                        services.sort((a, b) => b.count - a.count);
                        
                        services.forEach(service => {
                            const row = document.createElement('tr');
                            const serviceClass = service.name.toLowerCase();
                            row.innerHTML = `
                                <td><span class="service-badge ${serviceClass}">${service.name}</span></td>
                                <td>${service.count}</td>
                                <td>â‚±${service.revenue.toLocaleString()}</td>
                            `;
                            tableBody.appendChild(row);
                        });
                        
                        console.log('âœ… Popular services table loaded');
                    }
                }
            } catch (error) {
                console.error('Error loading popular services table:', error);
            }
        }

        // System Activity Module Functions
        async function initializeSystemActivity() {
            console.log('Initializing System Activity module...');
            await loadSystemActivity();
        }

        async function loadSystemActivity() {
            try {
                const response = await fetch('/api/admin/recent-activity');
                const result = await response.json();
                
                if (result.success) {
                    const activities = result.data;
                    const activityList = document.getElementById('activityList');
                    
                    if (activityList) {
                        activityList.innerHTML = '';
                        
                        activities.forEach(activity => {
                            const activityItem = document.createElement('div');
                            activityItem.className = 'activity-item';
                            activityItem.innerHTML = `
                                <div class="activity-icon">
                                    <i class="fas fa-calendar-check"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">${activity.action}</div>
                                    <div class="activity-meta">
                                        <span class="activity-user">${activity.user}</span>
                                        <span class="activity-time">${new Date(activity.timestamp).toLocaleString()}</span>
                                    </div>
                                </div>
                                <div class="activity-status">
                                    <span class="status-badge status-${activity.status}">${activity.status}</span>
                                </div>
                            `;
                            activityList.appendChild(activityItem);
                        });
                    }
                }
            } catch (error) {
                console.error('Error loading system activity:', error);
            }
        }

        // Settings Module Functions
        function initializeSettings() {
            console.log('Initializing Settings module...');
            // Settings initialization can be added here
        }

        // Service-Specific Details Population Function
        function populateAdminServiceDetails(reservation) {
            const container = document.getElementById('service-specific-details');
            if (!container) return;
            
            const serviceType = reservation.service_type;
            const serviceDetails = reservation.service_details || {};
            
            let detailsHTML = '';
            
            switch (serviceType) {
                case 'wedding':
                    detailsHTML = `
                        <div class="details-grid">
                            <div class="detail-item">
                                <label>Bride's Name:</label>
                                <span>${serviceDetails.bride_name || 'N/A'}</span>
                            </div>
                            <div class="detail-item">
                                <label>Groom's Name:</label>
                                <span>${serviceDetails.groom_name || 'N/A'}</span>
                            </div>
                            <div class="detail-item">
                                <label>Number of Guests:</label>
                                <span>${serviceDetails.number_of_guests || 'N/A'}</span>
                            </div>
                            <div class="detail-item">
                                <label>Wedding Theme:</label>
                                <span>${serviceDetails.wedding_theme || 'N/A'}</span>
                            </div>
                        </div>
                    `;
                    break;
                case 'baptism':
                    detailsHTML = `
                        <div class="details-grid">
                            <div class="detail-item">
                                <label>Child's Name:</label>
                                <span>${serviceDetails.child_name || 'N/A'}</span>
                            </div>
                            <div class="detail-item">
                                <label>Birth Date:</label>
                                <span>${serviceDetails.birth_date || 'N/A'}</span>
                            </div>
                            <div class="detail-item">
                                <label>Father's Name:</label>
                                <span>${serviceDetails.father_name || 'N/A'}</span>
                            </div>
                            <div class="detail-item">
                                <label>Mother's Name:</label>
                                <span>${serviceDetails.mother_name || 'N/A'}</span>
                            </div>
                        </div>
                    `;
                    break;
                case 'funeral':
                    detailsHTML = `
                        <div class="details-grid">
                            <div class="detail-item">
                                <label>Deceased Name:</label>
                                <span>${serviceDetails.deceased_name || 'N/A'}</span>
                            </div>
                            <div class="detail-item">
                                <label>Date of Death:</label>
                                <span>${serviceDetails.date_of_death || 'N/A'}</span>
                            </div>
                            <div class="detail-item">
                                <label>Funeral Home Contact:</label>
                                <span>${serviceDetails.funeral_home_contact || 'N/A'}</span>
                            </div>
                        </div>
                    `;
                    break;
                case 'confirmation':
                    detailsHTML = `
                        <div class="details-grid">
                            <div class="detail-item">
                                <label>Confirmand's Name:</label>
                                <span>${serviceDetails.confirmand_name || 'N/A'}</span>
                            </div>
                            <div class="detail-item">
                                <label>Confirmation Name:</label>
                                <span>${serviceDetails.confirmation_name || 'N/A'}</span>
                            </div>
                            <div class="detail-item">
                                <label>Sponsor's Name:</label>
                                <span>${serviceDetails.sponsor_name || 'N/A'}</span>
                            </div>
                            <div class="detail-item">
                                <label>Number of Attendees:</label>
                                <span>${serviceDetails.attendees || 'N/A'}</span>
                            </div>
                        </div>
                    `;
                    break;
                default:
                    detailsHTML = `
                        <div class="details-grid">
                            <div class="detail-item full-width">
                                <label>Service Details:</label>
                                <span>No specific details available for this service type.</span>
                            </div>
                        </div>
                    `;
            }
            
            container.innerHTML = detailsHTML;
        }

        // View Reservation Modal Functions - COMPLETE VERSION matching Secretary Dashboard
        async function viewReservationDetails(reservationId) {
            try {
                console.log('Viewing reservation:', reservationId);
                
                // Fetch reservation details from API
                const response = await fetch(`/api/reservations/${reservationId}`);
                const result = await response.json();
                
                if (result.success && result.data) {
                    const reservation = result.data;
                    console.log('Full reservation data:', reservation);
                    console.log('Priest ID:', reservation.priest_id);
                    console.log('Priest Name:', reservation.priest_name);
                    
                    // Helper function to safely set content
                    const safeSet = (id, value) => {
                        const el = document.getElementById(id);
                        if (el) el.textContent = value || 'N/A';
                    };
                    
                    // Reservation Summary
                    safeSet('detail-id', reservation.reservation_id || reservationId);
                    safeSet('detail-service-type', (reservation.service_type || 'N/A').toUpperCase());
                    safeSet('detail-date', reservation.date ? new Date(reservation.date).toLocaleDateString() : 'N/A');
                    safeSet('detail-time', reservation.time_slot || reservation.time || 'N/A');
                    safeSet('detail-status', (reservation.status || 'pending').toUpperCase());
                    safeSet('detail-created', reservation.created_at ? new Date(reservation.created_at).toLocaleString() : 'N/A');
                    safeSet('detail-created-by', reservation.created_by_secretary || 'System');
                    
                    // Contact Information
                    safeSet('detail-contact-name', reservation.contact_name || 'N/A');
                    safeSet('detail-contact-phone', reservation.contact_phone || 'N/A');
                    safeSet('detail-contact-email', reservation.contact_email || 'N/A');
                    safeSet('detail-contact-address', reservation.contact_address || 'N/A');
                    
                    // Service-Specific Details
                    populateAdminServiceDetails(reservation);
                    
                    // Additional Information
                    const priestName = reservation.priest_name || 'Not Assigned';
                    console.log('Setting priest name to:', priestName);
                    safeSet('detail-priest-name', priestName);
                    
                    // Hide Special Requests and Notes if empty
                    const specialReqEl = document.getElementById('detail-special-requests');
                    if (specialReqEl && specialReqEl.parentElement) {
                        if (!reservation.special_requests || reservation.special_requests.trim() === '') {
                            specialReqEl.parentElement.style.display = 'none';
                        } else {
                            specialReqEl.parentElement.style.display = '';
                            specialReqEl.textContent = reservation.special_requests;
                        }
                    }
                    
                    const notesEl = document.getElementById('detail-notes');
                    if (notesEl && notesEl.parentElement) {
                        if (!reservation.notes || reservation.notes.trim() === '') {
                            notesEl.parentElement.style.display = 'none';
                        } else {
                            notesEl.parentElement.style.display = '';
                            notesEl.textContent = reservation.notes;
                        }
                    }
                    
                    // Fetch Payment/Stipendium Information
                    try {
                        const paymentKey = reservation.reservation_id || reservation.id;
                        const paymentResponse = await fetch(`/api/payments/${paymentKey}`);
                        
                        if (paymentResponse.ok) {
                            const paymentResult = await paymentResponse.json();
                            if (paymentResult.success && paymentResult.data) {
                                const payment = paymentResult.data;
                                safeSet('detail-payment-status', payment.payment_status || 'Pending');
                                safeSet('detail-payment-type', payment.payment_type || 'N/A');
                                safeSet('detail-base-price', payment.base_price ? `â‚±${payment.base_price.toLocaleString()}` : 'N/A');
                                safeSet('detail-amount-due', payment.amount_due ? `â‚±${payment.amount_due.toLocaleString()}` : 'N/A');
                                safeSet('detail-amount-paid', payment.amount_paid ? `â‚±${payment.amount_paid.toLocaleString()}` : 'â‚±0.00');
                                safeSet('detail-balance', payment.balance ? `â‚±${payment.balance.toLocaleString()}` : 'â‚±0.00');
                                safeSet('detail-payment-method', payment.payment_method || 'N/A');
                            }
                        } else {
                            // Fallback to reservation data
                            safeSet('detail-payment-status', reservation.payment_status || 'Pending');
                            safeSet('detail-payment-type', reservation.payment_type || 'N/A');
                            safeSet('detail-amount-paid', reservation.amount_paid ? `â‚±${reservation.amount_paid}` : 'â‚±0');
                            safeSet('detail-amount-due', reservation.total_amount ? `â‚±${reservation.total_amount}` : 'N/A');
                            safeSet('detail-payment-method', reservation.payment_method || 'N/A');
                        }
                    } catch (paymentError) {
                        console.error('Error fetching payment info:', paymentError);
                        // Use fallback data from reservation
                        safeSet('detail-payment-status', reservation.payment_status || 'Pending');
                        safeSet('detail-payment-type', reservation.payment_type || 'N/A');
                        safeSet('detail-amount-paid', reservation.amount_paid ? `â‚±${reservation.amount_paid}` : 'â‚±0');
                        safeSet('detail-amount-due', reservation.total_amount ? `â‚±${reservation.total_amount}` : 'N/A');
                    }
                    
                    // Show modal
                    document.getElementById('viewReservationModal').style.display = 'block';
                } else {
                    alert('Failed to load reservation details');
                }
            } catch (error) {
                console.error('Error viewing reservation:', error);
                alert('Error loading reservation details');
            }
        }

        function closeViewReservationModal() {
            document.getElementById('viewReservationModal').style.display = 'none';
        }
        
        // Close modal button handlers
        document.getElementById('closeViewModal')?.addEventListener('click', closeViewReservationModal);
        document.getElementById('viewModalClose')?.addEventListener('click', closeViewReservationModal);
        
        // ===== EVENTS MODULE FUNCTIONS =====
        let allEvents = [];
        let filteredEvents = [];
        
        async function initializeEventsModule() {
            console.log('Initializing Events module...');
            await loadEventsData();
            setupEventFilters();
            setupEventSearch();
        }
        
        async function loadEventsData() {
            try {
                const response = await fetch('/api/events/all');
                const result = await response.json();
                
                if (result.success) {
                    allEvents = result.data || [];
                    filteredEvents = allEvents;
                    displayEvents(allEvents);
                } else {
                    console.error('Failed to load events:', result.error);
                    showEventsError('Failed to load events');
                }
            } catch (error) {
                console.error('Error loading events:', error);
                showEventsError('Error loading events from server');
            }
        }
        
        function displayEvents(events) {
            const tableBody = document.getElementById('eventsTableBody');
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            if (events.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #6b7280;">
                            <i class="fas fa-calendar-times" style="font-size: 32px; margin-bottom: 12px;"></i>
                            <p style="margin-top: 12px; font-size: 16px;">No events found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            events.forEach((event, index) => {
                const row = document.createElement('tr');
                const eventDate = new Date(event.event_date);
                const createdDate = new Date(event.created_at);
                const isUpcoming = eventDate >= new Date();
                
                row.innerHTML = `
                    <td>#${String(index + 1).padStart(3, '0')}</td>
                    <td style="font-weight: 600;">${event.event_title || 'Untitled Event'}</td>
                    <td>
                        <span style="display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; background: ${isUpcoming ? '#dbeafe' : '#f3f4f6'}; color: ${isUpcoming ? '#1e40af' : '#6b7280'}; border-radius: 6px; font-weight: 600; font-size: 13px;">
                            <i class="fas fa-calendar"></i>
                            ${eventDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
                        </span>
                    </td>
                    <td>${event.created_by_secretary || event.secretary_name || 'N/A'}</td>
                    <td style="color: #6b7280; font-size: 13px;">${createdDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</td>
                    <td class="table-actions">
                        <button class="action-btn" onclick="viewEventDetails('${event.id}')" title="View Details">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            console.log(`âœ… Displayed ${events.length} events`);
        }
        
        function showEventsError(message) {
            const tableBody = document.getElementById('eventsTableBody');
            if (!tableBody) return;
            
            tableBody.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align: center; padding: 40px; color: #ef4444;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 32px; margin-bottom: 12px;"></i>
                        <p style="margin-top: 12px; font-size: 16px;">${message}</p>
                    </td>
                </tr>
            `;
        }
        
        function setupEventFilters() {
            document.querySelectorAll('.event-filter-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Update active state
                    document.querySelectorAll('.event-filter-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    const filter = this.getAttribute('data-filter');
                    filterEvents(filter);
                });
            });
        }
        
        function filterEvents(filter) {
            const now = new Date();
            
            switch(filter) {
                case 'upcoming':
                    filteredEvents = allEvents.filter(event => new Date(event.event_date) >= now);
                    break;
                case 'past':
                    filteredEvents = allEvents.filter(event => new Date(event.event_date) < now);
                    break;
                case 'all':
                default:
                    filteredEvents = allEvents;
                    break;
            }
            
            displayEvents(filteredEvents);
        }
        
        function setupEventSearch() {
            const searchInput = document.getElementById('eventSearchInput');
            const clearBtn = document.getElementById('clearEventSearch');
            
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const query = this.value.toLowerCase().trim();
                    
                    if (query) {
                        clearBtn.style.display = 'block';
                        const searchResults = filteredEvents.filter(event => 
                            (event.event_title && event.event_title.toLowerCase().includes(query)) ||
                            (event.event_description && event.event_description.toLowerCase().includes(query)) ||
                            (event.secretary_name && event.secretary_name.toLowerCase().includes(query))
                        );
                        displayEvents(searchResults);
                    } else {
                        clearBtn.style.display = 'none';
                        displayEvents(filteredEvents);
                    }
                });
            }
            
            if (clearBtn) {
                clearBtn.addEventListener('click', function() {
                    searchInput.value = '';
                    this.style.display = 'none';
                    displayEvents(filteredEvents);
                });
            }
        }
        
        // Refresh button
        document.getElementById('refreshEventsBtn')?.addEventListener('click', async function() {
            this.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> Refreshing...';
            await loadEventsData();
            this.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh Events';
        });
        
        function viewEventDetails(eventId) {
            const event = allEvents.find(e => e.id === eventId);
            if (!event) return;
            
            console.log('Event details:', event); // Debug log
            
            // Show modal
            const modal = document.getElementById('adminCalendarEventModal');
            if (!modal) return;
            
            // Set modal title
            document.getElementById('adminModalTitle').textContent = 'Event Details';
            
            // Format date and time
            const eventDate = new Date(event.event_date);
            const dateStr = eventDate.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            // Format time
            let timeStr = 'Not specified';
            if (event.start_time) {
                timeStr = event.start_time;
                if (event.end_time) {
                    timeStr += ` - ${event.end_time}`;
                }
            }
            
            // Set date and time
            document.getElementById('admin-calendar-detail-date').textContent = dateStr;
            document.getElementById('admin-calendar-detail-time').textContent = timeStr;
            
            // Create event type badge
            const eventTypes = {
                'worship': { label: 'Worship Service', color: '#8b5cf6', icon: 'church' },
                'prayer': { label: 'Prayer Meeting', color: '#ec4899', icon: 'praying-hands' },
                'bible_study': { label: 'Bible Study', color: '#3b82f6', icon: 'book-bible' },
                'youth': { label: 'Youth Activity', color: '#10b981', icon: 'users' },
                'outreach': { label: 'Outreach Program', color: '#f59e0b', icon: 'hands-helping' },
                'fellowship': { label: 'Fellowship', color: '#06b6d4', icon: 'handshake' },
                'special': { label: 'Special Event', color: '#ef4444', icon: 'star' },
                'meeting': { label: 'Meeting', color: '#6366f1', icon: 'users-cog' },
                'other': { label: 'Other', color: '#64748b', icon: 'calendar' }
            };
            
            // Get event type - check both 'type' and 'event_type' fields
            const typeValue = event.type || event.event_type || 'other';
            console.log('Event type value:', typeValue); // Debug log
            const eventType = eventTypes[typeValue] || eventTypes['other'];
            document.getElementById('admin-calendar-detail-badge').innerHTML = `
                <span style="display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; background: ${eventType.color}; color: white; border-radius: 12px; font-weight: 600; font-size: 14px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <i class="fas fa-${eventType.icon}"></i>
                    ${eventType.label}
                </span>
            `;
            
            // Set content
            document.getElementById('admin-calendar-info-title').innerHTML = '<i class="fas fa-calendar-check" style="color: #002b5c;"></i> Event Information';
            
            const content = document.getElementById('admin-calendar-detail-content');
            content.innerHTML = `
                <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: white; border-radius: 10px; border: 1px solid rgba(148, 163, 184, 0.15);">
                    <i class="fas fa-heading" style="color: #002b5c; font-size: 16px; margin-top: 2px;"></i>
                    <div style="flex: 1;">
                        <div style="color: #64748b; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">Event Title</div>
                        <div style="color: #1e293b; font-size: 15px; font-weight: 600;">${event.event_title || 'Untitled Event'}</div>
                    </div>
                </div>
                
                <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: white; border-radius: 10px; border: 1px solid rgba(148, 163, 184, 0.15);">
                    <i class="fas fa-align-left" style="color: #002b5c; font-size: 16px; margin-top: 2px;"></i>
                    <div style="flex: 1;">
                        <div style="color: #64748b; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">Description</div>
                        <div style="color: #1e293b; font-size: 14px; line-height: 1.6;">${event.event_description || 'No description provided'}</div>
                    </div>
                </div>
                
                ${event.location ? `
                <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: white; border-radius: 10px; border: 1px solid rgba(148, 163, 184, 0.15);">
                    <i class="fas fa-map-marker-alt" style="color: #002b5c; font-size: 16px; margin-top: 2px;"></i>
                    <div style="flex: 1;">
                        <div style="color: #64748b; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">Location</div>
                        <div style="color: #1e293b; font-size: 14px;">${event.location}</div>
                    </div>
                </div>
                ` : ''}
                
                ${event.organizer ? `
                <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: white; border-radius: 10px; border: 1px solid rgba(148, 163, 184, 0.15);">
                    <i class="fas fa-user-tie" style="color: #002b5c; font-size: 16px; margin-top: 2px;"></i>
                    <div style="flex: 1;">
                        <div style="color: #64748b; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">Organizer</div>
                        <div style="color: #1e293b; font-size: 14px;">${event.organizer}</div>
                    </div>
                </div>
                ` : ''}
                
                <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: white; border-radius: 10px; border: 1px solid rgba(148, 163, 184, 0.15);">
                    <i class="fas fa-user-shield" style="color: #002b5c; font-size: 16px; margin-top: 2px;"></i>
                    <div style="flex: 1;">
                        <div style="color: #64748b; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">Created By</div>
                        <div style="color: #1e293b; font-size: 14px;">${event.created_by_secretary || event.secretary_name || 'N/A'}</div>
                    </div>
                </div>
            `;
            
            // Show modal
            modal.style.display = 'flex';
        }
    </script>

    <!-- Admin Calendar Event Details Modal -->
    <div id="adminCalendarEventModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); z-index: 9999; justify-content: center; align-items: center;">
        <div class="modal-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></div>
        <div class="modal-container" style="position: relative; background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 20px; max-width: 480px; width: 90%; box-shadow: 0 25px 50px rgba(0,0,0,0.15), 0 0 0 1px rgba(255,255,255,0.8);">
            
            <!-- Header -->
            <div class="modal-header" style="background: linear-gradient(135deg, #002b5c 0%, #0d1b2a 100%); padding: 28px 28px 24px 28px; text-align: center; border-radius: 20px 20px 0 0; position: relative; overflow: hidden;">
                <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.1); opacity: 0.3;"></div>
                <h3 style="margin: 0 0 8px 0; color: white !important; font-size: 24px; font-weight: 700; text-shadow: 0 2px 4px rgba(0,0,0,0.2); position: relative; z-index: 1;">
                    <i class="fas fa-calendar-check" style="margin-right: 8px; opacity: 0.9; color: white !important;"></i>
                    <span id="adminModalTitle" style="color: white !important;">Details</span>
                </h3>
                <button type="button" class="modal-close" id="closeAdminCalendarModal" style="position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.2); border: none; font-size: 18px; cursor: pointer; color: white; padding: 8px; border-radius: 50%; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; z-index: 2;">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-body" style="padding: 28px;">
                <!-- Service/Event Badge and Date/Time -->
                <div style="text-align: center; margin-bottom: 24px;">
                    <div id="admin-calendar-detail-badge" style="margin-bottom: 12px; transform: scale(1.1);"></div>
                    <div style="color: #64748b; font-size: 15px; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <i class="fas fa-calendar-alt" style="color: #d4af37; font-size: 14px;"></i>
                        <span id="admin-calendar-detail-date"></span>
                        <span style="color: #cbd5e1;">â€¢</span>
                        <i class="fas fa-clock" style="color: #d4af37; font-size: 14px;"></i>
                        <span id="admin-calendar-detail-time"></span>
                    </div>
                </div>
                
                <!-- Information Card -->
                <div style="background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%); border-radius: 16px; padding: 20px; margin-bottom: 20px; border: 1px solid rgba(148, 163, 184, 0.2); position: relative; overflow: hidden;">
                    <div style="position: absolute; top: -10px; right: -10px; width: 60px; height: 60px; background: linear-gradient(135deg, #002b5c, #d4af37); border-radius: 50%; opacity: 0.1;"></div>
                    <h4 style="margin: 0 0 16px 0; color: #334155; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-info-circle" style="color: #002b5c;"></i>
                        <span id="admin-calendar-info-title">Information</span>
                    </h4>
                    
                    <div id="admin-calendar-detail-content" style="display: grid; gap: 12px;">
                        <!-- Content will be populated dynamically -->
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="modal-footer" style="padding: 20px 28px 28px 28px; display: flex; gap: 12px; justify-content: center; border-top: 1px solid rgba(148, 163, 184, 0.1);">
                <button type="button" class="btn btn-secondary" id="closeAdminCalendarModalBtn" style="padding: 12px 24px; border: 2px solid #e0e0e0; background: white; color: #64748b; border-radius: 12px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.2s ease; display: flex; align-items: center; gap: 8px; min-width: 100px; justify-content: center;">
                    <i class="fas fa-times" style="font-size: 12px;"></i>
                    Close
                </button>
            </div>
        </div>
    </div>

</body>
</html>