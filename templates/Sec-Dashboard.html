<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChurchEase - Secretary Dashboard</title>
    <link rel="icon" type="image/jpeg" href="{{ url_for('static', filename='ChurchLogo.jpg') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='reservation-styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='events-styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='dashboard-styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='payment-styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='reservation-onepage.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='calendar-enhancements.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='client-search.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='mobile-responsive.css') }}">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="static/payment-calculator.js"></script>
    
    <style>
        /* ============================================================================ */
        /* LOGIN PAGE COLOR PALETTE - APPLIED GLOBALLY */
        /* ============================================================================ */
        :root {
            --primary-dark: #1e3a8a;
            --primary-mid: #0369a1;
            --primary-light: #0891b2;
            --primary-accent: #1e40af;
            --primary-gradient: linear-gradient(135deg, #1e3a8a 0%, #0369a1 50%, #0891b2 100%);
            --primary-gradient-reverse: linear-gradient(135deg, #0891b2 0%, #0369a1 50%, #1e3a8a 100%);
            --primary-shadow: rgba(30, 58, 138, 0.3);
            --primary-glow: rgba(8, 145, 178, 0.1);
            --border-radius-lg: 20px;
            --border-radius-md: 15px;
            --border-radius-sm: 10px;
            --success: #10b981;
            --warning: #f59e0b;
            --info: #3b82f6;
        }

        /* ============================================================================ */
        /* ENHANCED DASHBOARD STYLES */
        /* ============================================================================ */
        
        /* Enhanced Stat Cards */
        .enhanced-card {
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .enhanced-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            border-color: var(--primary-light);
        }
        
        .stat-background-pattern {
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .enhanced-card:hover .stat-background-pattern {
            opacity: 1;
        }
        
        .stat-progress {
            width: 100%;
            height: 4px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 2px;
            margin-top: 12px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-dark) 0%, var(--primary-light) 100%);
            border-radius: 2px;
            transition: width 1s ease-in-out;
            position: relative;
        }
        
        .progress-bar.success {
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
        }
        
        .progress-bar.warning {
            background: linear-gradient(90deg, #f59e0b 0%, #D97706 100%);
        }
        
        .progress-bar.info {
            background: linear-gradient(90deg, #3b82f6 0%, #1D4ED8 100%);
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* Enhanced Module Styles */
        .module-content {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Enhanced Header Styles */
        .enhanced-header,
        .top-header.enhanced-header,
        header.enhanced-header {
            background: linear-gradient(135deg, #1e3a8a 0%, #0369a1 50%, #0891b2 100%) !important;
            border-radius: 0 0 20px 20px !important;
            padding: 20px 32px !important;
            margin-bottom: 24px !important;
            color: white !important;
            position: relative;
            overflow: hidden;
            border: none !important;
            box-shadow: 0 8px 32px rgba(30, 58, 138, 0.3) !important;
        }
        
        .enhanced-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 1;
            width: 100%;
        }
        
        .header-info {
            flex: 1;
        }
        
        .enhanced-header .breadcrumb {
            margin-bottom: 8px;
        }
        
        .enhanced-header .breadcrumb,
        .enhanced-header .breadcrumb * {
            color: rgba(255, 255, 255, 0.9) !important;
        }
        
        .enhanced-header .breadcrumb a {
            color: rgba(255, 255, 255, 0.8) !important;
            text-decoration: none;
        }
        
        .enhanced-header .breadcrumb i {
            color: rgba(255, 255, 255, 0.6) !important;
            margin: 0 8px;
        }
        
        .enhanced-header .breadcrumb span {
            color: white !important;
        }
        
        .enhanced-title,
        .enhanced-header .page-title,
        .enhanced-header h1 {
            font-size: 1.4rem !important;
            font-weight: 600 !important;
            margin: 0 0 4px 0 !important;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
            color: white !important;
        }
        
        .enhanced-subtitle,
        .enhanced-header .page-subtitle,
        .enhanced-header p {
            font-size: 0.875rem !important;
            opacity: 0.9 !important;
            margin: 0 !important;
            color: rgba(255, 255, 255, 0.9) !important;
        }
        
        .enhanced-header .menu-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 12px;
            border-radius: 10px;
            margin-right: 20px;
            transition: all 0.3s ease;
        }
        
        .enhanced-header .menu-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        /* ============================================================================ */
        /* SIDEBAR & NAVIGATION - LOGIN PAGE COLORS */
        /* ============================================================================ */
        .sidebar {
            background: var(--primary-gradient);
            box-shadow: 4px 0 20px var(--primary-shadow);
        }

        .sidebar-header {
            background: rgba(255, 255, 255, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .sidebar .logo-text {
            color: white !important;
            font-weight: 700 !important;
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.9) !important;
        }

        .nav-link.active {
            background: rgba(255, 255, 255, 0.2) !important;
            border-left: 4px solid white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            color: white !important;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.15) !important;
            color: white !important;
        }

        .nav-link i {
            color: rgba(255, 255, 255, 0.9) !important;
        }

        .nav-link.active i {
            color: white !important;
        }

        .nav-text {
            color: rgba(255, 255, 255, 0.9) !important;
        }

        .nav-link.active .nav-text {
            color: white !important;
        }

        .nav-category {
            color: rgba(255, 255, 255, 0.7) !important;
            font-weight: 600 !important;
        }

        .nav-badge {
            background: white !important;
            color: var(--primary-dark) !important;
            box-shadow: 0 2px 8px rgba(255, 255, 255, 0.3);
            font-weight: 700 !important;
        }

        .user-name, .user-role {
            color: white !important;
        }

        .user-avatar {
            background: white !important;
            color: var(--primary-dark) !important;
            font-weight: 700 !important;
        }

        /* BUTTONS - LOGIN PAGE COLORS */
        .btn-primary, .btn.btn-primary {
            background: var(--primary-gradient) !important;
            border: none !important;
            color: white !important;
            border-radius: var(--border-radius-md) !important;
            padding: 12px 24px !important;
            font-weight: 600 !important;
            box-shadow: 0 4px 12px var(--primary-shadow) !important;
            transition: all 0.3s ease !important;
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before, .btn.btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover::before, .btn.btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover, .btn.btn-primary:hover {
            background: var(--primary-gradient-reverse) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 20px var(--primary-shadow) !important;
        }

        /* STAT CARDS - LOGIN PAGE COLORS */
        .stat-icon.primary {
            background: var(--primary-gradient) !important;
            box-shadow: 0 4px 12px var(--primary-shadow) !important;
            color: white !important;
        }
        
        .stat-icon.primary i {
            color: white !important;
        }
        
        .stat-icon.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3) !important;
            color: white !important;
        }
        
        .stat-icon.success i {
            color: white !important;
        }
        
        .stat-icon.warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%) !important;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3) !important;
            color: white !important;
        }
        
        .stat-icon.warning i {
            color: white !important;
        }
        
        .stat-icon.info {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%) !important;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3) !important;
            color: white !important;
        }
        
        .stat-icon.info i {
            color: white !important;
        }

        /* MODALS - IMPROVED READABLE COLORS */
        .modal-header {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%) !important;
            border-radius: var(--border-radius-md) var(--border-radius-md) 0 0 !important;
            color: white !important;
        }
        
        .modal-header h2,
        .modal-header h3,
        .modal-header h4,
        .modal-header .modal-title {
            color: white !important;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .modal-header i {
            color: white !important;
        }
        
        .modal-close,
        .close-btn {
            color: white !important;
            opacity: 0.9;
        }
        
        .modal-close:hover,
        .close-btn:hover {
            opacity: 1;
            background: rgba(255,255,255,0.2) !important;
        }

        /* BADGES & PILLS */
        .badge-primary, .status-badge.approved, .status-badge.confirmed {
            background: var(--primary-gradient) !important;
            box-shadow: 0 2px 8px var(--primary-glow) !important;
        }

        /* TABLES */
        table thead {
            background: var(--primary-gradient) !important;
            color: white !important;
        }

        table thead th {
            color: white !important;
            font-weight: 600 !important;
        }

        /* FOCUS STATES */
        input:focus, select:focus, textarea:focus {
            border-color: var(--primary-light) !important;
            box-shadow: 0 0 0 4px var(--primary-glow) !important;
        }

        /* Loading States */
        .loading-shimmer {
            background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%);
            background-size: 200% 100%;
            animation: shimmerLoad 2s infinite;
        }
        
        @keyframes shimmerLoad {
            0% {
                background-position: -200% 0;
            }
            100% {
                background-position: 200% 0;
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .enhanced-header {
                padding: 16px 20px;
            }
            
            .enhanced-title {
                font-size: 1.2rem;
            }
            
            .enhanced-subtitle {
                font-size: 0.8rem;
            }
        }
        
        /* Event Type Badges - Match Reservation Service Badges */
        .event-type-badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            gap: 5px;
            min-width: 80px;
            justify-content: center;
        }
        
        .event-type-badge.worship {
            background: linear-gradient(135deg, #1e40af 0%, #0369a1 100%);
            color: white;
            border: 1px solid #1e40af;
        }
        
        .event-type-badge.prayer {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: 1px solid #f093fb;
        }
        
        .event-type-badge.youth {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: 1px solid #4facfe;
        }
        
        .event-type-badge.outreach {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            border: 1px solid #43e97b;
        }
        
        .event-type-badge.special {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
            border: 1px solid #fa709a;
        }
        
        .event-type-badge.bible-study {
            background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
            color: white;
            border: 1px solid #a78bfa;
        }
        
        .event-type-badge.fellowship {
            background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
            color: white;
            border: 1px solid #34d399;
        }
        
        .event-type-badge.meeting {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            border: 1px solid #fbbf24;
        }
        
        .event-type-badge.other {
            background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
            color: white;
            border: 1px solid #9ca3af;
        }
    </style>
</head>
<body>
    <!-- Modern Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <img src="{{ url_for('static', filename='ChurchLogo.jpg') }}" alt="Church Logo" class="logo-image">
                <span class="logo-text">ChurchEase</span>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        <nav class="nav-menu">
            <div class="nav-category">Main Menu</div>
            <div class="nav-item">
                <a href="#dashboard" class="nav-link active" data-page="dashboard">
                    <i class="fas fa-home"></i>
                    <span class="nav-text">Dashboard</span>
                    <span class="nav-tooltip">Dashboard</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#reservations" class="nav-link" data-page="reservations" id="reservationsLink">
                    <i class="fas fa-calendar-check"></i>
                    <span class="nav-text">Reservations</span>
                    <span class="nav-badge">12</span>
                    <span class="nav-tooltip">Reservations</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#events" class="nav-link" data-page="events" id="eventsLink">
                    <i class="fas fa-calendar-alt"></i>
                    <span class="nav-text">Events</span>
                    <span class="nav-badge">5</span>
                    <span class="nav-tooltip">Events</span>
                </a>
            </div>
            <!-- User Profile Section - Positioned at Bottom -->
            <div class="nav-item user-profile-nav">
                <div class="nav-link" style="position: relative; cursor: pointer;" id="sidebarUserProfile">
                    <div class="user-avatar">{{ user.full_name[0] if user.full_name else 'S' }}{{ user.full_name.split()[1][0] if user.full_name and ' ' in user.full_name else 'A' }}</div>
                    <div class="nav-text user-info">
                        <div class="user-name">{{ user.full_name or 'Secretary' }}</div>
                        <div class="user-role">{{ (user.role or 'secretary').title() }}</div>
                    </div>
                    <i class="fas fa-chevron-up" style="margin-left: auto; font-size: 12px; color: rgba(255,255,255,0.7); transition: transform 0.3s;" id="dropdownArrow"></i>
                    <span class="nav-tooltip">Profile</span>
                </div>
                <!-- User Dropdown for Sidebar -->
                <div class="user-dropdown sidebar-dropdown" id="sidebarUserDropdown" style="display: none;">
                    <div class="dropdown-header">
                        <div class="dropdown-user-info">
                            <div class="dropdown-avatar">{{ user.full_name[0] if user.full_name else 'S' }}{{ user.full_name.split()[1][0] if user.full_name and ' ' in user.full_name else 'A' }}</div>
                            <div class="dropdown-user-details">
                                <div class="dropdown-user-name">{{ user.full_name or 'Secretary' }}</div>
                                <div class="dropdown-user-email">{{ user.email or 'secretary@churchease.com' }}</div>
                            </div>
                        </div>
                    </div>
                    <a href="#" class="dropdown-item" id="myProfileBtn">
                        <i class="fas fa-user-circle"></i>
                        <span>My Profile</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="/" class="dropdown-item">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </a>
                </div>
            </div>
        </nav>
    </aside>
    
    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <div class="content-wrapper">
            <!-- Enhanced Top Header with Welcome Banner Design -->
            <header class="top-header enhanced-header">
                <div class="header-content">
                    <div class="header-left">
                        <button class="menu-toggle" id="menuToggle">
                            <i class="fas fa-bars"></i>
                        </button>
                        <div class="header-info">
                            <div class="breadcrumb">
                                <a href="#">Home</a>
                                <i class="fas fa-chevron-right"></i>
                                <span id="breadcrumb-current">Dashboard</span>
                            </div>
                            <h1 class="page-title enhanced-title" id="dynamicGreeting">Good Morning, {{ user.full_name.split()[0] if user.full_name else 'Secretary' }}! ðŸ‘‹</h1>
                            <p class="page-subtitle enhanced-subtitle">Here's what's happening with your church operations today</p>
                        </div>
                    </div>
                </div>
            </header>

        <!-- Dashboard Content -->
        <div id="dashboardContent" style="max-width: 1400px; margin: 0 auto;">
            
            <!-- Dashboard Overview Cards -->
            <div class="dashboard-cards" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 24px; margin-bottom: 32px;" data-aos="fade-up">
                <!-- Today's Reservations -->
                <div class="stat-card enhanced-card" style="background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 16px; padding: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
                    <div class="stat-background-pattern"></div>
                    <div class="stat-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <div class="stat-icon info" style="width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                            <i class="fas fa-calendar-day"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="todayReservations" style="font-size: 36px; font-weight: 700; color: #1f2937; margin-bottom: 8px;">0</div>
                    <div class="stat-label" style="color: #374151; font-weight: 600; font-size: 14px; margin-bottom: 4px;">Today's Reservations</div>
                    <div class="stat-sublabel" style="color: #6b7280; font-size: 12px; margin-bottom: 12px;">Scheduled for today</div>
                    <div class="stat-progress">
                        <div class="progress-bar info" id="todayProgress" style="width: 0%;"></div>
                    </div>
                </div>
                
                <!-- This Week's Reservations -->
                <div class="stat-card enhanced-card" style="background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 16px; padding: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);" data-aos="fade-up" data-aos-delay="100">
                    <div class="stat-background-pattern"></div>
                    <div class="stat-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <div class="stat-icon success" style="width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                            <i class="fas fa-calendar-week"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="weekReservations" style="font-size: 36px; font-weight: 700; color: #1f2937; margin-bottom: 8px;">0</div>
                    <div class="stat-label" style="color: #374151; font-weight: 600; font-size: 14px; margin-bottom: 4px;">This Week</div>
                    <div class="stat-sublabel" style="color: #6b7280; font-size: 12px; margin-bottom: 12px;">Next 7 days</div>
                    <div class="stat-progress">
                        <div class="progress-bar success" id="weekProgress" style="width: 0%;"></div>
                    </div>
                </div>
                
                <!-- Pending Approvals -->
                <div class="stat-card enhanced-card" style="background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 16px; padding: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);" data-aos="fade-up" data-aos-delay="200">
                    <div class="stat-background-pattern"></div>
                    <div class="stat-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <div class="stat-icon warning" style="width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                            <i class="fas fa-hourglass-half"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="pendingApprovals" style="font-size: 36px; font-weight: 700; color: #1f2937; margin-bottom: 8px;">0</div>
                    <div class="stat-label" style="color: #374151; font-weight: 600; font-size: 14px; margin-bottom: 4px;">Pending Approvals</div>
                    <div class="stat-sublabel" style="color: #6b7280; font-size: 12px; margin-bottom: 12px;">Requires action</div>
                    <div class="stat-progress">
                        <div class="progress-bar warning" id="pendingProgress" style="width: 0%;"></div>
                    </div>
                </div>
                
                <!-- This Month's Revenue -->
                <div class="stat-card enhanced-card" style="background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 16px; padding: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);" data-aos="fade-up" data-aos-delay="300">
                    <div class="stat-background-pattern"></div>
                    <div class="stat-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <div class="stat-icon primary" style="width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                            <i class="fas fa-peso-sign"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="monthRevenue" style="font-size: 32px; font-weight: 700; color: #1f2937; margin-bottom: 8px;">â‚±0</div>
                    <div class="stat-label" style="color: #374151; font-weight: 600; font-size: 14px; margin-bottom: 4px;">This Month's Revenue</div>
                    <div class="stat-sublabel" style="color: #6b7280; font-size: 12px; margin-bottom: 12px;">Total stipendium</div>
                    <div class="stat-progress">
                        <div class="progress-bar" id="revenueProgress" style="width: 0%;"></div>
                    </div>
                </div>
            </div>
            
            <!-- Two Column Layout for Schedule and Activities -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px;">
                
                <!-- Today's Schedule Section -->
                <div class="today-schedule-section">
                    <div class="section-header" style="margin-bottom: 12px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-calendar-day" style="color: var(--primary); font-size: 16px;"></i>
                            <h2 class="section-title" style="font-size: 16px; margin: 0; font-weight: 600;">Today's Schedule</h2>
                            <span class="schedule-date" id="scheduleDate" style="color: #666; font-size: 11px; font-weight: normal;"></span>
                        </div>
                        <button class="export-btn" id="refreshSchedule" style="background: var(--primary); color: white; padding: 6px 12px; font-size: 12px;">
                            <i class="fas fa-sync-alt"></i>
                            Refresh
                        </button>
                    </div>
                    
                    <div class="schedule-container" style="background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); overflow: hidden; max-height: 500px; overflow-y: auto;">
                        <div id="scheduleContent">
                            <!-- Schedule items will be loaded here -->
                            <div style="padding: 30px; text-align: center; color: #999;">
                                <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 8px;"></i>
                                <p style="font-size: 13px;">Loading today's schedule...</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Activities Section -->
                <div class="recent-activities-section">
                    <div class="section-header" style="margin-bottom: 12px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-history" style="color: var(--primary); font-size: 16px;"></i>
                            <h2 class="section-title" style="font-size: 16px; margin: 0; font-weight: 600;">Recent Activities</h2>
                        </div>
                        <button class="export-btn" id="refreshActivities" style="background: var(--primary); color: white; padding: 6px 12px; font-size: 12px;">
                            <i class="fas fa-sync-alt"></i>
                            Refresh
                        </button>
                    </div>
                    
                    <div class="activities-container" style="background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); overflow: hidden; max-height: 500px; overflow-y: auto;">
                        <div id="activitiesContent">
                            <!-- Activities will be loaded here -->
                            <div style="padding: 30px; text-align: center; color: #999;">
                                <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 8px;"></i>
                                <p style="font-size: 13px;">Loading recent activities...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>

        <!-- Profile Settings Modal -->
        <div id="profileSettingsModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); z-index: 9999; justify-content: center; align-items: center;">
            <div class="modal-content profile-modal" style="background: white; border-radius: 16px; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3); position: relative; max-height: 90vh; overflow-y: auto;">
                <!-- Modal Header with Gradient Background -->
                <div class="modal-header" style="background: linear-gradient(135deg, #1e40af 0%, #0369a1 100%); padding: 24px 28px; border-radius: 16px 16px 0 0; position: relative;">
                    <h2 style="margin: 0; color: #ffffff !important; font-size: 22px; font-weight: 600; display: flex; align-items: center; gap: 10px; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                        <i class="fas fa-user-circle" style="font-size: 24px; color: #ffffff !important;"></i>
                        <span style="color: #ffffff !important;">My Profile</span>
                    </h2>
                    <button class="close-btn" id="closeProfileModal" style="position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.2); border: none; font-size: 20px; cursor: pointer; color: #ffffff !important; padding: 8px; border-radius: 50%; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <i class="fas fa-times" style="color: #ffffff !important;"></i>
                    </button>
                </div>
                
                <!-- Modal Body with Better Spacing -->
                <div class="modal-body" style="padding: 32px 28px;">
                    <form id="profileSettingsForm">
                        <!-- Account Information Section -->
                        <div style="margin-bottom: 24px;">
                            <h3 style="font-size: 16px; font-weight: 600; color: #1f2937; margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid #e5e7eb;">
                                <i class="fas fa-info-circle" style="color: #3b82f6; margin-right: 8px;"></i>
                                Account Information
                            </h3>
                            
                            <div class="form-group" style="margin-bottom: 20px;">
                                <label for="fullName" style="display: block; font-weight: 500; color: #374151; margin-bottom: 8px; font-size: 14px;">Full Name</label>
                                <input type="text" id="fullName" name="fullName" value="{{ user.full_name or 'Secretary' }}" class="form-input" readonly style="width: 100%; padding: 12px 16px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; background-color: #f9fafb; color: #6b7280; cursor: not-allowed;">
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 20px;">
                                <label for="email" style="display: block; font-weight: 500; color: #374151; margin-bottom: 8px; font-size: 14px;">Email Address</label>
                                <input type="email" id="email" name="email" value="{{ user.email or 'secretary@churchease.com' }}" class="form-input" readonly style="width: 100%; padding: 12px 16px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; background-color: #f9fafb; color: #6b7280; cursor: not-allowed;">
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="userRole" style="display: block; font-weight: 500; color: #374151; margin-bottom: 8px; font-size: 14px;">Role</label>
                                <input type="text" id="userRole" name="userRole" value="{{ (user.role or 'secretary').title() }}" class="form-input" readonly style="width: 100%; padding: 12px 16px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; background-color: #f9fafb; color: #6b7280; cursor: not-allowed;">
                            </div>
                        </div>
                        
                        <!-- Info Message -->
                        <div style="background: #eff6ff; border-left: 4px solid #3b82f6; padding: 12px 16px; border-radius: 8px; margin-top: 20px;">
                            <p style="margin: 0; color: #1e40af; font-size: 13px; display: flex; align-items: start; gap: 8px;">
                                <i class="fas fa-info-circle" style="margin-top: 2px;"></i>
                                <span>This information is view-only. Contact the system administrator to update your profile details.</span>
                            </p>
                        </div>
                    </form>
                </div>
                
                <!-- Modal Footer -->
                <div class="modal-footer" style="padding: 20px 28px; border-top: 1px solid #e5e7eb; display: flex; justify-content: flex-end; gap: 12px; border-radius: 0 0 16px 16px;">
                    <button type="button" class="btn btn-secondary" id="cancelProfileSettings" style="padding: 10px 24px; border: 1px solid #d1d5db; background: white; color: #374151; border-radius: 8px; font-weight: 500; cursor: pointer; transition: all 0.2s;">Close</button>
                </div>
            </div>
        </div>

        <!-- Logout Confirmation Modal -->
        <div id="logoutModal" class="modal" style="display: none;">
            <div class="modal-content logout-modal">
                <div class="modal-header">
                    <h2><i class="fas fa-sign-out-alt"></i> Confirm Logout</h2>
                </div>
                <div class="modal-body">
                    <div class="logout-message">
                        <i class="fas fa-question-circle"></i>
                        <p>Are you sure you want to logout from ChurchEase?</p>
                        <p class="logout-subtitle">You will need to login again to access the system.</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="cancelLogout">No, Stay Logged In</button>
                    <button type="button" class="btn btn-danger" id="confirmLogout">Yes, Logout</button>
                </div>
            </div>
        </div>
        </div> <!-- Close dashboardContent -->
        
        <!-- Events Module -->
        <div id="eventsModule" class="module-content" style="display: none;">
            
            <!-- Tab Navigation -->
            <div class="reservation-tabs">
                <button class="tab-btn active" data-tab="all-events">
                    <i class="fas fa-list"></i>
                    All Events
                </button>
                <button class="tab-btn" data-tab="add-events">
                    <i class="fas fa-plus"></i>
                    Add Events
                </button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- All Events Tab -->
                <div id="all-events" class="tab-pane active">
                    <!-- Search and Filters -->
                    <div class="search-and-filters">
                        <!-- Search Bar and Refresh -->
                        <div class="search-container">
                            <div class="search-input-wrapper">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" id="eventSearchInput" class="search-input" placeholder="Search by event name...">
                                <button class="clear-search" id="clearEventSearch" style="display: none;">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="refresh-controls">
                                <button class="refresh-btn" id="refreshEvents" title="Refresh Events">
                                    <i class="fas fa-sync-alt"></i>
                                    <span>Refresh</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Quick Filters -->
                        <div class="quick-filters">
                            <div class="filter-pills">
                                <button class="filter-pill active event-filter-tab" data-filter="all">
                                    <i class="fas fa-border-all"></i>
                                    All Events
                                </button>
                                <button class="filter-pill event-filter-tab" data-filter="worship">
                                    <i class="fas fa-praying-hands"></i>
                                    Worship
                                </button>
                                <button class="filter-pill event-filter-tab" data-filter="community">
                                    <i class="fas fa-users"></i>
                                    Community
                                </button>
                                <button class="filter-pill event-filter-tab" data-filter="youth">
                                    <i class="fas fa-child"></i>
                                    Youth
                                </button>
                                <button class="filter-pill event-filter-tab" data-filter="outreach">
                                    <i class="fas fa-hands-helping"></i>
                                    Outreach
                                </button>
                                <button class="filter-pill event-filter-tab" data-filter="special">
                                    <i class="fas fa-star"></i>
                                    Special
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Events Table -->
                    <div class="reservations-table-container">
                        <table class="reservations-table">
                            <thead>
                                <tr>
                                    <th>EVENT TYPE</th>
                                    <th>EVENT NAME</th>
                                    <th>ASSIGNED PRIEST</th>
                                    <th class="sortable-header" data-sort="date">
                                        DATE & TIME
                                        <span class="sort-arrows">
                                            <i class="fas fa-sort sort-icon" data-direction="none"></i>
                                        </span>
                                    </th>
                                    <th>ACTIONS</th>
                                </tr>
                            </thead>
                            <tbody id="eventsTableBody">
                                <!-- Events will be loaded from database -->
                                <tr>
                                    <td colspan="5" style="text-align: center; padding: 20px; color: #666;">
                                        <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 8px;"></i>
                                        <div>Loading events...</div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Add Events Tab -->
                <div id="add-events" class="tab-pane" style="display: none;">
                    <div class="calendar-reservation-container">
                        <!-- Calendar Header -->
                        <div class="calendar-header" style="margin-bottom: 10px;">
                            <div class="calendar-title-section">
                                <h3 class="calendar-title" style="font-size: 18px; margin-bottom: 5px;">
                                    <i class="fas fa-calendar-alt"></i>
                                    Church Events Calendar
                                </h3>
                                <p class="calendar-subtitle" style="font-size: 13px; margin-bottom: 0;">View all confirmed church reservations and events</p>
                            </div>
                            
                            <!-- Service Filter and Refresh Button -->
                            <div class="calendar-controls">
                                <div class="service-filter">
                                    <label style="font-size: 13px;">Filter by Service:</label>
                                    <select id="eventsServiceFilter" style="font-size: 13px; padding: 4px 8px; border-radius: 4px; border: 1px solid #ddd;">
                                        <option value="all">All Services</option>
                                        <option value="wedding">Wedding</option>
                                        <option value="baptism">Baptism</option>
                                        <option value="funeral">Funeral</option>
                                        <option value="confirmation">Confirmation</option>
                                    </select>
                                </div>
                                <button id="refreshEventsBtn" class="refresh-btn" style="font-size: 13px; padding: 6px 12px; margin-left: 10px;">
                                    <i class="fas fa-sync-alt"></i>
                                    <span>Refresh</span>
                                </button>
                            </div>
                        </div>

                        <!-- Events Calendar Container -->
                        <div id="eventsFullCalendar" class="calendar-container" style="background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);"></div>

                        <!-- Calendar Legend -->
                        <div class="calendar-legend" style="margin-top: 8px; padding: 6px; background: #f8f9fa; border-radius: 6px; border: 1px solid #e9ecef;">
                            <div class="legend-items" style="display: flex; flex-wrap: wrap; gap: 12px; justify-content: center;">
                                <div class="legend-item" style="font-size: 11px;">
                                    <div class="legend-color available" style="width: 10px; height: 10px;"></div>
                                    <span>Available</span>
                                </div>
                                <div class="legend-item" style="font-size: 11px;">
                                    <div class="legend-color wedding" style="width: 10px; height: 10px;"></div>
                                    <span>Wedding</span>
                                </div>
                                <div class="legend-item" style="font-size: 11px;">
                                    <div class="legend-color baptism" style="width: 10px; height: 10px;"></div>
                                    <span>Baptism</span>
                                </div>
                                <div class="legend-item" style="font-size: 11px;">
                                    <div class="legend-color funeral" style="width: 10px; height: 10px;"></div>
                                    <span>Funeral</span>
                                </div>
                                <div class="legend-item" style="font-size: 11px;">
                                    <div class="legend-color confirmation" style="width: 10px; height: 10px;"></div>
                                    <span>Confirmation</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div> <!-- Close eventsModule -->

        
        <!-- Reservation Module -->
        <div id="reservationModule" class="module-content" style="display: none;">
            
            <!-- Tab Navigation -->
            <div class="reservation-tabs">
                <button class="tab-btn active" data-tab="all-reservations">
                    <i class="fas fa-list"></i>
                    All Reservations
                </button>
                <button class="tab-btn" data-tab="add-reservation">
                    <i class="fas fa-plus"></i>
                    Add Reservation
                </button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- All Reservations Tab -->
                <div id="all-reservations" class="tab-pane active">
                    <!-- Search and Filters -->
                    <div class="search-and-filters">
                        <!-- Search Bar and Refresh -->
                        <div class="search-container">
                            <div class="search-input-wrapper">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" id="nameSearchInput" class="search-input" placeholder="Search by client name...">
                                <button class="clear-search" id="clearSearch" style="display: none;">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="refresh-controls">
                                <button class="refresh-btn" id="refreshReservations" title="Refresh Reservations">
                                    <i class="fas fa-sync-alt"></i>
                                    <span>Refresh</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Quick Filters -->
                        <div class="quick-filters">
                            <div class="filter-pills">
                                <button class="filter-pill active service-filter-tab" data-filter="all">
                                    <i class="fas fa-border-all"></i>
                                    All Services
                                </button>
                                <button class="filter-pill service-filter-tab" data-filter="wedding">
                                    <i class="fas fa-ring"></i>
                                    Wedding (Kasal)
                                </button>
                                <button class="filter-pill service-filter-tab" data-filter="baptism">
                                    <i class="fas fa-baby"></i>
                                    Baptism (Binyag)
                                </button>
                                <button class="filter-pill service-filter-tab" data-filter="funeral">
                                    <i class="fas fa-cross"></i>
                                    Funeral (Burol)
                                </button>
                                <button class="filter-pill service-filter-tab" data-filter="confirmation">
                                    <i class="fas fa-praying-hands"></i>
                                    Confirmation (Kumpil)
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Reservations Table -->
                    <div class="reservations-table-container">
                        <table class="reservations-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Service Type</th>
                                    <th>Client Name</th>
                                    <th class="sortable-header" data-sort="date">
                                        Date & Time
                                        <span class="sort-arrows">
                                            <i class="fas fa-sort sort-icon" data-direction="none"></i>
                                        </span>
                                    </th>
                                    <th>Status</th>
                                    <th>Assigned Priest</th>
                                    <th>Stipendium</th>
                                    <th>Attendance</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="reservationsTableBody">
                                <!-- Reservations will be loaded from database -->
                            </tbody>
                        </table>
                    </div>
                </div>


                <!-- Add Reservation Tab -->
                <div id="add-reservation" class="tab-pane">
                    <div class="calendar-reservation-container">
                        <!-- Calendar Header -->
                        <div class="calendar-header" style="margin-bottom: 10px;">
                            <div class="calendar-title-section">
                                <h3 class="calendar-title" style="font-size: 18px; margin-bottom: 5px;">
                                    <i class="fas fa-calendar-plus"></i>
                                    Church Reservation Calendar
                                </h3>
                                <p class="calendar-subtitle" style="font-size: 13px; margin-bottom: 0;">Click on any available date to make a reservation</p>
                            </div>
                            
                            <!-- Service Filter and Refresh Button -->
                            <div class="calendar-controls">
                                <div class="service-filter">
                                    <label style="font-size: 13px;">Filter by Service:</label>
                                    <select id="calendarServiceFilter" class="form-select" style="font-size: 13px; padding: 6px 10px;">
                                        <option value="all">All Services</option>
                                        <option value="wedding">Wedding</option>
                                        <option value="baptism">Baptism</option>
                                        <option value="funeral">Funeral</option>
                                        <option value="confirmation">Confirmation</option>
                                    </select>
                                </div>
                                <button class="refresh-btn calendar-refresh-btn" id="refreshCalendar" title="Refresh Calendar">
                                    <i class="fas fa-sync-alt"></i>
                                    <span>Refresh</span>
                                </button>
                            </div>
                        </div>

                        <!-- FullCalendar Container -->
                        <div id="fullCalendar" class="full-calendar-container"></div>

                        <!-- Calendar Legend -->
                        <div class="calendar-legend" style="margin-top: 8px; padding: 6px; gap: 8px;">
                            <div class="legend-item" style="font-size: 11px;">
                                <div class="legend-color available" style="width: 10px; height: 10px;"></div>
                                <span>Available</span>
                            </div>
                            <div class="legend-item" style="font-size: 11px;">
                                <div class="legend-color wedding" style="width: 10px; height: 10px;"></div>
                                <span>Wedding</span>
                            </div>
                            <div class="legend-item" style="font-size: 11px;">
                                <div class="legend-color baptism" style="width: 10px; height: 10px;"></div>
                                <span>Baptism</span>
                            </div>
                            <div class="legend-item" style="font-size: 11px;">
                                <div class="legend-color funeral" style="width: 10px; height: 10px;"></div>
                                <span>Funeral</span>
                            </div>
                            <div class="legend-item" style="font-size: 11px;">
                                <div class="legend-color confirmation" style="width: 10px; height: 10px;"></div>
                                <span>Confirmation</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>



                <!-- Date Details Modal -->
                <div class="date-details-modal" id="dateDetailsModal" style="display: none;">
                    <div class="modal-overlay"></div>
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title" id="dateModalTitle">Reservations for March 15, 2025</h4>
                            <button class="modal-close" id="dateModalClose">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <!-- Time Slots Grid -->
                            <div class="time-slots-section">
                                <h5>Available Time Slots</h5>
                                <div class="time-slots-grid" id="timeSlotsGrid">
                                    <!-- Time slots will be populated dynamically -->
                                </div>
                            </div>
                            
                            <!-- Existing Reservations -->
                            <div class="existing-reservations" id="existingReservations">
                                <h5>Existing Reservations</h5>
                                <div class="reservations-list" id="reservationsList">
                                    <!-- Existing reservations will be populated dynamically -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reservation Form Modal -->
                <div class="reservation-form-modal" id="reservationFormModal" style="display: none;">
                    <div class="modal-overlay"></div>
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title" id="formModalTitle">Make Reservation</h4>
                            <button class="modal-close" id="formModalClose">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="reservationForm">
                                <!-- Service Selection -->
                                <div class="form-section">
                                    <h5>Service Type <span class="required" style="color: #ef4444;">*</span></h5>
                                    <p style="margin: 0 0 10px 0; font-size: 13px; color: #6b7280;">Please select one service type to continue</p>
                                    <div class="service-selection">
                                        <div class="service-option" data-service="wedding">
                                            <i class="fas fa-ring"></i>
                                            <span>Wedding</span>
                                        </div>
                                        <div class="service-option" data-service="baptism">
                                            <i class="fas fa-water"></i>
                                            <span>Baptism</span>
                                        </div>
                                        <div class="service-option" data-service="funeral">
                                            <i class="fas fa-cross"></i>
                                            <span>Funeral</span>
                                        </div>
                                        <div class="service-option" data-service="confirmation">
                                            <i class="fas fa-hands-praying"></i>
                                            <span>Confirmation</span>
                                        </div>
                                    </div>
                                    <input type="hidden" id="selectedService" name="service_type" required>
                                </div>

                                <!-- Date and Time -->
                                <div class="form-section">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>Date</label>
                                            <input type="date" id="reservationDate" name="date" readonly required>
                                        </div>
                                        <div class="form-group">
                                            <label>Time Slot</label>
                                            <input type="text" id="reservationTime" name="time_slot" readonly required>
                                        </div>
                                    </div>
                                </div>

                                <!-- Client Search/Auto-fill -->
                                <div class="form-section">
                                    <h5>Client Information</h5>
                                    <div class="form-group">
                                        <label>Search Existing Client</label>
                                        <div class="client-search-container">
                                            <input type="text" id="clientSearch" placeholder="Search by name, phone, or email..." autocomplete="off">
                                            <div class="search-results" id="searchResults" style="display: none;"></div>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>First Name *</label>
                                            <input type="text" id="contactFirstName" name="contact_first_name" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Last Name *</label>
                                            <input type="text" id="contactLastName" name="contact_last_name" required>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>Phone Number *</label>
                                            <input type="tel" id="contactPhone" name="contact_phone" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Email Address</label>
                                            <input type="email" id="contactEmail" name="contact_email">
                                        </div>
                                    </div>
                                </div>

                                <!-- Priest Assignment -->
                                <div class="form-section">
                                    <h5><i class="fas fa-user"></i> Priest Assignment</h5>
                                    <div class="form-group">
                                        <label for="assignedPriest">Select Priest <span class="required">*</span></label>
                                        <select id="assignedPriest" name="assigned_priest" required>
                                            <option value="">Choose a priest...</option>
                                            <!-- Priests loaded dynamically from database -->
                                        </select>
                                        <small class="form-help">Select the priest who will officiate this service</small>
                                    </div>
                                </div>

                                <!-- Service-Specific Fields -->
                                <div id="serviceSpecificFields" class="form-section" style="display: none;">
                                    <!-- Wedding Fields -->
                                    <div id="weddingFields" class="service-fields" style="display: none;">
                                        <h5>Wedding Details</h5>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Bride's Full Name *</label>
                                                <input type="text" id="brideName" name="bride_name" required>
                                            </div>
                                            <div class="form-group">
                                                <label>Groom's Full Name *</label>
                                                <input type="text" id="groomName" name="groom_name" required>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Baptism Fields -->
                                    <div id="baptismFields" class="service-fields" style="display: none;">
                                        <h5>Child Information</h5>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Child's Full Name *</label>
                                                <input type="text" id="childFullName" name="child_full_name" required>
                                            </div>
                                            <div class="form-group">
                                                <label>Date of Birth *</label>
                                                <input type="date" id="childDateOfBirth" name="child_date_of_birth" required>
                                            </div>
                                        </div>
                                        <h5>Parents Information</h5>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Father's Full Name *</label>
                                                <input type="text" id="fatherName" name="father_name" required>
                                            </div>
                                            <div class="form-group">
                                                <label>Mother's Full Name *</label>
                                                <input type="text" id="motherName" name="mother_name" required>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Funeral Fields -->
                                    <div id="funeralFields" class="service-fields" style="display: none;">
                                        <h5>Deceased Information</h5>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Deceased's Full Name *</label>
                                                <input type="text" id="deceasedName" name="deceased_name" required>
                                            </div>
                                            <div class="form-group">
                                                <label>Date of Death *</label>
                                                <input type="date" id="dateOfDeath" name="date_of_death" required>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label>Funeral Home Contact</label>
                                            <input type="text" id="funeralHomeContact" name="funeral_home_contact">
                                        </div>
                                        
                                        <!-- 3-Day Funeral Schedule -->
                                        <div style="background: linear-gradient(135deg, #fee2e2 0%, #fef3c7 100%); padding: 20px; border-radius: 12px; margin-top: 20px; border: 2px solid #f59e0b;">
                                            <h5 style="color: #92400e; margin-bottom: 15px;">
                                                <i class="fas fa-calendar-week"></i> Funeral End Schedule (Burol)
                                            </h5>
                                            <p style="font-size: 13px; color: #78350f; margin-bottom: 15px;">
                                                <i class="fas fa-info-circle"></i> Funeral starts on the date/time you selected. Specify when it ends (typically 3 days).
                                            </p>
                                            
                                            <!-- End Date & Time Only -->
                                            <div class="form-row">
                                                <div class="form-group">
                                                    <label style="color: #92400e; font-weight: 600;">
                                                        <i class="fas fa-stop-circle"></i> End Date *
                                                    </label>
                                                    <input type="date" id="funeralEndDate" name="funeral_end_date" required 
                                                           style="border: 2px solid #f59e0b;">
                                                    <small style="color: #78350f;">Last day of funeral service</small>
                                                </div>
                                                <div class="form-group">
                                                    <label style="color: #92400e; font-weight: 600;">
                                                        <i class="fas fa-clock"></i> End Time *
                                                    </label>
                                                    <select id="funeralEndTime" name="funeral_end_time" required 
                                                            style="border: 2px solid #f59e0b;">
                                                        <option value="">Select end time...</option>
                                                        <option value="09:00">9:00 AM</option>
                                                        <option value="10:00">10:00 AM</option>
                                                        <option value="11:00">11:00 AM</option>
                                                        <option value="14:00">2:00 PM</option>
                                                        <option value="15:00">3:00 PM</option>
                                                        <option value="16:00">4:00 PM</option>
                                                        <option value="17:00">5:00 PM</option>
                                                    </select>
                                                    <small style="color: #78350f;">When the funeral ends</small>
                                                </div>
                                            </div>
                                            
                                            <!-- Duration Display -->
                                            <div id="funeralDurationDisplay" style="margin-top: 15px; padding: 12px; background: white; border-radius: 8px; border: 2px solid #10b981; display: none;">
                                                <p style="margin: 0; color: #065f46; font-weight: 600;">
                                                    <i class="fas fa-calendar-check"></i> Duration: <span id="funeralDurationDays">0</span> days
                                                </p>
                                                <p style="margin: 5px 0 0 0; color: #047857; font-size: 13px;">
                                                    <i class="fas fa-info-circle"></i> <span id="funeralDateRange"></span>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Confirmation Fields -->
                                    <div id="confirmationFields" class="service-fields" style="display: none;">
                                        <h5>Confirmation Details</h5>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Candidate's Full Name *</label>
                                                <input type="text" id="candidateName" name="candidate_name" required>
                                            </div>
                                            <div class="form-group">
                                                <label>Sponsor's Full Name *</label>
                                                <input type="text" id="sponsorName" name="sponsor_name" required>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Stipendium Information -->
                                <div class="form-section" id="paymentSection" style="display: none;">
                                    <h5><i class="fas fa-credit-card"></i> Stipendium Information</h5>
                                    
                                    <!-- Stipendium Method & Type -->
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>Stipendium Method</label>
                                            <input type="text" id="paymentMethod" name="payment_method" value="Cash" readonly class="readonly-field">
                                        </div>
                                        <div class="form-group">
                                            <label>Stipendium Type *</label>
                                            <select id="paymentType" name="payment_type" required>
                                                <option value="">Select Stipendium Type</option>
                                                <option value="Full">Full Stipendium</option>
                                                <option value="Downpayment">Partial Stipendium</option>
                                            </select>
                                        </div>
                                    </div>


                                    <!-- Pricing Information -->
                                    <div class="payment-summary-card">
                                        <h6><i class="fas fa-calculator"></i> Stipendium Summary</h6>
                                        
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Base Price</label>
                                                <input type="text" id="basePrice" name="base_price" readonly class="readonly-field">
                                            </div>
                                            <div class="form-group">
                                                <label>Discount Type</label>
                                                <select id="discountType" name="discount_type">
                                                    <option value="none">No Discount</option>
                                                    <option value="percentage">Percentage (%)</option>
                                                    <option value="fixed">Fixed Amount (â‚±)</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="form-row" id="discountValueGroup" style="display: none;">
                                            <div class="form-group">
                                                <label id="discountValueLabel">Discount Value</label>
                                                <input type="number" id="discountValue" name="discount_value" min="0" step="0.01" placeholder="0">
                                            </div>
                                            <div class="form-group">
                                                <label>Discount Amount</label>
                                                <input type="text" id="discountAmount" name="discount_amount" readonly class="readonly-field">
                                            </div>
                                        </div>

                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>Amount Due</label>
                                                <input type="text" id="amountDue" name="amount_due" readonly class="readonly-field amount-highlight">
                                            </div>
                                            <div class="form-group">
                                                <label>Amount Paid *</label>
                                                <input type="number" id="amountPaid" name="amount_paid" min="0" step="0.01" placeholder="0.00" required>
                                            </div>
                                        </div>

                                        <div class="form-group" id="balanceGroup" style="display: none;">
                                            <label>Remaining Balance</label>
                                            <input type="text" id="remainingBalance" name="remaining_balance" readonly class="readonly-field balance-highlight">
                                        </div>

                                        <div class="payment-status-indicator" id="paymentStatusIndicator">
                                            <span class="status-badge status-pending">Stipendium Pending</span>
                                        </div>
                                    </div>
                                </div>


                                <!-- Submit Button -->
                                <div class="form-actions">
                                    <button type="button" id="cancelReservation" class="btn btn-secondary">Cancel</button>
                                    <button type="submit" id="submitReservation" class="btn btn-primary">Make Reservation</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        
        <!-- View Reservation Details Modal -->
        <div class="view-reservation-modal" id="viewReservationModal" style="display: none;">
            <div class="modal-overlay"></div>
            <div class="modal-content large-modal">
                <div class="modal-header">
                    <h4 class="modal-title">Reservation Details</h4>
                    <button class="modal-close" id="viewModalClose">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="reservation-details-container">
                        <!-- Reservation Summary Section -->
                        <div class="details-section">
                            <div class="section-header">
                                <h5><i class="fas fa-calendar-check"></i> Reservation Summary</h5>
                            </div>
                            <div class="details-grid">
                                <div class="detail-item">
                                    <label>Reservation ID:</label>
                                    <span id="detail-id">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Service Type:</label>
                                    <span id="detail-service-type">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Date:</label>
                                    <span id="detail-date">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Time:</label>
                                    <span id="detail-time">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Status:</label>
                                    <span id="detail-status">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Created Date:</label>
                                    <span id="detail-created">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Created By:</label>
                                    <span id="detail-created-by" style="font-weight: 600; color: var(--primary-dark);">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Contact Information Section -->
                        <div class="details-section">
                            <div class="section-header">
                                <h5><i class="fas fa-user"></i> Contact Information</h5>
                            </div>
                            <div class="details-grid">
                                <div class="detail-item">
                                    <label>Full Name:</label>
                                    <span id="detail-contact-name">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Phone Number:</label>
                                    <span id="detail-contact-phone">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Email Address:</label>
                                    <span id="detail-contact-email">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Address:</label>
                                    <span id="detail-contact-address">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Service-Specific Details Section -->
                        <div class="details-section">
                            <div class="section-header">
                                <h5><i class="fas fa-info-circle"></i> Service Details</h5>
                            </div>
                            <div id="service-specific-details">
                                <!-- Content will be populated dynamically based on service type -->
                            </div>
                        </div>

                        <!-- Additional Information Section -->
                        <div class="details-section">
                            <div class="section-header">
                                <h5><i class="fas fa-sticky-note"></i> Additional Information</h5>
                            </div>
                            <div class="details-grid">
                                <div class="detail-item full-width">
                                    <label>Assigned Priest:</label>
                                    <span id="detail-priest-name">-</span>
                                </div>
                                <div class="detail-item full-width" id="priest-response-container" style="display: none;">
                                    <label style="color: #0369a1; font-weight: 600;">
                                        <i class="fas fa-comment-dots"></i> Priest Response:
                                    </label>
                                    <span id="detail-priest-response" style="color: #1e40af; font-weight: 500; background: #dbeafe; padding: 8px 12px; border-radius: 6px; display: block; margin-top: 4px; border-left: 3px solid #3b82f6;">-</span>
                                </div>
                                <div class="detail-item full-width">
                                    <label>Special Requests:</label>
                                    <span id="detail-special-requests">-</span>
                                </div>
                                <div class="detail-item full-width">
                                    <label>Notes:</label>
                                    <span id="detail-notes">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Stipendium Information Section -->
                        <div class="details-section reservation-section">
                            <div class="section-header">
                                <h5><i class="fas fa-credit-card"></i> Stipendium Information</h5>
                            </div>
                            <div class="details-grid">
                                <div class="detail-item">
                                    <label>Stipendium Status:</label>
                                    <span id="detail-payment-status">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Stipendium Type:</label>
                                    <span id="detail-payment-type">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Base Price:</label>
                                    <span id="detail-base-price">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Amount Due:</label>
                                    <span id="detail-amount-due">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Amount Paid:</label>
                                    <span id="detail-amount-paid">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Balance:</label>
                                    <span id="detail-balance">-</span>
                                </div>
                                <div class="detail-item">
                                    <label>Stipendium Method:</label>
                                    <span id="detail-payment-method">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Attendance Tracking Section -->
                        <div class="details-section" id="attendanceSection">
                            <div class="section-header">
                                <h5><i class="fas fa-user-check"></i> Attendance Status</h5>
                            </div>
                            <div class="details-grid">
                                <div class="detail-item">
                                    <label>Attendance:</label>
                                    <span id="detail-attendance-status">-</span>
                                </div>
                                <div class="detail-item" id="attendanceMarkedAtContainer" style="display: none;">
                                    <label>Marked At:</label>
                                    <span id="detail-attendance-marked-at">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="closeViewModal">Close</button>
                    
                    <!-- Attendance Action Buttons -->
                    <div class="attendance-actions" id="attendanceActions" style="display: none; margin-left: auto;">
                        <button type="button" class="btn btn-success" id="markAttendedBtn">
                            <i class="fas fa-check"></i> Mark Attended
                        </button>
                        <button type="button" class="btn btn-danger" id="markNoShowBtn">
                            <i class="fas fa-times"></i> Mark No-Show
                        </button>
                        <button type="button" class="btn btn-warning" id="markCancelledBtn">
                            <i class="fas fa-ban"></i> Mark Cancelled
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Edit Reservation Modal -->
        <div class="edit-reservation-modal" id="editReservationModal" style="display: none;">
            <div class="modal-overlay"></div>
            <div class="modal-content large-modal">
                <div class="modal-header">
                    <h4 class="modal-title">Edit Reservation</h4>
                    <button class="modal-close" id="editModalClose">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="editReservationForm">
                        <input type="hidden" id="edit-reservation-id" name="reservation_id">
                        
                        <!-- Basic Information Section -->
                        <div class="form-section">
                            <div class="section-header">
                                <h5><i class="fas fa-calendar-check"></i> Basic Information</h5>
                            </div>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="edit-service-type">Service Type</label>
                                    <select id="edit-service-type" name="service_type" class="form-control" required>
                                        <option value="wedding">Wedding (Kasal)</option>
                                        <option value="baptism">Baptism (Binyag)</option>
                                        <option value="funeral">Funeral (Burol)</option>
                                        <option value="confirmation">Confirmation (Kumpil)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="edit-date">Date</label>
                                    <input type="date" id="edit-date" name="date" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="edit-time">Time</label>
                                    <select id="edit-time" name="time" class="form-control" required>
                                        <option value="09:00">9:00 AM</option>
                                        <option value="10:00">10:00 AM</option>
                                        <option value="11:00">11:00 AM</option>
                                        <option value="12:00">12:00 PM</option>
                                        <option value="14:00">2:00 PM</option>
                                        <option value="15:00">3:00 PM</option>
                                        <option value="16:00">4:00 PM</option>
                                        <option value="17:00">5:00 PM</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Contact Information Section -->
                        <div class="form-section">
                            <div class="section-header">
                                <h5><i class="fas fa-user"></i> Contact Information</h5>
                            </div>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="edit-contact-first-name">First Name</label>
                                    <input type="text" id="edit-contact-first-name" name="contact_first_name" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="edit-contact-last-name">Last Name</label>
                                    <input type="text" id="edit-contact-last-name" name="contact_last_name" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="edit-contact-phone">Phone Number</label>
                                    <input type="tel" id="edit-contact-phone" name="contact_phone" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="edit-contact-email">Email Address</label>
                                    <input type="email" id="edit-contact-email" name="contact_email" class="form-control">
                                </div>
                            </div>
                        </div>

                        <!-- Service-Specific Details Section -->
                        <div class="form-section">
                            <div class="section-header">
                                <h5><i class="fas fa-info-circle"></i> Service Details</h5>
                            </div>
                            <div id="edit-service-specific-details">
                                <!-- Content will be populated dynamically based on service type -->
                            </div>
                        </div>

                        <!-- Priest Assignment Section -->
                        <div class="form-section">
                            <div class="section-header">
                                <h5><i class="fas fa-user-tie"></i> Priest Assignment</h5>
                                <div class="priest-status-indicator" id="edit-priest-status">
                                    <!-- Status will be populated dynamically -->
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="edit-assigned-priest">Assigned Priest</label>
                                <select id="edit-assigned-priest" name="assigned_priest" class="form-control" required>
                                    <option value="">Select a Priest</option>
                                    <option value="11111111-1111-1111-1111-111111111111">Carlos D. Cruz - Parish priest</option>
                                </select>
                                <div class="priest-change-notice" id="edit-priest-change-notice" style="display: none;">
                                    <i class="fas fa-info-circle"></i>
                                    <span>Changing the priest will send a new notification email and update the reservation status.</span>
                                </div>
                            </div>
                        </div>

                        <!-- Special Requests Section -->
                        <div class="form-section">
                            <div class="section-header">
                                <h5><i class="fas fa-sticky-note"></i> Special Requests</h5>
                            </div>
                            <div class="form-group">
                                <label for="edit-special-requests">Special Requests</label>
                                <textarea id="edit-special-requests" name="special_requests" class="form-control" rows="3" placeholder="Any special requests or notes..."></textarea>
                            </div>
                        </div>

                        <!-- Stipendium Information Section -->
                        <div class="form-section">
                            <div class="section-header">
                                <h5><i class="fas fa-credit-card"></i> Stipendium Information</h5>
                            </div>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="edit-payment-status">Stipendium Status:</label>
                                    <select id="edit-payment-status" class="form-control">
                                        <option value="">Select Status</option>
                                        <option value="Paid">Paid</option>
                                        <option value="Partial">Partial</option>
                                        <option value="Pending">Pending</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="edit-payment-type">Stipendium Type:</label>
                                    <select id="edit-payment-type" class="form-control">
                                        <option value="">Select Type</option>
                                        <option value="Full">Full</option>
                                        <option value="Partial">Partial</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="edit-base-price">Base Price:</label>
                                    <input type="number" id="edit-base-price" class="form-control" placeholder="Enter base price" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label for="edit-amount-due">Amount Due:</label>
                                    <input type="number" id="edit-amount-due" class="form-control" placeholder="Enter amount due" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label for="edit-amount-paid">Amount Paid:</label>
                                    <input type="number" id="edit-amount-paid" class="form-control" placeholder="Enter amount paid" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label for="edit-balance">Balance:</label>
                                    <input type="number" id="edit-balance" class="form-control" placeholder="Enter balance" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label for="edit-payment-method">Payment Method:</label>
                                    <select id="edit-payment-method" class="form-control">
                                        <option value="">Select Method</option>
                                        <option value="Cash">Cash</option>
                                        <option value="GCash">GCash</option>
                                        <option value="Bank Transfer">Bank Transfer</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="cancelEditModal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveReservationChanges">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>
            </div>
        </div>
        
        </div>
    </main>

    <!-- Calendar Event Details Modal -->
    <div id="calendarEventModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); z-index: 9999; justify-content: center; align-items: center; animation: fadeIn 0.2s ease-out;">
        <div class="modal-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></div>
        <div class="modal-container" style="position: relative; background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 20px; max-width: 480px; width: 90%; box-shadow: 0 25px 50px rgba(0,0,0,0.15), 0 0 0 1px rgba(255,255,255,0.8); transform: scale(1); animation: slideUp 0.3s ease-out;">
            
            <!-- Enhanced Header with Gradient -->
            <div class="modal-header" style="background: linear-gradient(135deg, #002b5c 0%, #0d1b2a 100%); padding: 28px 28px 24px 28px; text-align: center; border-radius: 20px 20px 0 0; position: relative; overflow: hidden;">
                <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.1); opacity: 0.3;"></div>
                <h3 style="margin: 0 0 8px 0; color: white; font-size: 24px; font-weight: 700; text-shadow: 0 2px 4px rgba(0,0,0,0.2); position: relative; z-index: 1;">
                    <i class="fas fa-calendar-check" style="margin-right: 8px; opacity: 0.9;"></i>
                    Reservation Details
                </h3>
                <button type="button" class="modal-close" id="closeCalendarEventModal" style="position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.2); border: none; font-size: 18px; cursor: pointer; color: white; padding: 8px; border-radius: 50%; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; z-index: 2;">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-body" style="padding: 28px;">
                <!-- Service Badge and Date/Time -->
                <div style="text-align: center; margin-bottom: 24px;">
                    <div id="calendar-detail-service" style="margin-bottom: 12px; transform: scale(1.1);"></div>
                    <div style="color: #64748b; font-size: 15px; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <i class="fas fa-calendar-alt" style="color: #d4af37; font-size: 14px;"></i>
                        <span id="calendar-detail-date"></span>
                        <span style="color: #cbd5e1;">â€¢</span>
                        <i class="fas fa-clock" style="color: #d4af37; font-size: 14px;"></i>
                        <span id="calendar-detail-time"></span>
                    </div>
                </div>
                
                <!-- Client Information Card -->
                <div style="background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%); border-radius: 16px; padding: 20px; margin-bottom: 20px; border: 1px solid rgba(148, 163, 184, 0.2); position: relative; overflow: hidden;">
                    <div style="position: absolute; top: -10px; right: -10px; width: 60px; height: 60px; background: linear-gradient(135deg, #002b5c, #d4af37); border-radius: 50%; opacity: 0.1;"></div>
                    <h4 style="margin: 0 0 16px 0; color: #334155; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-user-circle" style="color: #002b5c;"></i>
                        Client Information
                    </h4>
                    
                    <div style="display: grid; gap: 12px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="background: #002b5c; color: white; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px;">
                                <i class="fas fa-user"></i>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Name</div>
                                <div id="calendar-detail-client" style="color: #1e293b; font-weight: 600; font-size: 15px;"></div>
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="background: #228b22; color: white; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px;">
                                <i class="fas fa-phone"></i>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Phone</div>
                                <div id="calendar-detail-phone" style="color: #1e293b; font-weight: 600; font-size: 15px;"></div>
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="background: #d4af37; color: white; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px;">
                                <i class="fas fa-info-circle"></i>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Status</div>
                                <div id="calendar-detail-status"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Service-Specific Details Card -->
                <div id="calendar-service-specific-details" style="background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%); border-radius: 16px; padding: 20px; margin-bottom: 20px; border: 1px solid rgba(0, 43, 92, 0.2); position: relative; overflow: hidden;">
                    <div style="position: absolute; top: -10px; left: -10px; width: 60px; height: 60px; background: linear-gradient(135deg, #002b5c, #d4af37); border-radius: 50%; opacity: 0.1;"></div>
                    <!-- Service-specific content will be populated here -->
                </div>
            </div>

            <!-- Enhanced Footer with Better Buttons -->
            <div class="modal-footer" style="padding: 20px 28px 28px 28px; display: flex; gap: 12px; justify-content: center; border-top: 1px solid rgba(148, 163, 184, 0.1);">
                <button type="button" class="btn btn-secondary" id="closeCalendarModal" style="padding: 12px 24px; border: 2px solid #e0e0e0; background: white; color: #64748b; border-radius: 12px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.2s ease; display: flex; align-items: center; gap: 8px; min-width: 100px; justify-content: center;">
                    <i class="fas fa-times" style="font-size: 12px;"></i>
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Event Details Modal -->
    <div id="eventDetailsModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); z-index: 9999; justify-content: center; align-items: center; animation: fadeIn 0.2s ease-out;">
        <div class="modal-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></div>
        <div class="modal-container" style="position: relative; background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 20px; max-width: 480px; width: 90%; box-shadow: 0 25px 50px rgba(0,0,0,0.15), 0 0 0 1px rgba(255,255,255,0.8); transform: scale(1); animation: slideUp 0.3s ease-out;">
            
            <!-- Enhanced Header with Gradient -->
            <div class="modal-header" style="background: linear-gradient(135deg, #002b5c 0%, #0d1b2a 100%); padding: 28px 28px 24px 28px; text-align: center; border-radius: 20px 20px 0 0; position: relative; overflow: hidden;">
                <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.1); opacity: 0.3;"></div>
                <h3 style="margin: 0 0 8px 0; color: white; font-size: 24px; font-weight: 700; text-shadow: 0 2px 4px rgba(0,0,0,0.2); position: relative; z-index: 1;">
                    <i class="fas fa-calendar-alt" style="margin-right: 8px; opacity: 0.9;"></i>
                    Event Details
                </h3>
                <button type="button" class="modal-close" id="closeEventDetailsModal" style="position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.2); border: none; font-size: 18px; cursor: pointer; color: white; padding: 8px; border-radius: 50%; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; z-index: 2;">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-body" style="padding: 28px;">
                <!-- Event Type Badge and Date/Time -->
                <div style="text-align: center; margin-bottom: 24px;">
                    <div id="event-detail-type" style="margin-bottom: 12px; transform: scale(1.1);"></div>
                    <div style="color: #64748b; font-size: 15px; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <i class="fas fa-calendar-alt" style="color: #d4af37; font-size: 14px;"></i>
                        <span id="event-detail-date"></span>
                        <span style="color: #cbd5e1;">â€¢</span>
                        <i class="fas fa-clock" style="color: #d4af37; font-size: 14px;"></i>
                        <span id="event-detail-time"></span>
                    </div>
                </div>
                
                <!-- Event Information Card -->
                <div style="background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%); border-radius: 16px; padding: 20px; margin-bottom: 20px; border: 1px solid rgba(148, 163, 184, 0.2); position: relative; overflow: hidden;">
                    <div style="position: absolute; top: -10px; right: -10px; width: 60px; height: 60px; background: linear-gradient(135deg, #002b5c, #d4af37); border-radius: 50%; opacity: 0.1;"></div>
                    <h4 style="margin: 0 0 16px 0; color: #334155; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-calendar-check" style="color: #002b5c;"></i>
                        Event Information
                    </h4>
                    
                    <div style="display: grid; gap: 12px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="background: #002b5c; color: white; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px;">
                                <i class="fas fa-tag"></i>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Event Name</div>
                                <div id="event-detail-name" style="color: #1e293b; font-weight: 600; font-size: 15px;"></div>
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="background: #228b22; color: white; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px;">
                                <i class="fas fa-user-tie"></i>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Assigned Priest</div>
                                <div id="event-detail-priest" style="color: #1e293b; font-weight: 600; font-size: 15px;"></div>
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="background: #d4af37; color: white; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px;">
                                <i class="fas fa-info-circle"></i>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Status</div>
                                <div id="event-detail-status"></div>
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="background: #0891b2; color: white; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px;">
                                <i class="fas fa-user-edit"></i>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Created By</div>
                                <div id="event-detail-created-by" style="color: #1e293b; font-weight: 600; font-size: 15px;">-</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Event Description Card -->
                <div style="background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%); border-radius: 16px; padding: 20px; margin-bottom: 20px; border: 1px solid rgba(0, 43, 92, 0.2); position: relative; overflow: hidden;">
                    <div style="position: absolute; top: -10px; left: -10px; width: 60px; height: 60px; background: linear-gradient(135deg, #002b5c, #d4af37); border-radius: 50%; opacity: 0.1;"></div>
                    <h4 style="margin: 0 0 12px 0; color: #334155; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-file-alt" style="color: #002b5c;"></i>
                        Description
                    </h4>
                    <div id="event-detail-description" style="color: #64748b; font-size: 14px; line-height: 1.6; font-style: italic;"></div>
                </div>
            </div>

            <!-- Enhanced Footer with Better Buttons -->
            <div class="modal-footer" style="padding: 20px 28px 28px 28px; display: flex; gap: 12px; justify-content: center; border-top: 1px solid rgba(148, 163, 184, 0.1);">
                <button type="button" class="btn btn-secondary" id="closeEventModal" style="padding: 12px 24px; border: 2px solid #e0e0e0; background: white; color: #64748b; border-radius: 12px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.2s ease; display: flex; align-items: center; gap: 8px; min-width: 100px; justify-content: center;">
                    <i class="fas fa-times" style="font-size: 12px;"></i>
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Event Modal -->
    <div id="editEventModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); z-index: 9999; justify-content: center; align-items: center; animation: fadeIn 0.2s ease-out;">
        <div class="modal-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></div>
        <div class="modal-container" style="position: relative; background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 20px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 25px 50px rgba(0,0,0,0.15), 0 0 0 1px rgba(255,255,255,0.8); transform: scale(1); animation: slideUp 0.3s ease-out;">
            
            <!-- Enhanced Header with Gradient -->
            <div class="modal-header" style="background: linear-gradient(135deg, #002b5c 0%, #0d1b2a 100%); padding: 28px 28px 24px 28px; text-align: center; border-radius: 20px 20px 0 0; position: relative; overflow: hidden;">
                <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.1); opacity: 0.3;"></div>
                <h3 style="margin: 0 0 8px 0; color: white; font-size: 24px; font-weight: 700; text-shadow: 0 2px 4px rgba(0,0,0,0.2); position: relative; z-index: 1;">
                    <i class="fas fa-edit" style="margin-right: 8px; opacity: 0.9;"></i>
                    Edit Event
                </h3>
                <button type="button" class="modal-close" id="closeEditEventModal" style="position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.2); border: none; font-size: 18px; cursor: pointer; color: white; padding: 8px; border-radius: 50%; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; z-index: 2;">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-body" style="padding: 28px;">
                <form id="editEventForm">
                    <!-- Event Information -->
                    <div style="background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%); border-radius: 16px; padding: 20px; margin-bottom: 20px; border: 1px solid rgba(148, 163, 184, 0.2);">
                        <h4 style="margin: 0 0 16px 0; color: #334155; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-info-circle" style="color: #002b5c;"></i>
                            Event Information
                        </h4>
                        
                        <div style="display: grid; gap: 16px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                <div>
                                    <label style="display: block; font-size: 12px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">Event Name *</label>
                                    <input type="text" id="editEventName" required style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; transition: border-color 0.2s;">
                                </div>
                                <div>
                                    <label style="display: block; font-size: 12px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">Event Type *</label>
                                    <select id="editEventType" required style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                                        <option value="">Select Type</option>
                                        <option value="worship">Worship</option>
                                        <option value="prayer">Prayer</option>
                                        <option value="youth">Youth</option>
                                        <option value="outreach">Outreach</option>
                                        <option value="special">Special</option>
                                        <option value="bible-study">Bible Study</option>
                                        <option value="fellowship">Fellowship</option>
                                        <option value="meeting">Meeting</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
                                <div>
                                    <label style="display: block; font-size: 12px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">Date *</label>
                                    <input type="date" id="editEventDate" required style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                                </div>
                                <div>
                                    <label style="display: block; font-size: 12px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">Start Time *</label>
                                    <input type="time" id="editEventStartTime" required style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                                </div>
                                <div>
                                    <label style="display: block; font-size: 12px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">End Time</label>
                                    <input type="time" id="editEventEndTime" style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                                </div>
                            </div>
                            
                            
                            <div>
                                <label style="display: block; font-size: 12px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">Description</label>
                                <textarea id="editEventDescription" rows="3" style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; resize: vertical;"></textarea>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Enhanced Footer with Better Buttons -->
            <div class="modal-footer" style="padding: 20px 28px 28px 28px; display: flex; gap: 12px; justify-content: center; border-top: 1px solid rgba(148, 163, 184, 0.1);">
                <button type="button" class="btn btn-secondary" id="cancelEditEvent" style="padding: 12px 24px; border: 2px solid #e0e0e0; background: white; color: #64748b; border-radius: 12px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.2s ease; display: flex; align-items: center; gap: 8px; min-width: 100px; justify-content: center;">
                    <i class="fas fa-times" style="font-size: 12px;"></i>
                    Cancel
                </button>
                <button type="submit" form="editEventForm" class="btn btn-primary" id="saveEditEvent" style="padding: 12px 24px; border: 2px solid #002b5c; background: #002b5c; color: white; border-radius: 12px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.2s ease; display: flex; align-items: center; gap: 8px; min-width: 100px; justify-content: center;">
                    <i class="fas fa-save" style="font-size: 12px;"></i>
                    Save Changes
                </button>
            </div>
        </div>
    </div>


    <style>
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        #calendarEventModal .modal-close:hover {
            background: rgba(255,255,255,0.3) !important;
            transform: scale(1.1);
        }
        
        #calendarEventModal .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        #calendarEventModal .btn-secondary:hover {
            border-color: #cbd5e1;
            background: #f8fafc;
        }
        
        #calendarEventModal .btn-danger:hover {
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
        }

        /* Print Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .print-modal {
            background: white;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        }
        
        .reservation-modal .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
            margin: 0;
            flex: 1;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 18px;
            color: #6b7280;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        .modal-close:hover {
            background-color: #f3f4f6;
            color: #374151;
        }
        
        .modal-body {
            padding: 24px;
        }
        
        .modal-footer {
            padding: 20px 24px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
        
        .print-section-title {
            font-size: 16px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 16px;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 8px;
        }
        
        .print-checkbox-group {
            margin-bottom: 12px;
        }
        
        .print-checkbox-item {
            display: flex;
            align-items: flex-start;
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .print-checkbox-item:hover {
            border-color: #3b82f6;
            background-color: #f8fafc;
        }
        
        .print-checkbox-item input[type="checkbox"] {
            margin-right: 12px;
            margin-top: 2px;
        }
        
        .print-option-info strong {
            display: block;
            color: #1f2937;
            margin-bottom: 4px;
        }
        
        .print-option-info p {
            color: #6b7280;
            font-size: 14px;
            margin: 0;
        }
        
        .print-settings {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #e5e7eb;
        }
        
        .print-setting-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .print-setting-row label {
            min-width: 120px;
            font-weight: 500;
            color: #374151;
        }
        
        .print-setting-row select {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background-color: white;
        }
        
        /* Print Styles */
        @media print {
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            body {
                margin: 0;
                padding: 20px;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                font-size: 12px;
                line-height: 1.4;
            }
            
            .print-content {
                width: 100%;
                max-width: none;
            }
            
            .print-header {
                text-align: center;
                margin-bottom: 30px;
                border-bottom: 2px solid #333;
                padding-bottom: 20px;
            }
            
            .print-header h1 {
                font-size: 24px;
                color: #333;
                margin: 0 0 10px 0;
            }
            
            .print-header p {
                color: #666;
                margin: 0;
            }
            
            .print-section {
                margin-bottom: 30px;
                page-break-inside: avoid;
            }
            
            .print-section h2 {
                font-size: 18px;
                color: #333;
                border-bottom: 1px solid #ccc;
                padding-bottom: 8px;
                margin-bottom: 15px;
            }
            
            .print-stats-grid {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
                margin-bottom: 20px;
            }
            
            .print-stat-card {
                border: 1px solid #ddd;
                padding: 15px;
                border-radius: 8px;
                text-align: center;
            }
            
            .print-stat-value {
                font-size: 24px;
                font-weight: bold;
                color: #333;
                margin-bottom: 5px;
            }
            
            .print-stat-label {
                color: #666;
                font-size: 14px;
            }
            
            .print-chart-container {
                text-align: center;
                margin: 20px 0;
                page-break-inside: avoid;
            }
            
            .print-chart-container canvas {
                max-width: 100%;
                height: auto !important;
            }
            
            .print-footer {
                position: fixed;
                bottom: 20px;
                left: 20px;
                right: 20px;
                text-align: center;
                font-size: 10px;
                color: #666;
                border-top: 1px solid #ccc;
                padding-top: 10px;
            }
            
            /* Hide non-printable elements */
            .no-print,
            .modal-overlay,
            .nav-sidebar,
            .page-header,
            button,
            .btn {
                display: none !important;
            }
        }

        /* Enhanced Header Styles */
        .enhanced-header {
            background: linear-gradient(135deg, #002b5c 0%, #0d1b2a 100%);
            border-radius: 0 0 16px 16px;
            padding: 20px 32px;
            margin-bottom: 24px;
            color: white;
            position: relative;
            overflow: hidden;
            border: none;
            box-shadow: 0 6px 24px rgba(76, 99, 210, 0.25);
        }
        
        .enhanced-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 1;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .menu-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .menu-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .header-info .breadcrumb {
            margin-bottom: 8px;
        }
        
        .header-info .breadcrumb a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            font-size: 0.875rem;
        }
        
        .header-info .breadcrumb i {
            color: rgba(255, 255, 255, 0.6);
            margin: 0 8px;
            font-size: 0.75rem;
        }
        
        .header-info .breadcrumb span {
            color: white;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .enhanced-title {
            font-size: 1.4rem;
            font-weight: 600;
            margin: 0 0 4px 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            color: white !important;
        }
        
        .enhanced-subtitle {
            font-size: 0.875rem;
            opacity: 0.9;
            margin: 0;
            color: rgba(255, 255, 255, 0.9);
        }
        
        @media (max-width: 768px) {
            .enhanced-header {
                padding: 16px 20px;
            }
            
            .header-content {
                flex-direction: row;
                align-items: center;
            }
            
            .menu-toggle {
                margin-right: 16px;
            }
            
            .enhanced-title {
                font-size: 1.2rem;
            }
            
            .enhanced-subtitle {
                font-size: 0.8rem;
            }
        }

    </style>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='tailwind-compiled.css') }}">
    
    <!-- FullCalendar CSS and JS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.5/main.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.5/main.min.js"></script>
    
    <script src="{{ url_for('static', filename='philippine-holidays.js') }}"></script>
    <script src="{{ url_for('static', filename='mobile-navigation.js') }}"></script>
    <script src="{{ url_for('static', filename='dashboard-enhanced.js') }}"></script>
    <script src="{{ url_for('static', filename='reservation-table.js') }}"></script>
    <script src="{{ url_for('static', filename='events-table.js') }}"></script>
    <script src="{{ url_for('static', filename='calendar-reservation.js') }}"></script>
    <script src="{{ url_for('static', filename='calendar-events.js') }}"></script>
</script>
    <script>
        // Initialize Calendar Reservation System
        let calendarReservationSystem;
        
        // Load Dashboard Statistics
        async function loadDashboardStats() {
            try {
                console.log('Loading dashboard statistics...');
                const response = await fetch('/api/dashboard/stats');
                const stats = await response.json();
                
                console.log('Dashboard stats received:', stats);
                
                // Update Today's Reservations
                const todayReservationsEl = document.getElementById('todayReservations');
                if (todayReservationsEl) {
                    todayReservationsEl.textContent = stats.today_reservations || 0;
                }
                
                // Update progress bar for today
                const todayProgress = document.getElementById('todayProgress');
                if (todayProgress) {
                    const todayPercentage = Math.min((stats.today_reservations || 0) * 10, 100); // 10 reservations = 100%
                    todayProgress.style.width = todayPercentage + '%';
                }
                
                // Update This Week's Reservations
                const weekReservationsEl = document.getElementById('weekReservations');
                if (weekReservationsEl) {
                    weekReservationsEl.textContent = stats.week_reservations || 0;
                }
                
                // Update progress bar for week
                const weekProgress = document.getElementById('weekProgress');
                if (weekProgress) {
                    const weekPercentage = Math.min((stats.week_reservations || 0) * 5, 100); // 20 reservations = 100%
                    weekProgress.style.width = weekPercentage + '%';
                }
                
                // Update Pending Approvals
                const pendingApprovalsEl = document.getElementById('pendingApprovals');
                if (pendingApprovalsEl) {
                    pendingApprovalsEl.textContent = stats.pending_priest_approvals || 0;
                }
                
                // Update progress bar for pending
                const pendingProgress = document.getElementById('pendingProgress');
                if (pendingProgress) {
                    const pendingPercentage = Math.min((stats.pending_priest_approvals || 0) * 10, 100); // 10 pending = 100%
                    pendingProgress.style.width = pendingPercentage + '%';
                }
                
                // Update This Month's Revenue
                const revenue = stats.month_revenue || 0;
                const monthRevenueEl = document.getElementById('monthRevenue');
                if (monthRevenueEl) {
                    monthRevenueEl.textContent = 'â‚±' + revenue.toLocaleString('en-PH', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                }
                
                // Update progress bar for revenue
                const revenueProgress = document.getElementById('revenueProgress');
                if (revenueProgress) {
                    const revenuePercentage = Math.min((revenue / 100000) * 100, 100); // â‚±100,000 = 100%
                    revenueProgress.style.width = revenuePercentage + '%';
                }
                
                console.log('Dashboard statistics updated successfully');
                console.log('Stats breakdown:', {
                    today: stats.today_reservations,
                    week: stats.week_reservations,
                    pending: stats.pending_priest_approvals,
                    revenue: revenue
                });
            } catch (error) {
                console.error('Error loading dashboard stats:', error);
                // Set error state with null checks
                const todayReservationsEl = document.getElementById('todayReservations');
                if (todayReservationsEl) todayReservationsEl.textContent = 'Error';
                
                const weekReservationsEl = document.getElementById('weekReservations');
                if (weekReservationsEl) weekReservationsEl.textContent = 'Error';
                
                const pendingApprovalsEl = document.getElementById('pendingApprovals');
                if (pendingApprovalsEl) pendingApprovalsEl.textContent = 'Error';
                
                const monthRevenueEl = document.getElementById('monthRevenue');
                if (monthRevenueEl) monthRevenueEl.textContent = 'Error';
            }
        }
        
        // Load Today's Schedule
        async function loadTodaySchedule() {
            try {
                console.log('Loading today\'s schedule...');
                const response = await fetch('/api/dashboard/today-schedule');
                const result = await response.json();
                
                console.log('Today\'s schedule received:', result);
                
                // Update schedule date
                const today = new Date();
                const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('scheduleDate').textContent = '(' + today.toLocaleDateString('en-US', dateOptions) + ')';
                
                const scheduleContent = document.getElementById('scheduleContent');
                
                if (!result.success || result.data.length === 0) {
                    // No reservations today
                    scheduleContent.innerHTML = `
                        <div style="padding: 60px 40px; text-align: center;">
                            <i class="fas fa-calendar-check" style="font-size: 64px; color: #e0e0e0; margin-bottom: 20px;"></i>
                            <h3 style="color: #666; margin-bottom: 10px; font-weight: 500;">No Reservations Today</h3>
                            <p style="color: #999; font-size: 14px;">You have a clear schedule for today. Enjoy your day!</p>
                        </div>
                    `;
                    return;
                }
                
                // Build schedule items HTML
                let scheduleHTML = '<div style="padding: 0;">';
                
                result.data.forEach((item, index) => {
                    const serviceColors = {
                        'wedding': '#f59e0b',
                        'baptism': '#3b82f6',
                        'funeral': '#6b7280',
                        'confirmation': '#8b5cf6'
                    };
                    
                    const serviceIcons = {
                        'wedding': 'fa-ring',
                        'baptism': 'fa-baby',
                        'funeral': 'fa-cross',
                        'confirmation': 'fa-hands-praying'
                    };
                    
                    const statusColors = {
                        'pending': '#f59e0b',
                        'approved': '#10b981',
                        'confirmed': '#10b981',
                        'waiting_priest_approval': '#f59e0b'
                    };
                    
                    const serviceColor = serviceColors[item.service_type] || '#6b7280';
                    const serviceIcon = serviceIcons[item.service_type] || 'fa-calendar';
                    const statusColor = statusColors[item.status] || '#6b7280';
                    
                    scheduleHTML += `
                        <div style="padding: 20px 30px; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; gap: 20px; transition: background 0.2s;" 
                             onmouseover="this.style.background='#f9fafb'" 
                             onmouseout="this.style.background='white'">
                            
                            <!-- Time -->
                            <div style="min-width: 100px;">
                                <div style="font-size: 18px; font-weight: 600; color: #1f2937;">
                                    <i class="fas fa-clock" style="color: var(--primary); margin-right: 8px;"></i>
                                    ${item.time_slot}
                                </div>
                            </div>
                            
                            <!-- Service Badge -->
                            <div style="min-width: 120px;">
                                <span style="display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; 
                                             background: ${serviceColor}20; color: ${serviceColor}; 
                                             border-radius: 20px; font-size: 12px; font-weight: 600; text-transform: uppercase;">
                                    <i class="fas ${serviceIcon}"></i>
                                    ${item.service_type}
                                </span>
                            </div>
                            
                            <!-- Client Info -->
                            <div style="flex: 1;">
                                <div style="font-weight: 600; color: #1f2937; margin-bottom: 4px;">
                                    <i class="fas fa-user" style="color: #6b7280; margin-right: 8px;"></i>
                                    ${item.client_name}
                                </div>
                                <div style="font-size: 13px; color: #6b7280;">
                                    <i class="fas fa-phone" style="margin-right: 8px;"></i>
                                    ${item.client_phone}
                                </div>
                            </div>
                            
                            <!-- Priest -->
                            <div style="min-width: 180px;">
                                <div style="font-size: 13px; color: #6b7280;">
                                    <i class="fas fa-user-tie" style="color: var(--primary); margin-right: 8px;"></i>
                                    ${item.priest_name}
                                </div>
                            </div>
                            
                            <!-- Status -->
                            <div style="min-width: 100px;">
                                <span style="display: inline-block; padding: 4px 10px; 
                                             background: ${statusColor}20; color: ${statusColor}; 
                                             border-radius: 12px; font-size: 11px; font-weight: 600; text-transform: uppercase;">
                                    ${item.status.replace('_', ' ')}
                                </span>
                            </div>
                            
                            <!-- Actions -->
                            <div>
                                <button onclick="viewReservation('${item.id}')" 
                                        style="padding: 8px 16px; background: var(--primary); color: white; 
                                               border: none; border-radius: 6px; cursor: pointer; font-size: 13px;
                                               transition: all 0.2s;"
                                        onmouseover="this.style.background='#001f3f'"
                                        onmouseout="this.style.background='var(--primary)'">
                                    <i class="fas fa-eye"></i> View
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                scheduleHTML += '</div>';
                scheduleContent.innerHTML = scheduleHTML;
                
                console.log('Today\'s schedule loaded successfully');
            } catch (error) {
                console.error('Error loading today\'s schedule:', error);
                document.getElementById('scheduleContent').innerHTML = `
                    <div style="padding: 40px; text-align: center; color: #ef4444;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 32px; margin-bottom: 10px;"></i>
                        <p>Error loading schedule. Please try again.</p>
                    </div>
                `;
            }
        }
        
        // Load Recent Activities
        async function loadRecentActivities() {
            try {
                console.log('Loading recent activities...');
                const response = await fetch('/api/dashboard/recent-activities');
                const result = await response.json();
                
                console.log('Recent activities received:', result);
                
                const activitiesContent = document.getElementById('activitiesContent');
                
                if (!result.success || result.data.length === 0) {
                    // No activities
                    activitiesContent.innerHTML = `
                        <div style="padding: 60px 40px; text-align: center;">
                            <i class="fas fa-inbox" style="font-size: 64px; color: #e0e0e0; margin-bottom: 20px;"></i>
                            <h3 style="color: #666; margin-bottom: 10px; font-weight: 500;">No Recent Activities</h3>
                            <p style="color: #999; font-size: 14px;">Activity feed will appear here as reservations are created and updated.</p>
                        </div>
                    `;
                    return;
                }
                
                // Build activities HTML
                let activitiesHTML = '<div style="padding: 0;">';
                
                result.data.forEach((activity, index) => {
                    // Calculate time ago
                    const timestamp = new Date(activity.timestamp);
                    const now = new Date();
                    const diffMs = now - timestamp;
                    const diffMins = Math.floor(diffMs / 60000);
                    const diffHours = Math.floor(diffMs / 3600000);
                    const diffDays = Math.floor(diffMs / 86400000);
                    
                    let timeAgo;
                    if (diffMins < 1) {
                        timeAgo = 'Just now';
                    } else if (diffMins < 60) {
                        timeAgo = diffMins + ' min' + (diffMins > 1 ? 's' : '') + ' ago';
                    } else if (diffHours < 24) {
                        timeAgo = diffHours + ' hour' + (diffHours > 1 ? 's' : '') + ' ago';
                    } else if (diffDays < 7) {
                        timeAgo = diffDays + ' day' + (diffDays > 1 ? 's' : '') + ' ago';
                    } else {
                        timeAgo = timestamp.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    }
                    
                    activitiesHTML += `
                        <div style="padding: 16px 24px; border-bottom: 1px solid #f0f0f0; display: flex; align-items: flex-start; gap: 16px; transition: background 0.2s;"
                             onmouseover="this.style.background='#f9fafb'"
                             onmouseout="this.style.background='white'">
                            
                            <!-- Icon -->
                            <div style="min-width: 40px; height: 40px; border-radius: 50%; 
                                        background: ${activity.color}20; display: flex; align-items: center; 
                                        justify-content: center; flex-shrink: 0;">
                                <i class="fas ${activity.icon}" style="color: ${activity.color}; font-size: 18px;"></i>
                            </div>
                            
                            <!-- Content -->
                            <div style="flex: 1; min-width: 0;">
                                <div style="font-weight: 500; color: #1f2937; margin-bottom: 4px; line-height: 1.4;">
                                    ${activity.message}
                                </div>
                                <div style="font-size: 13px; color: #6b7280; margin-bottom: 4px;">
                                    ${activity.details}
                                </div>
                                <div style="font-size: 12px; color: #9ca3af;">
                                    <i class="fas fa-clock" style="margin-right: 4px;"></i>
                                    ${timeAgo}
                                </div>
                            </div>
                            
                            <!-- Reservation ID Badge -->
                            <div style="flex-shrink: 0;">
                                <span style="display: inline-block; padding: 4px 10px; 
                                             background: #f3f4f6; color: #6b7280; 
                                             border-radius: 12px; font-size: 11px; font-weight: 600;">
                                    ${activity.reservation_id}
                                </span>
                            </div>
                        </div>
                    `;
                });
                
                activitiesHTML += '</div>';
                activitiesContent.innerHTML = activitiesHTML;
                
                console.log('Recent activities loaded successfully');
            } catch (error) {
                console.error('Error loading recent activities:', error);
                document.getElementById('activitiesContent').innerHTML = `
                    <div style="padding: 40px; text-align: center; color: #ef4444;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 32px; margin-bottom: 10px;"></i>
                        <p>Error loading activities. Please try again.</p>
                    </div>
                `;
            }
        }
        
        // Handle reservation navigation
        document.addEventListener('DOMContentLoaded', function() {
            // ============================================================================
            // ENHANCED DASHBOARD FEATURES
            // ============================================================================
            
            // Initialize AOS (Animate On Scroll)
            if (typeof AOS !== 'undefined') {
                AOS.init({
                    duration: 800,
                    easing: 'ease-in-out',
                    once: true,
                    offset: 100
                });
            }
            
            // Animated Counter Function
            function animateCounter(element, target, duration = 1500) {
                if (!element) return;
                
                const start = 0;
                const increment = target / (duration / 16);
                let current = start;
                
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= target) {
                        element.textContent = Math.round(target);
                        clearInterval(timer);
                    } else {
                        element.textContent = Math.round(current);
                    }
                }, 16);
            }
            
            // Real-time Clock in Header
            function addRealTimeClock() {
                const headerRight = document.querySelector('.header-content');
                if (headerRight && !document.getElementById('realTimeClock')) {
                    const clockElement = document.createElement('div');
                    clockElement.id = 'realTimeClock';
                    clockElement.style.cssText = `
                        font-family: 'Poppins', sans-serif;
                        font-weight: 500;
                        color: rgba(255, 255, 255, 0.9);
                        font-size: 0.875rem;
                        padding: 8px 16px;
                        background: rgba(255, 255, 255, 0.15);
                        border-radius: 8px;
                        border: 1px solid rgba(255, 255, 255, 0.2);
                        backdrop-filter: blur(10px);
                    `;
                    headerRight.appendChild(clockElement);
                    
                    function updateClock() {
                        const now = new Date();
                        const options = {
                            weekday: 'short',
                            year: 'numeric',
                            month: 'short',
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit'
                        };
                        clockElement.textContent = now.toLocaleDateString('en-US', options);
                    }
                    
                    updateClock();
                    setInterval(updateClock, 1000);
                }
            }
            
            // Notification System
            function showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 16px 24px;
                    background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
                    color: white;
                    border-radius: 12px;
                    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
                    z-index: 10000;
                    font-family: 'Poppins', sans-serif;
                    font-weight: 500;
                    transform: translateX(400px);
                    transition: transform 0.3s ease;
                    display: flex;
                    align-items: center;
                    gap: 12px;
                `;
                
                const icon = document.createElement('i');
                icon.className = type === 'success' ? 'fas fa-check-circle' : type === 'error' ? 'fas fa-exclamation-circle' : 'fas fa-info-circle';
                notification.appendChild(icon);
                
                const text = document.createElement('span');
                text.textContent = message;
                notification.appendChild(text);
                
                document.body.appendChild(notification);
                
                // Animate in
                setTimeout(() => {
                    notification.style.transform = 'translateX(0)';
                }, 100);
                
                // Remove after 3 seconds
                setTimeout(() => {
                    notification.style.transform = 'translateX(400px)';
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            }
            
            // Make notification function globally accessible
            window.showNotification = showNotification;
            
            // Add real-time clock
            addRealTimeClock();
            
            // Dynamic Greeting based on time of day
            function updateGreeting() {
                const greetingElement = document.getElementById('dynamicGreeting');
                if (greetingElement) {
                    const hour = new Date().getHours();
                    let greeting = 'Good Morning';
                    
                    if (hour >= 12 && hour < 18) {
                        greeting = 'Good Afternoon';
                    } else if (hour >= 18) {
                        greeting = 'Good Evening';
                    }
                    
                    const currentText = greetingElement.textContent;
                    const nameMatch = currentText.match(/,\s*(.+?)!/);
                    const name = nameMatch ? nameMatch[1] : 'Secretary';
                    
                    greetingElement.textContent = `${greeting}, ${name}! ðŸ‘‹`;
                }
            }
            
            // Update greeting on page load
            updateGreeting();
            
            // Load dashboard statistics on page load
            loadDashboardStats();
            
            // Load today's schedule
            loadTodaySchedule();
            
            // Load recent activities
            loadRecentActivities();
            
            // Prevent multiple initialization
            if (window.calendarReservationSystem) {
                console.log('Calendar system already initialized, skipping...');
                return;
            }
            
            // Initialize the calendar reservation system when the page loads
            calendarReservationSystem = new CalendarReservationSystem();
            // Make it globally accessible for other modules
            window.calendarReservationSystem = calendarReservationSystem;
            window.calendarSystem = calendarReservationSystem; // For export functions
            
            
            // Initialize tab switching for reservation and events modules
            initializeTabs();
            
            // Initialize reservation table manager
            setTimeout(() => {
                window.reservationTable = new ReservationTableManager();
                console.log('ReservationTableManager initialized');
                
                // Initialize events table manager
                window.eventsTable = new EventsTableManager();
                console.log('EventsTableManager initialized');
                
                // Initialize events calendar system
                window.eventsCalendarSystem = new EventsCalendarSystem();
                console.log('EventsCalendarSystem initialized');
                
                // Add direct search functionality as fallback
                const searchInput = document.getElementById('nameSearchInput');
                if (searchInput) {
                    console.log('Search input found, adding event listener');
                    searchInput.addEventListener('input', function(e) {
                        const query = e.target.value;
                        console.log('Direct search input:', query);
                        
                        if (window.reservationTable && window.reservationTable.searchReservations) {
                            window.reservationTable.searchReservations(query);
                        } else {
                            console.log('ReservationTableManager not available');
                            // Manual search fallback
                            manualSearch(query);
                        }
                        
                        // Show/hide clear button
                        const clearBtn = document.getElementById('clearSearch');
                        if (clearBtn) {
                            clearBtn.style.display = query.trim() ? 'block' : 'none';
                        }
                    });
                } else {
                    console.log('Search input not found');
                }
                
                // Clear search button
                const clearBtn = document.getElementById('clearSearch');
                if (clearBtn) {
                    clearBtn.addEventListener('click', function() {
                        const searchInput = document.getElementById('nameSearchInput');
                        if (searchInput) {
                            searchInput.value = '';
                            if (window.reservationTable && window.reservationTable.searchReservations) {
                                window.reservationTable.searchReservations('');
                            } else {
                                manualSearch('');
                            }
                            this.style.display = 'none';
                        }
                    });
                }
            }, 500);
            
            // Manual search fallback function
            function manualSearch(query) {
                console.log('Manual search for:', query);
                const tableBody = document.getElementById('reservationsTableBody');
                if (!tableBody) return;
                
                const rows = tableBody.querySelectorAll('tr');
                rows.forEach(row => {
                    if (!query.trim()) {
                        row.style.display = '';
                        return;
                    }
                    
                    const text = row.textContent.toLowerCase();
                    const searchTerm = query.toLowerCase();
                    
                    if (text.includes(searchTerm)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            }
            
            // Initialize refresh button for reservations table
            const refreshBtn = document.getElementById('refreshReservations');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', function() {
                    // Save current scroll position
                    const scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
                    
                    // Add visual feedback to table
                    const tableContainer = document.querySelector('.reservations-table-container');
                    const table = document.querySelector('#reservationsTableBody');
                    
                    // Show loading state on button
                    this.disabled = true;
                    this.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Refreshing...</span>';
                    this.style.backgroundColor = '#002b5c';
                    this.style.color = 'white';
                    
                    // Add loading overlay to table
                    if (tableContainer) {
                        tableContainer.style.opacity = '0.6';
                        tableContainer.style.pointerEvents = 'none';
                    }
                    
                    // Refresh only the reservations table
                    if (window.reservationTable && window.reservationTable.loadReservations) {
                        console.log('Starting refresh...');
                        window.reservationTable.loadReservations().then(() => {
                            console.log('Refresh successful');
                            
                            // Reset button state immediately to normal
                            this.disabled = false;
                            this.innerHTML = '<i class="fas fa-sync-alt"></i><span>Refresh</span>';
                            this.style.backgroundColor = '';
                            this.style.color = '';
                            
                            // Remove table loading overlay
                            if (tableContainer) {
                                tableContainer.style.opacity = '1';
                                tableContainer.style.pointerEvents = 'auto';
                            }
                            
                            // Restore scroll position
                            setTimeout(() => {
                                window.scrollTo(0, scrollPosition);
                            }, 100);
                        }).catch((error) => {
                            console.log('Refresh error:', error);
                            // Reset button state immediately to normal even on error
                            this.disabled = false;
                            this.innerHTML = '<i class="fas fa-sync-alt"></i><span>Refresh</span>';
                            this.style.backgroundColor = '';
                            this.style.color = '';
                            
                            // Remove table loading overlay
                            if (tableContainer) {
                                tableContainer.style.opacity = '1';
                                tableContainer.style.pointerEvents = 'auto';
                            }
                            
                            // Restore scroll position even on error
                            setTimeout(() => {
                                window.scrollTo(0, scrollPosition);
                            }, 100);
                        });
                    } else {
                        // Fallback: show success state even if reservationTable not found
                        console.log('reservationTable not found, showing success anyway');
                        setTimeout(() => {
                            // Reset button state immediately to normal
                            this.disabled = false;
                            this.innerHTML = '<i class="fas fa-sync-alt"></i><span>Refresh</span>';
                            this.style.backgroundColor = '';
                            this.style.color = '';
                            
                            // Remove table loading overlay
                            if (tableContainer) {
                                tableContainer.style.opacity = '1';
                                tableContainer.style.pointerEvents = 'auto';
                            }
                            
                            // Restore scroll position
                            setTimeout(() => {
                                window.scrollTo(0, scrollPosition);
                            }, 100);
                        }, 1000);
                    }
                });
            }
            
            // Initialize refresh button for today's schedule
            const refreshScheduleBtn = document.getElementById('refreshSchedule');
            if (refreshScheduleBtn) {
                refreshScheduleBtn.addEventListener('click', function() {
                    // Show loading state
                    this.disabled = true;
                    this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Refreshing...';
                    
                    // Reload schedule
                    loadTodaySchedule().then(() => {
                        // Reset button
                        this.disabled = false;
                        this.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh';
                    }).catch(() => {
                        // Reset button even on error
                        this.disabled = false;
                        this.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh';
                    });
                });
            }
            
            // Initialize refresh button for recent activities
            const refreshActivitiesBtn = document.getElementById('refreshActivities');
            if (refreshActivitiesBtn) {
                refreshActivitiesBtn.addEventListener('click', function() {
                    // Show loading state
                    this.disabled = true;
                    this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Refreshing...';
                    
                    // Reload activities
                    loadRecentActivities().then(() => {
                        // Reset button
                        this.disabled = false;
                        this.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh';
                    }).catch(() => {
                        // Reset button even on error
                        this.disabled = false;
                        this.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh';
                    });
                });
            }
            
            // Reservation link click handler
            document.getElementById('reservationsLink').addEventListener('click', function(e) {
                e.preventDefault();
                console.log('Reservations link clicked!'); // Debug log
                
                // Update active navigation
                document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
                this.classList.add('active');
                
                // Hide dashboard content and events modules
                document.getElementById('dashboardContent').style.display = 'none';
                const eventsModule = document.getElementById('eventsModule');
                if (eventsModule) {
                    eventsModule.style.display = 'none';
                }
                
                // Show reservation module
                const reservationModule = document.getElementById('reservationModule');
                if (reservationModule) {
                    reservationModule.style.display = 'block';
                    console.log('Reservation module shown!'); // Debug log
                } else {
                    console.error('Reservation module not found!'); // Debug log
                }
                
                // Update page title and subtitle
                const pageTitle = document.querySelector('.page-title');
                const pageSubtitle = document.querySelector('.page-subtitle');
                if (pageTitle) {
                    pageTitle.textContent = 'Reservations';
                }
                if (pageSubtitle) {
                    pageSubtitle.textContent = 'Manage and track all church service reservations.';
                }
                
                // Update breadcrumb
                const breadcrumbElement = document.getElementById('breadcrumb-current');
                if (breadcrumbElement) {
                    breadcrumbElement.textContent = 'Reservations';
                }
            });
            
            // Events link click handler
            document.getElementById('eventsLink').addEventListener('click', function(e) {
                e.preventDefault();
                
                // Update active navigation
                document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
                this.classList.add('active');
                
                // Hide dashboard and reservation modules
                document.getElementById('dashboardContent').style.display = 'none';
                const reservationModule = document.getElementById('reservationModule');
                if (reservationModule) {
                    reservationModule.style.display = 'none';
                }
                
                // Show events module (empty)
                const eventsModule = document.getElementById('eventsModule');
                if (eventsModule) {
                    eventsModule.style.display = 'block';
                    
                    // Update page title and subtitle
                    const pageTitle = document.querySelector('.page-title');
                    const pageSubtitle = document.querySelector('.page-subtitle');
                    if (pageTitle) {
                        pageTitle.textContent = 'Events';
                    }
                    if (pageSubtitle) {
                        pageSubtitle.textContent = 'Manage and view all church events and activities.';
                    }
                    
                    // Update breadcrumb
                    const breadcrumbElement = document.getElementById('breadcrumb-current');
                    if (breadcrumbElement) {
                        breadcrumbElement.textContent = 'Events';
                    }
                }
            });
            
            
            // Dashboard link click handler
            document.querySelector('[data-page="dashboard"]').addEventListener('click', function(e) {
                e.preventDefault();
                console.log('Dashboard link clicked!'); // Debug log
                
                // Update active navigation
                document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
                this.classList.add('active');
                
                // Show dashboard content
                document.getElementById('dashboardContent').style.display = 'block';
                console.log('Dashboard content shown!'); // Debug log
                
                // Hide reservation and events modules
                const reservationModule = document.getElementById('reservationModule');
                if (reservationModule) {
                    reservationModule.style.display = 'none';
                    console.log('Reservation module hidden!'); // Debug log
                }
                const eventsModule = document.getElementById('eventsModule');
                if (eventsModule) {
                    eventsModule.style.display = 'none';
                }
                
                // Reset page title with greeting
                const pageTitle = document.querySelector('.page-title');
                const pageSubtitle = document.querySelector('.page-subtitle');
                if (pageTitle) {
                    // Restore the dynamic greeting
                    updateGreeting();
                }
                if (pageSubtitle) {
                    pageSubtitle.textContent = 'Here\'s what\'s happening with your church operations today';
                }
                
                // Update breadcrumb
                const breadcrumbElement = document.getElementById('breadcrumb-current');
                if (breadcrumbElement) {
                    breadcrumbElement.textContent = 'Dashboard';
                }
            });

        // Initialize tabs function for both reservations and events
        function initializeTabs() {
            const tabButtons = document.querySelectorAll('.tab-btn');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Find the parent module to limit scope
                    const parentModule = this.closest('.module-content');
                    if (!parentModule) return;
                    
                    // Remove active class from tabs and panes within this module only
                    const moduleTabButtons = parentModule.querySelectorAll('.tab-btn');
                    const moduleTabPanes = parentModule.querySelectorAll('.tab-pane');
                    
                    moduleTabButtons.forEach(btn => btn.classList.remove('active'));
                    moduleTabPanes.forEach(pane => {
                        pane.classList.remove('active');
                        pane.style.display = 'none';
                    });
                    
                    // Add active class to clicked tab and corresponding pane
                    this.classList.add('active');
                    const targetPane = document.getElementById(targetTab);
                    if (targetPane) {
                        targetPane.classList.add('active');
                        targetPane.style.display = 'block';
                    }
                    
                    // If switching to add-reservation tab, refresh the calendar
                    if (targetTab === 'add-reservation' && calendarReservationSystem) {
                        setTimeout(() => {
                            calendarReservationSystem.calendar.render();
                        }, 100);
                    }
                });
            });
        }
        
        // Add a simple test function to verify navigation
        window.testNavigation = function() {
            console.log('Testing navigation...');
            console.log('Dashboard content:', document.getElementById('dashboardContent'));
            console.log('Reservation module:', document.getElementById('reservationModule'));
            console.log('Events module:', document.getElementById('eventsModule'));
        };
        
        // Force initial state to be correct
        setTimeout(() => {
            console.log('Setting initial navigation state...');
            document.getElementById('dashboardContent').style.display = 'block';
            document.getElementById('reservationModule').style.display = 'none';
            const eventsModule = document.getElementById('eventsModule');
            if (eventsModule) {
                eventsModule.style.display = 'none';
            }
        }, 100);
        
        // ============================================================================
        // FUNERAL 3-DAY SCHEDULE HANDLING
        // ============================================================================
        
        const funeralEndDate = document.getElementById('funeralEndDate');
        const funeralEndTime = document.getElementById('funeralEndTime');
        const funeralDurationDisplay = document.getElementById('funeralDurationDisplay');
        const funeralDurationDays = document.getElementById('funeralDurationDays');
        const funeralDateRange = document.getElementById('funeralDateRange');
        const reservationDate = document.getElementById('reservationDate');
        const reservationTime = document.getElementById('reservationTime');
        
        // Calculate duration when end date changes
        function calculateFuneralDuration() {
            const startDate = reservationDate.value; // Use selected date from calendar
            const endDate = funeralEndDate.value;
            
            if (startDate && endDate) {
                const start = new Date(startDate);
                const end = new Date(endDate);
                
                // Validate end date is after start date
                if (end < start) {
                    alert('End date must be after start date!');
                    funeralEndDate.value = '';
                    funeralDurationDisplay.style.display = 'none';
                    return;
                }
                
                // Calculate days difference
                const timeDiff = end.getTime() - start.getTime();
                const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24)) + 1; // +1 to include both start and end days
                
                // Update display
                funeralDurationDays.textContent = daysDiff;
                
                // Format date range
                const options = { month: 'short', day: 'numeric', year: 'numeric' };
                const startFormatted = start.toLocaleDateString('en-US', options);
                const endFormatted = end.toLocaleDateString('en-US', options);
                funeralDateRange.textContent = `${startFormatted} to ${endFormatted}`;
                
                // Show duration display
                funeralDurationDisplay.style.display = 'block';
                
                // Warn if not 3 days
                if (daysDiff !== 3) {
                    funeralDurationDisplay.style.borderColor = '#f59e0b';
                    funeralDurationDisplay.innerHTML = `
                        <p style="margin: 0; color: #92400e; font-weight: 600;">
                            <i class="fas fa-exclamation-triangle"></i> Duration: ${daysDiff} days
                        </p>
                        <p style="margin: 5px 0 0 0; color: #78350f; font-size: 13px;">
                            <i class="fas fa-info-circle"></i> ${startFormatted} to ${endFormatted}
                        </p>
                        <p style="margin: 5px 0 0 0; color: #92400e; font-size: 12px;">
                            <i class="fas fa-lightbulb"></i> Typical funeral services span 3 days
                        </p>
                    `;
                } else {
                    funeralDurationDisplay.style.borderColor = '#10b981';
                    funeralDurationDisplay.innerHTML = `
                        <p style="margin: 0; color: #065f46; font-weight: 600;">
                            <i class="fas fa-calendar-check"></i> Duration: ${daysDiff} days
                        </p>
                        <p style="margin: 5px 0 0 0; color: #047857; font-size: 13px;">
                            <i class="fas fa-info-circle"></i> ${startFormatted} to ${endFormatted}
                        </p>
                    `;
                }
            } else {
                funeralDurationDisplay.style.display = 'none';
            }
        }
        
        // Auto-suggest end date when reservation date is set (for funeral)
        if (reservationDate) {
            reservationDate.addEventListener('change', function() {
                // Only auto-suggest if funeral service is selected
                const serviceOptions = document.querySelectorAll('.service-option');
                let isFuneralSelected = false;
                serviceOptions.forEach(option => {
                    if (option.classList.contains('selected') && option.dataset.service === 'funeral') {
                        isFuneralSelected = true;
                    }
                });
                
                if (isFuneralSelected && this.value && !funeralEndDate.value) {
                    const start = new Date(this.value);
                    const suggestedEnd = new Date(start);
                    suggestedEnd.setDate(suggestedEnd.getDate() + 2); // +2 days = 3 days total
                    
                    // Format date for input
                    const year = suggestedEnd.getFullYear();
                    const month = String(suggestedEnd.getMonth() + 1).padStart(2, '0');
                    const day = String(suggestedEnd.getDate()).padStart(2, '0');
                    funeralEndDate.value = `${year}-${month}-${day}`;
                    
                    calculateFuneralDuration();
                }
            });
        }
        
        if (funeralEndDate) {
            funeralEndDate.addEventListener('change', calculateFuneralDuration);
        }
        
        }); // Close DOMContentLoaded event listener
        
    </script>


    <!-- Success Modal -->
    <div class="success-modal" id="successModal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content success-content">
            <div class="success-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="success-message">
                <h3>Reservation Created Successfully!</h3>
                <p id="successDetails">Your reservation has been submitted and is pending approval.</p>
                <div class="success-info">
                    <div class="info-item">
                        <span class="label">Reservation ID:</span>
                        <span class="value" id="reservationId">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Service:</span>
                        <span class="value" id="reservationService">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Date:</span>
                        <span class="value" id="reservationDate">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Time:</span>
                        <span class="value" id="reservationTime">-</span>
                    </div>
                </div>
            </div>
            <div class="success-actions">
                <button type="button" class="btn btn-primary" onclick="closeSuccessModal()">
                    <i class="fas fa-calendar"></i> Back to Calendar
                </button>
            </div>
        </div>
    </div>

        </div> <!-- Close content-wrapper -->
    </main> <!-- Close main-content -->

    <!-- Custom Alert Modal System -->
    <div id="customAlertModal" class="custom-alert-modal" style="display: none;">
        <div class="custom-alert-overlay"></div>
        <div class="custom-alert-content">
            <div class="custom-alert-icon" id="customAlertIcon">
                <i class="fas fa-info-circle"></i>
            </div>
            <div class="custom-alert-body">
                <h3 id="customAlertTitle">Notification</h3>
                <p id="customAlertMessage">This is a message</p>
            </div>
            <div class="custom-alert-footer">
                <button class="custom-alert-btn" id="customAlertBtn">OK</button>
            </div>
        </div>
    </div>

    <!-- Custom Confirm Modal System -->
    <div id="customConfirmModal" class="custom-alert-modal" style="display: none;">
        <div class="custom-alert-overlay"></div>
        <div class="custom-alert-content">
            <div class="custom-alert-icon warning" id="customConfirmIcon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="custom-alert-body">
                <h3 id="customConfirmTitle">Confirm Action</h3>
                <p id="customConfirmMessage">Are you sure?</p>
            </div>
            <div class="custom-alert-footer">
                <button class="custom-alert-btn secondary" id="customConfirmCancelBtn">Cancel</button>
                <button class="custom-alert-btn" id="customConfirmOkBtn">Confirm</button>
            </div>
        </div>
    </div>

    <style>
        /* Custom Alert Modal Styles */
        .custom-alert-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease-out;
        }

        .custom-alert-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
        }

        .custom-alert-content {
            position: relative;
            background: white;
            border-radius: 16px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-out;
            overflow: hidden;
        }

        .custom-alert-icon {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            padding: 32px;
            text-align: center;
        }

        .custom-alert-icon i {
            font-size: 48px;
            color: white;
        }

        .custom-alert-icon.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .custom-alert-icon.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .custom-alert-icon.warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .custom-alert-body {
            padding: 28px 32px;
            text-align: center;
        }

        .custom-alert-body h3 {
            margin: 0 0 12px 0;
            font-size: 22px;
            font-weight: 700;
            color: #1f2937;
        }

        .custom-alert-body p {
            margin: 0;
            font-size: 15px;
            color: #6b7280;
            line-height: 1.6;
        }

        .custom-alert-footer {
            padding: 20px 32px 28px 32px;
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .custom-alert-btn {
            padding: 12px 32px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .custom-alert-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
        }

        .custom-alert-btn.secondary {
            background: #e5e7eb;
            color: #374151;
            box-shadow: none;
        }

        .custom-alert-btn.secondary:hover {
            background: #d1d5db;
            box-shadow: none;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>

    <script>
        // Custom Alert System
        function showCustomAlert(message, title = 'Notification', type = 'info') {
            const modal = document.getElementById('customAlertModal');
            const icon = document.getElementById('customAlertIcon');
            const titleEl = document.getElementById('customAlertTitle');
            const messageEl = document.getElementById('customAlertMessage');
            const btn = document.getElementById('customAlertBtn');

            // Set icon based on type
            icon.className = 'custom-alert-icon ' + type;
            let iconClass = 'fa-info-circle';
            if (type === 'success') iconClass = 'fa-check-circle';
            else if (type === 'error') iconClass = 'fa-times-circle';
            else if (type === 'warning') iconClass = 'fa-exclamation-triangle';
            
            icon.querySelector('i').className = 'fas ' + iconClass;

            // Set content
            titleEl.textContent = title;
            messageEl.textContent = message;

            // Show modal
            modal.style.display = 'flex';

            // Close on button click
            btn.onclick = () => {
                modal.style.display = 'none';
            };

            // Close on overlay click
            modal.querySelector('.custom-alert-overlay').onclick = () => {
                modal.style.display = 'none';
            };
        }

        // Custom Confirm Dialog
        function showCustomConfirm(message, title = 'Confirm Action', onConfirm, onCancel) {
            const modal = document.getElementById('customConfirmModal');
            const titleEl = document.getElementById('customConfirmTitle');
            const messageEl = document.getElementById('customConfirmMessage');
            const okBtn = document.getElementById('customConfirmOkBtn');
            const cancelBtn = document.getElementById('customConfirmCancelBtn');

            // Set content
            titleEl.textContent = title;
            messageEl.textContent = message;

            // Show modal
            modal.style.display = 'flex';

            // Handle confirm
            okBtn.onclick = () => {
                modal.style.display = 'none';
                if (onConfirm) onConfirm();
            };

            // Handle cancel
            cancelBtn.onclick = () => {
                modal.style.display = 'none';
                if (onCancel) onCancel();
            };

            // Close on overlay click
            modal.querySelector('.custom-alert-overlay').onclick = () => {
                modal.style.display = 'none';
                if (onCancel) onCancel();
            };
        }

        // Override native alert (optional)
        window.customAlert = showCustomAlert;
        window.customConfirm = showCustomConfirm;
    </script>

    <script>
        // User Profile Dropdown Animation and Modal Functionality
        document.addEventListener('DOMContentLoaded', function() {
            const sidebarUserProfile = document.getElementById('sidebarUserProfile');
            const sidebarUserDropdown = document.getElementById('sidebarUserDropdown');
            const profileSettingsModal = document.getElementById('profileSettingsModal');
            const myProfileBtn = document.getElementById('myProfileBtn');
            const closeProfileModal = document.getElementById('closeProfileModal');
            const cancelProfileSettings = document.getElementById('cancelProfileSettings');
            
            // Helper function to show modal
            function showModal(modal) {
                if (modal) {
                    modal.style.display = 'flex';
                }
            }
            
            // Helper function to hide modal
            function hideModal(modal) {
                if (modal) {
                    modal.style.display = 'none';
                }
            }
            
            // Helper function to close all dropdowns
            function closeAllDropdowns() {
                if (sidebarUserDropdown) {
                    sidebarUserDropdown.style.display = 'none';
                }
                const dropdownArrow = document.getElementById('dropdownArrow');
                if (dropdownArrow) {
                    dropdownArrow.style.transform = 'rotate(0deg)';
                }
            }
            
            // Sidebar User Profile Dropdown
            if (sidebarUserProfile && sidebarUserDropdown) {
                const dropdownArrow = document.getElementById('dropdownArrow');
                
                sidebarUserProfile.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const isShowing = sidebarUserDropdown.style.display === 'block';
                    
                    if (!isShowing) {
                        sidebarUserDropdown.style.display = 'block';
                        // Rotate arrow down when dropdown is open
                        if (dropdownArrow) {
                            dropdownArrow.style.transform = 'rotate(180deg)';
                        }
                    } else {
                        sidebarUserDropdown.style.display = 'none';
                        // Rotate arrow back up when dropdown is closed
                        if (dropdownArrow) {
                            dropdownArrow.style.transform = 'rotate(0deg)';
                        }
                    }
                });
            }
            
            // My Profile Button Click
            if (myProfileBtn) {
                myProfileBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    closeAllDropdowns();
                    showModal(profileSettingsModal);
                    console.log('Profile settings modal opened');
                });
            }
            
            // Close Profile Modal
            if (closeProfileModal) {
                closeProfileModal.addEventListener('click', function() {
                    hideModal(profileSettingsModal);
                });
            }
            
            if (cancelProfileSettings) {
                cancelProfileSettings.addEventListener('click', function() {
                    hideModal(profileSettingsModal);
                });
            }
            
            // Close modal when clicking outside
            if (profileSettingsModal) {
                profileSettingsModal.addEventListener('click', function(e) {
                    if (e.target === profileSettingsModal) {
                        hideModal(profileSettingsModal);
                    }
                });
            }
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.user-dropdown') && !e.target.closest('#sidebarUserProfile')) {
                    closeAllDropdowns();
                }
            });
        });
    </script>

</body>
</html>